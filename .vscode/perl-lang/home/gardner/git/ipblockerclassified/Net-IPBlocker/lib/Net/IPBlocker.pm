{"vars":[{"name":"Net::IPBlocker","kind":2,"definition":1,"line":0},{"kind":2,"containerName":"","line":3,"name":"strict"},{"name":"warnings","line":4,"containerName":"","kind":2},{"kind":2,"line":5,"containerName":"","name":"POSIX"},{"kind":2,"line":6,"containerName":"","name":"DateTime"},{"containerName":"File","line":7,"kind":2,"name":"Basename"},{"name":"Util","kind":2,"containerName":"List","line":8},{"kind":2,"containerName":"Time","line":9,"name":"HiRes"},{"kind":2,"containerName":"Config","line":10,"name":"File"},{"name":"Carp","kind":2,"containerName":"","line":11},{"name":"Any","kind":2,"line":12,"containerName":"Log"},{"name":"Dumper","containerName":"Data","line":13,"kind":2},{"kind":2,"line":14,"containerName":"Regexp","name":"IPv6"},{"name":"Simple","line":15,"containerName":"LockFile","kind":2},{"name":"Path","kind":2,"line":16,"containerName":"File"},{"containerName":"","line":17,"kind":2,"name":"lib"},{"name":"threads","line":21,"containerName":"","kind":2},{"containerName":"Thread","line":23,"kind":2,"name":"Queue"},{"kind":13,"name":"$LoggerTIDS","line":24,"containerName":null,"localvar":"my","definition":"my"},{"kind":13,"name":"$IptablesQueue","definition":"my","localvar":"my","line":27,"containerName":null},{"name":"Thread","kind":12,"line":27,"containerName":"Queue"},{"name":"new","kind":12,"line":27,"containerName":"Net::IPBlocker"},{"localvar":"my","containerName":null,"line":28,"definition":"my","kind":13,"name":"$IptablesTIDS"},{"name":"$Data","line":31,"containerName":null,"kind":13},{"kind":12,"containerName":"Sortkeys","line":31,"name":"Dumper"},{"name":"$Data","line":32,"containerName":null,"kind":13},{"name":"Dumper","kind":12,"line":32,"containerName":"Indent"},{"kind":13,"name":"$logger","line":39,"containerName":null,"localvar":"my","definition":"my"},{"localvar":"my","line":41,"containerName":null,"definition":"my","name":"$lock_obj","kind":13},{"name":"$REGEX_IPV4","kind":13,"containerName":null,"line":46,"localvar":"my","definition":"my"},{"kind":13,"name":"$REGEX_IPV6","definition":"my","containerName":null,"line":47,"localvar":"my"},{"kind":13,"name":"$IPTABLESRUNLINE","localvar":"my","containerName":null,"line":48,"definition":"my"},{"kind":13,"definition":"our","line":52,"containerName":"Net::IPBlocker","name":"%tracker"},{"name":"%DEFAULTS","kind":13,"definition":"my","line":54,"containerName":null,"localvar":"my"},{"name":"allowdeny","kind":12,"line":55},{"kind":12,"line":56,"name":"allowlist"},{"kind":12,"line":57,"name":"configsfile"},{"line":62,"kind":12,"name":"dumpconfigsandexit"},{"name":"denylist","line":63,"kind":12},{"kind":12,"line":64,"name":"forceremovelockfile"},{"name":"globalallowlist","line":65,"kind":12},{"line":66,"kind":12,"name":"chainprefix"},{"name":"globalchains","kind":12,"line":67},{"name":"globaldenylist","line":68,"kind":12},{"kind":12,"line":69,"name":"globalregexallowlist"},{"kind":12,"line":70,"name":"globalregexdenylist"},{"line":71,"kind":12,"name":"ignoreinterfaceips"},{"line":72,"kind":12,"name":"iptables"},{"name":"lockfile","kind":12,"line":73},{"line":74,"kind":12,"name":"logcontents"},{"kind":12,"line":76,"name":"logs_to_review"},{"name":"prodmode","line":77,"kind":12},{"kind":12,"line":78,"name":"queuechecktime"},{"line":79,"kind":12,"name":"queuecycles"},{"name":"LONG_MAX","kind":12,"line":79},{"kind":12,"line":80,"name":"readentirefile"},{"name":"totalruntime","kind":12,"line":81},{"name":"LONG_MAX","line":81,"kind":12},{"name":"$VERSION","kind":13,"definition":"our","containerName":"Net::IPBlocker","line":96},{"detail":"()","range":{"start":{"line":355,"character":0},"end":{"line":398,"character":9999}},"definition":"sub","containerName":"Net::IPBlocker","line":355,"name":"new","children":[{"kind":13,"name":"$class","definition":"my","localvar":"my","line":356,"containerName":"new"},{"kind":13,"name":"$args","definition":"my","containerName":"new","line":357,"localvar":"my"},{"line":359,"containerName":"new","kind":13,"name":"$args"},{"name":"$args","line":361,"containerName":"new","kind":13},{"name":"$args","kind":13,"containerName":"new","line":363},{"definition":"my","localvar":"my","line":368,"containerName":"new","kind":13,"name":"$configsfile"},{"name":"$args","kind":13,"containerName":"new","line":368},{"name":"$DEFAULTS","kind":13,"line":368,"containerName":"new"},{"containerName":"new","line":370,"localvar":"my","definition":"my","name":"$self","kind":13},{"name":"$configsfile","kind":13,"line":371,"containerName":"new"},{"kind":13,"line":372,"containerName":"new","name":"$args"},{"kind":13,"containerName":"new","line":376,"name":"$self"},{"line":376,"containerName":"new","kind":13,"name":"$class"},{"containerName":"new","line":380,"kind":13,"name":"$self"},{"name":"load_configs","line":380,"containerName":"new","kind":12},{"name":"$self","containerName":"new","line":382,"kind":13},{"name":"$self","containerName":"new","line":384,"kind":13},{"name":"$self","containerName":"new","line":385,"kind":13},{"name":"$self","kind":13,"containerName":"new","line":386},{"name":"$self","line":388,"containerName":"new","kind":13},{"name":"$logger","containerName":"new","line":393,"kind":13},{"name":"$log","kind":13,"containerName":"new","line":393},{"name":"$logger","kind":13,"containerName":"new","line":394},{"kind":12,"containerName":"new","line":394,"name":"info"},{"kind":13,"containerName":"new","line":395,"name":"$logger"},{"containerName":"new","line":395,"kind":12,"name":"debug"},{"name":"$self","kind":13,"line":395,"containerName":"new"},{"name":"$logger","line":395,"containerName":"new","kind":13},{"name":"is_debug","containerName":"new","line":395,"kind":12},{"name":"$self","kind":13,"containerName":"new","line":397}],"kind":12,"signature":{"documentation":"1; # End of Net::IPBlocker\npackage Net::IPBlocker;\n\nuse 5.8.0;\nuse strict;\nuse warnings;\nuse POSIX qw(LONG_MAX);\nuse DateTime;\nuse File::Basename;\nuse List::Util qw(any);\nuse Time::HiRes qw(usleep gettimeofday time);\nuse Config::File;\nuse Carp;\nuse Log::Any qw($log);  # Allegedly handles lots of different logging modules\nuse Data::Dumper;\nuse Regexp::IPv6     qw($IPv6_re);\nuse LockFile::Simple qw(lock trylock unlock);\nuse File::Path       qw(make_path);\nuse lib;\n# use Net::Ifconfig::Wrapper;  # Not yet implemented\n\n# Thread setup\nuse threads;\n# use threads::shared;\nuse Thread::Queue;\nmy $LoggerTIDS = ();                     # Thread IDs for tracking or whatever\n\n# Another queue for iptables commands\nmy $IptablesQueue = Thread::Queue->new();\nmy $IptablesTIDS  = ();                     # Thread IDs for tracking or whatever\n\n# Data Dumper setup\n$Data::Dumper::Sortkeys = 1;\n$Data::Dumper::Indent   = 1;\n\n### Global Variables  (clearly the threading stuff is global, duh)\n## I hate global variables!\n# logger --- I really debated whether to make this global or not.  I decided to make it global because it is used\n#   in the signal interupts and those use prototyped subs.  I don't know how (if possible) to pass $self to the\n#   signal interupt subs with so much threaded.\nmy $logger;     # This gets set in new() but is just set to $log from Log::Any\n                # I wrote all this for Log::Log4perl and then realized Log::Any is the better path.\nmy $lock_obj;    # This is the lock object and is set in set_lockFile()\n                 # Needs to be global because it is used in the signal interupts and those use prototyped subs.\n## Regex for IPv4 and IPv6 capturing.\n#   This is critical and needs be consistent across the entire module\n# my $REGEX_IPV4 = q/.*\\b((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\\b.*/;\nmy $REGEX_IPV4 = q/\\b((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\\b/;\nmy $REGEX_IPV6      = q/\\b($IPv6_re)\\b/;\nmy $IPTABLESRUNLINE = 0;    #This is just an odd one.  It is used to track the line number of the sub iptables_thread()\n                            #  where run_iptables() is called.  This is used in the signal interupts to print out the\n                            #  line number of where the iptables command was run.  This is used for debugging.\n                            #  This is set in the iptables_thread() sub.\nour $tracker = {};          # Mostly chains added and rules added are stuffed in here for tracking purposes\n                            # There has got to be a better way but for now it is just a global hash reference.\nmy $DEFAULTS = {\n    allowdeny            => 'Allow,Deny',\n    allowlist            => {},\n    configsfile          => '/etc/ipblocker/ipblocker.conf',\n    # cycles               => LONG_MAX,  # How long to run.  This is irrespective of any other cycle or queue cycle.\n    #                                    # Nice for testing or maybe you want to run this for a certain amount of time and \n    #                                    # and restart it out of cron or something.\n    # cyclesleep           => 0.5,\n    dumpconfigsandexit   => 0,\n    denylist             => {},\n    forceremovelockfile  => 0,\n    globalallowlist      => {},\n    chainprefix          => \"IPBLOCKER_\",\n    globalchains         => [qw / INPUT OUTPUT FORWARD /],\n    globaldenylist       => {},\n    globalregexallowlist => {},\n    globalregexdenylist  => {},\n    ignoreinterfaceips   => 1,                                   #This adds the IPs from the interfaces to the allowlist\n    iptables             => '/sbin/iptables',\n    lockfile             => '/var/run/ipblocker.run.default',\n    logcontents          => {},\n    # loglevel             => 'INFO',\n    logs_to_review       => {},\n    prodmode             => 0,\n    queuechecktime       => 1,\n    queuecycles          => LONG_MAX,\n    readentirefile       => 0,\n    totalruntime         => LONG_MAX,  # How long to run in seconds.  This is irrespective of any other cycle or queue \n                                    # cycle.  Nice for testing or maybe you want to run this for a certain amount of \n                                    # time and restart it out of cron or something.\n};\n\n=head1 NAME\n\nNet::IPBlocker - Blocks IPs based on regex from specified log files\n\n=head1 VERSION\n\nVersion 0.01\n\n\nour $VERSION = '0.01';\n\n\n=head1 SYNOPSIS\n\nBlocks IPs based on Regular Expressions in specified log files.\n\n use Net::IPBlocker;\n my $foo = Net::IPBlocker->new();\n $foo->go(); \n\nYou can send all configs into the constructor as a hash, I really advise using a config file.  \nThe default config file is F</etc/ipblocker/ipblocker.conf> but you can set it to another file.\nIf a config file is not found, it will use default values for everything and that will probably not work very well.\n\n my $foo = Net::IPBlocker->new( { configsfile => '/etc/ipblocker/ipblocker.conf' } );\n $foo->go();\n\n=head2 Future Enhancements\n\n=over 4\n\n* * Add reload ability of configs\n\nThis will make it so a full stop and restart does not need to happen to reload configs.\n\n* * Add jail time for IPs\n\nThis involves adding a database to store the IPs and the time they were blocked.\nThis also means adding a mechanism to unblock IPs after a certain amount of time.\nLuckily, I have threaded this so adding that is just a matter of adding another thread.\nI am open to ideas of what database to use.  I am thinking SQLite.\nOr, possibly just a file with the IPs (the rule) and the time they are to be unblocked (deleted \nfrom iptables).\n\n* * Add synchronized appender logging:\n      \nhttps://metacpan.org/dist/Log-Log4perl/view/lib/Log/Log4perl/Appender/Synchronized.pm\n\n* * Fix the ability for Log4perl to re-read the \"log4perl.conf\" which seems to not work right now\n\n* * Change from using log4perl to Log::Any\n\nI didn't know about Log::Any when I started this.  I am open to changing this to Log::Any but I need to \nfigure out how to do that.\n\n* * my $interfaces = Net::Ifconfig::Wrapper::Ifconfig('list', '', '', '');\n\nThis is a list of interfaces.  Need to figure out how to use this to get the IP address of the\ninterfaces.  Need to add those IPs to the global allow list.\n\n* * Fix sub add_ifconfig_ips_to_allowlist() to handle IPv4 and IPv6 addresses\n\nThis really findes the IPs on a network interface and adds them to the global allow list.\nUsually,we don't want to accidentally block our own IPs.\nOf course, this will mean adding an option to the configs file to turn this on or off.\n\n\n=head2 DESCRIPTION\n\nThis has been a very long running project of mine.  I have been using this script for years to block IPs and then \nrealized Fail2Ban exists.  I have tried to use Fail2Ban multiple times but it never seems to work right for me.\nIt seems to lock-up. \nThis module tries to incorporate the ideas of my past experience with the general idea of Fail2Ban.\n\nI highly encourage you to use a config file.  The default config file is in the same location as this module but you \ncan set it to another file.\n\nWhen installing this, you should also receive a script called \"ipBlocker.pl\".  This is a sample script that uses \nthis module.\n\nFinally, for now, this module use log4perl.  I didn't realize there was a heated debate about log4perl vs Log::Any vs \nwhatever else.  I am open to changing this to Log::Any but I need to figure out how to do that.\n\n=head1 SUBROUTINES/METHODS\n\n=head2 new\n\nReads configs form a file if exists otherwise uses defaults.\nSets up a class and returns a blessed \"object\".\nThe sub go() is where the action starts.\nThe sub new() just gets a few things setup.\n\nExample:\n\n  use IPblocker;\n\n  my $args = {\n    configsfile         => '/etc/ipblocker/ipblocker.conf',\n    dumpconfigsandexit  => '0', # True false value\n    forceremovelockfile => '0', # True false value\n    iptables            => 'sudo /sbin/iptables',\n    lockfile            => '/var/run/ipblocker.run',\n    log4perlconf        => '/etc/ipblocker/log4perl.conf',  #Can also be 0 to use default log4perl\n    loglevel            => 'DEBUG', # Can be TRACE DEBUG INFO WARN ERROR FATAL\n    prodmode            => '0', # True false value --- Determins if the iptables commands are actually run\n    queuechecktime      => '3', # How long to wait when the queue is empty before checking again. Any float value.\n    readentirefile      => '0', # True false value --- Determines if the entire log file is read or\n                                # new entries since last run are read.\n    cycles              => 'LONG_MAX', # How many times to run the main loop.  LONG_MAX is the default.\n    ### All configs can be set via a hash reference\n  };\n\n  my $ipb    = IPblocker->new($args);\n\n=head3 All arguments to new() and the defaults\n\n=head4 allowdeny\n\nallowdeny            => 'Allow,Deny',\n\nSet to 'Allow,Deny' or 'Deny,Allow' to determine the order of the allow and deny lists.\nSeteting to 'Allow,Deny' means the allow list is processed first and then the deny list is processed.\nMeaning, as an example, if 1.1.1.1 is on the allow list and allowdeny is set to Allow,Deny, then\nthe IP of 1.1.1.1 will never be blocked.  If allowdeny is set to Deny,Allow, then it is possible \nfor 1.1.1.1 to be blocked.\n\n=head4 allowlist\n\nallowlist            => {},\n\nA list of IPs to allow.  This is a hash reference.  The key is the order to allow the IP.  The value is the IP.\nExample:\n\n allowlist => (\n  '01' => '1.1.1.1',\n  '4' => '1.1.1.4',\n  '10' => '1.1.1.2',\n  '100' => '1.1.1.3',\n  \n )\n\nThe allow list is sorted in standard Perl sort order.  So, be sure to pad 0's or whatever to the front of the key.\n\n=head4 configsfile\n\nconfigsfile          => '/etc/ipblocker/ipblocker.conf',\n\nUse a config file!  This is the default config file location.  You can set it to another file.\n\n=head4 cycles\n\ncycles               => LONG_MAX,\n\nHow many times to run the main loop.  LONG_MAX is the default.  Why not infinity?  Because I don't want to.\n\n=head4 cyclesleep\n\ncyclesleep           => 0.5,\n\nHow long to sleep between cycles.  This is in seconds.  Default is 0.5 seconds.  You can use a float value.\n\n=head4 dumpconfigsandexit\n\ndumpconfigsandexit   => 0,\n\nIf set to 1 (true), then the configs are dumped to stdout and the script exits.  This is useful for creating a \nconfig file.\n\n=head4 denylist\n\ndenylist             => {},\n\nSimilar to allow list but for IPs to deny.  This is a hash reference.  The key is the order to deny the IP.\n\n=head4 forceremovelockfile\n\nforceremovelockfile  => 0,\n\nThis will force removal of lock file (if possible) before starting.  Seriously, you better know what you are doing.\n\n=head4 chainprefix\n\nchainprefix          => \"IPBLOCKER_\",\n\nThis is the prefix for the chains created in iptables.  This is the prefix you will see in iptables for \nall the chains created by this module.\n\n=head4 globalchains\n\nglobalchains         => [qw / INPUT OUTPUT FORWARD /],\n\nThis is a list of the global chains to add the global chain to.\nThe global chain is where all the subordinate file logger chains are added.\n\nI see some value in adding the global chain to some other chain but by default we add it to INPUT, OUTPUT, and FORWARD.\nOr, possibly, you don't want to add to the FORWARD chain.\nMaybe you onkly care about INPUT table.  I don't know.  Whatever works best for you.\n\n=head4 iptables\n\niptables             => '/sbin/iptables',\n\nThis is the iptables command to use.  You can use sudo or whatever you want.\nI really encourage using sudo but by default it is not used.  \nUsing sudo and non-root user is a bit more work.  You need to setup sudoers to allow the user to run iptables.\nHowever, I think it is worth it for an added measure of security.\nIf you change this to use sudo, then you may also need to change the lockfile location to a location that the user \ncan write to.\n\n=head4 lockfile\n\nlockfile             => '/var/run/ipblocker.run.default',\n\nThis is the lock file location to use to try to prevent multiple instances from running.\n\n=head4 log4perlconf\n\nlog4perlconf         => '/etc/ipblocker/log4perl.conf',\n\nThis is the log4perl configuration file to use.  You can also set this to 0 to use the default log4perl configuration.\n\n=head4 loglevel\n\nloglevel             => 'INFO'\n\nTHis can be TRACE DEBUG INFO WARN ERROR FATAL.\n\n=head4 prodmode\n\nprodmode          => 0,\n\nThis is a true/false value.  If set to 1 (true), then the iptables commands are actually run.  If set to 0 (false), \nthen the iptables commands are not run.  This is useful for testing.\n\nBy default, this is set to 0 (false).\n\n=head4 queuechecktime\n\nqueuechecktime    => 1,\n\nWhen the queue is empty, how long to wait before checking again.  When the queue is not empty, this value is ignored\n\n=head4 queuecycles\n\nqueuecycles       => LONG_MAX,\n\nHow many times to check the queue.  LONG_MAX is the default.  Why not infinity?  Because I don't want to.\n\n=head4 readentirefile\n\nreadentirefile    => 0,\n\nThis is a true/false value.  If set to 1 (true), then the entire log file is read.  If set to 0 (false), then only\nnew entries since the last run are read.\nThis can aslo be set per log file in the configs file.\n\n=head4 totalruntime\n\ntotalruntime      => LONG_MAX,\n\nHow long to run in seconds.  This is irrespective of any other cycle or queue cycle.  Nice for testing or maybe you\nwant to run this for a certain amount of time and restart it out of cron or something.\n\n Description:  Creates a new class/object\n Returns:      A blessed reference \"object\"","label":"new()","parameters":[]}},{"kind":12,"line":360,"name":"carp"},{"name":"croak","line":364,"kind":12},{"name":"configsfile","kind":12,"line":368},{"kind":12,"line":368,"name":"configsfile"},{"line":371,"kind":12,"name":"configsfile"},{"kind":12,"line":372,"name":"clargs"},{"line":382,"kind":12,"name":"configs"},{"name":"dumpconfigsandexit","kind":12,"line":382},{"name":"configs","kind":12,"line":384},{"line":384,"kind":12,"name":"configsfile"},{"name":"configs","kind":12,"line":385},{"name":"globalchain","kind":12,"line":385},{"line":386,"kind":12,"name":"configs"},{"kind":12,"line":386,"name":"dumpconfigsandexit"},{"line":388,"kind":12,"name":"recursiveHashPrint"},{"kind":12,"line":388,"name":"configs"},{"line":395,"kind":12,"name":"Dumper"},{"detail":"($ref,$prefix)","range":{"start":{"character":0,"line":402},"end":{"character":9999,"line":413}},"definition":"sub","line":402,"containerName":"Net::IPBlocker","name":"recursiveHashPrint","children":[{"definition":"my","localvar":"my","line":403,"containerName":"recursiveHashPrint","kind":13,"name":"$ref"},{"line":403,"containerName":"recursiveHashPrint","kind":13,"name":"$prefix"},{"name":"$prefix","containerName":"recursiveHashPrint","line":404,"kind":13},{"name":"$prefix","containerName":"recursiveHashPrint","line":404,"kind":13},{"name":"$ref","kind":13,"containerName":"recursiveHashPrint","line":406},{"kind":13,"name":"$key","definition":"my","containerName":"recursiveHashPrint","line":407,"localvar":"my"},{"line":407,"containerName":"recursiveHashPrint","kind":13,"name":"$ref"},{"kind":13,"name":"$new_prefix","definition":"my","line":410,"containerName":"recursiveHashPrint","localvar":"my"},{"name":"$prefix","kind":13,"line":410,"containerName":"recursiveHashPrint"},{"name":"$ref","kind":13,"line":411,"containerName":"recursiveHashPrint"},{"name":"$key","kind":13,"containerName":"recursiveHashPrint","line":411},{"name":"$new_prefix","line":411,"containerName":"recursiveHashPrint","kind":13}],"kind":12,"signature":{"documentation":" Description:  Recursively prints the configs in teh format of a config file\n Returns:      Nothing","label":"recursiveHashPrint($ref,$prefix)","parameters":[{"label":"$ref"},{"label":"$prefix"}]}},{"name":"%ref","kind":13,"line":414,"containerName":null},{"kind":13,"name":"$line","localvar":"my","line":417,"containerName":null,"definition":"my"},{"containerName":null,"line":417,"kind":13,"name":"$ref"},{"name":"$line","kind":13,"line":418,"containerName":null},{"kind":13,"containerName":null,"line":419,"name":"$line"},{"name":"%line","line":420,"containerName":null,"kind":13},{"definition":"my","localvar":"my","containerName":null,"line":424,"name":"$line","kind":13},{"name":"$line","containerName":null,"line":425,"kind":13},{"name":"$line","line":426,"containerName":null,"kind":13},{"name":"$line","containerName":null,"line":427,"kind":13},{"name":"go","children":[{"kind":13,"name":"$self","containerName":"go","line":447,"localvar":"my","definition":"my"},{"kind":13,"name":"$start_time","definition":"my","localvar":"my","line":448,"containerName":"go"},{"definition":"my","localvar":"my","line":449,"containerName":"go","kind":13,"name":"$TID"},{"name":"tid","containerName":"go","line":449,"kind":12},{"name":"$TID","containerName":"go","line":450,"kind":13},{"name":"$TID","kind":13,"containerName":"go","line":450},{"name":"$self","line":453,"containerName":"go","kind":13},{"name":"$logger","containerName":"go","line":454,"kind":13},{"name":"error","line":454,"containerName":"go","kind":12},{"containerName":"go","line":459,"kind":13,"name":"$self"},{"line":459,"containerName":"go","kind":12,"name":"set_iptables_command"},{"containerName":"go","line":459,"kind":13,"name":"$logger"},{"name":"error","line":459,"containerName":"go","kind":12},{"kind":13,"line":460,"containerName":"go","name":"$self"},{"name":"set_signal_handler","kind":12,"containerName":"go","line":460},{"name":"$self","containerName":"go","line":461,"kind":13},{"kind":13,"line":461,"containerName":"go","name":"$self"},{"line":462,"containerName":"go","kind":13,"name":"$self"},{"kind":12,"line":462,"containerName":"go","name":"set_lockFile"},{"name":"$logger","line":462,"containerName":"go","kind":13},{"name":"logdie","containerName":"go","line":462,"kind":12},{"kind":13,"name":"$iptables_thr","containerName":"go","line":467,"localvar":"my","definition":"my"},{"name":"create","containerName":"go","line":467,"kind":12},{"name":"$self","containerName":"go","line":467,"kind":13},{"name":"$self","kind":13,"containerName":"go","line":470},{"line":470,"containerName":"go","kind":12,"name":"add_global_chain"},{"name":"$self","kind":13,"containerName":"go","line":473},{"kind":12,"line":473,"containerName":"go","name":"add_global_allow_deny_ips"},{"name":"$logger","line":476,"containerName":"go","kind":13},{"name":"logdie","kind":12,"containerName":"go","line":476},{"line":476,"containerName":"go","kind":13,"name":"$self"},{"line":476,"containerName":"go","kind":12,"name":"logger_thread"},{"kind":13,"name":"$totalruntime","definition":"my","containerName":"go","line":478,"localvar":"my"},{"line":478,"containerName":"go","kind":13,"name":"$self"},{"containerName":"go","line":479,"localvar":"my","definition":"my","kind":13,"name":"$timeleft"},{"kind":13,"containerName":"go","line":479,"name":"$totalruntime"},{"name":"$timeleft","containerName":"go","line":480,"kind":13},{"containerName":"go","line":481,"kind":13,"name":"$timeleft"},{"localvar":"my","line":483,"containerName":"go","definition":"my","name":"$logmsg","kind":13},{"kind":13,"containerName":"go","line":484,"name":"$logmsg"},{"line":484,"containerName":"go","kind":13,"name":"$start_time"},{"name":"$logger","containerName":"go","line":485,"kind":13},{"containerName":"go","line":485,"kind":12,"name":"debug"},{"name":"$logmsg","kind":13,"line":485,"containerName":"go"},{"localvar":"my","containerName":"go","line":486,"definition":"my","kind":13,"name":"$queuestate"},{"name":"$IptablesQueue","kind":13,"containerName":"go","line":486},{"containerName":"go","line":486,"kind":12,"name":"pending"},{"definition":"my","localvar":"my","containerName":"go","line":487,"kind":13,"name":"$iptablesQueue_pending"},{"name":"$IptablesQueue","kind":13,"line":487,"containerName":"go"},{"name":"pending","containerName":"go","line":487,"kind":12},{"name":"$iptablesQueue_pending","kind":13,"line":488,"containerName":"go"},{"name":"$logmsg","kind":13,"line":489,"containerName":"go","localvar":"my","definition":"my"},{"name":"$logmsg","line":490,"containerName":"go","kind":13},{"kind":13,"containerName":"go","line":491,"name":"$logger"},{"line":491,"containerName":"go","kind":12,"name":"info"},{"kind":13,"line":491,"containerName":"go","name":"$logmsg"},{"kind":13,"name":"$runtime","definition":"my","line":496,"containerName":"go","localvar":"my"},{"name":"$start_time","kind":13,"line":496,"containerName":"go"},{"kind":13,"line":497,"containerName":"go","name":"$runtime"},{"kind":13,"line":497,"containerName":"go","name":"$runtime"},{"line":498,"containerName":"go","kind":13,"name":"$logger"},{"line":498,"containerName":"go","kind":12,"name":"info"},{"kind":13,"containerName":"go","line":499,"name":"$logger"},{"kind":12,"containerName":"go","line":499,"name":"info"},{"kind":13,"name":"$args","containerName":"go","line":500,"localvar":"my","definition":"my"},{"name":"$tracker","line":501,"containerName":"go","kind":13},{"kind":13,"line":503,"containerName":"go","name":"$self"},{"name":"stop","kind":12,"containerName":"go","line":503},{"name":"$args","kind":13,"line":503,"containerName":"go"},{"name":"$logger","kind":13,"line":504,"containerName":"go"},{"name":"error","line":504,"containerName":"go","kind":12}],"kind":12,"signature":{"documentation":"1; # End of Net::IPBlocker\npackage Net::IPBlocker;\n\nuse 5.8.0;\nuse strict;\nuse warnings;\nuse POSIX qw(LONG_MAX);\nuse DateTime;\nuse File::Basename;\nuse List::Util qw(any);\nuse Time::HiRes qw(usleep gettimeofday time);\nuse Config::File;\nuse Carp;\nuse Log::Any qw($log);  # Allegedly handles lots of different logging modules\nuse Data::Dumper;\nuse Regexp::IPv6     qw($IPv6_re);\nuse LockFile::Simple qw(lock trylock unlock);\nuse File::Path       qw(make_path);\nuse lib;\n# use Net::Ifconfig::Wrapper;  # Not yet implemented\n\n# Thread setup\nuse threads;\n# use threads::shared;\nuse Thread::Queue;\nmy $LoggerTIDS = ();                     # Thread IDs for tracking or whatever\n\n# Another queue for iptables commands\nmy $IptablesQueue = Thread::Queue->new();\nmy $IptablesTIDS  = ();                     # Thread IDs for tracking or whatever\n\n# Data Dumper setup\n$Data::Dumper::Sortkeys = 1;\n$Data::Dumper::Indent   = 1;\n\n### Global Variables  (clearly the threading stuff is global, duh)\n## I hate global variables!\n# logger --- I really debated whether to make this global or not.  I decided to make it global because it is used\n#   in the signal interupts and those use prototyped subs.  I don't know how (if possible) to pass $self to the\n#   signal interupt subs with so much threaded.\nmy $logger;     # This gets set in new() but is just set to $log from Log::Any\n                # I wrote all this for Log::Log4perl and then realized Log::Any is the better path.\nmy $lock_obj;    # This is the lock object and is set in set_lockFile()\n                 # Needs to be global because it is used in the signal interupts and those use prototyped subs.\n## Regex for IPv4 and IPv6 capturing.\n#   This is critical and needs be consistent across the entire module\n# my $REGEX_IPV4 = q/.*\\b((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\\b.*/;\nmy $REGEX_IPV4 = q/\\b((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\\b/;\nmy $REGEX_IPV6      = q/\\b($IPv6_re)\\b/;\nmy $IPTABLESRUNLINE = 0;    #This is just an odd one.  It is used to track the line number of the sub iptables_thread()\n                            #  where run_iptables() is called.  This is used in the signal interupts to print out the\n                            #  line number of where the iptables command was run.  This is used for debugging.\n                            #  This is set in the iptables_thread() sub.\nour $tracker = {};          # Mostly chains added and rules added are stuffed in here for tracking purposes\n                            # There has got to be a better way but for now it is just a global hash reference.\nmy $DEFAULTS = {\n    allowdeny            => 'Allow,Deny',\n    allowlist            => {},\n    configsfile          => '/etc/ipblocker/ipblocker.conf',\n    # cycles               => LONG_MAX,  # How long to run.  This is irrespective of any other cycle or queue cycle.\n    #                                    # Nice for testing or maybe you want to run this for a certain amount of time and \n    #                                    # and restart it out of cron or something.\n    # cyclesleep           => 0.5,\n    dumpconfigsandexit   => 0,\n    denylist             => {},\n    forceremovelockfile  => 0,\n    globalallowlist      => {},\n    chainprefix          => \"IPBLOCKER_\",\n    globalchains         => [qw / INPUT OUTPUT FORWARD /],\n    globaldenylist       => {},\n    globalregexallowlist => {},\n    globalregexdenylist  => {},\n    ignoreinterfaceips   => 1,                                   #This adds the IPs from the interfaces to the allowlist\n    iptables             => '/sbin/iptables',\n    lockfile             => '/var/run/ipblocker.run.default',\n    logcontents          => {},\n    # loglevel             => 'INFO',\n    logs_to_review       => {},\n    prodmode             => 0,\n    queuechecktime       => 1,\n    queuecycles          => LONG_MAX,\n    readentirefile       => 0,\n    totalruntime         => LONG_MAX,  # How long to run in seconds.  This is irrespective of any other cycle or queue \n                                    # cycle.  Nice for testing or maybe you want to run this for a certain amount of \n                                    # time and restart it out of cron or something.\n};\n\n=head1 NAME\n\nNet::IPBlocker - Blocks IPs based on regex from specified log files\n\n=head1 VERSION\n\nVersion 0.01\n\n\nour $VERSION = '0.01';\n\n\n=head1 SYNOPSIS\n\nBlocks IPs based on Regular Expressions in specified log files.\n\n use Net::IPBlocker;\n my $foo = Net::IPBlocker->new();\n $foo->go(); \n\nYou can send all configs into the constructor as a hash, I really advise using a config file.  \nThe default config file is F</etc/ipblocker/ipblocker.conf> but you can set it to another file.\nIf a config file is not found, it will use default values for everything and that will probably not work very well.\n\n my $foo = Net::IPBlocker->new( { configsfile => '/etc/ipblocker/ipblocker.conf' } );\n $foo->go();\n\n=head2 Future Enhancements\n\n=over 4\n\n* * Add reload ability of configs\n\nThis will make it so a full stop and restart does not need to happen to reload configs.\n\n* * Add jail time for IPs\n\nThis involves adding a database to store the IPs and the time they were blocked.\nThis also means adding a mechanism to unblock IPs after a certain amount of time.\nLuckily, I have threaded this so adding that is just a matter of adding another thread.\nI am open to ideas of what database to use.  I am thinking SQLite.\nOr, possibly just a file with the IPs (the rule) and the time they are to be unblocked (deleted \nfrom iptables).\n\n* * Add synchronized appender logging:\n      \nhttps://metacpan.org/dist/Log-Log4perl/view/lib/Log/Log4perl/Appender/Synchronized.pm\n\n* * Fix the ability for Log4perl to re-read the \"log4perl.conf\" which seems to not work right now\n\n* * Change from using log4perl to Log::Any\n\nI didn't know about Log::Any when I started this.  I am open to changing this to Log::Any but I need to \nfigure out how to do that.\n\n* * my $interfaces = Net::Ifconfig::Wrapper::Ifconfig('list', '', '', '');\n\nThis is a list of interfaces.  Need to figure out how to use this to get the IP address of the\ninterfaces.  Need to add those IPs to the global allow list.\n\n* * Fix sub add_ifconfig_ips_to_allowlist() to handle IPv4 and IPv6 addresses\n\nThis really findes the IPs on a network interface and adds them to the global allow list.\nUsually,we don't want to accidentally block our own IPs.\nOf course, this will mean adding an option to the configs file to turn this on or off.\n\n\n=head2 DESCRIPTION\n\nThis has been a very long running project of mine.  I have been using this script for years to block IPs and then \nrealized Fail2Ban exists.  I have tried to use Fail2Ban multiple times but it never seems to work right for me.\nIt seems to lock-up. \nThis module tries to incorporate the ideas of my past experience with the general idea of Fail2Ban.\n\nI highly encourage you to use a config file.  The default config file is in the same location as this module but you \ncan set it to another file.\n\nWhen installing this, you should also receive a script called \"ipBlocker.pl\".  This is a sample script that uses \nthis module.\n\nFinally, for now, this module use log4perl.  I didn't realize there was a heated debate about log4perl vs Log::Any vs \nwhatever else.  I am open to changing this to Log::Any but I need to figure out how to do that.\n\n=head1 SUBROUTINES/METHODS\n\n=head2 new\n\nReads configs form a file if exists otherwise uses defaults.\nSets up a class and returns a blessed \"object\".\nThe sub go() is where the action starts.\nThe sub new() just gets a few things setup.\n\nExample:\n\n  use IPblocker;\n\n  my $args = {\n    configsfile         => '/etc/ipblocker/ipblocker.conf',\n    dumpconfigsandexit  => '0', # True false value\n    forceremovelockfile => '0', # True false value\n    iptables            => 'sudo /sbin/iptables',\n    lockfile            => '/var/run/ipblocker.run',\n    log4perlconf        => '/etc/ipblocker/log4perl.conf',  #Can also be 0 to use default log4perl\n    loglevel            => 'DEBUG', # Can be TRACE DEBUG INFO WARN ERROR FATAL\n    prodmode            => '0', # True false value --- Determins if the iptables commands are actually run\n    queuechecktime      => '3', # How long to wait when the queue is empty before checking again. Any float value.\n    readentirefile      => '0', # True false value --- Determines if the entire log file is read or\n                                # new entries since last run are read.\n    cycles              => 'LONG_MAX', # How many times to run the main loop.  LONG_MAX is the default.\n    ### All configs can be set via a hash reference\n  };\n\n  my $ipb    = IPblocker->new($args);\n\n=head3 All arguments to new() and the defaults\n\n=head4 allowdeny\n\nallowdeny            => 'Allow,Deny',\n\nSet to 'Allow,Deny' or 'Deny,Allow' to determine the order of the allow and deny lists.\nSeteting to 'Allow,Deny' means the allow list is processed first and then the deny list is processed.\nMeaning, as an example, if 1.1.1.1 is on the allow list and allowdeny is set to Allow,Deny, then\nthe IP of 1.1.1.1 will never be blocked.  If allowdeny is set to Deny,Allow, then it is possible \nfor 1.1.1.1 to be blocked.\n\n=head4 allowlist\n\nallowlist            => {},\n\nA list of IPs to allow.  This is a hash reference.  The key is the order to allow the IP.  The value is the IP.\nExample:\n\n allowlist => (\n  '01' => '1.1.1.1',\n  '4' => '1.1.1.4',\n  '10' => '1.1.1.2',\n  '100' => '1.1.1.3',\n  \n )\n\nThe allow list is sorted in standard Perl sort order.  So, be sure to pad 0's or whatever to the front of the key.\n\n=head4 configsfile\n\nconfigsfile          => '/etc/ipblocker/ipblocker.conf',\n\nUse a config file!  This is the default config file location.  You can set it to another file.\n\n=head4 cycles\n\ncycles               => LONG_MAX,\n\nHow many times to run the main loop.  LONG_MAX is the default.  Why not infinity?  Because I don't want to.\n\n=head4 cyclesleep\n\ncyclesleep           => 0.5,\n\nHow long to sleep between cycles.  This is in seconds.  Default is 0.5 seconds.  You can use a float value.\n\n=head4 dumpconfigsandexit\n\ndumpconfigsandexit   => 0,\n\nIf set to 1 (true), then the configs are dumped to stdout and the script exits.  This is useful for creating a \nconfig file.\n\n=head4 denylist\n\ndenylist             => {},\n\nSimilar to allow list but for IPs to deny.  This is a hash reference.  The key is the order to deny the IP.\n\n=head4 forceremovelockfile\n\nforceremovelockfile  => 0,\n\nThis will force removal of lock file (if possible) before starting.  Seriously, you better know what you are doing.\n\n=head4 chainprefix\n\nchainprefix          => \"IPBLOCKER_\",\n\nThis is the prefix for the chains created in iptables.  This is the prefix you will see in iptables for \nall the chains created by this module.\n\n=head4 globalchains\n\nglobalchains         => [qw / INPUT OUTPUT FORWARD /],\n\nThis is a list of the global chains to add the global chain to.\nThe global chain is where all the subordinate file logger chains are added.\n\nI see some value in adding the global chain to some other chain but by default we add it to INPUT, OUTPUT, and FORWARD.\nOr, possibly, you don't want to add to the FORWARD chain.\nMaybe you onkly care about INPUT table.  I don't know.  Whatever works best for you.\n\n=head4 iptables\n\niptables             => '/sbin/iptables',\n\nThis is the iptables command to use.  You can use sudo or whatever you want.\nI really encourage using sudo but by default it is not used.  \nUsing sudo and non-root user is a bit more work.  You need to setup sudoers to allow the user to run iptables.\nHowever, I think it is worth it for an added measure of security.\nIf you change this to use sudo, then you may also need to change the lockfile location to a location that the user \ncan write to.\n\n=head4 lockfile\n\nlockfile             => '/var/run/ipblocker.run.default',\n\nThis is the lock file location to use to try to prevent multiple instances from running.\n\n=head4 log4perlconf\n\nlog4perlconf         => '/etc/ipblocker/log4perl.conf',\n\nThis is the log4perl configuration file to use.  You can also set this to 0 to use the default log4perl configuration.\n\n=head4 loglevel\n\nloglevel             => 'INFO'\n\nTHis can be TRACE DEBUG INFO WARN ERROR FATAL.\n\n=head4 prodmode\n\nprodmode          => 0,\n\nThis is a true/false value.  If set to 1 (true), then the iptables commands are actually run.  If set to 0 (false), \nthen the iptables commands are not run.  This is useful for testing.\n\nBy default, this is set to 0 (false).\n\n=head4 queuechecktime\n\nqueuechecktime    => 1,\n\nWhen the queue is empty, how long to wait before checking again.  When the queue is not empty, this value is ignored\n\n=head4 queuecycles\n\nqueuecycles       => LONG_MAX,\n\nHow many times to check the queue.  LONG_MAX is the default.  Why not infinity?  Because I don't want to.\n\n=head4 readentirefile\n\nreadentirefile    => 0,\n\nThis is a true/false value.  If set to 1 (true), then the entire log file is read.  If set to 0 (false), then only\nnew entries since the last run are read.\nThis can aslo be set per log file in the configs file.\n\n=head4 totalruntime\n\ntotalruntime      => LONG_MAX,\n\nHow long to run in seconds.  This is irrespective of any other cycle or queue cycle.  Nice for testing or maybe you\nwant to run this for a certain amount of time and restart it out of cron or something.\n\n\n# Description:  Creates a new class/object\n# Returns:      A blessed reference \"object\"\nsub new() {\n    my $class = shift;\n    my $args  = shift;\n\n    if ( !$args ) {\n        carp(\"No arguments passed to new().  This may not be an issue.\");\n        $args = {};\n    }\n    elsif ( ref($args) ne 'HASH' ) {\n        croak(\"Arguments passed to new() are not a hash reference\");\n    }\n\n    # Allow command line to override default configs file location\n    my $configsfile = $args->{configsfile} || $DEFAULTS->{configsfile};\n\n    my $self = {\n        configsfile => $configsfile,\n        clargs      => $args,\n    };\n\n    # Create the $self object\n    bless $self, $class;\n\n    # Load all the configs into the $self object under the configs key\n    # The sub load_configs() expects $self to be an object and have configsfile setup\n    $self->load_configs();\n\n    if ( $self->{configs}->{dumpconfigsandexit} ) {\n        ## Rip out some stuff that is used internally and not needed for the configs file\n        delete $self->{configs}->{configsfile};\n        delete $self->{configs}->{globalchain};\n        delete $self->{configs}->{dumpconfigsandexit};\n        print \"This can basically be copy/pasted into a config file:\\n\";\n        recursiveHashPrint( $self->{configs} );\n        exit;\n    } ## end if ( $self->{configs}->...)\n\n    # Setup logging.\n    $logger = $log;  #From Log::Any\n    $logger->info(\"Logging initialized and ready to go\");\n    $logger->debug( \"Dumping self: \" . Dumper($self) ) if ( $logger->is_debug() ); \n\n    return $self;\n} ## end sub new\n\n# Description:  Recursively prints the configs in teh format of a config file\n# Returns:      Nothing\nsub recursiveHashPrint {\n    my ( $ref, $prefix ) = @_;\n    $prefix = '' unless defined $prefix;    # Initialize prefix if not provided\n\n    if ( ref($ref) eq 'HASH' ) {\n        foreach my $key ( sort keys %{$ref} ) {\n\n            # Concatenate the current key to the prefix for the next level\n            my $new_prefix = $prefix ? \"$prefix][$key\" : \"[$key\";\n            recursiveHashPrint( $ref->{$key}, $new_prefix );\n        } ## end foreach my $key ( sort keys...)\n    } ## end if ( ref($ref) eq 'HASH')\n    elsif ( ref($ref) eq 'ARRAY' ) {\n\n        # If the reference is an array, join and print the elements\n        my $line = \"$prefix] = \" . join( ', ', @{$ref} ) . \"\\n\";\n        $line =~ s/\\[//;\n        $line =~ s/\\]//;\n        print $line;\n    } ## end elsif ( ref($ref) eq 'ARRAY')\n    else {\n        # Print the scalar value\n        my $line = \"$prefix]=$ref\\n\";\n        $line =~ s/\\[//;\n        $line =~ s/\\]//;\n        print $line;\n    } ## end else [ if ( ref($ref) eq 'HASH')]\n} ## end sub recursiveHashPrint\n\n=head2 go\n\nThis is where the action starts.  This is called from the script that uses this module after\nnew() is instantiated.\n\nThis creates a thread for each log watcher and a thread for the iptables queue watcher.\nAs an example, if you have 5 files to watch, then there will be 5 threads watching those files + 1 thread to add commands to \niptables.  Worst case scenario, you may need 1 CPU per thread (at most).  \nHowever, that is very unlikely because the timing of processing will vary and it is not really a 1:1 ratio.\n\n Description:  Starts the module\n Requires:     $self\n Returns:      1 if able to stop gracefully, otherwise 0","label":"go()","parameters":[]},"detail":"()","range":{"start":{"character":0,"line":446},"end":{"line":506,"character":9999}},"definition":"sub","line":446,"containerName":"Net::IPBlocker"},{"name":"threads","line":449,"kind":12},{"name":"configs","line":453,"kind":12},{"name":"logs_to_review","kind":12,"line":453},{"kind":12,"line":461,"name":"configs"},{"line":461,"kind":12,"name":"globalchain"},{"kind":12,"line":461,"name":"configs"},{"line":461,"kind":12,"name":"chainprefix"},{"kind":12,"line":467,"name":"threads"},{"kind":12,"line":467,"name":"iptables_thread"},{"name":"configs","line":478,"kind":12},{"name":"totalruntime","kind":12,"line":478},{"name":"chains_created","kind":12,"line":501},{"name":"chains_created","kind":12,"line":501},{"detail":"()","line":511,"containerName":"Net::IPBlocker","range":{"end":{"line":562,"character":9999},"start":{"line":511,"character":0}},"definition":"sub","children":[{"definition":"my","line":512,"containerName":"iptables_thread","localvar":"my","name":"$self","kind":13},{"name":"$TID","kind":13,"localvar":"my","line":513,"containerName":"iptables_thread","definition":"my"},{"name":"tid","containerName":"iptables_thread","line":513,"kind":12},{"name":"$TID","kind":13,"containerName":"iptables_thread","line":514},{"name":"$TID","kind":13,"line":514,"containerName":"iptables_thread"},{"name":"$cyclesleep","kind":13,"localvar":"my","line":516,"containerName":"iptables_thread","definition":"my"},{"line":516,"containerName":"iptables_thread","kind":13,"name":"$self"},{"definition":"my","localvar":"my","line":517,"containerName":"iptables_thread","kind":13,"name":"$cycles"},{"line":517,"containerName":"iptables_thread","kind":13,"name":"$self"},{"name":"$cyclesleft","kind":13,"line":518,"containerName":"iptables_thread","localvar":"my","definition":"my"},{"kind":13,"containerName":"iptables_thread","line":518,"name":"$cycles"},{"kind":13,"name":"$logmsg","line":519,"containerName":"iptables_thread","localvar":"my","definition":"my"},{"name":"$logmsg","kind":13,"containerName":"iptables_thread","line":520},{"name":"$logger","kind":13,"line":521,"containerName":"iptables_thread"},{"name":"info","kind":12,"containerName":"iptables_thread","line":521},{"name":"$logmsg","line":521,"containerName":"iptables_thread","kind":13},{"localvar":"my","line":524,"containerName":"iptables_thread","definition":"my","name":"$iptablesQueue_pending","kind":13},{"name":"$IptablesQueue","containerName":"iptables_thread","line":524,"kind":13},{"line":524,"containerName":"iptables_thread","kind":12,"name":"pending"},{"name":"$iptablesQueue_pending","containerName":"iptables_thread","line":525,"kind":13},{"kind":13,"name":"$logmsg","definition":"my","localvar":"my","containerName":"iptables_thread","line":526},{"line":527,"containerName":"iptables_thread","kind":13,"name":"$logmsg"},{"name":"$logger","line":528,"containerName":"iptables_thread","kind":13},{"line":528,"containerName":"iptables_thread","kind":12,"name":"info"},{"containerName":"iptables_thread","line":528,"kind":13,"name":"$logmsg"},{"kind":13,"containerName":"iptables_thread","line":532,"name":"$iptablesQueue_pending"},{"kind":13,"line":533,"containerName":"iptables_thread","name":"$logger"},{"kind":12,"line":533,"containerName":"iptables_thread","name":"info"},{"name":"$data","kind":13,"definition":"my","line":534,"containerName":"iptables_thread","localvar":"my"},{"kind":13,"line":534,"containerName":"iptables_thread","name":"$IptablesQueue"},{"name":"dequeue","kind":12,"line":534,"containerName":"iptables_thread"},{"containerName":"iptables_thread","line":535,"kind":13,"name":"$logger"},{"name":"debug","line":535,"containerName":"iptables_thread","kind":12},{"name":"$data","kind":13,"line":535,"containerName":"iptables_thread"},{"name":"$logger","line":535,"containerName":"iptables_thread","kind":13},{"kind":12,"containerName":"iptables_thread","line":535,"name":"is_debug"},{"localvar":"my","line":536,"containerName":"iptables_thread","definition":"my","name":"$now","kind":13},{"name":"$self","line":537,"containerName":"iptables_thread","kind":13},{"kind":12,"containerName":"iptables_thread","line":537,"name":"run_iptables"},{"name":"$data","kind":13,"containerName":"iptables_thread","line":537},{"kind":13,"containerName":"iptables_thread","line":537,"name":"$logger"},{"name":"error","kind":12,"containerName":"iptables_thread","line":537},{"kind":13,"containerName":"iptables_thread","line":537,"name":"$data"},{"containerName":"iptables_thread","line":538,"kind":13,"name":"$IPTABLESRUNLINE"},{"containerName":"iptables_thread","line":539,"kind":13,"name":"$IPTABLESRUNLINE"},{"name":"$IPTABLESRUNLINE","kind":13,"line":539,"containerName":"iptables_thread"},{"kind":13,"name":"$elapsed","definition":"my","containerName":"iptables_thread","line":540,"localvar":"my"},{"name":"$now","containerName":"iptables_thread","line":540,"kind":13},{"name":"$elapsed","kind":13,"containerName":"iptables_thread","line":541},{"name":"$elapsed","kind":13,"containerName":"iptables_thread","line":541},{"kind":13,"line":542,"containerName":"iptables_thread","name":"$logger"},{"name":"debug","kind":12,"containerName":"iptables_thread","line":542},{"containerName":"iptables_thread","line":544,"kind":13,"name":"$iptablesQueue_pending"},{"name":"$logmsg","kind":13,"containerName":"iptables_thread","line":546,"localvar":"my","definition":"my"},{"name":"$logmsg","line":547,"containerName":"iptables_thread","kind":13},{"name":"$cyclesleep","containerName":"iptables_thread","line":547,"kind":13},{"name":"$logmsg","kind":13,"containerName":"iptables_thread","line":548},{"line":549,"containerName":"iptables_thread","kind":13,"name":"$logger"},{"name":"info","containerName":"iptables_thread","line":549,"kind":12},{"name":"$logmsg","containerName":"iptables_thread","line":549,"kind":13},{"name":"$cyclesleep","containerName":"iptables_thread","line":550,"kind":13},{"line":551,"containerName":"iptables_thread","kind":13,"name":"$cyclesleft"},{"name":"$cyclesleft","line":552,"containerName":"iptables_thread","kind":13},{"containerName":"iptables_thread","line":553,"kind":13,"name":"$logger"},{"name":"info","line":553,"containerName":"iptables_thread","kind":12},{"line":554,"containerName":"iptables_thread","kind":13,"name":"$IptablesQueue"},{"kind":12,"line":554,"containerName":"iptables_thread","name":"end"},{"name":"$logger","containerName":"iptables_thread","line":558,"kind":13},{"name":"error","containerName":"iptables_thread","line":558,"kind":12}],"name":"iptables_thread","signature":{"parameters":[],"label":"iptables_thread()","documentation":" Description:  Manages an iptables queue in a continuous loop, handling queue items, logging status, and pausing\n               based on configuration settings.\n Requires:     $self"},"kind":12},{"line":513,"kind":12,"name":"threads"},{"name":"configs","line":516,"kind":12},{"name":"queuechecktime","line":516,"kind":12},{"name":"configs","kind":12,"line":517},{"line":517,"kind":12,"name":"queuecycles"},{"name":"Dumper","kind":12,"line":535},{"name":"Dumper","line":537,"kind":12},{"kind":12,"line":550,"name":"usleep"},{"children":[{"localvar":"my","line":567,"containerName":"add_ifconfig_ips_to_allowlist","definition":"my","kind":13,"name":"$self"}],"name":"add_ifconfig_ips_to_allowlist","signature":{"documentation":" Description:  Adds IPs on the local interfaces to the global allowlist\n               This does not work because it only handles IPv4 addresses and other issues","label":"add_ifconfig_ips_to_allowlist()","parameters":[]},"kind":12,"detail":"()","containerName":"Net::IPBlocker","line":566,"range":{"start":{"character":0,"line":566},"end":{"character":9999,"line":594}},"definition":"sub"},{"children":[{"line":604,"containerName":"set_lockFile","localvar":"my","definition":"my","name":"$self","kind":13},{"containerName":"set_lockFile","line":606,"kind":13,"name":"$self"},{"name":"$logger","line":607,"containerName":"set_lockFile","kind":13},{"containerName":"set_lockFile","line":607,"kind":12,"name":"logdie"},{"kind":13,"name":"$lockfile","containerName":"set_lockFile","line":610,"localvar":"my","definition":"my"},{"kind":13,"line":610,"containerName":"set_lockFile","name":"$self"},{"definition":"my","localvar":"my","containerName":"set_lockFile","line":613,"kind":13,"name":"$lf"},{"name":"$self","kind":13,"line":613,"containerName":"set_lockFile"},{"name":"$logger","line":614,"containerName":"set_lockFile","kind":13},{"kind":12,"containerName":"set_lockFile","line":614,"name":"debug"},{"kind":13,"containerName":"set_lockFile","line":616,"name":"$lf"},{"name":"$self","line":617,"containerName":"set_lockFile","kind":13},{"containerName":"set_lockFile","line":618,"kind":13,"name":"$logger"},{"name":"info","line":618,"containerName":"set_lockFile","kind":12},{"name":"$lf","kind":13,"line":619,"containerName":"set_lockFile"},{"name":"$logger","line":619,"containerName":"set_lockFile","kind":13},{"name":"logdie","kind":12,"line":619,"containerName":"set_lockFile"},{"definition":"my","line":622,"containerName":"set_lockFile","localvar":"my","name":"$fh","kind":13},{"name":"$lf","line":622,"containerName":"set_lockFile","kind":13},{"kind":13,"line":622,"containerName":"set_lockFile","name":"$logger"},{"kind":12,"line":622,"containerName":"set_lockFile","name":"logdie"},{"definition":"my","line":623,"containerName":"set_lockFile","localvar":"my","name":"@contents","kind":13},{"line":623,"containerName":"set_lockFile","kind":13,"name":"$fh"},{"name":"$fh","kind":13,"line":624,"containerName":"set_lockFile"},{"name":"@contents","kind":13,"line":625,"containerName":"set_lockFile"},{"localvar":"my","containerName":"set_lockFile","line":626,"definition":"my","kind":13,"name":"$printable_contents"},{"containerName":"set_lockFile","line":626,"kind":13,"name":"@contents"},{"kind":13,"name":"$logmsg","definition":"my","containerName":"set_lockFile","line":627,"localvar":"my"},{"name":"$logger","containerName":"set_lockFile","line":628,"kind":13},{"name":"info","kind":12,"line":628,"containerName":"set_lockFile"},{"name":"$logmsg","kind":13,"line":628,"containerName":"set_lockFile"},{"kind":13,"containerName":"set_lockFile","line":632,"name":"$lf"},{"name":"$logger","kind":13,"line":632,"containerName":"set_lockFile"},{"name":"logdie","kind":12,"line":632,"containerName":"set_lockFile"},{"kind":13,"containerName":"set_lockFile","line":635,"name":"$self"},{"name":"make","kind":12,"line":635,"containerName":"set_lockFile"},{"containerName":"set_lockFile","line":638,"kind":13,"name":"$logger"},{"line":638,"containerName":"set_lockFile","kind":12,"name":"debug"},{"kind":13,"line":638,"containerName":"set_lockFile","name":"$self"},{"kind":13,"line":638,"containerName":"set_lockFile","name":"$logger"},{"containerName":"set_lockFile","line":638,"kind":12,"name":"is_debug"},{"name":"$self","kind":13,"containerName":"set_lockFile","line":639},{"kind":13,"line":639,"containerName":"set_lockFile","name":"$self"},{"name":"lock","line":639,"containerName":"set_lockFile","kind":12},{"name":"$lf","kind":13,"line":639,"containerName":"set_lockFile"},{"name":"$logger","kind":13,"line":640,"containerName":"set_lockFile"},{"kind":12,"line":640,"containerName":"set_lockFile","name":"logdie"},{"kind":13,"line":641,"containerName":"set_lockFile","name":"$lock_obj"},{"containerName":"set_lockFile","line":641,"kind":13,"name":"$self"},{"kind":13,"containerName":"set_lockFile","line":643,"name":"$logger"},{"name":"info","containerName":"set_lockFile","line":643,"kind":12}],"name":"set_lockFile","signature":{"label":"set_lockFile()","parameters":[],"documentation":" Description:  Sets the lock file\n               This is very important to this module.  If the lock file is not set, then multiple instances of this\n               script can cause problems.\n               Some of this is on the user but I'll try my best to make it so duplicate instances of this script\n               can't run.\n Requires:     $self->{configs}->{lockfile}\n Returns:      1 if able to set lock file, otherwise logdie happens"},"kind":12,"detail":"()","line":603,"containerName":"Net::IPBlocker","definition":"sub","range":{"end":{"line":645,"character":9999},"start":{"line":603,"character":0}}},{"name":"configs","line":606,"kind":12},{"kind":12,"line":606,"name":"lockfile"},{"line":610,"kind":12,"name":"configs"},{"line":610,"kind":12,"name":"lockfile"},{"name":"configs","line":613,"kind":12},{"name":"lockfile","line":613,"kind":12},{"name":"configs","kind":12,"line":617},{"kind":12,"line":617,"name":"forceremovelockfile"},{"kind":12,"line":635,"name":"lockmgr"},{"line":635,"containerName":"Simple","kind":12,"name":"LockFile"},{"name":"Dumper","kind":12,"line":638},{"name":"lockmgr","line":638,"kind":12},{"name":"lock","line":639,"kind":12},{"line":639,"kind":12,"name":"lockmgr"},{"name":"lock","kind":12,"line":641},{"detail":"()","containerName":"Net::IPBlocker","line":650,"definition":"sub","range":{"start":{"character":0,"line":650},"end":{"line":657,"character":9999}},"children":[{"kind":13,"name":"$self","definition":"my","localvar":"my","containerName":"logger_thread","line":651},{"localvar":"my","containerName":"logger_thread","line":653,"definition":"my","name":"$logstoreview","kind":13},{"name":"$self","line":653,"containerName":"logger_thread","kind":13},{"name":"$logstoreview","line":654,"containerName":"logger_thread","kind":13},{"name":"$logtoreview","kind":13,"definition":"my","localvar":"my","line":657,"containerName":"logger_thread"},{"containerName":"logger_thread","line":657,"kind":13,"name":"$logstoreview"}],"name":"logger_thread","signature":{"documentation":" Description: Creates a thread for each log file to review\n Requires:    $self->{configs}->{logs_to_review}\n Returns:     1 or dies if thread can not be created","label":"logger_thread()","parameters":[]},"kind":12},{"name":"configs","kind":12,"line":653},{"line":653,"kind":12,"name":"logs_to_review"},{"line":658,"containerName":null,"kind":13,"name":"$logger"},{"containerName":"Net::IPBlocker","line":658,"kind":12,"name":"info"},{"name":"$logobj","kind":13,"definition":"my","localvar":"my","line":659,"containerName":null},{"containerName":null,"line":659,"kind":13,"name":"%logstoreview"},{"kind":13,"containerName":null,"line":659,"name":"$logtoreview"},{"kind":13,"line":660,"containerName":null,"name":"%logobj"},{"line":660,"kind":12,"name":"chain"},{"containerName":null,"line":660,"kind":13,"name":"$logtoreview"},{"name":"$thr","kind":13,"definition":"my","containerName":null,"line":662,"localvar":"my"},{"kind":12,"line":662,"name":"threads"},{"name":"create","line":662,"containerName":"Net::IPBlocker","kind":12},{"name":"review_log","kind":12,"line":662},{"containerName":null,"line":662,"kind":13,"name":"$self"},{"line":662,"containerName":null,"kind":13,"name":"$logobj"},{"name":"$logger","containerName":null,"line":662,"kind":13},{"kind":12,"containerName":"Net::IPBlocker","line":662,"name":"logdie"},{"name":"$LoggerTIDS","line":663,"containerName":null,"kind":13},{"name":"$thr","line":663,"containerName":null,"kind":13},{"name":"tid","kind":12,"line":663,"containerName":"Net::IPBlocker"},{"containerName":null,"line":664,"kind":13,"name":"$logger"},{"name":"debug","kind":12,"containerName":"Net::IPBlocker","line":664},{"name":"$thr","kind":13,"line":664,"containerName":null},{"name":"tid","line":664,"containerName":"Net::IPBlocker","kind":12},{"name":"$logger","kind":13,"line":664,"containerName":null},{"name":"is_debug","line":664,"containerName":"Net::IPBlocker","kind":12},{"kind":13,"containerName":null,"line":665,"name":"$logger"},{"containerName":"Net::IPBlocker","line":665,"kind":12,"name":"debug"},{"name":"$thr","kind":13,"containerName":null,"line":665},{"name":"tid","kind":12,"containerName":"Net::IPBlocker","line":665},{"line":665,"containerName":null,"kind":13,"name":"$thr"},{"name":"is_running","line":665,"containerName":"Net::IPBlocker","kind":12},{"name":"$logger","kind":13,"containerName":null,"line":665},{"name":"is_debug","kind":12,"line":665,"containerName":"Net::IPBlocker"},{"kind":12,"signature":{"documentation":" Description:  Sets the direction of using source or destination for the iptables rules\n Requires:     $self, $logobj->{directions}\n Returns:      @directions","parameters":[],"label":"prepare_directions()"},"name":"prepare_directions","children":[{"kind":13,"name":"$self","definition":"my","localvar":"my","line":677,"containerName":"prepare_directions"},{"name":"$logobj","kind":13,"containerName":"prepare_directions","line":677},{"definition":"my","containerName":"prepare_directions","line":678,"localvar":"my","kind":13,"name":"$TID"},{"line":678,"containerName":"prepare_directions","kind":12,"name":"tid"},{"name":"$TID","kind":13,"containerName":"prepare_directions","line":679},{"name":"$TID","containerName":"prepare_directions","line":679,"kind":13},{"localvar":"my","line":681,"containerName":"prepare_directions","definition":"my","kind":13,"name":"@directions"},{"name":"$logobj","kind":13,"line":681,"containerName":"prepare_directions"},{"kind":13,"line":681,"containerName":"prepare_directions","name":"$logobj"},{"kind":13,"containerName":"prepare_directions","line":682,"name":"@directions"},{"name":"@directions","containerName":"prepare_directions","line":682,"kind":13},{"name":"@directions","containerName":"prepare_directions","line":683,"kind":13},{"kind":13,"line":683,"containerName":"prepare_directions","name":"@directions"},{"name":"@directions","kind":13,"line":684,"containerName":"prepare_directions"},{"name":"@directions","kind":13,"containerName":"prepare_directions","line":684},{"containerName":"prepare_directions","line":685,"kind":13,"name":"@directions"},{"line":685,"containerName":"prepare_directions","kind":13,"name":"@directions"},{"containerName":"prepare_directions","line":686,"kind":13,"name":"@directions"}],"definition":"sub","range":{"start":{"character":0,"line":676},"end":{"line":687,"character":9999}},"line":676,"containerName":"Net::IPBlocker","detail":"()"},{"kind":12,"line":678,"name":"threads"},{"name":"directions","kind":12,"line":681},{"name":"directions","line":681,"kind":12},{"kind":12,"line":684,"name":"any"},{"signature":{"documentation":" sub get_grepmodule {\n     my ($self, $logobj) = @_;\n     my $TID = \"TID: \" . threads->tid;\n     lib->import($logobj->{libpath}) if ( $logobj->{libpath} );\n     my $grepmodule = $logobj->{grepmodule} || 'Net::IPBlocker::GrepRegexpsDefault';\n     $logger->debug(\"$TID|Trying to require $grepmodule\");\n     if ( $grepmodule =~ m/::/ ) {\n         eval \"require $grepmodule\";\n     } else {\n         eval require $grepmodule;\n     }\n     # eval require $grepmodule; # This works for both module names and paths\n     if ($@) {\n         $logger->error(\"$TID|Unable to require $grepmodule: $@\");\n         return 0;\n     } else {\n         $logger->info(\"$TID|Successfully required $grepmodule\");\n     }\n     return $grepmodule;\n }\n Description:  Gets the log review module or sets to the default\n               The log review module is the module that actually reads the log file and determisn what to do with IPs\n               It can do other things as well.  The LogReviewDefault module is the default module.\n               We do not use \"use\" because we don't want this to load at compile.  So, we use \"require\" instead.\n Requires:     $self, $logobj\n Returns:      $module","parameters":[{"label":"$self"},{"label":"$logobj"}],"label":"get_reviewlog_module($self,$logobj)"},"kind":12,"children":[{"localvar":"my","line":721,"containerName":"get_reviewlog_module","definition":"my","name":"$self","kind":13},{"name":"$logobj","line":721,"containerName":"get_reviewlog_module","kind":13},{"kind":13,"name":"$TID","definition":"my","containerName":"get_reviewlog_module","line":722,"localvar":"my"},{"name":"tid","kind":12,"containerName":"get_reviewlog_module","line":722},{"name":"$logobj","containerName":"get_reviewlog_module","line":723,"kind":13},{"kind":13,"containerName":"get_reviewlog_module","line":724,"name":"$logger"},{"name":"debug","kind":12,"containerName":"get_reviewlog_module","line":724},{"name":"import","containerName":"get_reviewlog_module","line":725,"kind":12},{"kind":13,"containerName":"get_reviewlog_module","line":725,"name":"$logobj"},{"localvar":"my","line":727,"containerName":"get_reviewlog_module","definition":"my","name":"$module","kind":13},{"containerName":"get_reviewlog_module","line":727,"kind":13,"name":"$logobj"},{"name":"$logger","containerName":"get_reviewlog_module","line":729,"kind":13},{"name":"debug","containerName":"get_reviewlog_module","line":729,"kind":12},{"name":"$module","containerName":"get_reviewlog_module","line":730,"kind":13},{"containerName":"get_reviewlog_module","line":731,"kind":13,"name":"$logger"},{"containerName":"get_reviewlog_module","line":731,"kind":12,"name":"debug"},{"containerName":"get_reviewlog_module","line":734,"kind":13,"name":"$logger"},{"name":"debug","containerName":"get_reviewlog_module","line":734,"kind":12},{"name":"$module","containerName":"get_reviewlog_module","line":735,"kind":13},{"name":"$logger","containerName":"get_reviewlog_module","line":739,"kind":13},{"name":"error","kind":12,"line":739,"containerName":"get_reviewlog_module"},{"line":742,"containerName":"get_reviewlog_module","kind":13,"name":"$logger"},{"kind":12,"line":742,"containerName":"get_reviewlog_module","name":"info"},{"kind":13,"line":744,"containerName":"get_reviewlog_module","name":"$module"},{"name":"can","kind":12,"containerName":"get_reviewlog_module","line":744},{"definition":"my","localvar":"my","line":745,"containerName":"get_reviewlog_module","name":"$newargs","kind":13},{"kind":13,"line":746,"containerName":"get_reviewlog_module","name":"$logobj"},{"name":"$self","kind":13,"line":747,"containerName":"get_reviewlog_module"},{"name":"$module","line":750,"containerName":"get_reviewlog_module","kind":13},{"kind":13,"containerName":"get_reviewlog_module","line":750,"name":"$module"},{"name":"new","kind":12,"containerName":"get_reviewlog_module","line":750},{"containerName":"get_reviewlog_module","line":750,"kind":13,"name":"$newargs"},{"name":"$logger","kind":13,"containerName":"get_reviewlog_module","line":751},{"name":"debug","line":751,"containerName":"get_reviewlog_module","kind":12},{"containerName":"get_reviewlog_module","line":753,"kind":13,"name":"$logger"},{"kind":12,"containerName":"get_reviewlog_module","line":753,"name":"error"},{"name":"$module","kind":13,"line":757,"containerName":"get_reviewlog_module"}],"name":"get_reviewlog_module","containerName":"Net::IPBlocker","line":720,"definition":"sub","range":{"end":{"character":9999,"line":757},"start":{"line":720,"character":0}},"detail":"($self,$logobj)"},{"kind":12,"line":722,"name":"threads"},{"name":"libpath","line":723,"kind":12},{"name":"lib","kind":12,"line":725},{"name":"libpath","line":725,"kind":12},{"line":727,"kind":12,"name":"module"},{"line":746,"kind":12,"name":"logobj"},{"name":"parentobjself","kind":12,"line":747},{"line":748,"kind":12,"name":"iptablesqueue_enqueue"},{"line":748,"kind":12,"name":"iptablesqueue_enqueue"},{"name":"review_log","children":[{"localvar":"my","containerName":"review_log","line":769,"definition":"my","name":"$self","kind":13},{"kind":13,"containerName":"review_log","line":769,"name":"$logobj"},{"name":"$TID","kind":13,"containerName":"review_log","line":770,"localvar":"my","definition":"my"},{"containerName":"review_log","line":770,"kind":12,"name":"tid"},{"name":"$TID","line":771,"containerName":"review_log","kind":13},{"name":"$TID","line":771,"containerName":"review_log","kind":13},{"containerName":"review_log","line":772,"localvar":"my","definition":"my","name":"$start_time","kind":13},{"name":"$reviewlogmodule","kind":13,"definition":"my","line":775,"containerName":"review_log","localvar":"my"},{"kind":13,"containerName":"review_log","line":775,"name":"$self"},{"containerName":"review_log","line":775,"kind":12,"name":"get_reviewlog_module"},{"kind":13,"containerName":"review_log","line":775,"name":"$logobj"},{"kind":13,"containerName":"review_log","line":776,"name":"$reviewlogmodule"},{"name":"$logger","containerName":"review_log","line":777,"kind":13},{"containerName":"review_log","line":777,"kind":12,"name":"error"},{"name":"$logobj","containerName":"review_log","line":781,"kind":13},{"name":"$chain","kind":13,"definition":"my","line":782,"containerName":"review_log","localvar":"my"},{"name":"$self","line":782,"containerName":"review_log","kind":13},{"line":782,"containerName":"review_log","kind":13,"name":"$logobj"},{"kind":13,"containerName":"review_log","line":783,"name":"$logger"},{"name":"debug","line":783,"containerName":"review_log","kind":12},{"name":"$logger","kind":13,"line":784,"containerName":"review_log"},{"name":"debug","containerName":"review_log","line":784,"kind":12},{"name":"$logobj","line":784,"containerName":"review_log","kind":13},{"name":"$logger","kind":13,"line":784,"containerName":"review_log"},{"kind":12,"line":784,"containerName":"review_log","name":"is_debug"},{"name":"$cycles","kind":13,"definition":"my","localvar":"my","containerName":"review_log","line":787},{"name":"$logobj","line":787,"containerName":"review_log","kind":13},{"name":"$cyclesleft","kind":13,"containerName":"review_log","line":788,"localvar":"my","definition":"my"},{"kind":13,"line":788,"containerName":"review_log","name":"$cycles"},{"name":"$cyclesleep","kind":13,"containerName":"review_log","line":789,"localvar":"my","definition":"my"},{"kind":13,"line":789,"containerName":"review_log","name":"$logobj"},{"kind":13,"name":"$microcyclesleep","line":790,"containerName":"review_log","localvar":"my","definition":"my"},{"line":790,"containerName":"review_log","kind":13,"name":"$cyclesleep"},{"name":"$logger","line":792,"containerName":"review_log","kind":13},{"name":"info","containerName":"review_log","line":792,"kind":12},{"line":797,"containerName":"review_log","kind":13,"name":"$logger"},{"line":797,"containerName":"review_log","kind":12,"name":"info"},{"containerName":"review_log","line":798,"kind":13,"name":"$self"},{"name":"add_chain","kind":12,"containerName":"review_log","line":798},{"name":"$chain","kind":13,"containerName":"review_log","line":798},{"definition":"my","localvar":"my","containerName":"review_log","line":801,"kind":13,"name":"$globalchain"},{"line":801,"containerName":"review_log","kind":13,"name":"$self"},{"kind":13,"containerName":"review_log","line":802,"name":"$logger"},{"kind":12,"containerName":"review_log","line":802,"name":"debug"},{"kind":13,"line":803,"containerName":"review_log","name":"$self"},{"line":803,"containerName":"review_log","kind":12,"name":"iptablesqueue_enqueue"},{"name":"$self","line":805,"containerName":"review_log","kind":13},{"containerName":"review_log","line":805,"kind":12,"name":"add_logger_allow_deny_ips"},{"line":805,"containerName":"review_log","kind":13,"name":"$logobj"},{"kind":13,"name":"@directions","definition":"my","line":808,"containerName":"review_log","localvar":"my"},{"line":808,"containerName":"review_log","kind":13,"name":"$self"},{"kind":12,"line":808,"containerName":"review_log","name":"prepare_directions"},{"name":"$logobj","kind":13,"containerName":"review_log","line":808},{"definition":"my","localvar":"my","line":809,"containerName":"review_log","kind":13,"name":"@protocols"},{"kind":13,"containerName":"review_log","line":809,"name":"$logobj"},{"name":"$logobj","line":809,"containerName":"review_log","kind":13},{"name":"$ports","kind":13,"definition":"my","containerName":"review_log","line":810,"localvar":"my"},{"name":"$logobj","kind":13,"containerName":"review_log","line":810},{"containerName":"review_log","line":812,"kind":13,"name":"$cyclesleft"},{"localvar":"my","line":813,"containerName":"review_log","definition":"my","kind":13,"name":"$start_loop_time"},{"line":814,"containerName":"review_log","kind":13,"name":"$logger"},{"name":"info","line":814,"containerName":"review_log","kind":12},{"name":"$logobj","kind":13,"line":815,"containerName":"review_log"},{"name":"$self","kind":13,"containerName":"review_log","line":815},{"name":"readlogfile","kind":12,"containerName":"review_log","line":815},{"kind":13,"containerName":"review_log","line":815,"name":"$logobj"},{"name":"$logger","kind":13,"line":816,"containerName":"review_log"},{"name":"debug","kind":12,"containerName":"review_log","line":816},{"name":"$logobj","kind":13,"line":816,"containerName":"review_log"},{"kind":13,"line":816,"containerName":"review_log","name":"$logger"},{"line":816,"containerName":"review_log","kind":12,"name":"is_debug"},{"line":817,"containerName":"review_log","kind":13,"name":"$logobj"},{"kind":13,"line":818,"containerName":"review_log","name":"$logger"},{"name":"debug","line":818,"containerName":"review_log","kind":12},{"kind":13,"line":819,"containerName":"review_log","name":"$logobj"},{"line":819,"containerName":"review_log","kind":13,"name":"$reviewlogmodule"},{"name":"grep_regexps","line":819,"containerName":"review_log","kind":12},{"containerName":"review_log","line":819,"kind":13,"name":"$logobj"},{"name":"$logger","line":822,"containerName":"review_log","kind":13},{"kind":12,"line":822,"containerName":"review_log","name":"debug"},{"containerName":"review_log","line":822,"kind":13,"name":"$logobj"},{"containerName":"review_log","line":823,"kind":13,"name":"$logger"},{"kind":12,"containerName":"review_log","line":823,"name":"is_debug"},{"definition":"my","line":825,"containerName":"review_log","localvar":"my","name":"@rules","kind":13},{"kind":13,"name":"$ip","localvar":"my","line":826,"containerName":"review_log","definition":"my"},{"line":826,"containerName":"review_log","kind":13,"name":"$logobj"},{"name":"$logger","kind":13,"containerName":"review_log","line":827},{"name":"debug","containerName":"review_log","line":827,"kind":12},{"name":"$direction","kind":13,"definition":"my","localvar":"my","containerName":"review_log","line":828},{"name":"@directions","containerName":"review_log","line":828,"kind":13},{"localvar":"my","containerName":"review_log","line":829,"definition":"my","name":"$direction_switch","kind":13},{"name":"$direction","kind":13,"containerName":"review_log","line":829},{"kind":13,"name":"$randval","definition":"my","localvar":"my","line":830,"containerName":"review_log"},{"name":"$direction_switch","containerName":"review_log","line":831,"kind":13},{"kind":13,"containerName":"review_log","line":831,"name":"$direction"},{"kind":13,"containerName":"review_log","line":832,"name":"$logger"},{"line":832,"containerName":"review_log","kind":12,"name":"trace"},{"localvar":"my","line":833,"containerName":"review_log","definition":"my","name":"$base_rule","kind":13},{"name":"$logger","line":834,"containerName":"review_log","kind":13},{"name":"debug","containerName":"review_log","line":834,"kind":12},{"containerName":"review_log","line":836,"kind":13,"name":"@protocols"},{"name":"$logger","containerName":"review_log","line":837,"kind":13},{"containerName":"review_log","line":837,"kind":12,"name":"info"},{"kind":13,"line":838,"containerName":"review_log","name":"@rules"},{"kind":13,"name":"$protocol","definition":"my","line":841,"containerName":"review_log","localvar":"my"},{"name":"@protocols","containerName":"review_log","line":841,"kind":13},{"localvar":"my","containerName":"review_log","line":842,"definition":"my","name":"$rule","kind":13},{"name":"$base_rule","containerName":"review_log","line":842,"kind":13},{"name":"$logger","containerName":"review_log","line":843,"kind":13},{"line":843,"containerName":"review_log","kind":12,"name":"debug"},{"name":"$logobj","kind":13,"containerName":"review_log","line":844},{"kind":13,"line":847,"containerName":"review_log","name":"$rule"},{"kind":13,"line":849,"containerName":"review_log","name":"$logger"},{"line":849,"containerName":"review_log","kind":12,"name":"info"},{"name":"@rules","line":850,"containerName":"review_log","kind":13},{"containerName":"review_log","line":855,"kind":13,"name":"$logger"},{"name":"debug","line":855,"containerName":"review_log","kind":12},{"line":855,"containerName":"review_log","kind":13,"name":"@rules"},{"name":"$logger","line":856,"containerName":"review_log","kind":13},{"kind":12,"line":856,"containerName":"review_log","name":"is_debug"},{"name":"$eject","kind":13,"definition":"my","containerName":"review_log","line":857,"localvar":"my"},{"kind":13,"name":"@rules_enqueued","containerName":"review_log","line":858,"localvar":"my","definition":"my"},{"localvar":"my","line":859,"containerName":"review_log","definition":"my","kind":13,"name":"$rule"},{"name":"@rules","line":859,"containerName":"review_log","kind":13},{"kind":13,"line":860,"containerName":"review_log","name":"$tracker"},{"line":861,"containerName":"review_log","kind":13,"name":"$logger"},{"name":"debug","kind":12,"containerName":"review_log","line":861},{"name":"$args","kind":13,"definition":"my","containerName":"review_log","line":864,"localvar":"my"},{"name":"$logger","containerName":"review_log","line":868,"kind":13},{"kind":12,"containerName":"review_log","line":868,"name":"debug"},{"kind":13,"containerName":"review_log","line":869,"name":"$tracker"},{"name":"$logobj","line":872,"containerName":"review_log","kind":13},{"name":"$args","kind":13,"containerName":"review_log","line":872},{"name":"$self","kind":13,"containerName":"review_log","line":873},{"kind":12,"line":873,"containerName":"review_log","name":"iptablesqueue_enqueue"},{"kind":13,"line":873,"containerName":"review_log","name":"$args"},{"name":"$eject","kind":13,"line":873,"containerName":"review_log"}],"kind":12,"signature":{"documentation":" Description:  Reads the log file and adds IPs to the iptables queue\n               This is called as a thread and runs a loop to check the log file for new entries\n               Prior to checking the log file, it creates a chain for the log file and adds it to the global chain\n Future:       This entire sub needs to be refactored.\n               It's easy to folllow but it is:\n                 a) just too many lines for one sub\n                 b) way too heavily nested!\n Requires:     $self, $logobj\n Returns:      1 (usually) but could return 0 if something goes wrong","parameters":[],"label":"review_log()"},"detail":"()","range":{"start":{"character":0,"line":768},"end":{"line":874,"character":9999}},"definition":"sub","line":768,"containerName":"Net::IPBlocker"},{"kind":12,"line":770,"name":"threads"},{"kind":12,"line":782,"name":"configs"},{"name":"chainprefix","line":782,"kind":12},{"name":"chain","kind":12,"line":782},{"kind":12,"line":784,"name":"Dumper"},{"name":"cycles","line":787,"kind":12},{"line":787,"kind":12,"name":"LONG_MAX"},{"name":"cyclesleep","line":789,"kind":12},{"name":"configs","kind":12,"line":801},{"name":"globalchain","kind":12,"line":801},{"line":803,"kind":12,"name":"options"},{"kind":12,"line":803,"name":"rule"},{"line":809,"kind":12,"name":"protocols"},{"name":"protocols","line":809,"kind":12},{"name":"ports","kind":12,"line":810},{"line":816,"kind":12,"name":"Dumper"},{"kind":12,"line":817,"name":"logcontents"},{"name":"ips_to_block","kind":12,"line":819},{"name":"Dumper","kind":12,"line":822},{"name":"ips_to_block","line":822,"kind":12},{"line":826,"kind":12,"name":"ips_to_block"},{"line":844,"kind":12,"name":"ports"},{"line":855,"kind":12,"name":"Dumper"},{"line":860,"kind":12,"name":"iptables_rules"},{"line":865,"kind":12,"name":"options"},{"name":"rule","kind":12,"line":866},{"line":869,"kind":12,"name":"iptables_rules"},{"name":"enqueued_rules","line":872,"kind":12},{"localvar":"my","containerName":null,"line":876,"definition":"my","kind":13,"name":"$logmsg"},{"kind":13,"containerName":null,"line":877,"name":"$eject"},{"line":877,"containerName":null,"kind":13,"name":"$logger"},{"name":"info","kind":12,"containerName":"Net::IPBlocker","line":877},{"kind":13,"line":877,"containerName":null,"name":"$logmsg"},{"kind":13,"containerName":null,"line":879,"name":"%logobj"},{"name":"ips_to_block","line":879,"kind":12},{"kind":13,"containerName":null,"line":883,"name":"$self"},{"name":"iptablesqueue_enqueue","containerName":"Net::IPBlocker","line":883,"kind":12},{"name":"check_pending","kind":12,"line":883},{"containerName":null,"line":887,"kind":13,"name":"$reviewlogmodule"},{"name":"can","kind":12,"containerName":"Net::IPBlocker","line":887},{"name":"$reviewlogmodule","containerName":null,"line":888,"kind":13},{"name":"post_enqueue","containerName":"Net::IPBlocker","line":888,"kind":12},{"kind":13,"containerName":null,"line":888,"name":"$logobj"},{"definition":"my","localvar":"my","containerName":null,"line":891,"kind":13,"name":"$timediff"},{"kind":13,"containerName":null,"line":891,"name":"$start_loop_time"},{"kind":13,"line":892,"containerName":null,"name":"$timediff"},{"name":"$timediff","containerName":null,"line":892,"kind":13},{"name":"$logger","line":893,"containerName":null,"kind":13},{"kind":12,"containerName":"Net::IPBlocker","line":893,"name":"info"},{"kind":13,"line":895,"containerName":null,"name":"$cyclesleft"},{"kind":13,"line":896,"containerName":null,"name":"$logger"},{"containerName":"Net::IPBlocker","line":896,"kind":12,"name":"debug"},{"name":"usleep","kind":12,"line":897},{"kind":13,"line":897,"containerName":null,"name":"$microcyclesleep"},{"line":900,"containerName":null,"localvar":"my","definition":"my","kind":13,"name":"$runtime"},{"name":"$start_time","kind":13,"line":900,"containerName":null},{"name":"$runtime","containerName":null,"line":901,"kind":13},{"name":"$runtime","line":901,"containerName":null,"kind":13},{"definition":"my","line":902,"containerName":null,"localvar":"my","kind":13,"name":"$cycles_completed"},{"kind":13,"containerName":null,"line":902,"name":"%logobj"},{"name":"cycles","kind":12,"line":902},{"containerName":null,"line":902,"kind":13,"name":"$cyclesleft"},{"containerName":null,"line":903,"localvar":"my","definition":"my","kind":13,"name":"$logmsg"},{"kind":13,"line":904,"containerName":null,"name":"$logmsg"},{"name":"$logger","kind":13,"containerName":null,"line":905},{"name":"info","kind":12,"line":905,"containerName":"Net::IPBlocker"},{"name":"$logmsg","line":905,"containerName":null,"kind":13},{"children":[{"name":"$self","kind":13,"definition":"my","localvar":"my","line":914,"containerName":"load_configs"},{"kind":13,"name":"$configsfile","definition":"my","containerName":"load_configs","line":915,"localvar":"my"},{"name":"$self","line":915,"containerName":"load_configs","kind":13},{"kind":13,"name":"$clargs","localvar":"my","line":916,"containerName":"load_configs","definition":"my"},{"name":"$self","kind":13,"containerName":"load_configs","line":916},{"name":"$configsfile","containerName":"load_configs","line":918,"kind":13},{"name":"$self","containerName":"load_configs","line":920,"kind":13},{"name":"$self","kind":13,"containerName":"load_configs","line":920},{"name":"$self","kind":13,"containerName":"load_configs","line":921},{"name":"$self","line":921,"containerName":"load_configs","kind":13},{"kind":13,"containerName":"load_configs","line":922,"name":"$self"},{"name":"$msg","kind":13,"containerName":"load_configs","line":925,"localvar":"my","definition":"my"},{"name":"$msg","line":926,"containerName":"load_configs","kind":13},{"kind":13,"containerName":"load_configs","line":927,"name":"$msg"},{"kind":13,"line":927,"containerName":"load_configs","name":"$clargs"},{"line":928,"containerName":"load_configs","kind":13,"name":"$msg"},{"name":"$DEFAULTS","containerName":"load_configs","line":928,"kind":13},{"line":929,"containerName":"load_configs","kind":13,"name":"$msg"},{"name":"$msg","kind":13,"line":930,"containerName":"load_configs"},{"kind":13,"containerName":"load_configs","line":931,"name":"$msg"},{"name":"$config","kind":13,"definition":"my","line":934,"containerName":"load_configs","localvar":"my"},{"containerName":"load_configs","line":934,"kind":13,"name":"$DEFAULTS"}],"name":"load_configs","kind":12,"containerName":"Net::IPBlocker","line":913,"range":{"start":{"character":0,"line":913},"end":{"character":9999,"line":934}},"definition":"sub"},{"kind":12,"line":915,"name":"configsfile"},{"kind":12,"line":916,"name":"clargs"},{"line":920,"kind":12,"name":"configs"},{"line":920,"containerName":"File::read_config_file","kind":12,"name":"Config"},{"line":920,"kind":12,"name":"configsfile"},{"kind":12,"line":921,"name":"configs"},{"line":921,"kind":12,"name":"globalchain"},{"name":"configs","line":921,"kind":12},{"name":"globalchain","kind":12,"line":921},{"line":922,"kind":12,"name":"configs"},{"line":922,"kind":12,"name":"globalchain"},{"line":927,"kind":12,"name":"Dumper"},{"name":"Dumper","line":928,"kind":12},{"name":"carp","kind":12,"line":930},{"name":"%self","line":937,"containerName":null,"kind":13},{"kind":12,"line":937,"name":"configs"},{"name":"$config","kind":13,"line":937,"containerName":null},{"name":"%clargs","kind":13,"line":938,"containerName":null},{"name":"$config","line":938,"containerName":null,"kind":13},{"kind":13,"line":939,"containerName":null,"name":"%clargs"},{"name":"$config","kind":13,"line":939,"containerName":null},{"line":940,"containerName":null,"kind":13,"name":"%self"},{"name":"configs","kind":12,"line":940},{"kind":13,"line":940,"containerName":null,"name":"$config"},{"name":"%DEFAULTS","containerName":null,"line":940,"kind":13},{"name":"$config","line":940,"containerName":null,"kind":13},{"name":"%self","containerName":null,"line":943,"kind":13},{"name":"configs","kind":12,"line":943},{"detail":"()","range":{"start":{"line":1056,"character":0},"end":{"character":9999,"line":1156}},"definition":"sub","line":1056,"containerName":"Net::IPBlocker","name":"run_iptables","children":[{"containerName":"run_iptables","line":1057,"localvar":"my","definition":"my","kind":13,"name":"$self"},{"kind":13,"line":1057,"containerName":"run_iptables","name":"$args"},{"localvar":"my","line":1058,"containerName":"run_iptables","definition":"my","name":"@caller_lst","kind":13},{"kind":13,"containerName":"run_iptables","line":1059,"name":"$caller_lst"},{"name":"$IPTABLESRUNLINE","line":1059,"containerName":"run_iptables","kind":13},{"name":"$IPTABLESRUNLINE","containerName":"run_iptables","line":1059,"kind":13},{"line":1060,"containerName":"run_iptables","localvar":"my","definition":"my","kind":13,"name":"$logmsg"},{"name":"@caller_lst","kind":13,"line":1063,"containerName":"run_iptables"},{"name":"$logger","containerName":"run_iptables","line":1068,"kind":13},{"name":"error","line":1068,"containerName":"run_iptables","kind":12},{"line":1068,"containerName":"run_iptables","kind":13,"name":"$logmsg"},{"kind":13,"name":"$TID","localvar":"my","line":1070,"containerName":"run_iptables","definition":"my"},{"containerName":"run_iptables","line":1070,"kind":12,"name":"tid"},{"name":"$TID","containerName":"run_iptables","line":1071,"kind":13},{"containerName":"run_iptables","line":1071,"kind":13,"name":"$TID"},{"kind":13,"line":1074,"containerName":"run_iptables","name":"$args"},{"kind":13,"containerName":"run_iptables","line":1074,"name":"$logger"},{"containerName":"run_iptables","line":1074,"kind":12,"name":"error"},{"name":"$self","kind":13,"containerName":"run_iptables","line":1075},{"kind":13,"line":1075,"containerName":"run_iptables","name":"$logger"},{"name":"error","line":1075,"containerName":"run_iptables","kind":12},{"definition":"my","localvar":"my","containerName":"run_iptables","line":1077,"name":"$iptables","kind":13},{"name":"$self","kind":13,"containerName":"run_iptables","line":1077},{"line":1078,"containerName":"run_iptables","localvar":"my","definition":"my","kind":13,"name":"$rule"},{"containerName":"run_iptables","line":1078,"kind":13,"name":"$args"},{"name":"$options","kind":13,"localvar":"my","line":1079,"containerName":"run_iptables","definition":"my"},{"line":1079,"containerName":"run_iptables","kind":13,"name":"$args"},{"name":"$logger","kind":13,"containerName":"run_iptables","line":1081},{"kind":12,"line":1081,"containerName":"run_iptables","name":"is_debug"},{"name":"$logger","containerName":"run_iptables","line":1082,"kind":13},{"containerName":"run_iptables","line":1082,"kind":12,"name":"debug"},{"kind":13,"containerName":"run_iptables","line":1083,"name":"$args"},{"line":1091,"containerName":"run_iptables","kind":13,"name":"$args"},{"definition":"my","containerName":"run_iptables","line":1092,"localvar":"my","kind":13,"name":"$allowdupes"},{"name":"$args","containerName":"run_iptables","line":1092,"kind":13},{"name":"$allowdupes","line":1094,"containerName":"run_iptables","kind":13},{"kind":13,"containerName":"run_iptables","line":1095,"name":"$logger"},{"kind":12,"line":1095,"containerName":"run_iptables","name":"debug"},{"kind":13,"name":"$retval","containerName":"run_iptables","line":1096,"localvar":"my","definition":"my"},{"name":"$self","kind":13,"containerName":"run_iptables","line":1096},{"kind":12,"line":1096,"containerName":"run_iptables","name":"check_if_rule_exists"},{"name":"$args","containerName":"run_iptables","line":1096,"kind":13},{"name":"$retval","containerName":"run_iptables","line":1097,"kind":13},{"kind":13,"name":"$logmsg","definition":"my","localvar":"my","line":1098,"containerName":"run_iptables"},{"name":"$logmsg","kind":13,"containerName":"run_iptables","line":1099},{"name":"$logger","kind":13,"containerName":"run_iptables","line":1100},{"name":"debug","kind":12,"containerName":"run_iptables","line":1100},{"name":"$logmsg","line":1100,"containerName":"run_iptables","kind":13},{"name":"$tracker","containerName":"run_iptables","line":1102,"kind":13},{"name":"$rule","kind":13,"line":1102,"containerName":"run_iptables"},{"name":"$retval","kind":13,"containerName":"run_iptables","line":1105},{"name":"$logger","kind":13,"containerName":"run_iptables","line":1108},{"kind":12,"line":1108,"containerName":"run_iptables","name":"debug"},{"kind":13,"containerName":"run_iptables","line":1110,"name":"$tracker"},{"containerName":"run_iptables","line":1110,"kind":13,"name":"$rule"},{"kind":13,"line":1113,"containerName":"run_iptables","name":"$retval"},{"name":"$logger","kind":13,"containerName":"run_iptables","line":1114},{"name":"debug","kind":12,"line":1114,"containerName":"run_iptables"},{"containerName":"run_iptables","line":1116,"kind":13,"name":"$retval"},{"kind":13,"line":1116,"containerName":"run_iptables","name":"$options"},{"kind":13,"containerName":"run_iptables","line":1119,"name":"$logger"},{"kind":12,"line":1119,"containerName":"run_iptables","name":"debug"},{"name":"$tracker","kind":13,"line":1122,"containerName":"run_iptables"},{"name":"$rule","kind":13,"containerName":"run_iptables","line":1122},{"name":"$retval","kind":13,"containerName":"run_iptables","line":1124},{"kind":13,"line":1125,"containerName":"run_iptables","name":"$logger"},{"name":"error","kind":12,"line":1125,"containerName":"run_iptables"},{"name":"$retval","kind":13,"containerName":"run_iptables","line":1128},{"definition":"my","line":1129,"containerName":"run_iptables","localvar":"my","kind":13,"name":"$logmsg"},{"name":"$logmsg","kind":13,"containerName":"run_iptables","line":1130},{"name":"$logger","kind":13,"containerName":"run_iptables","line":1131},{"kind":12,"line":1131,"containerName":"run_iptables","name":"error"},{"line":1131,"containerName":"run_iptables","kind":13,"name":"$logmsg"},{"kind":13,"containerName":"run_iptables","line":1135,"name":"$logger"},{"kind":12,"containerName":"run_iptables","line":1135,"name":"error"},{"name":"$retval","kind":13,"containerName":"run_iptables","line":1135},{"name":"$command","kind":13,"definition":"my","containerName":"run_iptables","line":1140,"localvar":"my"},{"name":"$tracker","line":1141,"containerName":"run_iptables","kind":13},{"name":"$rule","containerName":"run_iptables","line":1141,"kind":13},{"containerName":"run_iptables","line":1142,"kind":13,"name":"$self"},{"name":"$logger","containerName":"run_iptables","line":1143,"kind":13},{"name":"debug","containerName":"run_iptables","line":1143,"kind":12},{"line":1144,"containerName":"run_iptables","localvar":"my","definition":"my","kind":13,"name":"$output"},{"line":1145,"containerName":"run_iptables","kind":13,"name":"$logger"},{"name":"debug","containerName":"run_iptables","line":1145,"kind":12},{"name":"$logger","line":1149,"containerName":"run_iptables","kind":13},{"containerName":"run_iptables","line":1149,"kind":12,"name":"info"},{"name":"$logger","kind":13,"line":1154,"containerName":"run_iptables"},{"name":"error","line":1154,"containerName":"run_iptables","kind":12}],"kind":12,"signature":{"label":"run_iptables()","parameters":[],"documentation":" Special helper function for clean_ips_to_block()\n Description:  A helper function for clean_ips_to_block_allowdeny()\n Returns:      A hash reference of IPs\n sub reverseMapHash() {\n     my $self = shift;\n     my $hash = shift;\n     my $new_hash = {};\n     foreach my $key ( sort keys %{$hash} ) {\n         $new_hash->{ $hash->{$key} }++;\n     }\n     return $new_hash;\n } ## end sub reverseMapHash\n Description: Returns the logobj with ips_to_block set with the IPs to block from the allow/deny lists\n   There is a lot of logging available in this sub.\n   This sub is called from review_log()\n sub clean_ips_to_block_allowdeny() {\n     my $self   = shift;\n     my $logobj = shift;\n     my $TID    = threads->tid;\n     $TID = \"TID: \" . $TID;\n     local $Data::Dumper::Terse  = 1;    # Disable use of $VARn\n     local $Data::Dumper::Indent = 0;    # Disable indentation\n     # $logger->debug(\"Reviewing log object: \" . Dumper($logobj)) if ( $logger->is_debug() );\n     my $allowdeny        = $logobj->{allowdeny}          ||= $self->{configs}->{allowdeny} ||= \"\";\n     my $logobj_allowlist = $logobj->{allowlist}          ||= $self->{configs}->{allowlist} ||= {};\n     my $logobj_denylist  = $logobj->{denylist}           ||= $self->{configs}->{denylist}  ||= {};\n     my $global_denylist  = $self->{configs}->{denylist}  ||= {};\n     my $global_allowlist = $self->{configs}->{allowlist} ||= {};\n     my $ips_to_block = $logobj->{ips_to_block} ||= {};\n     # Due to the configs module, need to reverse map the allowlists and denylists\n     $logobj_allowlist = $self->reverseMapHash($logobj_allowlist);\n     $logobj_denylist  = $self->reverseMapHash($logobj_denylist);\n     $global_allowlist = $self->reverseMapHash($global_allowlist);\n     $global_denylist  = $self->reverseMapHash($global_denylist);\n     # Some logging info:\n     $logger->info(\"$TID|Allow/Deny: $allowdeny\");\n     $logger->debug( \"$TID|Logobj allowlist: \" . Dumper($logobj_allowlist) ) if ( $logger->is_debug() );\n     $logger->debug( \"$TID|Logobj denylist: \" . Dumper($logobj_denylist) )   if ( $logger->is_debug() );\n     $logger->debug( \"$TID|Logobj ips_to_block: \" . Dumper($ips_to_block) )  if ( $logger->is_debug() );\n     $logger->debug( \"$TID|Global allowlist: \" . Dumper($global_allowlist) ) if ( $logger->is_debug() );\n     $logger->debug( \"$TID|Global denylist: \" . Dumper($global_denylist) )   if ( $logger->is_debug() );\n     # Combine global and logobj allowlist and denylist\n     my $allowlist = { %{$global_allowlist}, %{$logobj_allowlist} };\n     my $denylist  = { %{$global_denylist},  %{$logobj_denylist} };\n     # More logging info:\n     $logger->debug( \"$TID|Combined allowlist: \" . Dumper($allowlist) ) if ( $logger->is_debug() );\n     $logger->debug( \"$TID|Combined denylist: \" . Dumper($denylist) )   if ( $logger->is_debug() );\n     # Combine denylist with ips_to_block\n     $denylist = { %{$denylist}, %{$ips_to_block} };\n     # More logging info:\n     $logger->debug( \"$TID|Combined denylist with ips_to_block: \" . Dumper($denylist) ) if ( $logger->is_debug() );\n     # This is the meat of the function....\n     ## If we Deny first then then no need to remove IPs from the denylist\n     if ( $allowdeny eq 'Deny,Allow' ) {\n         $logobj->{ips_to_block} = $denylist;\n         $logger->debug( \"$TID|Returning logobj with ips_to_block of: \" . Dumper( $logobj->{ips_to_block} ) )\n           if ( $logger->is_debug() );\n         return $logobj;\n     } ## end if ( $allowdeny eq 'Deny,Allow')\n     ## If we Allow first then we need to remove IPs from the denylist\n     ## The map below removes allowlist from denylist\n     ## The || (or) is used to prevent undef errors\n     map { delete $denylist->{$_} || $_ } keys %{$allowlist};\n     $logobj->{ips_to_block} = $denylist;\n     $logger->debug( \"$TID|Returning logobj with ips_to_block of: \" . Dumper( $logobj->{ips_to_block} ) )\n       if ( $logger->is_debug() );\n     return $logobj;\n } ## end sub clean_ips_to_block_allowdeny\n Runs whatever parameters are passed to it against iptables\n  This is intended to be a one stop shop for running iptables out from a queue.\n  However, there are a few instances where it is called directly... especially when creating chains\n   This hopefully prevents excessive wait/locking on iptables\n   and helps to keep commands running in the order they are received.\n Arguments must be passed as a hash reference with (so far) the following keys:\n   rule:  The rule to run\n   options:  Any options to pass to iptables\n  Where it is ran like this:\n   iptables $options $rule 2>&1\n Future enhancement:\n   1. delete existing rule if it exists\n Take note this sub is intended (but not required) to be called from sub iptables_thread()\n  An error will happen if not called from sub iptables_thread(), but it will not stop the program\n  This is to encourage using the iptablesqueue_enqueue() sub instead of run_iptables() directly\n  So, to say this more clearly, if you want to run iptables commands, then call iptablesqueue_enqueue()\n Description:  Runs iptables commands.  This is intended to be a one stop shop for running iptables out from a queue.\n               However, there are a few instances where it is called directly... especially when creating chains\n               This hopefully prevents excessive wait/locking on iptables and helps to keep commands running in the\n               order they are received.\n               If the calling sub is not sub iptables_thread, then an error is thrown but the program continues.\n               This is to encourage using the iptablesqueue_enqueue() sub instead of run_iptables() directly.\n Arguments:    $self, $args (hash reference)\n               $args->{rule} (string) - The rule to run\n               $args->{options} (string) - Any options to pass to iptables (like -N or -A)\n Returns:      1 if successful, otherwise 0"}},{"name":"Dumper","line":1063,"kind":12},{"name":"threads","line":1070,"kind":12},{"name":"rule","line":1074,"kind":12},{"line":1075,"kind":12,"name":"configs"},{"kind":12,"line":1075,"name":"iptables"},{"line":1077,"kind":12,"name":"configs"},{"kind":12,"line":1077,"name":"iptables"},{"name":"rule","line":1078,"kind":12},{"name":"options","line":1079,"kind":12},{"line":1083,"kind":12,"name":"Dumper"},{"name":"allowdupes","line":1091,"kind":12},{"kind":12,"line":1092,"name":"allowdupes"},{"line":1102,"kind":12,"name":"iptables_rules"},{"line":1110,"kind":12,"name":"iptables_rules"},{"name":"chains_created","line":1122,"kind":12},{"kind":12,"line":1141,"name":"iptables_rules"},{"name":"configs","line":1142,"kind":12},{"name":"PRODMODE","line":1142,"kind":12},{"detail":"()","definition":"sub","range":{"start":{"character":0,"line":1161},"end":{"line":1169,"character":9999}},"line":1161,"containerName":"Net::IPBlocker","name":"set_iptables_command","children":[{"name":"$self","kind":13,"definition":"my","line":1162,"containerName":"set_iptables_command","localvar":"my"},{"name":"$self","kind":13,"line":1165,"containerName":"set_iptables_command"},{"name":"$self","kind":13,"containerName":"set_iptables_command","line":1166},{"name":"$logger","containerName":"set_iptables_command","line":1167,"kind":13},{"line":1167,"containerName":"set_iptables_command","kind":12,"name":"info"}],"kind":12,"signature":{"parameters":[],"label":"set_iptables_command()","documentation":" Description:  Finds the iptables command to use\n Returns:      1 always"}},{"name":"configs","line":1165,"kind":12},{"line":1165,"kind":12,"name":"iptables"},{"kind":12,"line":1166,"name":"configs"},{"name":"iptables","line":1166,"kind":12},{"signature":{"documentation":" Description:  Checks if a command already exists in the iptables queue or in the tracker config\n               This is used to prevent duplicate rules from being added to the iptables queue\n Returns:      Multiple scalar strings returns with specific meanings.  See code for details","parameters":[{"label":"$self"},{"label":"$args"}],"label":"check_if_rule_exists($self,$args)"},"kind":12,"children":[{"name":"$self","kind":13,"localvar":"my","line":1175,"containerName":"check_if_rule_exists","definition":"my"},{"containerName":"check_if_rule_exists","line":1175,"kind":13,"name":"$args"},{"name":"$TID","kind":13,"localvar":"my","line":1176,"containerName":"check_if_rule_exists","definition":"my"},{"containerName":"check_if_rule_exists","line":1176,"kind":12,"name":"tid"},{"kind":13,"containerName":"check_if_rule_exists","line":1177,"name":"$TID"},{"name":"$TID","kind":13,"line":1177,"containerName":"check_if_rule_exists"},{"name":"$args","containerName":"check_if_rule_exists","line":1180,"kind":13},{"kind":13,"containerName":"check_if_rule_exists","line":1180,"name":"$self"},{"name":"error","line":1180,"containerName":"check_if_rule_exists","kind":12},{"line":1181,"containerName":"check_if_rule_exists","kind":13,"name":"$self"},{"kind":13,"line":1181,"containerName":"check_if_rule_exists","name":"$logger"},{"kind":12,"line":1181,"containerName":"check_if_rule_exists","name":"error"},{"definition":"my","localvar":"my","line":1183,"containerName":"check_if_rule_exists","kind":13,"name":"$iptables"},{"name":"$self","line":1183,"containerName":"check_if_rule_exists","kind":13},{"kind":13,"name":"$rule","definition":"my","line":1184,"containerName":"check_if_rule_exists","localvar":"my"},{"name":"$args","kind":13,"containerName":"check_if_rule_exists","line":1184},{"kind":13,"name":"$options","localvar":"my","containerName":"check_if_rule_exists","line":1185,"definition":"my"},{"containerName":"check_if_rule_exists","line":1185,"kind":13,"name":"$args"},{"name":"$tracker","kind":13,"line":1187,"containerName":"check_if_rule_exists"},{"name":"$rule","containerName":"check_if_rule_exists","line":1187,"kind":13},{"name":"$logger","containerName":"check_if_rule_exists","line":1188,"kind":13},{"line":1188,"containerName":"check_if_rule_exists","kind":12,"name":"debug"},{"containerName":"check_if_rule_exists","line":1192,"kind":13,"name":"$tracker"},{"kind":13,"containerName":"check_if_rule_exists","line":1192,"name":"$rule"},{"name":"$logger","kind":13,"containerName":"check_if_rule_exists","line":1193},{"kind":12,"containerName":"check_if_rule_exists","line":1193,"name":"debug"},{"name":"$options","kind":13,"containerName":"check_if_rule_exists","line":1197},{"kind":13,"name":"$logmsg","line":1198,"containerName":"check_if_rule_exists","localvar":"my","definition":"my"},{"name":"$logmsg","kind":13,"line":1199,"containerName":"check_if_rule_exists"},{"name":"$logger","kind":13,"line":1200,"containerName":"check_if_rule_exists"},{"line":1200,"containerName":"check_if_rule_exists","kind":12,"name":"debug"},{"name":"$logmsg","containerName":"check_if_rule_exists","line":1200,"kind":13},{"definition":"my","localvar":"my","line":1204,"containerName":"check_if_rule_exists","name":"$checkrule_result","kind":13},{"name":"$logger","containerName":"check_if_rule_exists","line":1206,"kind":13},{"kind":12,"line":1206,"containerName":"check_if_rule_exists","name":"debug"},{"containerName":"check_if_rule_exists","line":1210,"kind":13,"name":"$checkrule_result"},{"name":"$logger","line":1211,"containerName":"check_if_rule_exists","kind":13},{"containerName":"check_if_rule_exists","line":1211,"kind":12,"name":"debug"},{"name":"$logger","line":1212,"containerName":"check_if_rule_exists","kind":13},{"name":"debug","kind":12,"line":1212,"containerName":"check_if_rule_exists"},{"name":"$checkrule_result","line":1216,"containerName":"check_if_rule_exists","kind":13},{"name":"$logger","kind":13,"line":1217,"containerName":"check_if_rule_exists"},{"name":"debug","kind":12,"line":1217,"containerName":"check_if_rule_exists"},{"name":"$logger","kind":13,"line":1218,"containerName":"check_if_rule_exists"},{"containerName":"check_if_rule_exists","line":1218,"kind":12,"name":"debug"},{"kind":13,"line":1222,"containerName":"check_if_rule_exists","name":"$checkrule_result"},{"kind":13,"containerName":"check_if_rule_exists","line":1223,"name":"$logger"},{"name":"debug","kind":12,"line":1223,"containerName":"check_if_rule_exists"},{"name":"$logger","kind":13,"containerName":"check_if_rule_exists","line":1224},{"containerName":"check_if_rule_exists","line":1224,"kind":12,"name":"debug"},{"name":"$self","kind":13,"line":1228,"containerName":"check_if_rule_exists"},{"name":"error","kind":12,"containerName":"check_if_rule_exists","line":1228}],"name":"check_if_rule_exists","containerName":"Net::IPBlocker","line":1174,"range":{"start":{"character":0,"line":1174},"end":{"line":1229,"character":9999}},"definition":"sub","detail":"($self,$args)"},{"kind":12,"line":1176,"name":"threads"},{"name":"rule","line":1180,"kind":12},{"line":1181,"kind":12,"name":"configs"},{"name":"iptables","line":1181,"kind":12},{"kind":12,"line":1183,"name":"configs"},{"name":"iptables","line":1183,"kind":12},{"kind":12,"line":1184,"name":"rule"},{"kind":12,"line":1185,"name":"options"},{"kind":12,"line":1187,"name":"chains_created"},{"name":"iptables_rules","kind":12,"line":1192},{"line":1236,"containerName":"Net::IPBlocker","definition":"sub","range":{"start":{"line":1236,"character":0},"end":{"line":1264,"character":9999}},"detail":"()","signature":{"documentation":" Description:  Creates the global chain and then adds jump rule(s) to the global chain.\n               With default values this means creating the global chain \"IPBLOCKER_global\" and then\n               adding a jump rule to the INPUT, OUTPUT, and FORWARD tables to go to IPBLOCKER_global\n               Actually, this enqueue's the commands via the iptablesqueue_enqueue() sub\n Returns:      1 if able to enqueue commands otherwise 0","parameters":[],"label":"add_global_chain()"},"kind":12,"children":[{"line":1237,"containerName":"add_global_chain","localvar":"my","definition":"my","name":"$self","kind":13},{"name":"$TID","kind":13,"localvar":"my","line":1238,"containerName":"add_global_chain","definition":"my"},{"name":"tid","line":1238,"containerName":"add_global_chain","kind":12},{"kind":13,"containerName":"add_global_chain","line":1239,"name":"$TID"},{"containerName":"add_global_chain","line":1239,"kind":13,"name":"$TID"},{"name":"$chain","kind":13,"line":1241,"containerName":"add_global_chain","localvar":"my","definition":"my"},{"kind":13,"containerName":"add_global_chain","line":1241,"name":"$self"},{"name":"$logger","containerName":"add_global_chain","line":1241,"kind":13},{"name":"logdie","kind":12,"line":1241,"containerName":"add_global_chain"},{"kind":13,"line":1242,"containerName":"add_global_chain","name":"$chain"},{"name":"$chain","kind":13,"containerName":"add_global_chain","line":1242},{"definition":"my","localvar":"my","containerName":"add_global_chain","line":1244,"kind":13,"name":"$globalchains_str"},{"name":"$self","line":1244,"containerName":"add_global_chain","kind":13},{"name":"$logger","line":1244,"containerName":"add_global_chain","kind":13},{"name":"logdie","line":1244,"containerName":"add_global_chain","kind":12},{"definition":"my","containerName":"add_global_chain","line":1245,"localvar":"my","name":"@globalchains","kind":13},{"name":"$globalchains_str","kind":13,"line":1245,"containerName":"add_global_chain"},{"name":"$logger","kind":13,"containerName":"add_global_chain","line":1247},{"name":"info","containerName":"add_global_chain","line":1247,"kind":12},{"line":1248,"containerName":"add_global_chain","localvar":"my","definition":"my","kind":13,"name":"$args"},{"name":"$self","kind":13,"containerName":"add_global_chain","line":1252},{"kind":12,"containerName":"add_global_chain","line":1252,"name":"iptablesqueue_enqueue"},{"name":"$args","line":1252,"containerName":"add_global_chain","kind":13},{"name":"$logger","containerName":"add_global_chain","line":1254,"kind":13},{"name":"info","kind":12,"line":1254,"containerName":"add_global_chain"},{"name":"$table","kind":13,"definition":"my","localvar":"my","line":1255,"containerName":"add_global_chain"},{"name":"@globalchains","line":1255,"containerName":"add_global_chain","kind":13},{"name":"$args","kind":13,"definition":"my","localvar":"my","line":1256,"containerName":"add_global_chain"},{"name":"$self","kind":13,"containerName":"add_global_chain","line":1260},{"line":1260,"containerName":"add_global_chain","kind":12,"name":"iptablesqueue_enqueue"},{"name":"$args","kind":13,"containerName":"add_global_chain","line":1260}],"name":"add_global_chain"},{"name":"threads","kind":12,"line":1238},{"line":1241,"kind":12,"name":"configs"},{"line":1241,"kind":12,"name":"chainprefix"},{"name":"configs","kind":12,"line":1244},{"name":"globalchains","line":1244,"kind":12},{"name":"options","kind":12,"line":1249},{"name":"rule","line":1250,"kind":12},{"line":1257,"kind":12,"name":"options"},{"kind":12,"line":1258,"name":"rule"},{"detail":"()","line":1269,"containerName":"Net::IPBlocker","definition":"sub","range":{"start":{"line":1269,"character":0},"end":{"line":1285,"character":9999}},"children":[{"localvar":"my","containerName":"iptablesqueue_enqueue","line":1270,"definition":"my","name":"$self","kind":13},{"name":"$args","containerName":"iptablesqueue_enqueue","line":1270,"kind":13},{"definition":"my","containerName":"iptablesqueue_enqueue","line":1271,"localvar":"my","name":"$TID","kind":13},{"name":"tid","kind":12,"line":1271,"containerName":"iptablesqueue_enqueue"},{"name":"$TID","kind":13,"containerName":"iptablesqueue_enqueue","line":1272},{"kind":13,"containerName":"iptablesqueue_enqueue","line":1272,"name":"$TID"},{"kind":13,"name":"$iptablesQueue_pending","definition":"my","containerName":"iptablesqueue_enqueue","line":1274,"localvar":"my"},{"line":1274,"containerName":"iptablesqueue_enqueue","kind":13,"name":"$IptablesQueue"},{"kind":12,"containerName":"iptablesqueue_enqueue","line":1274,"name":"pending"},{"name":"$iptablesQueue_pending","kind":13,"containerName":"iptablesqueue_enqueue","line":1275},{"localvar":"my","containerName":"iptablesqueue_enqueue","line":1276,"definition":"my","kind":13,"name":"$logmsg"},{"name":"$logmsg","kind":13,"containerName":"iptablesqueue_enqueue","line":1277},{"kind":13,"containerName":"iptablesqueue_enqueue","line":1278,"name":"$logger"},{"name":"info","kind":12,"containerName":"iptablesqueue_enqueue","line":1278},{"name":"$logmsg","line":1278,"containerName":"iptablesqueue_enqueue","kind":13},{"kind":13,"line":1281,"containerName":"iptablesqueue_enqueue","name":"$args"},{"name":"$logger","kind":13,"containerName":"iptablesqueue_enqueue","line":1282},{"name":"debug","kind":12,"line":1282,"containerName":"iptablesqueue_enqueue"},{"name":"$args","kind":13,"line":1282,"containerName":"iptablesqueue_enqueue"},{"name":"$logger","containerName":"iptablesqueue_enqueue","line":1282,"kind":13},{"containerName":"iptablesqueue_enqueue","line":1282,"kind":12,"name":"is_debug"},{"kind":13,"containerName":"iptablesqueue_enqueue","line":1283,"name":"$IptablesQueue"},{"name":"enqueue","kind":12,"containerName":"iptablesqueue_enqueue","line":1283},{"name":"$args","line":1283,"containerName":"iptablesqueue_enqueue","kind":13}],"name":"iptablesqueue_enqueue","signature":{"documentation":" Description: Queues items onto the iptables queue\n Returns 1 if queue is allowing enqueuing\n Returns 0 if queue is not allowing enqueuing","parameters":[],"label":"iptablesqueue_enqueue()"},"kind":12},{"name":"threads","line":1271,"kind":12},{"name":"check_pending","kind":12,"line":1281},{"name":"Dumper","kind":12,"line":1282},{"detail":"($self,$logobj)","range":{"start":{"character":0,"line":1296},"end":{"character":9999,"line":1341}},"definition":"sub","line":1296,"containerName":"Net::IPBlocker","name":"readlogfile","children":[{"line":1297,"containerName":"readlogfile","localvar":"my","definition":"my","name":"$self","kind":13},{"name":"$logobj","containerName":"readlogfile","line":1297,"kind":13},{"kind":13,"name":"$TID","containerName":"readlogfile","line":1298,"localvar":"my","definition":"my"},{"name":"tid","kind":12,"containerName":"readlogfile","line":1298},{"name":"$TID","line":1299,"containerName":"readlogfile","kind":13},{"name":"$TID","kind":13,"line":1299,"containerName":"readlogfile"},{"definition":"my","localvar":"my","containerName":"readlogfile","line":1302,"kind":13,"name":"$file"},{"name":"$logobj","kind":13,"line":1302,"containerName":"readlogfile"},{"containerName":"readlogfile","line":1303,"kind":13,"name":"$file"},{"kind":13,"containerName":"readlogfile","line":1303,"name":"$logger"},{"containerName":"readlogfile","line":1303,"kind":12,"name":"error"},{"line":1303,"containerName":"readlogfile","kind":13,"name":"$logobj"},{"name":"$logobj","kind":13,"containerName":"readlogfile","line":1306},{"line":1307,"containerName":"readlogfile","kind":13,"name":"$logobj"},{"containerName":"readlogfile","line":1307,"kind":13,"name":"$file"},{"kind":13,"line":1307,"containerName":"readlogfile","name":"$logobj"},{"kind":13,"line":1308,"containerName":"readlogfile","name":"$logobj"},{"containerName":"readlogfile","line":1308,"kind":13,"name":"$self"},{"name":"$logobj","kind":13,"line":1309,"containerName":"readlogfile"},{"line":1309,"containerName":"readlogfile","kind":13,"name":"$logobj"},{"name":"$logger","containerName":"readlogfile","line":1311,"kind":13},{"containerName":"readlogfile","line":1311,"kind":12,"name":"debug"},{"definition":"my","containerName":"readlogfile","line":1317,"localvar":"my","kind":13,"name":"$fh"},{"kind":13,"line":1317,"containerName":"readlogfile","name":"$file"},{"line":1318,"containerName":"readlogfile","kind":13,"name":"$logger"},{"kind":12,"containerName":"readlogfile","line":1318,"name":"error"},{"name":"$logobj","containerName":"readlogfile","line":1319,"kind":13},{"name":"$fh","kind":13,"line":1321,"containerName":"readlogfile"},{"line":1321,"containerName":"readlogfile","kind":13,"name":"$logobj"},{"localvar":"my","containerName":"readlogfile","line":1322,"definition":"my","name":"@logcontents","kind":13},{"name":"$fh","kind":13,"line":1322,"containerName":"readlogfile"},{"containerName":"readlogfile","line":1323,"kind":13,"name":"$logobj"},{"name":"$fh","containerName":"readlogfile","line":1323,"kind":13},{"kind":13,"containerName":"readlogfile","line":1324,"name":"$fh"},{"name":"@logcontents","line":1326,"containerName":"readlogfile","kind":13},{"line":1327,"containerName":"readlogfile","kind":13,"name":"$logger"},{"name":"debug","containerName":"readlogfile","line":1327,"kind":12},{"name":"@logcontents","line":1327,"containerName":"readlogfile","kind":13},{"name":"$logger","kind":13,"containerName":"readlogfile","line":1330},{"containerName":"readlogfile","line":1330,"kind":12,"name":"info"},{"line":1331,"containerName":"readlogfile","kind":13,"name":"$logobj"},{"name":"@logcontents","kind":13,"line":1334,"containerName":"readlogfile"},{"name":"$logobj","kind":13,"line":1335,"containerName":"readlogfile"},{"kind":13,"containerName":"readlogfile","line":1335,"name":"@logcontents"},{"kind":13,"containerName":"readlogfile","line":1337,"name":"$logger"},{"name":"debug","line":1337,"containerName":"readlogfile","kind":12},{"line":1337,"containerName":"readlogfile","kind":13,"name":"@logcontents"},{"name":"$logger","containerName":"readlogfile","line":1338,"kind":13},{"name":"trace","containerName":"readlogfile","line":1338,"kind":12},{"name":"$logobj","containerName":"readlogfile","line":1338,"kind":13},{"name":"$logger","containerName":"readlogfile","line":1338,"kind":13},{"containerName":"readlogfile","line":1338,"kind":12,"name":"is_trace"},{"name":"$logobj","containerName":"readlogfile","line":1340,"kind":13}],"kind":12,"signature":{"parameters":[{"label":"$self"},{"label":"$logobj"}],"label":"readlogfile($self,$logobj)","documentation":" This function reads the log file into memory from the seek position (if it exists)\n The reading of a log file based on the seek position creates a big issue if the log file is rotated AND is larger than\n   the seek position\n   This is a tradeoff of reading the entire log file into memory and then grepping for the regexps\n Returns: $logobj\n Description:  Reads the log file into memory based on whether or not the readentirefile flag is set\n Requires:     $self, $logobj\n Returns:      $logobj with the logcontents set"}},{"name":"threads","line":1298,"kind":12},{"kind":12,"line":1302,"name":"file"},{"kind":12,"line":1306,"name":"seek"},{"name":"seek","line":1307,"kind":12},{"name":"seek","line":1307,"kind":12},{"kind":12,"line":1308,"name":"readentirefile"},{"name":"configs","line":1308,"kind":12},{"line":1308,"kind":12,"name":"readentirefile"},{"name":"seek","kind":12,"line":1309},{"line":1309,"kind":12,"name":"readentirefile"},{"kind":12,"line":1321,"name":"seek"},{"name":"seek","line":1323,"kind":12},{"name":"logcontents","kind":12,"line":1331},{"name":"logcontents","line":1335,"kind":12},{"name":"Dumper","line":1338,"kind":12},{"line":1338,"kind":12,"name":"logcontents"},{"name":"add_chain","children":[{"definition":"my","containerName":"add_chain","line":1388,"localvar":"my","name":"$self","kind":13},{"kind":13,"containerName":"add_chain","line":1388,"name":"$chain"},{"name":"$TID","kind":13,"localvar":"my","line":1389,"containerName":"add_chain","definition":"my"},{"kind":12,"containerName":"add_chain","line":1389,"name":"tid"},{"name":"$logger","line":1391,"containerName":"add_chain","kind":13},{"name":"debug","line":1391,"containerName":"add_chain","kind":12},{"kind":13,"name":"$rule","definition":"my","localvar":"my","line":1392,"containerName":"add_chain"},{"kind":13,"name":"$options","localvar":"my","containerName":"add_chain","line":1393,"definition":"my"},{"kind":13,"name":"$args","localvar":"my","line":1394,"containerName":"add_chain","definition":"my"},{"containerName":"add_chain","line":1394,"kind":13,"name":"$rule"},{"kind":13,"line":1394,"containerName":"add_chain","name":"$options"},{"line":1395,"containerName":"add_chain","kind":13,"name":"$self"},{"name":"iptablesqueue_enqueue","kind":12,"line":1395,"containerName":"add_chain"},{"name":"$args","kind":13,"containerName":"add_chain","line":1395},{"containerName":"add_chain","line":1396,"kind":13,"name":"$tracker"},{"name":"$chain","kind":13,"containerName":"add_chain","line":1396}],"kind":12,"signature":{"documentation":" Description:  Using the logobj, this greps against the log contents for matching lines and then gets the\n               IP address on each line.\n Requires:     $self, $log\n Returns:      Hash reference of IP addresses with count of how many times the IP address was found\n sub grep_regexps {\n     my ( $self, $log ) = @_;\n     my $TID = \"TID: \" . threads->tid;\n     my $matches      = {};\n     my @log_contents = @{ $log->{logcontents} };\n     return {} if ( !@log_contents );\n     # DO NOT SORT NUMERICALLY!  The info in the configs states the order is sorted alphabetically\n     foreach my $regex ( sort keys %{ $log->{regexpdeny} } ) {\n         my $pattern = $log->{regexpdeny}{$regex};\n         $logger->debug(\"$TID|Grep'ing for >>$pattern<< in $log->{file} from byte position $log->{seek}\");\n         my @current_matches = grep { /$pattern/ } @log_contents;\n         $logger->debug( \"$TID|Dumper of current matches: \" . Dumper(@current_matches) ) if $logger->is_debug();\n         foreach my $line (@current_matches) {\n             chomp($line);\n             $logger->debug(\"$TID|Checking >>$line<< for IP address\");\n             foreach my $ip_address ( $line =~ /$REGEX_IPV4/g, $line =~ /$REGEX_IPV6/g ) {\n                 $matches->{$ip_address}++;\n                 $logger->debug(\"$TID|Found IP address: $ip_address\");\n             }\n         } ## end foreach my $line (@current_matches)\n     } ## end foreach my $regex ( sort keys...)\n     $logger->debug( \"$TID|Dump of IP matches after all regex comparisons: \" . Dumper($matches) ) if $logger->is_debug();\n     my $log_msg = \"$TID|Matched IP addresses to be reviewed for potential blocking: \";\n     $log_msg .= join( \",\", keys %{$matches} );\n     $logger->info($log_msg);\n     return $matches;\n } ## end sub grep_regexps\n Description:  Adds a chain to iptables\n               Also adds the chain to $tracker\n Returns:      1 if able to enqueue commands otherwise 0","parameters":[],"label":"add_chain()"},"detail":"()","range":{"start":{"line":1387,"character":0},"end":{"character":9999,"line":1398}},"definition":"sub","containerName":"Net::IPBlocker","line":1387},{"name":"threads","line":1389,"kind":12},{"line":1394,"kind":12,"name":"rule"},{"name":"options","line":1394,"kind":12},{"name":"chains_created","kind":12,"line":1396},{"definition":"sub","range":{"end":{"character":9999,"line":1447},"start":{"character":0,"line":1409}},"containerName":"Net::IPBlocker","line":1409,"detail":"()","kind":12,"signature":{"documentation":" Description:  Adds IPs as DROP or ACCEPT to the chain provided\n Requires:     $self\n               $args to be a hash reference with the following optional keys:\n                   chain:  The chain to add the rules to.  If no chain provided then the\n                           default is ipblocker_global\n                   allowlist:  An array of IPs to allow\n                   denylist:  An array of IPs to deny\n                   allowdenyorder:  The order to add the allow and deny rules\n Returns:      1 if able to enqueue commands otherwise 0","parameters":[],"label":"add_allowdeny_ips()"},"name":"add_allowdeny_ips","children":[{"name":"$self","kind":13,"definition":"my","containerName":"add_allowdeny_ips","line":1410,"localvar":"my"},{"kind":13,"line":1410,"containerName":"add_allowdeny_ips","name":"$args"},{"definition":"my","containerName":"add_allowdeny_ips","line":1411,"localvar":"my","name":"$TID","kind":13},{"name":"tid","kind":12,"containerName":"add_allowdeny_ips","line":1411},{"name":"$args","kind":13,"line":1413,"containerName":"add_allowdeny_ips"},{"name":"$logger","line":1414,"containerName":"add_allowdeny_ips","kind":13},{"name":"error","line":1414,"containerName":"add_allowdeny_ips","kind":12},{"kind":13,"name":"$chain","localvar":"my","containerName":"add_allowdeny_ips","line":1417,"definition":"my"},{"name":"$args","containerName":"add_allowdeny_ips","line":1417,"kind":13},{"kind":13,"name":"%ip_rules","definition":"my","localvar":"my","containerName":"add_allowdeny_ips","line":1419},{"name":"$args","kind":13,"line":1420,"containerName":"add_allowdeny_ips"},{"line":1421,"containerName":"add_allowdeny_ips","kind":13,"name":"$args"},{"kind":13,"name":"@allowdenyorder","definition":"my","containerName":"add_allowdeny_ips","line":1424,"localvar":"my"},{"name":"$args","kind":13,"containerName":"add_allowdeny_ips","line":1425},{"containerName":"add_allowdeny_ips","line":1426,"kind":13,"name":"@allowdenyorder"},{"name":"$logger","containerName":"add_allowdeny_ips","line":1429,"kind":13},{"containerName":"add_allowdeny_ips","line":1429,"kind":12,"name":"debug"},{"name":"%ip_rules","kind":13,"containerName":"add_allowdeny_ips","line":1429},{"name":"$logger","line":1429,"containerName":"add_allowdeny_ips","kind":13},{"line":1429,"containerName":"add_allowdeny_ips","kind":12,"name":"is_debug"},{"definition":"my","line":1432,"containerName":"add_allowdeny_ips","localvar":"my","kind":13,"name":"$action"},{"name":"@allowdenyorder","line":1432,"containerName":"add_allowdeny_ips","kind":13},{"kind":13,"containerName":"add_allowdeny_ips","line":1433,"name":"$logger"},{"name":"debug","kind":12,"line":1433,"containerName":"add_allowdeny_ips"},{"kind":13,"name":"$chain","containerName":"add_allowdeny_ips","line":1436,"localvar":"my","definition":"my"},{"name":"$args","containerName":"add_allowdeny_ips","line":1436,"kind":13},{"name":"$rule_action","kind":13,"containerName":"add_allowdeny_ips","line":1437,"localvar":"my","definition":"my"},{"name":"$action","containerName":"add_allowdeny_ips","line":1437,"kind":13},{"containerName":"add_allowdeny_ips","line":1438,"localvar":"my","definition":"my","name":"$ip","kind":13},{"kind":13,"line":1438,"containerName":"add_allowdeny_ips","name":"$ip_rules"},{"line":1438,"containerName":"add_allowdeny_ips","kind":13,"name":"$action"},{"name":"$logger","kind":13,"line":1439,"containerName":"add_allowdeny_ips"},{"line":1439,"containerName":"add_allowdeny_ips","kind":12,"name":"debug"},{"kind":13,"name":"$direction","line":1440,"containerName":"add_allowdeny_ips","localvar":"my","definition":"my"},{"localvar":"my","containerName":"add_allowdeny_ips","line":1441,"definition":"my","name":"$rule","kind":13},{"kind":13,"name":"$args","definition":"my","containerName":"add_allowdeny_ips","line":1442,"localvar":"my"},{"kind":13,"containerName":"add_allowdeny_ips","line":1442,"name":"$rule"},{"kind":13,"line":1443,"containerName":"add_allowdeny_ips","name":"$logger"},{"kind":12,"containerName":"add_allowdeny_ips","line":1443,"name":"debug"},{"kind":13,"containerName":"add_allowdeny_ips","line":1444,"name":"$self"},{"kind":12,"containerName":"add_allowdeny_ips","line":1444,"name":"iptablesqueue_enqueue"},{"kind":13,"line":1444,"containerName":"add_allowdeny_ips","name":"$args"}]},{"line":1411,"kind":12,"name":"threads"},{"line":1417,"kind":12,"name":"chain"},{"name":"allow","line":1420,"kind":12},{"kind":12,"line":1420,"name":"allowlist"},{"line":1421,"kind":12,"name":"deny"},{"name":"denylist","line":1421,"kind":12},{"name":"allowdeny","kind":12,"line":1425},{"kind":12,"line":1429,"name":"Dumper"},{"name":"chain","line":1436,"kind":12},{"kind":12,"line":1442,"name":"rule"},{"name":"options","kind":12,"line":1442},{"line":1457,"containerName":"Net::IPBlocker","definition":"sub","range":{"end":{"character":9999,"line":1463},"start":{"line":1457,"character":0}},"detail":"()","signature":{"label":"add_global_allow_deny_ips()","parameters":[],"documentation":" Description:  Adds the IPs to block or accept from the configs global allowlist and global denylist\n               to the global chain\n Requires:     $self->{configs}->{allowlist} to be a hash reference\n               $self->{configs}->{denylist} to be a hash reference\n Returns:      Returns the value returned by add_allowdeny_ips()"},"kind":12,"children":[{"localvar":"my","containerName":"add_global_allow_deny_ips","line":1458,"definition":"my","kind":13,"name":"$self"},{"name":"$TID","kind":13,"localvar":"my","line":1459,"containerName":"add_global_allow_deny_ips","definition":"my"},{"containerName":"add_global_allow_deny_ips","line":1459,"kind":12,"name":"tid"},{"containerName":"add_global_allow_deny_ips","line":1461,"kind":13,"name":"$logger"},{"name":"debug","kind":12,"line":1461,"containerName":"add_global_allow_deny_ips"},{"line":1462,"containerName":"add_global_allow_deny_ips","localvar":"my","definition":"my","kind":13,"name":"$chain"},{"name":"$self","containerName":"add_global_allow_deny_ips","line":1462,"kind":13},{"name":"@allowlist","kind":13,"localvar":"my","containerName":"add_global_allow_deny_ips","line":1463,"definition":"my"},{"name":"$self","kind":13,"containerName":"add_global_allow_deny_ips","line":1463},{"kind":13,"line":1463,"containerName":"add_global_allow_deny_ips","name":"$self"}],"name":"add_global_allow_deny_ips"},{"name":"threads","line":1459,"kind":12},{"line":1462,"kind":12,"name":"configs"},{"name":"chainprefix","kind":12,"line":1462},{"name":"configs","line":1463,"kind":12},{"name":"allowlist","line":1463,"kind":12},{"line":1463,"kind":12,"name":"configs"},{"kind":12,"line":1463,"name":"allowlist"},{"definition":"my","containerName":null,"line":1464,"localvar":"my","name":"@denylist","kind":13},{"name":"%self","line":1464,"containerName":null,"kind":13},{"line":1464,"kind":12,"name":"configs"},{"name":"denylist","kind":12,"line":1464},{"line":1464,"containerName":null,"kind":13,"name":"%self"},{"name":"configs","kind":12,"line":1464},{"line":1464,"kind":12,"name":"denylist"},{"containerName":null,"line":1465,"localvar":"my","definition":"my","kind":13,"name":"$allowdeny"},{"containerName":null,"line":1465,"kind":13,"name":"%self"},{"kind":12,"line":1465,"name":"configs"},{"line":1465,"kind":12,"name":"allowdeny"},{"containerName":null,"line":1467,"localvar":"my","definition":"my","kind":13,"name":"%args"},{"line":1468,"kind":12,"name":"chain"},{"name":"$chain","line":1468,"containerName":null,"kind":13},{"line":1469,"kind":12,"name":"allowlist"},{"kind":13,"line":1469,"containerName":null,"name":"@allowlist"},{"line":1470,"kind":12,"name":"denylist"},{"line":1470,"containerName":null,"kind":13,"name":"@denylist"},{"kind":12,"line":1471,"name":"allowdeny"},{"name":"$allowdeny","line":1472,"containerName":null,"kind":13},{"line":1474,"containerName":null,"kind":13,"name":"$logger"},{"kind":12,"line":1474,"containerName":"Net::IPBlocker","name":"debug"},{"name":"Dumper","kind":12,"line":1474},{"name":"$args","line":1474,"containerName":null,"kind":13},{"kind":13,"line":1474,"containerName":null,"name":"$logger"},{"name":"is_debug","line":1474,"containerName":"Net::IPBlocker","kind":12},{"name":"$self","containerName":null,"line":1476,"kind":13},{"name":"add_allowdeny_ips","containerName":"Net::IPBlocker","line":1476,"kind":12},{"name":"$args","kind":13,"line":1476,"containerName":null},{"kind":12,"signature":{"documentation":" Description:  Adds the IPs to block or accept from the logobj allowlist and logobj denylist\n Requires:     $logobj->{allowlist} to be a hash reference\n               $logobj->{denylist} to be a hash reference\n Returns:      Returns the value returned by add_allowdeny_ips()","label":"add_logger_allow_deny_ips()","parameters":[]},"name":"add_logger_allow_deny_ips","children":[{"definition":"my","containerName":"add_logger_allow_deny_ips","line":1484,"localvar":"my","name":"$self","kind":13},{"name":"$logobj","line":1484,"containerName":"add_logger_allow_deny_ips","kind":13},{"definition":"my","line":1485,"containerName":"add_logger_allow_deny_ips","localvar":"my","name":"$TID","kind":13},{"containerName":"add_logger_allow_deny_ips","line":1485,"kind":12,"name":"tid"},{"containerName":"add_logger_allow_deny_ips","line":1487,"kind":13,"name":"$logger"},{"name":"debug","kind":12,"containerName":"add_logger_allow_deny_ips","line":1487},{"definition":"my","localvar":"my","containerName":"add_logger_allow_deny_ips","line":1488,"name":"$chain","kind":13},{"name":"$self","kind":13,"containerName":"add_logger_allow_deny_ips","line":1488},{"name":"$logobj","kind":13,"containerName":"add_logger_allow_deny_ips","line":1488},{"definition":"my","localvar":"my","containerName":"add_logger_allow_deny_ips","line":1489,"kind":13,"name":"@allowlist"},{"name":"$logobj","containerName":"add_logger_allow_deny_ips","line":1489,"kind":13},{"kind":13,"line":1489,"containerName":"add_logger_allow_deny_ips","name":"$logobj"}],"definition":"sub","range":{"start":{"character":0,"line":1483},"end":{"character":9999,"line":1489}},"containerName":"Net::IPBlocker","line":1483,"detail":"()"},{"name":"threads","line":1485,"kind":12},{"name":"configs","kind":12,"line":1488},{"kind":12,"line":1488,"name":"chainprefix"},{"name":"chain","kind":12,"line":1488},{"name":"allowlist","kind":12,"line":1489},{"line":1489,"kind":12,"name":"allowlist"},{"line":1490,"containerName":null,"localvar":"my","definition":"my","name":"@denylist","kind":13},{"name":"%logobj","kind":13,"line":1490,"containerName":null},{"name":"denylist","line":1490,"kind":12},{"name":"%logobj","kind":13,"containerName":null,"line":1490},{"kind":12,"line":1490,"name":"denylist"},{"localvar":"my","containerName":null,"line":1491,"definition":"my","name":"$allowdeny","kind":13},{"containerName":null,"line":1491,"kind":13,"name":"%logobj"},{"line":1491,"kind":12,"name":"allowdeny"},{"name":"%args","kind":13,"localvar":"my","containerName":null,"line":1493,"definition":"my"},{"kind":12,"line":1494,"name":"chain"},{"name":"$chain","kind":13,"containerName":null,"line":1494},{"name":"allowlist","line":1495,"kind":12},{"name":"@allowlist","kind":13,"line":1495,"containerName":null},{"kind":12,"line":1496,"name":"denylist"},{"kind":13,"containerName":null,"line":1496,"name":"@denylist"},{"kind":12,"line":1497,"name":"allowdeny"},{"name":"$allowdeny","line":1498,"containerName":null,"kind":13},{"name":"$logger","containerName":null,"line":1500,"kind":13},{"name":"debug","containerName":"Net::IPBlocker","line":1500,"kind":12},{"kind":12,"line":1500,"name":"Dumper"},{"kind":13,"containerName":null,"line":1500,"name":"$args"},{"name":"$logger","kind":13,"containerName":null,"line":1500},{"name":"is_debug","line":1500,"containerName":"Net::IPBlocker","kind":12},{"kind":13,"line":1502,"containerName":null,"name":"$self"},{"kind":12,"containerName":"Net::IPBlocker","line":1502,"name":"add_allowdeny_ips"},{"name":"$args","kind":13,"line":1502,"containerName":null},{"detail":"()","definition":"sub","range":{"end":{"line":1543,"character":9999},"start":{"line":1514,"character":0}},"containerName":"Net::IPBlocker","line":1514,"name":"stop","children":[{"definition":"my","localvar":"my","line":1515,"containerName":"stop","name":"$self","kind":13},{"name":"$args","kind":13,"containerName":"stop","line":1515},{"name":"$TID","kind":13,"definition":"my","line":1516,"containerName":"stop","localvar":"my"},{"containerName":"stop","line":1516,"kind":12,"name":"tid"},{"name":"$TID","containerName":"stop","line":1517,"kind":13},{"containerName":"stop","line":1517,"kind":13,"name":"$TID"},{"name":"$logger","kind":13,"line":1518,"containerName":"stop"},{"name":"info","line":1518,"containerName":"stop","kind":12},{"name":"$chains_created","kind":13,"definition":"my","localvar":"my","line":1520,"containerName":"stop"},{"name":"$args","containerName":"stop","line":1520,"kind":13},{"name":"$tracker","kind":13,"containerName":"stop","line":1520},{"localvar":"my","line":1521,"containerName":"stop","definition":"my","name":"$iptables_rules","kind":13},{"kind":13,"line":1521,"containerName":"stop","name":"$args"},{"kind":13,"line":1521,"containerName":"stop","name":"$tracker"},{"name":"@chains_to_remove","kind":13,"definition":"my","line":1525,"containerName":"stop","localvar":"my"},{"containerName":"stop","line":1526,"kind":13,"name":"$self"},{"name":"$chain","kind":13,"definition":"my","localvar":"my","containerName":"stop","line":1527},{"line":1527,"containerName":"stop","kind":13,"name":"$self"},{"name":"@chains_to_remove","kind":13,"line":1528,"containerName":"stop"},{"line":1528,"containerName":"stop","kind":13,"name":"$chain"},{"name":"@chains_to_remove","kind":13,"containerName":"stop","line":1530},{"name":"$self","line":1530,"containerName":"stop","kind":13},{"name":"$logger","containerName":"stop","line":1531,"kind":13},{"containerName":"stop","line":1531,"kind":12,"name":"info"},{"name":"@chains_to_remove","containerName":"stop","line":1531,"kind":13},{"name":"$logger","kind":13,"line":1531,"containerName":"stop"},{"line":1531,"containerName":"stop","kind":12,"name":"is_debug"},{"kind":13,"line":1532,"containerName":"stop","name":"$self"},{"kind":13,"containerName":"stop","line":1532,"name":"$chains_created"},{"kind":13,"line":1533,"containerName":"stop","name":"$logger"},{"kind":12,"containerName":"stop","line":1533,"name":"info"},{"containerName":"stop","line":1534,"localvar":"my","definition":"my","name":"$chain","kind":13},{"name":"$self","containerName":"stop","line":1534,"kind":13},{"kind":13,"containerName":"stop","line":1535,"name":"$logger"},{"line":1535,"containerName":"stop","kind":12,"name":"info"},{"kind":13,"containerName":"stop","line":1536,"name":"$IptablesQueue"},{"name":"enqueue","line":1536,"containerName":"stop","kind":12}],"kind":12,"signature":{"documentation":" Description:  Stops the module, gracefully (or at least tries to)\n               Removes the chains that were created (or tried to be created) and removes the iptables rules that were\n               added (or tried to be added)\n Requires:     $self\n               $args which is really a hash reference for $tracker\n                   $args->{chains_created} --> chains created (or tried to be created)\n                   $args->{iptables_rules} --> iptables rules that were added (or tried to be added)\n Returns:      1 if successful, otherwise 0","parameters":[],"label":"stop()"}},{"name":"threads","kind":12,"line":1516},{"name":"chains_created","kind":12,"line":1520},{"name":"chains_created","kind":12,"line":1520},{"line":1521,"kind":12,"name":"iptables_rules"},{"name":"iptables_rules","kind":12,"line":1521},{"kind":12,"line":1526,"name":"configs"},{"line":1526,"kind":12,"name":"logs_to_review"},{"line":1527,"kind":12,"name":"configs"},{"name":"chainprefix","line":1527,"kind":12},{"line":1530,"kind":12,"name":"configs"},{"line":1530,"kind":12,"name":"chainprefix"},{"name":"Dumper","kind":12,"line":1531},{"line":1532,"kind":12,"name":"chains_created"},{"kind":12,"line":1534,"name":"chains_created"},{"line":1538,"kind":12,"name":"options"},{"name":"rule","line":1539,"kind":12},{"kind":13,"containerName":null,"line":1545,"name":"$logger"},{"name":"info","kind":12,"line":1545,"containerName":"Net::IPBlocker"},{"name":"$logger","kind":13,"containerName":null,"line":1548},{"name":"info","kind":12,"containerName":"Net::IPBlocker","line":1548},{"name":"clear_queues","kind":12,"line":1549},{"kind":13,"line":1549,"containerName":null,"name":"$logger"},{"kind":12,"containerName":"Net::IPBlocker","line":1549,"name":"error"},{"kind":13,"containerName":null,"line":1550,"name":"$logger"},{"kind":12,"containerName":"Net::IPBlocker","line":1550,"name":"info"},{"kind":12,"line":1551,"name":"join_threads"},{"containerName":null,"line":1551,"kind":13,"name":"$logger"},{"kind":12,"line":1551,"containerName":"Net::IPBlocker","name":"error"},{"name":"$logger","kind":13,"line":1553,"containerName":null},{"name":"info","line":1553,"containerName":"Net::IPBlocker","kind":12},{"name":"$lock_obj","kind":13,"containerName":null,"line":1554},{"name":"release","kind":12,"containerName":"Net::IPBlocker","line":1554},{"kind":13,"line":1555,"containerName":null,"name":"$logger"},{"name":"info","kind":12,"containerName":"Net::IPBlocker","line":1555},{"name":"join_threads","children":[{"kind":13,"name":"$TID","localvar":"my","line":1577,"containerName":"join_threads","definition":"my"},{"kind":12,"line":1577,"containerName":"join_threads","name":"tid"},{"name":"$TID","kind":13,"containerName":"join_threads","line":1578},{"name":"$TID","kind":13,"containerName":"join_threads","line":1578},{"name":"$logger","kind":13,"line":1579,"containerName":"join_threads"},{"kind":12,"containerName":"join_threads","line":1579,"name":"debug"},{"name":"join","containerName":"join_threads","line":1580,"kind":12},{"kind":12,"line":1580,"containerName":"join_threads","name":"list"}],"kind":12,"signature":{"documentation":" Joins all threads\n   Simple sub but really needs some rework\n   If a thread is taking a while to join then it will block the other threads from joining\n   Some of the threads could be reading a log file and if the log file is large then it could take a while or\n   if the log file is causing soem kind of blocking for reading then it could take a while.\n   This may be an issue, if an example, if trying to read a file across NFS or SSHFS and there is a network issue.\n Description:  Joins all threads\n               This needs some rework.\n               If a thread is taking a while to join then it will block the other threads from joining.\n               Some of the threads could be reading a log file and if the log file is large then it\n               could take a while or if the log file is causing some kind of blocking for reading then it\n               could take a while.\n               This may be an issue if trying to read a file across NFS or SSHFS and there is a network issue.\n Returns:      1 if successful.","parameters":[],"label":"join_threads()"},"detail":"()","definition":"sub","range":{"end":{"character":9999,"line":1582},"start":{"line":1576,"character":0}},"line":1576,"containerName":"Net::IPBlocker"},{"name":"threads","line":1577,"kind":12},{"name":"threads","line":1580,"kind":12},{"detail":"()","line":1586,"containerName":"Net::IPBlocker","definition":"sub","range":{"end":{"line":1605,"character":9999},"start":{"line":1586,"character":0}},"children":[{"kind":13,"name":"$TID","definition":"my","containerName":"clear_queues","line":1587,"localvar":"my"},{"kind":12,"line":1587,"containerName":"clear_queues","name":"tid"},{"kind":13,"containerName":"clear_queues","line":1588,"name":"$TID"},{"containerName":"clear_queues","line":1588,"kind":13,"name":"$TID"},{"name":"$logger","containerName":"clear_queues","line":1589,"kind":13},{"name":"debug","kind":12,"line":1589,"containerName":"clear_queues"},{"line":1590,"containerName":"clear_queues","kind":13,"name":"$IptablesQueue"},{"kind":12,"line":1590,"containerName":"clear_queues","name":"end"},{"kind":13,"name":"$counter","definition":"my","localvar":"my","containerName":"clear_queues","line":1591},{"line":1592,"containerName":"clear_queues","kind":13,"name":"$IptablesQueue"},{"name":"pending","kind":12,"line":1592,"containerName":"clear_queues"},{"name":"$counter","containerName":"clear_queues","line":1592,"kind":13},{"name":"$IptablesQueue","kind":13,"containerName":"clear_queues","line":1593},{"name":"pending","kind":12,"containerName":"clear_queues","line":1593},{"name":"$logger","kind":13,"line":1593,"containerName":"clear_queues"},{"name":"debug","kind":12,"line":1593,"containerName":"clear_queues"},{"name":"$IptablesQueue","line":1596,"containerName":"clear_queues","kind":13},{"name":"pending","kind":12,"line":1596,"containerName":"clear_queues"},{"containerName":"clear_queues","line":1597,"kind":13,"name":"$logger"},{"name":"error","kind":12,"line":1597,"containerName":"clear_queues"},{"line":1598,"containerName":"clear_queues","kind":13,"name":"$logger"},{"name":"error","line":1598,"containerName":"clear_queues","kind":12},{"kind":13,"line":1598,"containerName":"clear_queues","name":"$IptablesQueue"},{"name":"$logger","containerName":"clear_queues","line":1602,"kind":13},{"name":"debug","containerName":"clear_queues","line":1602,"kind":12}],"name":"clear_queues","signature":{"label":"clear_queues()","parameters":[],"documentation":" Description:  Clears the queues\n Returns:      1 if successful, otherwise 0"},"kind":12},{"name":"threads","kind":12,"line":1587},{"line":1598,"kind":12,"name":"Dumper"},{"range":{"end":{"line":1635,"character":9999},"start":{"line":1610,"character":0}},"definition":"sub","containerName":"Net::IPBlocker","line":1610,"detail":"()","kind":12,"signature":{"parameters":[],"label":"reload()","documentation":" Description:  Reloads the module\n               This is not yet implemented"},"name":"reload","children":[{"kind":13,"name":"$TID","definition":"my","localvar":"my","line":1611,"containerName":"reload"},{"kind":12,"line":1611,"containerName":"reload","name":"tid"},{"name":"$TID","kind":13,"line":1612,"containerName":"reload"},{"name":"$TID","line":1612,"containerName":"reload","kind":13},{"name":"$logger","kind":13,"containerName":"reload","line":1613},{"name":"info","containerName":"reload","line":1613,"kind":12}]},{"kind":12,"line":1611,"name":"threads"},{"definition":"sub","range":{"start":{"character":0,"line":1639},"end":{"line":1643,"character":9999}},"line":1639,"containerName":"Net::IPBlocker","kind":12,"name":"SIG_INT","children":[{"kind":13,"containerName":"SIG_INT","line":1640,"name":"$logger"},{"containerName":"SIG_INT","line":1640,"kind":12,"name":"info"}]},{"kind":12,"children":[{"containerName":"SIG_HUP","line":1648,"kind":13,"name":"$logger"},{"kind":12,"containerName":"SIG_HUP","line":1648,"name":"info"}],"name":"SIG_HUP","containerName":"Net::IPBlocker","line":1647,"definition":"sub","range":{"start":{"character":0,"line":1647},"end":{"line":1650,"character":9999}}},{"line":1654,"containerName":"Net::IPBlocker","definition":"sub","range":{"end":{"character":9999,"line":1657},"start":{"character":0,"line":1654}},"kind":12,"children":[{"containerName":"SIG_TERM","line":1655,"kind":13,"name":"$logger"},{"kind":12,"line":1655,"containerName":"SIG_TERM","name":"info"}],"name":"SIG_TERM"},{"children":[{"definition":"my","line":1662,"containerName":"SIG_QUIT","localvar":"my","kind":13,"name":"$self"}],"name":"SIG_QUIT","kind":12,"containerName":"Net::IPBlocker","line":1661,"definition":"sub","range":{"end":{"line":1664,"character":9999},"start":{"character":0,"line":1661}}},{"detail":"()","line":1668,"containerName":"Net::IPBlocker","definition":"sub","range":{"end":{"character":9999,"line":1674},"start":{"line":1668,"character":0}},"children":[{"kind":13,"containerName":"set_signal_handler","line":1669,"name":"$logger"},{"name":"info","kind":12,"line":1669,"containerName":"set_signal_handler"},{"name":"$SIG","kind":13,"containerName":"set_signal_handler","line":1670},{"kind":13,"line":1671,"containerName":"set_signal_handler","name":"$SIG"},{"kind":13,"containerName":"set_signal_handler","line":1672,"name":"$SIG"},{"kind":13,"line":1673,"containerName":"set_signal_handler","name":"$SIG"}],"name":"set_signal_handler","signature":{"parameters":[],"label":"set_signal_handler()","documentation":" Description:  Sets the signal handlers"},"kind":12},{"name":"INT","line":1670,"kind":12},{"name":"TERM","line":1671,"kind":12},{"kind":12,"line":1672,"name":"HUP"},{"name":"QUIT","kind":12,"line":1673}],"version":5}