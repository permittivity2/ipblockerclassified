{"version":5,"vars":[{"kind":2,"line":0,"name":"Net::IPBlocker","definition":1},{"containerName":"","line":3,"name":"strict","kind":2},{"name":"warnings","containerName":"","line":4,"kind":2},{"kind":2,"name":"POSIX","line":5,"containerName":""},{"name":"DateTime","line":6,"containerName":"","kind":2},{"name":"Basename","containerName":"File","line":7,"kind":2},{"name":"Util","containerName":"List","line":8,"kind":2},{"line":12,"containerName":"Time","name":"HiRes","kind":2},{"kind":2,"line":18,"containerName":"Config","name":"File"},{"kind":2,"name":"Carp","line":19,"containerName":""},{"name":"Log4perl","line":20,"containerName":"Log","kind":2},{"name":"Any","line":21,"containerName":"Log","kind":2},{"name":"Dumper","line":22,"containerName":"Data","kind":2},{"kind":2,"containerName":"Regexp","line":23,"name":"IPv6"},{"name":"Simple","line":24,"containerName":"LockFile","kind":2},{"name":"Path","containerName":"File","line":25,"kind":2},{"kind":2,"name":"Wrapper","line":26,"containerName":"Net::Ifconfig"},{"kind":2,"name":"threads","line":29,"containerName":""},{"kind":2,"containerName":"Thread","line":31,"name":"Queue"},{"kind":13,"name":"$DataQueue","definition":"my","line":32,"containerName":null,"localvar":"my"},{"kind":12,"name":"Thread","line":32,"containerName":"Queue"},{"line":32,"containerName":"Net::IPBlocker","name":"new","kind":12},{"line":33,"containerName":null,"name":"$LoggerTIDS","definition":"my","localvar":"my","kind":13},{"kind":13,"definition":"my","name":"$IptablesQueue","line":36,"containerName":null,"localvar":"my"},{"name":"Thread","line":36,"containerName":"Queue","kind":12},{"kind":12,"name":"new","line":36,"containerName":"Net::IPBlocker"},{"localvar":"my","line":37,"containerName":null,"name":"$IptablesTIDS","definition":"my","kind":13},{"name":"$Data","line":40,"containerName":null,"kind":13},{"name":"Dumper","containerName":"Sortkeys","line":40,"kind":12},{"kind":13,"name":"$Data","containerName":null,"line":41},{"kind":12,"name":"Dumper","line":41,"containerName":"Indent"},{"kind":13,"definition":"my","name":"$logger","containerName":null,"line":48,"localvar":"my"},{"definition":"my","name":"$lock_obj","containerName":null,"line":51,"localvar":"my","kind":13},{"kind":13,"definition":"my","name":"$REGEX_IPV4","containerName":null,"line":56,"localvar":"my"},{"name":"$REGEX_IPV6","definition":"my","containerName":null,"line":57,"localvar":"my","kind":13},{"kind":13,"definition":"my","name":"$IPTABLESRUNLINE","line":58,"containerName":null,"localvar":"my"},{"kind":13,"line":62,"containerName":"Net::IPBlocker","definition":"our","name":"%tracker"},{"name":"%DEFAULTS","definition":"my","containerName":null,"line":63,"localvar":"my","kind":13},{"kind":12,"name":"allowdeny","line":64},{"line":65,"name":"allowlist","kind":12},{"name":"configsfile","line":66,"kind":12},{"name":"cycles","line":67,"kind":12},{"kind":12,"line":67,"name":"LONG_MAX"},{"kind":12,"line":68,"name":"cyclesleep"},{"kind":12,"line":69,"name":"dumpconfigsandexit"},{"kind":12,"name":"denylist","line":70},{"name":"forceremovelockfile","line":71,"kind":12},{"line":72,"name":"globalallowlist","kind":12},{"kind":12,"name":"chainprefix","line":73},{"line":74,"name":"globalchains","kind":12},{"name":"globaldenylist","line":75,"kind":12},{"kind":12,"line":76,"name":"globalregexallowlist"},{"line":77,"name":"globalregexdenylist","kind":12},{"kind":12,"line":78,"name":"ignoreinterfaceips"},{"kind":12,"line":79,"name":"iptables"},{"name":"lockfile","line":80,"kind":12},{"kind":12,"name":"log4perlconf","line":81},{"line":82,"name":"loglevel","kind":12},{"name":"logcontents","line":86,"kind":12},{"kind":12,"line":87,"name":"logs_to_review"},{"kind":12,"name":"logwatch_interval","line":88},{"kind":12,"name":"prodmode","line":89},{"kind":12,"line":90,"name":"queuechecktime"},{"name":"queuecycles","line":91,"kind":12},{"line":91,"name":"LONG_MAX","kind":12},{"name":"readentirefile","line":92,"kind":12},{"kind":13,"definition":"our","name":"$VERSION","containerName":"Net::IPBlocker","line":105},{"definition":"sub","name":"new","line":667,"range":{"end":{"line":710,"character":9999},"start":{"character":0,"line":667}},"containerName":"Net::IPBlocker","signature":{"label":"new()","parameters":[],"documentation":"1; # End of Net::IPBlocker\npackage Net::IPBlocker;\n\nuse 5.006;\nuse strict;\nuse warnings;\nuse POSIX qw(LONG_MAX);\nuse DateTime;\nuse File::Basename;\nuse List::Util qw(any);\n\n# use Getopt::Long;\n# use File::Lockfile;\nuse Time::HiRes qw(usleep gettimeofday time);\n\n# use Regexp::Common qw/ net number /;\n# use NetAddr::IP::Util qw(inet_ntoa);\n# use Net::DNS::Dig;\n# use Term::ANSIColor;\nuse Config::File;\nuse Carp;\nuse Log::Log4perl qw(get_logger :nowarn :levels);\nuse Log::Any qw($log);\nuse Data::Dumper;\nuse Regexp::IPv6     qw($IPv6_re);\nuse LockFile::Simple qw(lock trylock unlock);\nuse File::Path       qw(make_path);\nuse Net::Ifconfig::Wrapper;\n\n# Thread setup\nuse threads;\n# use threads::shared;\nuse Thread::Queue;\nmy $DataQueue  = Thread::Queue->new();\nmy $LoggerTIDS = ();                     # Thread IDs for tracking or whatever\n\n# Another queue for iptables commands\nmy $IptablesQueue = Thread::Queue->new();\nmy $IptablesTIDS  = ();                     # Thread IDs for tracking or whatever\n\n# Data Dumper setup\n$Data::Dumper::Sortkeys = 1;\n$Data::Dumper::Indent   = 1;\n\n### Global Variables  (clearly the threading stuff is global, duh)\n## I hate global variables!\n# logger --- I really debated whether to make this global or not.  I decided to make it global because it is used\n#   in the signal interupts and those use prototyped subs.  I don't know how (if possible) to pass $self to the\n#   signal interupt subs with so much threaded.\nmy $logger;      # This gets set after log4Perl is loaded in new()\n                 # Some might say to use 'our' instead of 'my' but does it matter when it is global to lexical scope of\n                 #   the package?\nmy $lock_obj;    # This is the lock object and is set in set_lockFile()\n                 # Needs to be global because it is used in the signal interupts and those use prototyped subs.\n## Regex for IPv4 and IPv6 capturing.\n#   This is critical and needs be consistent across the entire module\n# my $REGEX_IPV4 = q/.*\\b((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\\b.*/;\nmy $REGEX_IPV4 = q/\\b((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\\b/;\nmy $REGEX_IPV6      = q/\\b($IPv6_re)\\b/;\nmy $IPTABLESRUNLINE = 0;    #This is just an odd one.  It is used to track the line number of the sub iptables_thread()\n                            #  where run_iptables() is called.  This is used in the signal interupts to print out the\n                            #  line number of where the iptables command was run.  This is used for debugging.\n                            #  This is set in the iptables_thread() sub.\nour $tracker = {};          # Mostly chains added and rules added are stuffed in here for tracking purposes\nmy $DEFAULTS = {\n    allowdeny            => 'Allow,Deny',\n    allowlist            => {},\n    configsfile          => '/etc/ipblocker/ipblocker.conf',\n    cycles               => LONG_MAX,\n    cyclesleep           => 0.5,\n    dumpconfigsandexit   => 0,\n    denylist             => {},\n    forceremovelockfile  => 0,\n    globalallowlist      => {},\n    chainprefix          => \"IPBLOCKER_\",\n    globalchains         => [qw / INPUT OUTPUT FORWARD /],\n    globaldenylist       => {},\n    globalregexallowlist => {},\n    globalregexdenylist  => {},\n    ignoreinterfaceips   => 1,                                   #This adds the IPs from the interfaces to the allowlist\n    iptables             => '/sbin/iptables',\n    lockfile             => '/var/run/ipblocker.run.default',\n    log4perlconf         => '/etc/ipblocker/log4perl.conf',\n    loglevel             => 'Will use value from log4perl.conf', # Can be set from calling script.\n                                                                 #   If no value sent from calling script, then\n        #   use value from configs file.  If no value in configs file then I think the\n        #   Easy Init log4perl is used which defaults to DEBUG, i think.\n    logcontents       => {},\n    logs_to_review    => {},\n    logwatch_interval => 3,\n    prodmode          => 0,\n    queuechecktime    => 1,\n    queuecycles       => LONG_MAX,\n    readentirefile    => 0,\n};\n\n=head1 NAME\n\nNet::IPBlocker - Blocks IPs based on regex from specified log files\n\n=head1 VERSION\n\nVersion 0.01\n\n\nour $VERSION = '0.01';\n\n\n=head1 SYNOPSIS\n\nBlocks IPs based on Regular Expressions in specified log files.\n\n use Net::IPBlocker;\n my $foo = Net::IPBlocker->new();\n $foo->go(); \n\nYou can send all configs into the constructor as a hash, I really advise using a config file.  \nThe default config file is F</etc/ipblocker/ipblocker.conf> but you can set it to another file.\nIf a config file is not found, it will use default values for everything and that will probably not work very well.\n\n my $foo = Net::IPBlocker->new( { configsfile => '/etc/ipblocker/ipblocker.conf' } );\n $foo->go();\n\n=head2 Future Enhancements\n\n=over 4\n\n* * Add jail time for IPs\n\nThis involves adding a database to store the IPs and the time they were blocked.\nThis also means adding a mechanism to unblock IPs after a certain amount of time.\nLuckily, I have threaded this so adding that is just a matter of adding another thread.\nI am open to ideas of what database to use.  I am thinking SQLite.\nOr, possibly just a file with the IPs (the rule) and the time they are to be unblocked (deleted \nfrom iptables).\n\n* * Add synchronized appender logging:\n      \nhttps://metacpan.org/dist/Log-Log4perl/view/lib/Log/Log4perl/Appender/Synchronized.pm\n\n* * Fix the ability for Log4perl to re-read the \"log4perl.conf\" which seems to not work right now\n\n* * my $interfaces = Net::Ifconfig::Wrapper::Ifconfig('list', '', '', '');\n\nThis is a list of interfaces.  Need to figure out how to use this to get the IP address of the\ninterfaces.  Need to add those IPs to the global allow list.\n\n* * Fix sub add_ifconfig_ips_to_allowlist() to handle IPv4 and IPv6 addresses\n\n* * Change from using log4perl to Log::Any\n\n\n=head2 DESCRIPTION\n\nThis has been a very long running project of mine.  I have been using this script for years to block IPs and then \nrealized Fail2Ban exists.  I have tried to use Fail2Ban multiple times but it never seems to work right for me.\nIt seems to lock-up. \nThis module tries to incorporate the ideas of my past experience with the general idea of Fail2Ban.\n\nI highly encourage you to use a config file.  The default config file is in the same location as this module but you \ncan set it to another file.\n\nWhen installing this, you should also receive a script called \"ipBlocker.pl\".  This is a sample script that uses \nthis module.\n\nFinally, for now, this module use log4perl.  I didn't realize there was a heated debate about log4perl vs Log::Any vs \nwhatever else.  I am open to changing this to Log::Any but I need to figure out how to do that.\n\n=head1 SUBROUTINES/METHODS\n\n=head2 new\n\nReads configs, logging configs, sets up logging, sets up a class and returns a blessed object\nThe sub go() is where the action starts\n\nExample:\n\n  use IPblocker;\n\n  my $args = {\n    configsfile         => '/etc/ipblocker/ipblocker.conf',\n    dumpconfigsandexit  => '0', # True false value\n    forceremovelockfile => '0', # True false value\n    iptables            => 'sudo /sbin/iptables',\n    lockfile            => '/var/run/ipblocker.run',\n    log4perlconf        => '/etc/ipblocker/log4perl.conf',  #Can also be 0 to use default log4perl\n    loglevel            => 'DEBUG', # Can be TRACE DEBUG INFO WARN ERROR FATAL\n    prodmode            => '0', # True false value --- Determins if the iptables commands are actually run\n    queuechecktime      => '3', # How long to wait when the queue is empty before checking again. Any float value.\n    readentirefile      => '0', # True false value --- Determines if the entire log file is read or\n                                # new entries since last run are read.\n    cycles              => 'LONG_MAX', # How many times to run the main loop.  LONG_MAX is the default.\n  };\n\n  my $ipb    = IPblocker->new($args);\n  my $logger = $ipb->{logger};\n\n=head3 All arguments to new() and their defaults\n\n=head4 allowdeny\n\nallowdeny            => 'Allow,Deny',\n\nSet to 'Allow,Deny' or 'Deny,Allow' to determine the order of the allow and deny lists.\nSeteting to 'Allow,Deny' means the allow list is processed first and then the deny list is processed.\nMeaning, as an example, if 1.1.1.1 is on the allow list and allowdeny is set to Allow,Deny, then\nthe IP of 1.1.1.1 will never be blocked.  If allowdeny is set to Deny,Allow, then it is possible \nfor 1.1.1.1 to be blocked.\n\n=head4 allowlist\n\nallowlist            => {},\n\nA list of IPs to allow.  This is a hash reference.  The key is the order to allow the IP.  The value is the IP.\nExample:\n\n allowlist => (\n  '01' => '1.1.1.1',\n  '4' => '1.1.1.4',\n  '10' => '1.1.1.2',\n  '100' => '1.1.1.3',\n  \n )\n\nThe allow list is sorted in standard Perl sort order.  So, be sure to pad 0's or whatever to the front of the key.\n\n=head4 configsfile\n\nconfigsfile          => '/etc/ipblocker/ipblocker.conf',\n\nUse a config file!  This is the default config file location.  You can set it to another file.\n\n=head4 cycles\n\ncycles               => LONG_MAX,\n\nHow many times to run the main loop.  LONG_MAX is the default.  Why not infinity?  Because I don't want to.\n\n=head4 cyclesleep\n\ncyclesleep           => 0.5,\n\nHow long to sleep between cycles.  This is in seconds.  Default is 0.5 seconds.  You can use a float value.\n\n=head4 dumpconfigsandexit\n\ndumpconfigsandexit   => 0,\n\nIf set to 1 (true), then the configs are dumped to stdout and the script exits.  This is useful for creating a \nconfig file.\n\n=head4 denylist\n\ndenylist             => {},\n\nSimilar to allow list but for IPs to deny.  This is a hash reference.  The key is the order to deny the IP.\n\n=head4 forceremovelockfile\n\nforceremovelockfile  => 0,\n\nThis will force removal of lock file (if possible) before starting.  Seriously, you better know what you are doing.\n\n=head4 chainprefix\n\nchainprefix          => \"IPBLOCKER_\",\n\nThis is the prefix for the chains created in iptables.  This is the prefix you will see in iptables for \nall the chains created by this module.\n\n=head4 globalchains\n\nglobalchains         => [qw / INPUT OUTPUT FORWARD /],\n\nThis is a list of the global chains to add the global chain to.\nThe global chain is where all the subordinate file logger chains are added.\n\nI see some value in adding the global chain to some other chain but by default we add it to INPUT, OUTPUT, and FORWARD.\nOr, possibly, you don't want to add to the FORWARD chain.\nMaybe you onkly care about INPUT table.  I don't know.  Whatever works best for you.\n\n=head4 iptables\n\niptables             => '/sbin/iptables',\n\nThis is the iptables command to use.  You can use sudo or whatever you want.\nI really encourage using sudo but by default it is not used.  \nUsing sudo and non-root user is a bit more work.  You need to setup sudoers to allow the user to run iptables.\nHowever, I think it is worth it for an added measure of security.\nIf you change this to use sudo, then you may also need to change the lockfile location to a location that the user \ncan write to.\n\n=head4 lockfile\n\nlockfile             => '/var/run/ipblocker.run.default',\n\nThis is the lock file location to use to try to prevent multiple instances from running.\n\n=head4 log4perlconf\n\nlog4perlconf         => '/etc/ipblocker/log4perl.conf',\n\nThis is the log4perl configuration file to use.  You can also set this to 0 to use the default log4perl configuration.\n\n=head4 loglevel\n\nloglevel             => 'INFO'\n\nTHis can be TRACE DEBUG INFO WARN ERROR FATAL.\n\n=head4 prodmode\n\nprodmode          => 0,\n\nThis is a true/false value.  If set to 1 (true), then the iptables commands are actually run.  If set to 0 (false), \nthen the iptables commands are not run.  This is useful for testing.\n\nBy default, this is set to 0 (false).\n\n=head4 queuechecktime\n\nqueuechecktime    => 1,\n\nWhen the queue is empty, how long to wait before checking again.  When the queue is not empty, this value is ignored\n\n=head4 queuecycles\n\nqueuecycles       => LONG_MAX,\n\nHow many times to check the queue.  LONG_MAX is the default.  Why not infinity?  Because I don't want to.\n\n=head4 readentirefile\n\nreadentirefile    => 0,\n\nThis is a true/false value.  If set to 1 (true), then the entire log file is read.  If set to 0 (false), then only\nnew entries since the last run are read.\nThis can aslo be set per log file in the configs file.\n\n=head1 Sample config file\n\n  # Lines that begin with a comment (#) are ignored\n  # Think of each line as a a key:value setup as such: key[sub-key][sub-sub-key][sub-sub-sub-key]=value\n  # Duplicates are allowed.  The last one wins!\n  # This is being used by perl so let's keep a few thigns in mind:\n  #   1. False value is 0.  Period.  That's it.  0 (zero) is false.  Everything else is true.\n  #   2. Regular expressions are PERL regular expressions.  So they are case sensitive and use PERL regular expressions.\n  #   3. Unless otherwise noted, sorting is regular perl sorting.  So 1, 10, 11 come before 2, 20, 21, etc.\n\n\n  ### Global settings \n  # The global settings are used for all log files unless overridden or combined by the individual log file settings.\n\n  # The a different iptables command\n  #   If this is not set, then the default is `which iptables`\n  #   A simpe check is done to verify that the iptables command exists and is executable.\n  #   A good method is to use a sudo command to run iptables as a different user.\n  #   This also means seting up sudo to allow the user to run iptables as a different user in passwordless mode.\n  #   Steps to do this:\n  #     1.  Create a user to run the iptables command.  For example, iptablesuser\n  #     2.  Create a group to run the iptables command.  For example, iptablesgroup\n  #     3.  Add the iptablesuser to the iptablesgroup\n  #     4.  Add the following line to the /etc/sudoers file:\n  #           iptablesuser ALL=(ALL) NOPASSWD: /sbin/iptables\n  #     5.  Set the iptables command to the following:\n  #           iptables=sudo -u iptablesuser /sbin/iptables\n  # iptables=/usr/sbin/iptables_some_other_location\n  iptables=sudo /sbin/iptables\n\n  # The location of the log4perl configuration file if different than default location of /etc/ipblocker/log4perl.conf\n  # log4perlconf=/some/other/place/log4perl.conf\n\n  # The log level to use.  \n  # This will override the log level in the log4perl configuration file.\n  # I encourage setting this in the the log4perl configuration file but it is here if you need it.\n  # I put this in here because the sample calling has the ability to set the log level so might as well have it here too.\n  # This may be one of the following:\n  #  DEBUG INFO WARN ERROR FATAL TRACE\n  #  FYI:  I did not use trace anywhere in the code so it is not really an option that will give you anything extra \n  #        than just using DEBUG.\n  # loglevel=DEBUG\n\n  # The location of the lock file\n  #   If this is not set, then the default is /var/run/iptables.run\n  #   The lock file is used to prevent multiple instances of this script from running at the same time.\n  # lockfile=/some/other/directory/iptables.run\n\n  # If not set, the default value is 1\n  # The number of seconds to wait to check to see if there are entries in the queue to process\n  #   Prevents the script from going CPU crazy and checking the queue as fast as possible.\n  #   You can set this to 0 to check the queue as fast as possible but I would not recommend it.\n  # Once a queue entry is found then the queue is checked continuously until the queue is empty.\n  # I see very little utility in having this set to 0 or even less than 1 second.\n  queuechecktime=1\n\n  # Whether or not the entire log file is read each time.  If set to 0 (false), then we only read from the end of the \n  #   last read (or the beginning if it is the first read or if the log file has been allegedly rotated)\n  #   Reading from last read is faster, but if the log file is rotated AND the log file grows larger than the \n  #       last read, then we may miss some entries.\n  #   If this setting does not exist, then it is assumed to be 0.\n  #   For most situations, this should be set to 0.\n  #   If you rotate your log files frequently AND get a lot of traffic, then you may want to set this to 1.\n  readentirefile\t    = 0\n\n  # This is how many times a log file will be reviewed.\n  # This is a global value and can be set for each log file individually.\n  #  (Very bad naming of a variable, sorry)\n  #   If this is not set, then the default is 9007199254740991\n  cycles=25\n\n  # This is how many seconds to sleep between checking a log file.\n  # This is a global value and can be set for each log file individually.\n  #  If this is not set, then the default is 0.5 seconds\n  #  This gets a bit complex to decide but here goes:\n  #  If you are always reviewing the entire log file, then this value is rather important.\n  #     Reviewing the entire log file means that you are not using the \"readentirefile\" setting.\n  cyclesleep=1\n\n  # Process nice level on the OS\n  nice=15\n\n  PRODMODE=1  # Set this to a perl false value (0) to run in test mode.\n              # Default is test mode. (meaning  PRODMODE=0 is the default)\n              # Test mode will NOT run any iptable command but will log what it would have been done.\n\n  chainprefix=IPBLOCKER_  # If not set, default is IPBLOCKER_\n                          # This is the prefix for the iptables chain names.\n                          # The chain names are created as follows:\n                          #   ${chainprefix}${logname}\n                          #  All actions are performed from ${chainprefix}global\n                          # The default is IPBLOCKER_ but you can change it if you want.\n                          # When you do an 'iptables -nvL' you will see the chain prefix in the chain names.\n\n  globalchains=INPUT,OUTPUT,FORWARD   # If not set, default is INPUT,OUTPUT,FORWARD\n                                      # These are the chains that {chainprefix}global will be added to.\n                                      # All other logger chains will be added to {chainprefix}global\n                                      # The logger rules are then added to the logger chains.\n                                      # Instead of adding the rules to the INPUT,OUTPUT,FORWARD chains, you can\n                                      #   add them to a different chain.  For example, you could add them to a chain\n                                      #   called \"MailServer\" and then that chain would have to be added to the\n                                      #  INPUT,OUTPUT,FORWARD chains (or whatever chains you want).\n                                      #  This might be useful to change if you want to add the rules to a dummy chain but\n                                      #  is not actually used.... maybe for pre-production testing or something.\n                                      #  Or, maybe you only want rules acted on the INPUT chain and not the OUTPUT chain.\n                                      #  Having FORWARD is a bit aggressive but to each their own.\n                                      #  This value must be a comma separated.  No spaces.\n\n  # Deny list of IPs:  deny these IPs, almost always.  The allowdeny value takes precedence when order of allowdeny\n  # is set.  See below.\n  # The denylist is added to the individual log file denylist.\n  denylist[01]\t\t\t\t\t\t\t= 165.232.121.37\n  denylist[02]\t\t\t\t\t\t\t= 165.232.121.36\n\n  # Allow list of IPs:  allow these IPs, almost always.  The allowdeny value takes precedence when order of allowdeny\n  # is set.  See below.\n  # The allowlist is added to the individual log file allowlist.\n  allowlist[00]\t\t\t\t\t\t\t= 75.87.147.162\n  allowlist[01]\t\t\t\t\t\t\t= 64.250.56.204\n  allowlist[02]\t\t\t\t\t\t\t= 192.73.248.201\n  allowlist[03]\t\t\t\t\t\t\t= 199.38.182.248\n  allowlist[04]\t\t\t\t\t\t\t= 158.69.195.66\n  allowlist[05]\t\t\t\t\t\t\t= 185.34.216.102\n  allowlist[06]\t\t\t\t\t\t\t= 192.73.241.233\n  allowlist[07]\t\t\t\t\t\t\t= 192.73.241.56\n  allowlist[08]\t\t\t\t\t\t\t= 198.251.81.67\n  allowlist[09]\t\t\t\t\t\t\t= 198.50.163.67\n  allowlist[10]\t\t\t\t\t\t\t= 199.195.248.92\n  allowlist[11]\t\t\t\t\t\t\t= 204.109.63.3\n  allowlist[12]\t\t\t\t\t\t\t= 208.86.227.242\n  allowlist[13]\t\t\t\t\t\t\t= 209.177.157.147\n  allowlist[14]\t\t\t\t\t\t\t= 81.4.124.103\n  allowlist[15]\t\t\t\t\t\t\t= 91.189.91.38\n  allowlist[16]\t\t\t\t\t\t\t= 185.34.3.136\n  allowlist[17]\t\t\t\t\t\t\t= 20.245.57.59\n  allowlist[18]\t\t\t\t\t\t\t= 3.3.3.3\n\n  # Individual log files settings for this value take precedence over the general settings here\n  #   Allow,Deny means that the allowlist is processed first and then the denylist is processed.\n  #      Items in the allowlist will be allowed even if they are in the denylist.\n  #   Deny,Allow means that the denylist is processed first and then the allowlist is processed.\n  #      Items in the denylist will be denied even if they are in the allowlist.\n  #  I would not change this unless you know what you are doing.  You have the potential to lock yourself out of your\n  #  own system.\n  allowdeny                               = Allow,Deny\n\n\n  ### Not yet implemented....\n  # Finds the IPs of each interface and adds them to the allow list.\n  #  Some logs have the IP of the interface in the log file.\n  #  This is a perl true/false value.  If it is set to 0 (false) then the IPs of each interface will be added to \n  #  the allowlist.\n  #  If you keep allowdeny set  to Allow,Deny then this will keep you from blocking your own IPs.\n  #    Or, at least that is the idea!  This is totally based on Net::Ifconfig::Wrapper so... do some testing\n  #    to make sure that it is working as expected.\n  #  I encourage leaving this as 0 (false) but it is here if you need it.  \n  #  The default value, if not set, is 0 (false)\n  # ignoreinterfaceips=0\n\n  ### End of Global settings\n\n\n\n  # Settings for each log file from here down\n\n  ### The authlog settings:\n  # The \"logs_to_review\" hash is a list of log files to review.  Each log file has a unique name.  The name is used \n  #   to reference the log file in other parts of the configuration file.\n  #   In the exampple of \"authlog\", the string \"authlog\" could be any alphanumeric string.  It is just used for reference.\n\n  # load:  This is a perl true/false value.  If it is set to 1 (true) then the log file will be reviewed.\n  #   This is just an easy way to keep configs in here but the script/module will not review the log file.\n  logs_to_review[authlog][load] \t\t\t\t    = 1\n\n  # file: The \"file\" value is the location of the log file to review.\n  logs_to_review[authlog][file]\t\t\t\t    = /var/log/auth.log\n\n  # readentirefile: Whether or not the entire log file is read each time.  If set to 0 (false), then we only read from \n  #   the end of the last read (or the beginning if it is the first read or if the log file has been allegedly \n  #   rotated)\n  #   Reading from last read is faster, but if the log file is rotated AND the log file grows larger than the last \n  #   read, then we may miss some entries.\n  #   If this setting does not exist, then it is assumed to be 0.\n  #   For most situations, this should be set to 0.\n  #   If you rotate your log files frequently AND get a lot of traffic, then you may want to set this to 1.\n  #   For now, the script/module is pretty dumb about this.  When set to 0, the entire file is reread if the file size\n  #   is less than the last read.\n  #   This should be enhanced to check the inode, file size, last change time, etc.  But for now, it is pretty dumb.\n  logs_to_review[authlog][readentirefile]\t    = 0\n\n  # cycles: Cycles and cyclessleep\n  #   The number of times the log file will be reviewed.\n  # logs_to_review[authlog][cycles]                 = 10\n  # cyclesleep:  The number of seconds to sleep between cycles.  Can be partial seconds.  So 0.5 is a half second.\n  logs_to_review[authlog][cyclesleep]             = 1.5\n\n  # protocols:  This is the protocol(s) that will be blocked in the firewall.\n  #   If the protocol is not set, then the default is no protocol.\n  #   You do not have to set protocol unless you set ports.\n  #   If you set ports but not protocol then the script will add the IP to the firewall but will not add the protocol and\n  #     thus no ports.  So, the entire IP will be blocked.\n  #   There is no checking if the protocol is valid.  So if you set protocol=blah then the script will give an error \n  #     when the rule is tries to be added to the firewall.\n  #   Must be separated by non-alphanumeric-digit characters.  So tcp,udp is good.  tcp udp is good.  tcp-udp is good.\n  #    The \"_\" character is not allowed.  So tcp_udp is not good.\n  #    Most folks will use commas but whatever floats your boat.\n  logs_to_review[authlog][protocols]              = tcp,udp\n\n  # ports: This is the port(s) that will be matched for blocking of IPs in the log file.\n  #   If the ports are not set, then the default is no ports.\n  #   You do not have to set ports but if you do, then you must set protocol.\n  #   Example:  ports=22,21,23 means that the script will block IPs that are trying to connect to ports 22, 21, and 23.\n  #   Must be separated by commas and ranges are accepted.  Maximum of 15 comma separated values.\n  # Example 1:  logs_to_review[authlog][ports]                  = 22,21,23\n  # Example 2:  logs_to_review[authlog][ports]                  = 22,21,23,1000:2000,3000:4000\n  # Example 3:  logs_to_review[authlog][ports]                  = 22,21,23,1000:2000\n  # Bad ports will log as an error and the rule will not be added.\n  # If you set ports but no protocol then the entire IP will be blocked on the protocol.\n  # logs_to_review[authlog][ports]                  = 22,21,23\n\n  # directions:  This is the direction(s) that will be blocked in the firewall.\n  #   If the direction is not set, then the default is source\n  #  Must be separated by non-digit-alphanumeric characters.  So source,destination is good.  source destination is good.\n  #   source-destination is good.\n  #   The \"_\" character is not allowed.  So source_destination is not good.\n  #  Most folks will use commas but whatever floats your boat.\n  #  Accepted values are source, destination, random\n  # Example 1:  logs_to_review[authlog][direction]              = source,destination\n  # Example 2:  logs_to_review[authlog][direction]              = source\n  # Example 3:  logs_to_review[authlog][direction]              = destination\n  # Example 4:  logs_to_review[authlog][direction]              = source,destination,cool,blah,blah,blah\n  # In example 4, only source and destination will be used.  The values of cool,blah,blah,blah will be ignored.\n  # I think most folks will not set this or just use 'source' but I can see value in blocking the destination as well.\n  # If you want to really screw with hackers, then set this to 'destination' and then they will not get any response\n  # The \"random\" value will ignore (for now) any other value set.  If randiom is used then source or \n  # destination will be randomly chosen for each IP rule.\n  # logs_to_review[authlog][directions]          = source,destination\n  # logs_to_review[authlog][directions]          = destination\n  # logs_to_review[authlog][directions]          = random\n\n  # allowdeny\n  #  This is the order preference for whitelisted and blacklisted IPs.\n  #  If the order is set to \"Deny,Allow\" then blacklisted IPs will ALWAYS be \n  #    blocked (even if they are in the whitelisted hash)!\n  #  If the order is set to \"Allow,Deny\" then whitelisted IPs will ALWAYS be \n  #    allowed (even if they are in the blacklisted hash)!\n  #  If the order is not set or is set incorrectly then the default is \"Allow,Deny\"\n  #  When using authlog, I would reccomend setting the order to \"Allow,Deny\" so that whitelisted IPs are always allowed \n  #    for ssh.\n  #  The order is case insensitive.\n  logs_to_review[authlog][allowdeny]          = Allow,Deny\n\n  # allowlist: List of IPs to allow just for this log file\n  logs_to_review[authlog][allowlist][01]     =  1.1.1.1\n  logs_to_review[authlog][allowlist][02]     =  2.2.2.2\n  logs_to_review[authlog][allowlist][03]     =  3.3.3.3\n  logs_to_review[authlog][allowlist][04]     =  4.4.4.4\n  logs_to_review[authlog][allowlist][05]     =  23.116.91.65\n  logs_to_review[authlog][allowlist][05]     =  23.116.91.66\n  logs_to_review[authlog][allowlist][06]     =  23.116.91.67\n  logs_to_review[authlog][allowlist][07]     =  23.116.91.68\n\n  # denylist: List of IPs to block just for this log file\n  logs_to_review[authlog][denylist][01]      =  5.5.5.5\n  logs_to_review[authlog][denylist][02]      =  6.6.6.6\n\n  # regexpdeny: Each regular expression must have a unique value.  \n  #   This is just typically indexed as 01, 02, 03, 04, etc.  But it can be any Alphanumeric\n  #   The index is sorted in simple Perl sort.  So 1, 10, 11 come before 2, 20, 21, etc.\n  #   Also, lowercase will come before uppercase.  So a, b, c, A, B, C.\n  #   The sorting may matter because the regular expressions are applied in order.\n  #   Regular expressions are case insensitive therefore \"Failed\" is the same as \"fAiLed\"\n  #   Regular expressions Perl regular expressions so you can do fancy *.?[]{}() stuff.\n  logs_to_review[authlog][regexpdeny][01]  \t\t= Failed password for root from\n  logs_to_review[authlog][regexpdeny][02]  \t\t= Failed password for invalid user\n  logs_to_review[authlog][regexpdeny][03]  \t\t= Did not receive identification string from\n  logs_to_review[authlog][regexpdeny][04]  \t\t= not allowed because listed in DenyUsers\n\n  # Special use cases for particular loggers is not yet implemented.\n  # # Authlog has a special value of allowed usernames\n  # logs_to_review[authlog][allowedusername][01]    = gardner\n  # logs_to_review[authlog][allowedusername][02]    = jiggerboy\n  # # Authlog has a special value of not-allowed usernames\n  # logs_to_review[authlog][deniedusername][01] \t= root\n\n\n\n  #### Now... an example without comments\n\n  ### The maillog settings:\n  logs_to_review[maillog][load] \t\t\t\t= 1\n  logs_to_review[maillog][file]\t\t\t\t= /var/log/mail.log\n  logs_to_review[maillog][cycles]             = 3\n  logs_to_review[maillog][cyclesleep]         = 2.25\n  logs_to_review[maillog][order]              = Allow,Deny \n  logs_to_review[maillog][regexpdeny][1] \t\t\t= Relay access denied,Illegal address syntax from\n  logs_to_review[maillog][regexpdeny][2]\t\t\t= SASL LOGIN authentication failed\n  logs_to_review[maillog][regexpdeny][3]\t\t\t= SSL_accept error from\n  logs_to_review[maillog][regexpdeny][4]\t\t\t= lost connection after AUTH from unknown\n  logs_to_review[maillog][regexpdeny][5]\t\t\t= 503 5.5.1 Error: authentication # not enabled\n  logs_to_review[maillog][regexpdeny][6]\t\t\t= disconnect from.* commands=0\\/0\n  logs_to_review[maillog][regexpdeny][7]\t\t\t= non-SMTP command from unknown\n  logs_to_review[maillog][regexpdeny][8]\t\t\t= connect to.*:25: Connection refused"},"kind":12,"detail":"()","children":[{"kind":13,"containerName":"new","line":668,"definition":"my","name":"$class","localvar":"my"},{"localvar":"my","containerName":"new","line":669,"definition":"my","name":"$args","kind":13},{"kind":13,"name":"$args","containerName":"new","line":671},{"kind":13,"name":"$args","line":673,"containerName":"new"},{"kind":13,"line":675,"containerName":"new","name":"$args"},{"kind":13,"definition":"my","name":"$configsfile","line":680,"containerName":"new","localvar":"my"},{"name":"$args","containerName":"new","line":680,"kind":13},{"containerName":"new","line":680,"name":"$DEFAULTS","kind":13},{"localvar":"my","name":"$self","definition":"my","containerName":"new","line":682,"kind":13},{"name":"$configsfile","containerName":"new","line":683,"kind":13},{"containerName":"new","line":684,"name":"$args","kind":13},{"line":688,"containerName":"new","name":"$self","kind":13},{"kind":13,"containerName":"new","line":688,"name":"$class"},{"line":692,"containerName":"new","name":"$self","kind":13},{"name":"load_configs","containerName":"new","line":692,"kind":12},{"kind":13,"name":"$self","line":694,"containerName":"new"},{"line":696,"containerName":"new","name":"$self","kind":13},{"kind":13,"containerName":"new","line":697,"name":"$self"},{"name":"$self","containerName":"new","line":698,"kind":13},{"kind":13,"line":700,"containerName":"new","name":"$self"},{"line":705,"containerName":"new","name":"$logger","kind":13},{"kind":13,"name":"$self","line":705,"containerName":"new"},{"name":"setup_Logger","line":705,"containerName":"new","kind":12},{"name":"$logger","containerName":"new","line":706,"kind":13},{"name":"info","containerName":"new","line":706,"kind":12},{"name":"$logger","containerName":"new","line":707,"kind":13},{"kind":12,"name":"debug","line":707,"containerName":"new"},{"line":707,"containerName":"new","name":"$self","kind":13},{"line":707,"containerName":"new","name":"$logger","kind":13},{"name":"is_debug","containerName":"new","line":707,"kind":12},{"containerName":"new","line":709,"name":"$self","kind":13}]},{"line":672,"name":"carp","kind":12},{"line":676,"name":"croak","kind":12},{"kind":12,"line":680,"name":"configsfile"},{"kind":12,"name":"configsfile","line":680},{"kind":12,"line":683,"name":"configsfile"},{"line":684,"name":"clargs","kind":12},{"name":"configs","line":694,"kind":12},{"name":"dumpconfigsandexit","line":694,"kind":12},{"kind":12,"line":696,"name":"configs"},{"kind":12,"line":696,"name":"configsfile"},{"kind":12,"line":697,"name":"configs"},{"line":697,"name":"globalchain","kind":12},{"kind":12,"line":698,"name":"configs"},{"line":698,"name":"dumpconfigsandexit","kind":12},{"kind":12,"line":700,"name":"recursiveHashPrint"},{"name":"configs","line":700,"kind":12},{"name":"Dumper","line":707,"kind":12},{"range":{"start":{"line":712,"character":0},"end":{"character":9999,"line":723}},"containerName":"Net::IPBlocker","line":712,"definition":"sub","name":"recursiveHashPrint","kind":12,"signature":{"documentation":"","label":"recursiveHashPrint($ref,$prefix)","parameters":[{"label":"$ref"},{"label":"$prefix"}]},"children":[{"name":"$ref","definition":"my","containerName":"recursiveHashPrint","line":713,"localvar":"my","kind":13},{"kind":13,"name":"$prefix","line":713,"containerName":"recursiveHashPrint"},{"kind":13,"containerName":"recursiveHashPrint","line":714,"name":"$prefix"},{"kind":13,"name":"$prefix","containerName":"recursiveHashPrint","line":714},{"kind":13,"line":716,"containerName":"recursiveHashPrint","name":"$ref"},{"localvar":"my","definition":"my","name":"$key","containerName":"recursiveHashPrint","line":717,"kind":13},{"kind":13,"containerName":"recursiveHashPrint","line":717,"name":"$ref"},{"localvar":"my","containerName":"recursiveHashPrint","line":720,"name":"$new_prefix","definition":"my","kind":13},{"name":"$prefix","line":720,"containerName":"recursiveHashPrint","kind":13},{"name":"$ref","containerName":"recursiveHashPrint","line":721,"kind":13},{"name":"$key","containerName":"recursiveHashPrint","line":721,"kind":13},{"kind":13,"name":"$new_prefix","line":721,"containerName":"recursiveHashPrint"}],"detail":"($ref,$prefix)"},{"kind":13,"name":"%ref","containerName":null,"line":724},{"kind":13,"definition":"my","name":"$line","containerName":null,"line":727,"localvar":"my"},{"kind":13,"name":"$ref","containerName":null,"line":727},{"kind":13,"line":728,"containerName":null,"name":"$line"},{"line":729,"containerName":null,"name":"$line","kind":13},{"kind":13,"containerName":null,"line":730,"name":"%line"},{"name":"$line","definition":"my","containerName":null,"line":734,"localvar":"my","kind":13},{"kind":13,"name":"$line","line":735,"containerName":null},{"name":"$line","containerName":null,"line":736,"kind":13},{"name":"$line","containerName":null,"line":737,"kind":13},{"signature":{"parameters":[],"label":"go()","documentation":"1; # End of Net::IPBlocker\npackage Net::IPBlocker;\n\nuse 5.006;\nuse strict;\nuse warnings;\nuse POSIX qw(LONG_MAX);\nuse DateTime;\nuse File::Basename;\nuse List::Util qw(any);\n\n# use Getopt::Long;\n# use File::Lockfile;\nuse Time::HiRes qw(usleep gettimeofday time);\n\n# use Regexp::Common qw/ net number /;\n# use NetAddr::IP::Util qw(inet_ntoa);\n# use Net::DNS::Dig;\n# use Term::ANSIColor;\nuse Config::File;\nuse Carp;\nuse Log::Log4perl qw(get_logger :nowarn :levels);\nuse Log::Any qw($log);\nuse Data::Dumper;\nuse Regexp::IPv6     qw($IPv6_re);\nuse LockFile::Simple qw(lock trylock unlock);\nuse File::Path       qw(make_path);\nuse Net::Ifconfig::Wrapper;\n\n# Thread setup\nuse threads;\n# use threads::shared;\nuse Thread::Queue;\nmy $DataQueue  = Thread::Queue->new();\nmy $LoggerTIDS = ();                     # Thread IDs for tracking or whatever\n\n# Another queue for iptables commands\nmy $IptablesQueue = Thread::Queue->new();\nmy $IptablesTIDS  = ();                     # Thread IDs for tracking or whatever\n\n# Data Dumper setup\n$Data::Dumper::Sortkeys = 1;\n$Data::Dumper::Indent   = 1;\n\n### Global Variables  (clearly the threading stuff is global, duh)\n## I hate global variables!\n# logger --- I really debated whether to make this global or not.  I decided to make it global because it is used\n#   in the signal interupts and those use prototyped subs.  I don't know how (if possible) to pass $self to the\n#   signal interupt subs with so much threaded.\nmy $logger;      # This gets set after log4Perl is loaded in new()\n                 # Some might say to use 'our' instead of 'my' but does it matter when it is global to lexical scope of\n                 #   the package?\nmy $lock_obj;    # This is the lock object and is set in set_lockFile()\n                 # Needs to be global because it is used in the signal interupts and those use prototyped subs.\n## Regex for IPv4 and IPv6 capturing.\n#   This is critical and needs be consistent across the entire module\n# my $REGEX_IPV4 = q/.*\\b((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\\b.*/;\nmy $REGEX_IPV4 = q/\\b((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\\b/;\nmy $REGEX_IPV6      = q/\\b($IPv6_re)\\b/;\nmy $IPTABLESRUNLINE = 0;    #This is just an odd one.  It is used to track the line number of the sub iptables_thread()\n                            #  where run_iptables() is called.  This is used in the signal interupts to print out the\n                            #  line number of where the iptables command was run.  This is used for debugging.\n                            #  This is set in the iptables_thread() sub.\nour $tracker = {};          # Mostly chains added and rules added are stuffed in here for tracking purposes\nmy $DEFAULTS = {\n    allowdeny            => 'Allow,Deny',\n    allowlist            => {},\n    configsfile          => '/etc/ipblocker/ipblocker.conf',\n    cycles               => LONG_MAX,\n    cyclesleep           => 0.5,\n    dumpconfigsandexit   => 0,\n    denylist             => {},\n    forceremovelockfile  => 0,\n    globalallowlist      => {},\n    chainprefix          => \"IPBLOCKER_\",\n    globalchains         => [qw / INPUT OUTPUT FORWARD /],\n    globaldenylist       => {},\n    globalregexallowlist => {},\n    globalregexdenylist  => {},\n    ignoreinterfaceips   => 1,                                   #This adds the IPs from the interfaces to the allowlist\n    iptables             => '/sbin/iptables',\n    lockfile             => '/var/run/ipblocker.run.default',\n    log4perlconf         => '/etc/ipblocker/log4perl.conf',\n    loglevel             => 'Will use value from log4perl.conf', # Can be set from calling script.\n                                                                 #   If no value sent from calling script, then\n        #   use value from configs file.  If no value in configs file then I think the\n        #   Easy Init log4perl is used which defaults to DEBUG, i think.\n    logcontents       => {},\n    logs_to_review    => {},\n    logwatch_interval => 3,\n    prodmode          => 0,\n    queuechecktime    => 1,\n    queuecycles       => LONG_MAX,\n    readentirefile    => 0,\n};\n\n=head1 NAME\n\nNet::IPBlocker - Blocks IPs based on regex from specified log files\n\n=head1 VERSION\n\nVersion 0.01\n\n\nour $VERSION = '0.01';\n\n\n=head1 SYNOPSIS\n\nBlocks IPs based on Regular Expressions in specified log files.\n\n use Net::IPBlocker;\n my $foo = Net::IPBlocker->new();\n $foo->go(); \n\nYou can send all configs into the constructor as a hash, I really advise using a config file.  \nThe default config file is F</etc/ipblocker/ipblocker.conf> but you can set it to another file.\nIf a config file is not found, it will use default values for everything and that will probably not work very well.\n\n my $foo = Net::IPBlocker->new( { configsfile => '/etc/ipblocker/ipblocker.conf' } );\n $foo->go();\n\n=head2 Future Enhancements\n\n=over 4\n\n* * Add jail time for IPs\n\nThis involves adding a database to store the IPs and the time they were blocked.\nThis also means adding a mechanism to unblock IPs after a certain amount of time.\nLuckily, I have threaded this so adding that is just a matter of adding another thread.\nI am open to ideas of what database to use.  I am thinking SQLite.\nOr, possibly just a file with the IPs (the rule) and the time they are to be unblocked (deleted \nfrom iptables).\n\n* * Add synchronized appender logging:\n      \nhttps://metacpan.org/dist/Log-Log4perl/view/lib/Log/Log4perl/Appender/Synchronized.pm\n\n* * Fix the ability for Log4perl to re-read the \"log4perl.conf\" which seems to not work right now\n\n* * my $interfaces = Net::Ifconfig::Wrapper::Ifconfig('list', '', '', '');\n\nThis is a list of interfaces.  Need to figure out how to use this to get the IP address of the\ninterfaces.  Need to add those IPs to the global allow list.\n\n* * Fix sub add_ifconfig_ips_to_allowlist() to handle IPv4 and IPv6 addresses\n\n* * Change from using log4perl to Log::Any\n\n\n=head2 DESCRIPTION\n\nThis has been a very long running project of mine.  I have been using this script for years to block IPs and then \nrealized Fail2Ban exists.  I have tried to use Fail2Ban multiple times but it never seems to work right for me.\nIt seems to lock-up. \nThis module tries to incorporate the ideas of my past experience with the general idea of Fail2Ban.\n\nI highly encourage you to use a config file.  The default config file is in the same location as this module but you \ncan set it to another file.\n\nWhen installing this, you should also receive a script called \"ipBlocker.pl\".  This is a sample script that uses \nthis module.\n\nFinally, for now, this module use log4perl.  I didn't realize there was a heated debate about log4perl vs Log::Any vs \nwhatever else.  I am open to changing this to Log::Any but I need to figure out how to do that.\n\n=head1 SUBROUTINES/METHODS\n\n=head2 new\n\nReads configs, logging configs, sets up logging, sets up a class and returns a blessed object\nThe sub go() is where the action starts\n\nExample:\n\n  use IPblocker;\n\n  my $args = {\n    configsfile         => '/etc/ipblocker/ipblocker.conf',\n    dumpconfigsandexit  => '0', # True false value\n    forceremovelockfile => '0', # True false value\n    iptables            => 'sudo /sbin/iptables',\n    lockfile            => '/var/run/ipblocker.run',\n    log4perlconf        => '/etc/ipblocker/log4perl.conf',  #Can also be 0 to use default log4perl\n    loglevel            => 'DEBUG', # Can be TRACE DEBUG INFO WARN ERROR FATAL\n    prodmode            => '0', # True false value --- Determins if the iptables commands are actually run\n    queuechecktime      => '3', # How long to wait when the queue is empty before checking again. Any float value.\n    readentirefile      => '0', # True false value --- Determines if the entire log file is read or\n                                # new entries since last run are read.\n    cycles              => 'LONG_MAX', # How many times to run the main loop.  LONG_MAX is the default.\n  };\n\n  my $ipb    = IPblocker->new($args);\n  my $logger = $ipb->{logger};\n\n=head3 All arguments to new() and their defaults\n\n=head4 allowdeny\n\nallowdeny            => 'Allow,Deny',\n\nSet to 'Allow,Deny' or 'Deny,Allow' to determine the order of the allow and deny lists.\nSeteting to 'Allow,Deny' means the allow list is processed first and then the deny list is processed.\nMeaning, as an example, if 1.1.1.1 is on the allow list and allowdeny is set to Allow,Deny, then\nthe IP of 1.1.1.1 will never be blocked.  If allowdeny is set to Deny,Allow, then it is possible \nfor 1.1.1.1 to be blocked.\n\n=head4 allowlist\n\nallowlist            => {},\n\nA list of IPs to allow.  This is a hash reference.  The key is the order to allow the IP.  The value is the IP.\nExample:\n\n allowlist => (\n  '01' => '1.1.1.1',\n  '4' => '1.1.1.4',\n  '10' => '1.1.1.2',\n  '100' => '1.1.1.3',\n  \n )\n\nThe allow list is sorted in standard Perl sort order.  So, be sure to pad 0's or whatever to the front of the key.\n\n=head4 configsfile\n\nconfigsfile          => '/etc/ipblocker/ipblocker.conf',\n\nUse a config file!  This is the default config file location.  You can set it to another file.\n\n=head4 cycles\n\ncycles               => LONG_MAX,\n\nHow many times to run the main loop.  LONG_MAX is the default.  Why not infinity?  Because I don't want to.\n\n=head4 cyclesleep\n\ncyclesleep           => 0.5,\n\nHow long to sleep between cycles.  This is in seconds.  Default is 0.5 seconds.  You can use a float value.\n\n=head4 dumpconfigsandexit\n\ndumpconfigsandexit   => 0,\n\nIf set to 1 (true), then the configs are dumped to stdout and the script exits.  This is useful for creating a \nconfig file.\n\n=head4 denylist\n\ndenylist             => {},\n\nSimilar to allow list but for IPs to deny.  This is a hash reference.  The key is the order to deny the IP.\n\n=head4 forceremovelockfile\n\nforceremovelockfile  => 0,\n\nThis will force removal of lock file (if possible) before starting.  Seriously, you better know what you are doing.\n\n=head4 chainprefix\n\nchainprefix          => \"IPBLOCKER_\",\n\nThis is the prefix for the chains created in iptables.  This is the prefix you will see in iptables for \nall the chains created by this module.\n\n=head4 globalchains\n\nglobalchains         => [qw / INPUT OUTPUT FORWARD /],\n\nThis is a list of the global chains to add the global chain to.\nThe global chain is where all the subordinate file logger chains are added.\n\nI see some value in adding the global chain to some other chain but by default we add it to INPUT, OUTPUT, and FORWARD.\nOr, possibly, you don't want to add to the FORWARD chain.\nMaybe you onkly care about INPUT table.  I don't know.  Whatever works best for you.\n\n=head4 iptables\n\niptables             => '/sbin/iptables',\n\nThis is the iptables command to use.  You can use sudo or whatever you want.\nI really encourage using sudo but by default it is not used.  \nUsing sudo and non-root user is a bit more work.  You need to setup sudoers to allow the user to run iptables.\nHowever, I think it is worth it for an added measure of security.\nIf you change this to use sudo, then you may also need to change the lockfile location to a location that the user \ncan write to.\n\n=head4 lockfile\n\nlockfile             => '/var/run/ipblocker.run.default',\n\nThis is the lock file location to use to try to prevent multiple instances from running.\n\n=head4 log4perlconf\n\nlog4perlconf         => '/etc/ipblocker/log4perl.conf',\n\nThis is the log4perl configuration file to use.  You can also set this to 0 to use the default log4perl configuration.\n\n=head4 loglevel\n\nloglevel             => 'INFO'\n\nTHis can be TRACE DEBUG INFO WARN ERROR FATAL.\n\n=head4 prodmode\n\nprodmode          => 0,\n\nThis is a true/false value.  If set to 1 (true), then the iptables commands are actually run.  If set to 0 (false), \nthen the iptables commands are not run.  This is useful for testing.\n\nBy default, this is set to 0 (false).\n\n=head4 queuechecktime\n\nqueuechecktime    => 1,\n\nWhen the queue is empty, how long to wait before checking again.  When the queue is not empty, this value is ignored\n\n=head4 queuecycles\n\nqueuecycles       => LONG_MAX,\n\nHow many times to check the queue.  LONG_MAX is the default.  Why not infinity?  Because I don't want to.\n\n=head4 readentirefile\n\nreadentirefile    => 0,\n\nThis is a true/false value.  If set to 1 (true), then the entire log file is read.  If set to 0 (false), then only\nnew entries since the last run are read.\nThis can aslo be set per log file in the configs file.\n\n=head1 Sample config file\n\n  # Lines that begin with a comment (#) are ignored\n  # Think of each line as a a key:value setup as such: key[sub-key][sub-sub-key][sub-sub-sub-key]=value\n  # Duplicates are allowed.  The last one wins!\n  # This is being used by perl so let's keep a few thigns in mind:\n  #   1. False value is 0.  Period.  That's it.  0 (zero) is false.  Everything else is true.\n  #   2. Regular expressions are PERL regular expressions.  So they are case sensitive and use PERL regular expressions.\n  #   3. Unless otherwise noted, sorting is regular perl sorting.  So 1, 10, 11 come before 2, 20, 21, etc.\n\n\n  ### Global settings \n  # The global settings are used for all log files unless overridden or combined by the individual log file settings.\n\n  # The a different iptables command\n  #   If this is not set, then the default is `which iptables`\n  #   A simpe check is done to verify that the iptables command exists and is executable.\n  #   A good method is to use a sudo command to run iptables as a different user.\n  #   This also means seting up sudo to allow the user to run iptables as a different user in passwordless mode.\n  #   Steps to do this:\n  #     1.  Create a user to run the iptables command.  For example, iptablesuser\n  #     2.  Create a group to run the iptables command.  For example, iptablesgroup\n  #     3.  Add the iptablesuser to the iptablesgroup\n  #     4.  Add the following line to the /etc/sudoers file:\n  #           iptablesuser ALL=(ALL) NOPASSWD: /sbin/iptables\n  #     5.  Set the iptables command to the following:\n  #           iptables=sudo -u iptablesuser /sbin/iptables\n  # iptables=/usr/sbin/iptables_some_other_location\n  iptables=sudo /sbin/iptables\n\n  # The location of the log4perl configuration file if different than default location of /etc/ipblocker/log4perl.conf\n  # log4perlconf=/some/other/place/log4perl.conf\n\n  # The log level to use.  \n  # This will override the log level in the log4perl configuration file.\n  # I encourage setting this in the the log4perl configuration file but it is here if you need it.\n  # I put this in here because the sample calling has the ability to set the log level so might as well have it here too.\n  # This may be one of the following:\n  #  DEBUG INFO WARN ERROR FATAL TRACE\n  #  FYI:  I did not use trace anywhere in the code so it is not really an option that will give you anything extra \n  #        than just using DEBUG.\n  # loglevel=DEBUG\n\n  # The location of the lock file\n  #   If this is not set, then the default is /var/run/iptables.run\n  #   The lock file is used to prevent multiple instances of this script from running at the same time.\n  # lockfile=/some/other/directory/iptables.run\n\n  # If not set, the default value is 1\n  # The number of seconds to wait to check to see if there are entries in the queue to process\n  #   Prevents the script from going CPU crazy and checking the queue as fast as possible.\n  #   You can set this to 0 to check the queue as fast as possible but I would not recommend it.\n  # Once a queue entry is found then the queue is checked continuously until the queue is empty.\n  # I see very little utility in having this set to 0 or even less than 1 second.\n  queuechecktime=1\n\n  # Whether or not the entire log file is read each time.  If set to 0 (false), then we only read from the end of the \n  #   last read (or the beginning if it is the first read or if the log file has been allegedly rotated)\n  #   Reading from last read is faster, but if the log file is rotated AND the log file grows larger than the \n  #       last read, then we may miss some entries.\n  #   If this setting does not exist, then it is assumed to be 0.\n  #   For most situations, this should be set to 0.\n  #   If you rotate your log files frequently AND get a lot of traffic, then you may want to set this to 1.\n  readentirefile\t    = 0\n\n  # This is how many times a log file will be reviewed.\n  # This is a global value and can be set for each log file individually.\n  #  (Very bad naming of a variable, sorry)\n  #   If this is not set, then the default is 9007199254740991\n  cycles=25\n\n  # This is how many seconds to sleep between checking a log file.\n  # This is a global value and can be set for each log file individually.\n  #  If this is not set, then the default is 0.5 seconds\n  #  This gets a bit complex to decide but here goes:\n  #  If you are always reviewing the entire log file, then this value is rather important.\n  #     Reviewing the entire log file means that you are not using the \"readentirefile\" setting.\n  cyclesleep=1\n\n  # Process nice level on the OS\n  nice=15\n\n  PRODMODE=1  # Set this to a perl false value (0) to run in test mode.\n              # Default is test mode. (meaning  PRODMODE=0 is the default)\n              # Test mode will NOT run any iptable command but will log what it would have been done.\n\n  chainprefix=IPBLOCKER_  # If not set, default is IPBLOCKER_\n                          # This is the prefix for the iptables chain names.\n                          # The chain names are created as follows:\n                          #   ${chainprefix}${logname}\n                          #  All actions are performed from ${chainprefix}global\n                          # The default is IPBLOCKER_ but you can change it if you want.\n                          # When you do an 'iptables -nvL' you will see the chain prefix in the chain names.\n\n  globalchains=INPUT,OUTPUT,FORWARD   # If not set, default is INPUT,OUTPUT,FORWARD\n                                      # These are the chains that {chainprefix}global will be added to.\n                                      # All other logger chains will be added to {chainprefix}global\n                                      # The logger rules are then added to the logger chains.\n                                      # Instead of adding the rules to the INPUT,OUTPUT,FORWARD chains, you can\n                                      #   add them to a different chain.  For example, you could add them to a chain\n                                      #   called \"MailServer\" and then that chain would have to be added to the\n                                      #  INPUT,OUTPUT,FORWARD chains (or whatever chains you want).\n                                      #  This might be useful to change if you want to add the rules to a dummy chain but\n                                      #  is not actually used.... maybe for pre-production testing or something.\n                                      #  Or, maybe you only want rules acted on the INPUT chain and not the OUTPUT chain.\n                                      #  Having FORWARD is a bit aggressive but to each their own.\n                                      #  This value must be a comma separated.  No spaces.\n\n  # Deny list of IPs:  deny these IPs, almost always.  The allowdeny value takes precedence when order of allowdeny\n  # is set.  See below.\n  # The denylist is added to the individual log file denylist.\n  denylist[01]\t\t\t\t\t\t\t= 165.232.121.37\n  denylist[02]\t\t\t\t\t\t\t= 165.232.121.36\n\n  # Allow list of IPs:  allow these IPs, almost always.  The allowdeny value takes precedence when order of allowdeny\n  # is set.  See below.\n  # The allowlist is added to the individual log file allowlist.\n  allowlist[00]\t\t\t\t\t\t\t= 75.87.147.162\n  allowlist[01]\t\t\t\t\t\t\t= 64.250.56.204\n  allowlist[02]\t\t\t\t\t\t\t= 192.73.248.201\n  allowlist[03]\t\t\t\t\t\t\t= 199.38.182.248\n  allowlist[04]\t\t\t\t\t\t\t= 158.69.195.66\n  allowlist[05]\t\t\t\t\t\t\t= 185.34.216.102\n  allowlist[06]\t\t\t\t\t\t\t= 192.73.241.233\n  allowlist[07]\t\t\t\t\t\t\t= 192.73.241.56\n  allowlist[08]\t\t\t\t\t\t\t= 198.251.81.67\n  allowlist[09]\t\t\t\t\t\t\t= 198.50.163.67\n  allowlist[10]\t\t\t\t\t\t\t= 199.195.248.92\n  allowlist[11]\t\t\t\t\t\t\t= 204.109.63.3\n  allowlist[12]\t\t\t\t\t\t\t= 208.86.227.242\n  allowlist[13]\t\t\t\t\t\t\t= 209.177.157.147\n  allowlist[14]\t\t\t\t\t\t\t= 81.4.124.103\n  allowlist[15]\t\t\t\t\t\t\t= 91.189.91.38\n  allowlist[16]\t\t\t\t\t\t\t= 185.34.3.136\n  allowlist[17]\t\t\t\t\t\t\t= 20.245.57.59\n  allowlist[18]\t\t\t\t\t\t\t= 3.3.3.3\n\n  # Individual log files settings for this value take precedence over the general settings here\n  #   Allow,Deny means that the allowlist is processed first and then the denylist is processed.\n  #      Items in the allowlist will be allowed even if they are in the denylist.\n  #   Deny,Allow means that the denylist is processed first and then the allowlist is processed.\n  #      Items in the denylist will be denied even if they are in the allowlist.\n  #  I would not change this unless you know what you are doing.  You have the potential to lock yourself out of your\n  #  own system.\n  allowdeny                               = Allow,Deny\n\n\n  ### Not yet implemented....\n  # Finds the IPs of each interface and adds them to the allow list.\n  #  Some logs have the IP of the interface in the log file.\n  #  This is a perl true/false value.  If it is set to 0 (false) then the IPs of each interface will be added to \n  #  the allowlist.\n  #  If you keep allowdeny set  to Allow,Deny then this will keep you from blocking your own IPs.\n  #    Or, at least that is the idea!  This is totally based on Net::Ifconfig::Wrapper so... do some testing\n  #    to make sure that it is working as expected.\n  #  I encourage leaving this as 0 (false) but it is here if you need it.  \n  #  The default value, if not set, is 0 (false)\n  # ignoreinterfaceips=0\n\n  ### End of Global settings\n\n\n\n  # Settings for each log file from here down\n\n  ### The authlog settings:\n  # The \"logs_to_review\" hash is a list of log files to review.  Each log file has a unique name.  The name is used \n  #   to reference the log file in other parts of the configuration file.\n  #   In the exampple of \"authlog\", the string \"authlog\" could be any alphanumeric string.  It is just used for reference.\n\n  # load:  This is a perl true/false value.  If it is set to 1 (true) then the log file will be reviewed.\n  #   This is just an easy way to keep configs in here but the script/module will not review the log file.\n  logs_to_review[authlog][load] \t\t\t\t    = 1\n\n  # file: The \"file\" value is the location of the log file to review.\n  logs_to_review[authlog][file]\t\t\t\t    = /var/log/auth.log\n\n  # readentirefile: Whether or not the entire log file is read each time.  If set to 0 (false), then we only read from \n  #   the end of the last read (or the beginning if it is the first read or if the log file has been allegedly \n  #   rotated)\n  #   Reading from last read is faster, but if the log file is rotated AND the log file grows larger than the last \n  #   read, then we may miss some entries.\n  #   If this setting does not exist, then it is assumed to be 0.\n  #   For most situations, this should be set to 0.\n  #   If you rotate your log files frequently AND get a lot of traffic, then you may want to set this to 1.\n  #   For now, the script/module is pretty dumb about this.  When set to 0, the entire file is reread if the file size\n  #   is less than the last read.\n  #   This should be enhanced to check the inode, file size, last change time, etc.  But for now, it is pretty dumb.\n  logs_to_review[authlog][readentirefile]\t    = 0\n\n  # cycles: Cycles and cyclessleep\n  #   The number of times the log file will be reviewed.\n  # logs_to_review[authlog][cycles]                 = 10\n  # cyclesleep:  The number of seconds to sleep between cycles.  Can be partial seconds.  So 0.5 is a half second.\n  logs_to_review[authlog][cyclesleep]             = 1.5\n\n  # protocols:  This is the protocol(s) that will be blocked in the firewall.\n  #   If the protocol is not set, then the default is no protocol.\n  #   You do not have to set protocol unless you set ports.\n  #   If you set ports but not protocol then the script will add the IP to the firewall but will not add the protocol and\n  #     thus no ports.  So, the entire IP will be blocked.\n  #   There is no checking if the protocol is valid.  So if you set protocol=blah then the script will give an error \n  #     when the rule is tries to be added to the firewall.\n  #   Must be separated by non-alphanumeric-digit characters.  So tcp,udp is good.  tcp udp is good.  tcp-udp is good.\n  #    The \"_\" character is not allowed.  So tcp_udp is not good.\n  #    Most folks will use commas but whatever floats your boat.\n  logs_to_review[authlog][protocols]              = tcp,udp\n\n  # ports: This is the port(s) that will be matched for blocking of IPs in the log file.\n  #   If the ports are not set, then the default is no ports.\n  #   You do not have to set ports but if you do, then you must set protocol.\n  #   Example:  ports=22,21,23 means that the script will block IPs that are trying to connect to ports 22, 21, and 23.\n  #   Must be separated by commas and ranges are accepted.  Maximum of 15 comma separated values.\n  # Example 1:  logs_to_review[authlog][ports]                  = 22,21,23\n  # Example 2:  logs_to_review[authlog][ports]                  = 22,21,23,1000:2000,3000:4000\n  # Example 3:  logs_to_review[authlog][ports]                  = 22,21,23,1000:2000\n  # Bad ports will log as an error and the rule will not be added.\n  # If you set ports but no protocol then the entire IP will be blocked on the protocol.\n  # logs_to_review[authlog][ports]                  = 22,21,23\n\n  # directions:  This is the direction(s) that will be blocked in the firewall.\n  #   If the direction is not set, then the default is source\n  #  Must be separated by non-digit-alphanumeric characters.  So source,destination is good.  source destination is good.\n  #   source-destination is good.\n  #   The \"_\" character is not allowed.  So source_destination is not good.\n  #  Most folks will use commas but whatever floats your boat.\n  #  Accepted values are source, destination, random\n  # Example 1:  logs_to_review[authlog][direction]              = source,destination\n  # Example 2:  logs_to_review[authlog][direction]              = source\n  # Example 3:  logs_to_review[authlog][direction]              = destination\n  # Example 4:  logs_to_review[authlog][direction]              = source,destination,cool,blah,blah,blah\n  # In example 4, only source and destination will be used.  The values of cool,blah,blah,blah will be ignored.\n  # I think most folks will not set this or just use 'source' but I can see value in blocking the destination as well.\n  # If you want to really screw with hackers, then set this to 'destination' and then they will not get any response\n  # The \"random\" value will ignore (for now) any other value set.  If randiom is used then source or \n  # destination will be randomly chosen for each IP rule.\n  # logs_to_review[authlog][directions]          = source,destination\n  # logs_to_review[authlog][directions]          = destination\n  # logs_to_review[authlog][directions]          = random\n\n  # allowdeny\n  #  This is the order preference for whitelisted and blacklisted IPs.\n  #  If the order is set to \"Deny,Allow\" then blacklisted IPs will ALWAYS be \n  #    blocked (even if they are in the whitelisted hash)!\n  #  If the order is set to \"Allow,Deny\" then whitelisted IPs will ALWAYS be \n  #    allowed (even if they are in the blacklisted hash)!\n  #  If the order is not set or is set incorrectly then the default is \"Allow,Deny\"\n  #  When using authlog, I would reccomend setting the order to \"Allow,Deny\" so that whitelisted IPs are always allowed \n  #    for ssh.\n  #  The order is case insensitive.\n  logs_to_review[authlog][allowdeny]          = Allow,Deny\n\n  # allowlist: List of IPs to allow just for this log file\n  logs_to_review[authlog][allowlist][01]     =  1.1.1.1\n  logs_to_review[authlog][allowlist][02]     =  2.2.2.2\n  logs_to_review[authlog][allowlist][03]     =  3.3.3.3\n  logs_to_review[authlog][allowlist][04]     =  4.4.4.4\n  logs_to_review[authlog][allowlist][05]     =  23.116.91.65\n  logs_to_review[authlog][allowlist][05]     =  23.116.91.66\n  logs_to_review[authlog][allowlist][06]     =  23.116.91.67\n  logs_to_review[authlog][allowlist][07]     =  23.116.91.68\n\n  # denylist: List of IPs to block just for this log file\n  logs_to_review[authlog][denylist][01]      =  5.5.5.5\n  logs_to_review[authlog][denylist][02]      =  6.6.6.6\n\n  # regexpdeny: Each regular expression must have a unique value.  \n  #   This is just typically indexed as 01, 02, 03, 04, etc.  But it can be any Alphanumeric\n  #   The index is sorted in simple Perl sort.  So 1, 10, 11 come before 2, 20, 21, etc.\n  #   Also, lowercase will come before uppercase.  So a, b, c, A, B, C.\n  #   The sorting may matter because the regular expressions are applied in order.\n  #   Regular expressions are case insensitive therefore \"Failed\" is the same as \"fAiLed\"\n  #   Regular expressions Perl regular expressions so you can do fancy *.?[]{}() stuff.\n  logs_to_review[authlog][regexpdeny][01]  \t\t= Failed password for root from\n  logs_to_review[authlog][regexpdeny][02]  \t\t= Failed password for invalid user\n  logs_to_review[authlog][regexpdeny][03]  \t\t= Did not receive identification string from\n  logs_to_review[authlog][regexpdeny][04]  \t\t= not allowed because listed in DenyUsers\n\n  # Special use cases for particular loggers is not yet implemented.\n  # # Authlog has a special value of allowed usernames\n  # logs_to_review[authlog][allowedusername][01]    = gardner\n  # logs_to_review[authlog][allowedusername][02]    = jiggerboy\n  # # Authlog has a special value of not-allowed usernames\n  # logs_to_review[authlog][deniedusername][01] \t= root\n\n\n\n  #### Now... an example without comments\n\n  ### The maillog settings:\n  logs_to_review[maillog][load] \t\t\t\t= 1\n  logs_to_review[maillog][file]\t\t\t\t= /var/log/mail.log\n  logs_to_review[maillog][cycles]             = 3\n  logs_to_review[maillog][cyclesleep]         = 2.25\n  logs_to_review[maillog][order]              = Allow,Deny \n  logs_to_review[maillog][regexpdeny][1] \t\t\t= Relay access denied,Illegal address syntax from\n  logs_to_review[maillog][regexpdeny][2]\t\t\t= SASL LOGIN authentication failed\n  logs_to_review[maillog][regexpdeny][3]\t\t\t= SSL_accept error from\n  logs_to_review[maillog][regexpdeny][4]\t\t\t= lost connection after AUTH from unknown\n  logs_to_review[maillog][regexpdeny][5]\t\t\t= 503 5.5.1 Error: authentication # not enabled\n  logs_to_review[maillog][regexpdeny][6]\t\t\t= disconnect from.* commands=0\\/0\n  logs_to_review[maillog][regexpdeny][7]\t\t\t= non-SMTP command from unknown\n  logs_to_review[maillog][regexpdeny][8]\t\t\t= connect to.*:25: Connection refused\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nsub new() {\n    my $class = shift;\n    my $args  = shift;\n\n    if ( !$args ) {\n        carp(\"No arguments passed to new().  This may not be an issue.\");\n        $args = {};\n    }\n    elsif ( ref($args) ne 'HASH' ) {\n        croak(\"Arguments passed to new() are not a hash reference\");\n    }\n\n    # Allow command line to override default configs file location\n    my $configsfile = $args->{configsfile} || $DEFAULTS->{configsfile};\n\n    my $self = {\n        configsfile => $configsfile,\n        clargs      => $args,\n    };\n\n    # Create the $self object\n    bless $self, $class;\n\n    # Load all the configs into the $self object under the configs key\n    # The sub load_configs() expects $self to be an object and have configsfile setup\n    $self->load_configs();\n\n    if ( $self->{configs}->{dumpconfigsandexit} ) {\n        ## Rip out some stuff that is used internally and not needed for the configs file\n        delete $self->{configs}->{configsfile};\n        delete $self->{configs}->{globalchain};\n        delete $self->{configs}->{dumpconfigsandexit};\n        print \"This can basically be copy/pasted into a config file:\\n\";\n        recursiveHashPrint( $self->{configs} );\n        exit;\n    } ## end if ( $self->{configs}->...)\n\n    # Setup logging.\n    $logger = $self->setup_Logger();\n    $logger->info(\"Logging initialized and ready to go\");\n    $logger->debug( \"Dumping self: \" . Dumper($self) ) if ( $logger->is_debug() );\n\n    return $self;\n} ## end sub new\n\nsub recursiveHashPrint {\n    my ( $ref, $prefix ) = @_;\n    $prefix = '' unless defined $prefix;    # Initialize prefix if not provided\n\n    if ( ref($ref) eq 'HASH' ) {\n        foreach my $key ( sort keys %{$ref} ) {\n\n            # Concatenate the current key to the prefix for the next level\n            my $new_prefix = $prefix ? \"$prefix][$key\" : \"[$key\";\n            recursiveHashPrint( $ref->{$key}, $new_prefix );\n        } ## end foreach my $key ( sort keys...)\n    } ## end if ( ref($ref) eq 'HASH')\n    elsif ( ref($ref) eq 'ARRAY' ) {\n\n        # If the reference is an array, join and print the elements\n        my $line = \"$prefix] = \" . join( ', ', @{$ref} ) . \"\\n\";\n        $line =~ s/\\[//;\n        $line =~ s/\\]//;\n        print $line;\n    } ## end elsif ( ref($ref) eq 'ARRAY')\n    else {\n        # Print the scalar value\n        my $line = \"$prefix]=$ref\\n\";\n        $line =~ s/\\[//;\n        $line =~ s/\\]//;\n        print $line;\n    } ## end else [ if ( ref($ref) eq 'HASH')]\n} ## end sub recursiveHashPrint\n\n=head2 go\n\nThis is where the action starts.  This is called from the script that uses this module after\nnew() is instantiated.\n\nThis creates a thread for each log watcher and a thread for the iptables queue watcher.\nIf you have 5 files to watch, then there will be 5 threads watching those files + 1 thread to add commands to \niptables."},"kind":12,"definition":"sub","name":"go","containerName":"Net::IPBlocker","range":{"start":{"line":752,"character":0},"end":{"line":808,"character":9999}},"line":752,"detail":"()","children":[{"kind":13,"line":753,"containerName":"go","name":"$self","definition":"my","localvar":"my"},{"localvar":"my","containerName":"go","line":754,"definition":"my","name":"$start_time","kind":13},{"kind":13,"name":"$self","line":757,"containerName":"go"},{"kind":13,"containerName":"go","line":758,"name":"$logger"},{"kind":12,"name":"error","containerName":"go","line":758},{"kind":13,"name":"$self","line":763,"containerName":"go"},{"containerName":"go","line":763,"name":"set_iptables_command","kind":12},{"line":763,"containerName":"go","name":"$logger","kind":13},{"kind":12,"line":763,"containerName":"go","name":"error"},{"containerName":"go","line":764,"name":"$self","kind":13},{"kind":12,"name":"set_signal_handler","containerName":"go","line":764},{"kind":13,"name":"$self","containerName":"go","line":765},{"kind":13,"containerName":"go","line":765,"name":"$self"},{"name":"$self","containerName":"go","line":766,"kind":13},{"kind":12,"name":"set_lockFile","line":766,"containerName":"go"},{"name":"$logger","line":766,"containerName":"go","kind":13},{"kind":12,"containerName":"go","line":766,"name":"logdie"},{"name":"$iptables_thr","definition":"my","line":771,"containerName":"go","localvar":"my","kind":13},{"kind":12,"name":"create","line":771,"containerName":"go"},{"containerName":"go","line":771,"name":"$self","kind":13},{"kind":13,"containerName":"go","line":774,"name":"$self"},{"kind":12,"line":774,"containerName":"go","name":"add_global_chain"},{"name":"$self","containerName":"go","line":777,"kind":13},{"kind":12,"name":"add_global_allow_deny_ips","containerName":"go","line":777},{"line":781,"containerName":"go","name":"$logger","kind":13},{"containerName":"go","line":781,"name":"logdie","kind":12},{"kind":13,"name":"$self","line":781,"containerName":"go"},{"kind":12,"name":"logger_thread","line":781,"containerName":"go"},{"kind":13,"localvar":"my","name":"$cycles","definition":"my","containerName":"go","line":791},{"kind":13,"line":791,"containerName":"go","name":"$self"},{"definition":"my","name":"$cyclesleep","line":792,"containerName":"go","localvar":"my","kind":13},{"containerName":"go","line":792,"name":"$self","kind":13},{"kind":13,"name":"$cycles","containerName":"go","line":793},{"kind":13,"name":"$cycles","line":794,"containerName":"go"},{"kind":13,"name":"$cyclesleep","containerName":"go","line":795},{"localvar":"my","name":"$logmsg","definition":"my","containerName":"go","line":796,"kind":13},{"name":"$logmsg","line":797,"containerName":"go","kind":13},{"containerName":"go","line":797,"name":"$cycles","kind":13},{"kind":13,"line":798,"containerName":"go","name":"$logmsg"},{"containerName":"go","line":799,"name":"$logmsg","kind":13},{"line":799,"containerName":"go","name":"$cyclesleep","kind":13},{"kind":13,"name":"$logmsg","containerName":"go","line":800},{"kind":13,"containerName":"go","line":801,"name":"$logger"},{"containerName":"go","line":801,"name":"trace","kind":12},{"kind":13,"line":801,"containerName":"go","name":"$logmsg"},{"kind":13,"name":"$logger","line":801,"containerName":"go"},{"containerName":"go","line":801,"name":"is_debug","kind":12},{"localvar":"my","containerName":"go","line":804,"name":"$runtime","definition":"my","kind":13},{"kind":13,"name":"$start_time","line":804,"containerName":"go"},{"kind":13,"containerName":"go","line":805,"name":"$runtime"},{"containerName":"go","line":805,"name":"$runtime","kind":13},{"kind":13,"line":806,"containerName":"go","name":"$logger"},{"containerName":"go","line":806,"name":"info","kind":12},{"kind":13,"name":"$self","line":807,"containerName":"go"},{"kind":12,"containerName":"go","line":807,"name":"stop"}]},{"line":757,"name":"configs","kind":12},{"kind":12,"name":"logs_to_review","line":757},{"kind":12,"name":"configs","line":765},{"name":"globalchain","line":765,"kind":12},{"line":765,"name":"configs","kind":12},{"kind":12,"line":765,"name":"chainprefix"},{"kind":12,"line":771,"name":"threads"},{"name":"iptables_thread","line":771,"kind":12},{"kind":12,"line":791,"name":"configs"},{"name":"cycles","line":791,"kind":12},{"line":792,"name":"configs","kind":12},{"kind":12,"line":792,"name":"cyclesleep"},{"kind":12,"line":795,"name":"usleep"},{"kind":12,"signature":{"documentation":"","parameters":[],"label":"iptables_thread()"},"range":{"start":{"line":810,"character":0},"end":{"character":9999,"line":852}},"containerName":"Net::IPBlocker","line":810,"definition":"sub","name":"iptables_thread","children":[{"localvar":"my","definition":"my","name":"$self","containerName":"iptables_thread","line":811,"kind":13},{"localvar":"my","line":812,"containerName":"iptables_thread","name":"$TID","definition":"my","kind":13},{"name":"tid","containerName":"iptables_thread","line":812,"kind":12},{"kind":13,"containerName":"iptables_thread","line":813,"name":"$TID"},{"kind":13,"line":813,"containerName":"iptables_thread","name":"$TID"},{"localvar":"my","containerName":"iptables_thread","line":815,"name":"$cyclesleep","definition":"my","kind":13},{"kind":13,"name":"$self","containerName":"iptables_thread","line":815},{"kind":13,"localvar":"my","name":"$cycles","definition":"my","containerName":"iptables_thread","line":816},{"line":816,"containerName":"iptables_thread","name":"$self","kind":13},{"kind":13,"name":"$logmsg","definition":"my","line":817,"containerName":"iptables_thread","localvar":"my"},{"kind":13,"containerName":"iptables_thread","line":818,"name":"$logmsg"},{"kind":13,"line":819,"containerName":"iptables_thread","name":"$logger"},{"line":819,"containerName":"iptables_thread","name":"info","kind":12},{"kind":13,"line":819,"containerName":"iptables_thread","name":"$logmsg"},{"kind":13,"name":"$iptablesQueue_pending","definition":"my","line":822,"containerName":"iptables_thread","localvar":"my"},{"kind":13,"line":822,"containerName":"iptables_thread","name":"$IptablesQueue"},{"kind":12,"line":822,"containerName":"iptables_thread","name":"pending"},{"line":823,"containerName":"iptables_thread","name":"$iptablesQueue_pending","kind":13},{"kind":13,"name":"$logmsg","definition":"my","line":824,"containerName":"iptables_thread","localvar":"my"},{"name":"$logmsg","containerName":"iptables_thread","line":825,"kind":13},{"name":"$logger","containerName":"iptables_thread","line":826,"kind":13},{"containerName":"iptables_thread","line":826,"name":"info","kind":12},{"kind":13,"line":826,"containerName":"iptables_thread","name":"$logmsg"},{"kind":13,"name":"$iptablesQueue_pending","containerName":"iptables_thread","line":830},{"kind":13,"name":"$logger","line":831,"containerName":"iptables_thread"},{"kind":12,"name":"info","line":831,"containerName":"iptables_thread"},{"kind":13,"containerName":"iptables_thread","line":832,"definition":"my","name":"$data","localvar":"my"},{"containerName":"iptables_thread","line":832,"name":"$IptablesQueue","kind":13},{"line":832,"containerName":"iptables_thread","name":"dequeue","kind":12},{"line":833,"containerName":"iptables_thread","name":"$logger","kind":13},{"containerName":"iptables_thread","line":833,"name":"debug","kind":12},{"kind":13,"name":"$data","line":833,"containerName":"iptables_thread"},{"kind":13,"line":833,"containerName":"iptables_thread","name":"$logger"},{"name":"is_debug","line":833,"containerName":"iptables_thread","kind":12},{"line":834,"containerName":"iptables_thread","name":"$self","kind":13},{"kind":12,"containerName":"iptables_thread","line":834,"name":"run_iptables"},{"kind":13,"line":834,"containerName":"iptables_thread","name":"$data"},{"name":"$logger","line":834,"containerName":"iptables_thread","kind":13},{"kind":12,"line":834,"containerName":"iptables_thread","name":"error"},{"containerName":"iptables_thread","line":834,"name":"$data","kind":13},{"kind":13,"line":835,"containerName":"iptables_thread","name":"$IPTABLESRUNLINE"},{"containerName":"iptables_thread","line":836,"name":"$IPTABLESRUNLINE","kind":13},{"kind":13,"name":"$IPTABLESRUNLINE","containerName":"iptables_thread","line":836},{"kind":13,"name":"$iptablesQueue_pending","line":838,"containerName":"iptables_thread"},{"localvar":"my","line":841,"containerName":"iptables_thread","definition":"my","name":"$logmsg","kind":13},{"line":842,"containerName":"iptables_thread","name":"$logmsg","kind":13},{"line":842,"containerName":"iptables_thread","name":"$cyclesleep","kind":13},{"kind":13,"name":"$logmsg","line":843,"containerName":"iptables_thread"},{"kind":13,"name":"$logger","containerName":"iptables_thread","line":844},{"kind":12,"containerName":"iptables_thread","line":844,"name":"info"},{"containerName":"iptables_thread","line":844,"name":"$logmsg","kind":13},{"containerName":"iptables_thread","line":845,"name":"$cyclesleep","kind":13},{"kind":13,"name":"$logger","containerName":"iptables_thread","line":848},{"kind":12,"name":"error","line":848,"containerName":"iptables_thread"}],"detail":"()"},{"kind":12,"name":"threads","line":812},{"kind":12,"line":815,"name":"configs"},{"kind":12,"line":815,"name":"queuechecktime"},{"kind":12,"name":"configs","line":816},{"kind":12,"line":816,"name":"queuecycles"},{"kind":12,"line":833,"name":"Dumper"},{"kind":12,"name":"Dumper","line":834},{"kind":12,"line":845,"name":"usleep"},{"detail":"()","children":[{"name":"$self","definition":"my","line":857,"containerName":"add_ifconfig_ips_to_allowlist","localvar":"my","kind":13}],"name":"add_ifconfig_ips_to_allowlist","definition":"sub","range":{"start":{"line":856,"character":0},"end":{"line":884,"character":9999}},"containerName":"Net::IPBlocker","line":856,"signature":{"documentation":" Description:  Adds IPs on the local interfaces to the global allowlist\n  This does not work becasue it only handles IPv4 addresses and other issues","label":"add_ifconfig_ips_to_allowlist()","parameters":[]},"kind":12},{"containerName":"Net::IPBlocker","range":{"start":{"line":934,"character":0},"end":{"line":959,"character":9999}},"line":934,"definition":"sub","name":"setup_Logger","signature":{"parameters":[],"label":"setup_Logger()","documentation":" Unnecesary sub.  I am leaving it here for now in case I need it later.\n sub dataQueue_runner() {\n     my ($self) = @_;\n     my $TID = threads->tid;\n     $TID = \"TID: \" . $TID;\n     local $Data::Dumper::Terse  = 1;    # Disable use of $VARn\n     local $Data::Dumper::Indent = 0;    # Disable indentation\n     $logger->info(\"$TID|DataQueue runner\");\n     my $queuechecktime = $self->{configs}->{queuechecktime};\n     my $queuecycles    = $self->{configs}->{queuecycles};\n     while (1) {\n         my $dataqueue_pending = eval { $DataQueue->pending() };\n         unless ( defined $dataqueue_pending ) {\n             $logger->info(\"$TID|DataQueue is in an undefined state. This is probably intentional. Exiting the loop.\");\n             last;\n         }\n         if ( $dataqueue_pending > 0 ) {\n             $logger->info(\"$TID|Queue length of DataQueue is $dataqueue_pending\");\n             my $data = $DataQueue->dequeue();\n             ##### Need to add an 'if ( $data eq \"stop\" )' here to call sub stop() and gracefully exit\n             $logger->debug( \"$TID|Dequeued from DataQueue: \" . Dumper($data) ) if $logger->is_debug();\n         } ## end if ( $dataqueue_pending...)\n         elsif ( $dataqueue_pending == 0 ) {\n             my $logmsg = \"$TID|DataQueue depth: $dataqueue_pending.  Sleeping: $queuechecktime second(s).  \";\n             $logmsg .= \"Queue cycles remaining: $queuecycles\";\n             $logger->info($logmsg);\n             $queuecycles--;\n             last if ( $queuecycles <= 0 );\n             sleep $queuechecktime;\n         } ## end elsif ( $dataqueue_pending...)\n         else {\n             $logger->error(\"$TID|DataQueue is in an unknown state. Leaving queue watch due to an unknown issue.\");\n             last;\n         }\n     } ## end while (1)\n     $logger->info(\"$TID|DataQueue runner exiting\");\n } ## end sub dataQueue_runner\n Assumptions:\n   $self->{configs}->{log4perlconf} is set\n   $self->{configs}->{logwatch_interval} is set\n These assumptions *should* be true because this is called from new()"},"kind":12,"children":[{"definition":"my","name":"$self","containerName":"setup_Logger","line":935,"localvar":"my","kind":13},{"kind":13,"localvar":"my","line":938,"containerName":"setup_Logger","definition":"my","name":"$log4perlconf"},{"kind":13,"name":"$self","containerName":"setup_Logger","line":938},{"containerName":"setup_Logger","line":939,"name":"$logwatch_interval","definition":"my","localvar":"my","kind":13},{"name":"$self","line":939,"containerName":"setup_Logger","kind":13},{"kind":12,"name":"init_and_watch","line":940,"containerName":"setup_Logger"},{"name":"$log4perlconf","line":940,"containerName":"setup_Logger","kind":13},{"name":"$logwatch_interval","containerName":"setup_Logger","line":940,"kind":13},{"kind":12,"containerName":"setup_Logger","line":944,"name":"easy_init"},{"kind":13,"name":"$Log","containerName":"setup_Logger","line":944},{"kind":13,"containerName":"setup_Logger","line":946,"name":"$logger"},{"kind":13,"name":"$self","containerName":"setup_Logger","line":947},{"kind":13,"name":"$logger","line":948,"containerName":"setup_Logger"},{"kind":12,"line":948,"containerName":"setup_Logger","name":"level"},{"name":"$self","line":948,"containerName":"setup_Logger","kind":13},{"name":"$logger","line":949,"containerName":"setup_Logger","kind":13},{"line":949,"containerName":"setup_Logger","name":"info","kind":12},{"name":"$logger","line":949,"containerName":"setup_Logger","kind":13},{"kind":12,"name":"level","containerName":"setup_Logger","line":949},{"containerName":"setup_Logger","line":956,"name":"$logger","kind":13},{"kind":12,"name":"info","line":956,"containerName":"setup_Logger"},{"line":958,"containerName":"setup_Logger","name":"$logger","kind":13}],"detail":"()"},{"name":"configs","line":938,"kind":12},{"name":"log4perlconf","line":938,"kind":12},{"kind":12,"name":"configs","line":939},{"kind":12,"line":939,"name":"logwatch_interval"},{"name":"Log","containerName":"Log4perl","line":940,"kind":12},{"kind":12,"line":942,"name":"carp"},{"kind":12,"line":943,"name":"carp"},{"name":"Log","line":944,"containerName":"Log4perl","kind":12},{"name":"Log4perl","containerName":"DEBUG","line":944,"kind":12},{"line":946,"name":"get_logger","kind":12},{"kind":12,"name":"croak","line":946},{"kind":12,"line":947,"name":"configs"},{"kind":12,"name":"loglevel","line":947},{"line":948,"name":"configs","kind":12},{"kind":12,"name":"loglevel","line":948},{"line":966,"range":{"start":{"character":0,"line":966},"end":{"character":9999,"line":1008}},"containerName":"Net::IPBlocker","name":"set_lockFile","definition":"sub","kind":12,"signature":{"parameters":[],"label":"set_lockFile()","documentation":" Set lock file\n   Returns 1 if lock file is set, otherwise returns 0\n   This is very important to get right.  If the lock file is not set, then multiple instances of this script can\n   cause problems.\n   Some of this is on the user but I'll try my best to make it so duplicate instances of this script can't run."},"children":[{"kind":13,"definition":"my","name":"$self","line":967,"containerName":"set_lockFile","localvar":"my"},{"kind":13,"line":969,"containerName":"set_lockFile","name":"$self"},{"containerName":"set_lockFile","line":970,"name":"$logger","kind":13},{"containerName":"set_lockFile","line":970,"name":"logdie","kind":12},{"containerName":"set_lockFile","line":973,"definition":"my","name":"$lockfile","localvar":"my","kind":13},{"containerName":"set_lockFile","line":973,"name":"$self","kind":13},{"line":976,"containerName":"set_lockFile","definition":"my","name":"$lf","localvar":"my","kind":13},{"containerName":"set_lockFile","line":976,"name":"$self","kind":13},{"kind":13,"containerName":"set_lockFile","line":977,"name":"$logger"},{"containerName":"set_lockFile","line":977,"name":"debug","kind":12},{"name":"$lf","line":979,"containerName":"set_lockFile","kind":13},{"kind":13,"containerName":"set_lockFile","line":980,"name":"$self"},{"name":"$logger","containerName":"set_lockFile","line":981,"kind":13},{"name":"info","line":981,"containerName":"set_lockFile","kind":12},{"name":"$lf","containerName":"set_lockFile","line":982,"kind":13},{"kind":13,"name":"$logger","line":982,"containerName":"set_lockFile"},{"kind":12,"name":"logdie","containerName":"set_lockFile","line":982},{"localvar":"my","containerName":"set_lockFile","line":985,"name":"$fh","definition":"my","kind":13},{"kind":13,"name":"$lf","containerName":"set_lockFile","line":985},{"kind":13,"line":985,"containerName":"set_lockFile","name":"$logger"},{"name":"logdie","line":985,"containerName":"set_lockFile","kind":12},{"containerName":"set_lockFile","line":986,"name":"@contents","definition":"my","localvar":"my","kind":13},{"name":"$fh","line":986,"containerName":"set_lockFile","kind":13},{"containerName":"set_lockFile","line":987,"name":"$fh","kind":13},{"name":"@contents","line":988,"containerName":"set_lockFile","kind":13},{"kind":13,"line":989,"containerName":"set_lockFile","definition":"my","name":"$printable_contents","localvar":"my"},{"name":"@contents","line":989,"containerName":"set_lockFile","kind":13},{"kind":13,"localvar":"my","name":"$logmsg","definition":"my","containerName":"set_lockFile","line":990},{"name":"$logger","containerName":"set_lockFile","line":991,"kind":13},{"kind":12,"containerName":"set_lockFile","line":991,"name":"info"},{"kind":13,"name":"$logmsg","containerName":"set_lockFile","line":991},{"kind":13,"line":995,"containerName":"set_lockFile","name":"$lf"},{"name":"$logger","line":995,"containerName":"set_lockFile","kind":13},{"containerName":"set_lockFile","line":995,"name":"logdie","kind":12},{"kind":13,"name":"$self","line":998,"containerName":"set_lockFile"},{"containerName":"set_lockFile","line":998,"name":"make","kind":12},{"name":"$logger","containerName":"set_lockFile","line":1001,"kind":13},{"kind":12,"name":"debug","line":1001,"containerName":"set_lockFile"},{"name":"$self","line":1001,"containerName":"set_lockFile","kind":13},{"kind":13,"name":"$logger","line":1001,"containerName":"set_lockFile"},{"kind":12,"containerName":"set_lockFile","line":1001,"name":"is_debug"},{"containerName":"set_lockFile","line":1002,"name":"$self","kind":13},{"kind":13,"name":"$self","containerName":"set_lockFile","line":1002},{"line":1002,"containerName":"set_lockFile","name":"lock","kind":12},{"name":"$lf","line":1002,"containerName":"set_lockFile","kind":13},{"name":"$logger","line":1003,"containerName":"set_lockFile","kind":13},{"kind":12,"name":"logdie","line":1003,"containerName":"set_lockFile"},{"name":"$lock_obj","line":1004,"containerName":"set_lockFile","kind":13},{"kind":13,"name":"$self","containerName":"set_lockFile","line":1004},{"kind":13,"line":1006,"containerName":"set_lockFile","name":"$logger"},{"kind":12,"containerName":"set_lockFile","line":1006,"name":"info"}],"detail":"()"},{"line":969,"name":"configs","kind":12},{"line":969,"name":"lockfile","kind":12},{"kind":12,"name":"configs","line":973},{"name":"lockfile","line":973,"kind":12},{"kind":12,"line":976,"name":"configs"},{"kind":12,"line":976,"name":"lockfile"},{"line":980,"name":"configs","kind":12},{"kind":12,"name":"forceremovelockfile","line":980},{"name":"lockmgr","line":998,"kind":12},{"kind":12,"line":998,"containerName":"Simple","name":"LockFile"},{"name":"Dumper","line":1001,"kind":12},{"line":1001,"name":"lockmgr","kind":12},{"kind":12,"name":"lock","line":1002},{"kind":12,"line":1002,"name":"lockmgr"},{"name":"lock","line":1004,"kind":12},{"children":[{"kind":13,"localvar":"my","definition":"my","name":"$self","line":1013,"containerName":"logger_thread"},{"localvar":"my","name":"$logstoreview","definition":"my","line":1015,"containerName":"logger_thread","kind":13},{"kind":13,"name":"$self","containerName":"logger_thread","line":1015},{"name":"$logstoreview","line":1016,"containerName":"logger_thread","kind":13},{"kind":13,"localvar":"my","containerName":"logger_thread","line":1019,"definition":"my","name":"$logtoreview"},{"kind":13,"name":"$logstoreview","containerName":"logger_thread","line":1019}],"detail":"()","containerName":"Net::IPBlocker","range":{"end":{"line":1019,"character":9999},"start":{"line":1012,"character":0}},"line":1012,"name":"logger_thread","definition":"sub","kind":12,"signature":{"parameters":[],"label":"logger_thread()","documentation":"# Description: Creates a thread for each log file to review\n# Returns 1 or dies if thread can not be created"}},{"kind":12,"line":1015,"name":"configs"},{"name":"logs_to_review","line":1015,"kind":12},{"containerName":null,"line":1020,"name":"$logger","kind":13},{"line":1020,"containerName":"Net::IPBlocker","name":"info","kind":12},{"containerName":null,"line":1021,"definition":"my","name":"$logobj","localvar":"my","kind":13},{"name":"%logstoreview","containerName":null,"line":1021,"kind":13},{"kind":13,"name":"$logtoreview","line":1021,"containerName":null},{"containerName":null,"line":1022,"name":"%logobj","kind":13},{"name":"chain","line":1022,"kind":12},{"kind":13,"line":1022,"containerName":null,"name":"$logtoreview"},{"localvar":"my","containerName":null,"line":1024,"definition":"my","name":"$thr","kind":13},{"name":"threads","line":1024,"kind":12},{"kind":12,"containerName":"Net::IPBlocker","line":1024,"name":"create"},{"kind":12,"name":"review_log","line":1024},{"containerName":null,"line":1024,"name":"$self","kind":13},{"kind":13,"name":"$logobj","line":1024,"containerName":null},{"name":"$logger","line":1024,"containerName":null,"kind":13},{"kind":12,"name":"logdie","containerName":"Net::IPBlocker","line":1024},{"kind":13,"name":"$LoggerTIDS","line":1025,"containerName":null},{"kind":13,"containerName":null,"line":1025,"name":"$thr"},{"kind":12,"name":"tid","line":1025,"containerName":"Net::IPBlocker"},{"name":"$logger","line":1026,"containerName":null,"kind":13},{"name":"debug","containerName":"Net::IPBlocker","line":1026,"kind":12},{"kind":13,"name":"$thr","line":1026,"containerName":null},{"containerName":"Net::IPBlocker","line":1026,"name":"tid","kind":12},{"kind":13,"name":"$logger","line":1026,"containerName":null},{"kind":12,"containerName":"Net::IPBlocker","line":1026,"name":"is_debug"},{"line":1027,"containerName":null,"name":"$logger","kind":13},{"name":"debug","containerName":"Net::IPBlocker","line":1027,"kind":12},{"line":1027,"containerName":null,"name":"$thr","kind":13},{"kind":12,"name":"tid","line":1027,"containerName":"Net::IPBlocker"},{"kind":13,"name":"$thr","containerName":null,"line":1027},{"kind":12,"containerName":"Net::IPBlocker","line":1027,"name":"is_running"},{"kind":13,"containerName":null,"line":1027,"name":"$logger"},{"kind":12,"line":1027,"containerName":"Net::IPBlocker","name":"is_debug"},{"name":"prepare_directions","definition":"sub","line":1035,"range":{"end":{"line":1046,"character":9999},"start":{"line":1035,"character":0}},"containerName":"Net::IPBlocker","signature":{"parameters":[],"label":"prepare_directions()","documentation":""},"kind":12,"detail":"()","children":[{"localvar":"my","line":1036,"containerName":"prepare_directions","name":"$self","definition":"my","kind":13},{"containerName":"prepare_directions","line":1036,"name":"$logobj","kind":13},{"kind":13,"localvar":"my","definition":"my","name":"$TID","containerName":"prepare_directions","line":1037},{"line":1037,"containerName":"prepare_directions","name":"tid","kind":12},{"kind":13,"name":"$TID","containerName":"prepare_directions","line":1038},{"line":1038,"containerName":"prepare_directions","name":"$TID","kind":13},{"name":"@directions","definition":"my","containerName":"prepare_directions","line":1040,"localvar":"my","kind":13},{"containerName":"prepare_directions","line":1040,"name":"$logobj","kind":13},{"kind":13,"name":"$logobj","containerName":"prepare_directions","line":1040},{"kind":13,"containerName":"prepare_directions","line":1041,"name":"@directions"},{"kind":13,"line":1041,"containerName":"prepare_directions","name":"@directions"},{"line":1042,"containerName":"prepare_directions","name":"@directions","kind":13},{"line":1042,"containerName":"prepare_directions","name":"@directions","kind":13},{"line":1043,"containerName":"prepare_directions","name":"@directions","kind":13},{"kind":13,"line":1043,"containerName":"prepare_directions","name":"@directions"},{"kind":13,"name":"@directions","containerName":"prepare_directions","line":1044},{"containerName":"prepare_directions","line":1044,"name":"@directions","kind":13},{"kind":13,"name":"@directions","containerName":"prepare_directions","line":1045}]},{"name":"threads","line":1037,"kind":12},{"line":1040,"name":"directions","kind":12},{"name":"directions","line":1040,"kind":12},{"kind":12,"name":"any","line":1043},{"range":{"end":{"line":1169,"character":9999},"start":{"character":0,"line":1054}},"containerName":"Net::IPBlocker","line":1054,"definition":"sub","name":"review_log","kind":12,"signature":{"label":"review_log()","parameters":[],"documentation":" This is called as a thread and runs a loop to check the log file for new entries\n   Prior to checking the log file, it creates a chain for the log file and adds it to the global chain\n This entire sub needs to be refactored.\n It's easy to folllw but it is:\n  a) just too many lines for one sub\n  b) the for loops nesting is just too much"},"children":[{"kind":13,"name":"$self","definition":"my","line":1055,"containerName":"review_log","localvar":"my"},{"line":1055,"containerName":"review_log","name":"$logobj","kind":13},{"kind":13,"containerName":"review_log","line":1056,"definition":"my","name":"$TID","localvar":"my"},{"name":"tid","line":1056,"containerName":"review_log","kind":12},{"kind":13,"containerName":"review_log","line":1057,"name":"$TID"},{"kind":13,"name":"$TID","containerName":"review_log","line":1057},{"containerName":"review_log","line":1058,"definition":"my","name":"$start_time","localvar":"my","kind":13},{"kind":13,"name":"$logobj","line":1060,"containerName":"review_log"},{"definition":"my","name":"$chain","line":1061,"containerName":"review_log","localvar":"my","kind":13},{"kind":13,"containerName":"review_log","line":1061,"name":"$self"},{"name":"$logobj","containerName":"review_log","line":1061,"kind":13},{"name":"$logger","line":1062,"containerName":"review_log","kind":13},{"kind":12,"name":"info","line":1062,"containerName":"review_log"},{"kind":13,"line":1063,"containerName":"review_log","name":"$logger"},{"kind":12,"name":"debug","line":1063,"containerName":"review_log"},{"name":"$logobj","line":1063,"containerName":"review_log","kind":13},{"line":1063,"containerName":"review_log","name":"$logger","kind":13},{"containerName":"review_log","line":1063,"name":"is_debug","kind":12},{"kind":13,"localvar":"my","name":"$cycles","definition":"my","line":1066,"containerName":"review_log"},{"kind":13,"name":"$logobj","containerName":"review_log","line":1066},{"kind":13,"definition":"my","name":"$cyclesleep","containerName":"review_log","line":1067,"localvar":"my"},{"name":"$logobj","containerName":"review_log","line":1067,"kind":13},{"kind":13,"localvar":"my","containerName":"review_log","line":1068,"definition":"my","name":"$microcyclesleep"},{"kind":13,"name":"$cyclesleep","containerName":"review_log","line":1068},{"kind":13,"name":"$logger","line":1070,"containerName":"review_log"},{"name":"info","line":1070,"containerName":"review_log","kind":12},{"name":"$logger","containerName":"review_log","line":1075,"kind":13},{"name":"info","line":1075,"containerName":"review_log","kind":12},{"containerName":"review_log","line":1076,"name":"$self","kind":13},{"containerName":"review_log","line":1076,"name":"add_chain","kind":12},{"kind":13,"line":1076,"containerName":"review_log","name":"$chain"},{"definition":"my","name":"$globalchain","line":1079,"containerName":"review_log","localvar":"my","kind":13},{"line":1079,"containerName":"review_log","name":"$self","kind":13},{"name":"$logger","containerName":"review_log","line":1080,"kind":13},{"line":1080,"containerName":"review_log","name":"debug","kind":12},{"name":"$self","containerName":"review_log","line":1081,"kind":13},{"kind":12,"name":"iptablesqueue_enqueue","line":1081,"containerName":"review_log"},{"kind":13,"name":"$self","line":1083,"containerName":"review_log"},{"line":1083,"containerName":"review_log","name":"add_logger_allow_deny_ips","kind":12},{"kind":13,"line":1083,"containerName":"review_log","name":"$logobj"},{"kind":13,"containerName":"review_log","line":1086,"definition":"my","name":"@directions","localvar":"my"},{"containerName":"review_log","line":1086,"name":"$self","kind":13},{"kind":12,"name":"prepare_directions","containerName":"review_log","line":1086},{"kind":13,"name":"$logobj","containerName":"review_log","line":1086},{"name":"@protocols","definition":"my","containerName":"review_log","line":1087,"localvar":"my","kind":13},{"name":"$logobj","line":1087,"containerName":"review_log","kind":13},{"kind":13,"line":1087,"containerName":"review_log","name":"$logobj"},{"kind":13,"localvar":"my","definition":"my","name":"$ports","containerName":"review_log","line":1088},{"kind":13,"name":"$logobj","containerName":"review_log","line":1088},{"kind":13,"name":"$cycles","line":1090,"containerName":"review_log"},{"kind":13,"localvar":"my","containerName":"review_log","line":1091,"definition":"my","name":"$start_loop_time"},{"kind":13,"name":"$logger","line":1092,"containerName":"review_log"},{"kind":12,"line":1092,"containerName":"review_log","name":"info"},{"kind":13,"line":1093,"containerName":"review_log","name":"$logobj"},{"containerName":"review_log","line":1093,"name":"$self","kind":13},{"kind":12,"containerName":"review_log","line":1093,"name":"readlogfile"},{"kind":13,"name":"$logobj","containerName":"review_log","line":1093},{"kind":13,"name":"$logobj","line":1094,"containerName":"review_log"},{"kind":13,"name":"$self","line":1094,"containerName":"review_log"},{"line":1094,"containerName":"review_log","name":"_grep_regexps","kind":12},{"name":"$logobj","line":1094,"containerName":"review_log","kind":13},{"kind":13,"name":"$logobj","line":1094,"containerName":"review_log"},{"containerName":"review_log","line":1098,"name":"$logger","kind":13},{"line":1098,"containerName":"review_log","name":"debug","kind":12},{"name":"$logobj","line":1098,"containerName":"review_log","kind":13},{"kind":13,"line":1099,"containerName":"review_log","name":"$logger"},{"name":"is_debug","line":1099,"containerName":"review_log","kind":12},{"name":"@rules","definition":"my","containerName":"review_log","line":1101,"localvar":"my","kind":13},{"kind":13,"localvar":"my","name":"$ip","definition":"my","containerName":"review_log","line":1102},{"containerName":"review_log","line":1102,"name":"$logobj","kind":13},{"kind":13,"line":1103,"containerName":"review_log","name":"$logger"},{"line":1103,"containerName":"review_log","name":"debug","kind":12},{"kind":13,"definition":"my","name":"$direction","containerName":"review_log","line":1105,"localvar":"my"},{"name":"@directions","containerName":"review_log","line":1105,"kind":13},{"kind":13,"localvar":"my","definition":"my","name":"$direction_switch","line":1106,"containerName":"review_log"},{"kind":13,"containerName":"review_log","line":1106,"name":"$direction"},{"kind":13,"line":1107,"containerName":"review_log","definition":"my","name":"$randval","localvar":"my"},{"line":1108,"containerName":"review_log","name":"$direction_switch","kind":13},{"name":"$direction","line":1108,"containerName":"review_log","kind":13},{"containerName":"review_log","line":1109,"name":"$logger","kind":13},{"kind":12,"containerName":"review_log","line":1109,"name":"info"},{"containerName":"review_log","line":1110,"name":"$base_rule","definition":"my","localvar":"my","kind":13},{"containerName":"review_log","line":1111,"name":"$logger","kind":13},{"kind":12,"line":1111,"containerName":"review_log","name":"debug"},{"containerName":"review_log","line":1113,"name":"@protocols","kind":13},{"line":1114,"containerName":"review_log","name":"$protocol","definition":"my","localvar":"my","kind":13},{"containerName":"review_log","line":1114,"name":"@protocols","kind":13},{"localvar":"my","name":"$rule","definition":"my","line":1115,"containerName":"review_log","kind":13},{"kind":13,"name":"$base_rule","containerName":"review_log","line":1115},{"name":"$logger","line":1116,"containerName":"review_log","kind":13},{"line":1116,"containerName":"review_log","name":"debug","kind":12},{"name":"$logobj","line":1117,"containerName":"review_log","kind":13},{"containerName":"review_log","line":1121,"name":"$rule","kind":13},{"kind":13,"name":"$logger","containerName":"review_log","line":1123},{"kind":12,"containerName":"review_log","line":1123,"name":"debug"},{"line":1124,"containerName":"review_log","name":"@rules","kind":13},{"kind":13,"name":"$logger","containerName":"review_log","line":1128},{"name":"debug","line":1128,"containerName":"review_log","kind":12},{"kind":13,"containerName":"review_log","line":1129,"name":"@rules"},{"name":"$logger","containerName":"review_log","line":1134,"kind":13},{"name":"debug","containerName":"review_log","line":1134,"kind":12},{"kind":13,"line":1134,"containerName":"review_log","name":"@rules"},{"line":1135,"containerName":"review_log","name":"$logger","kind":13},{"kind":12,"name":"is_debug","line":1135,"containerName":"review_log"},{"localvar":"my","name":"$eject","definition":"my","containerName":"review_log","line":1136,"kind":13},{"kind":13,"containerName":"review_log","line":1137,"definition":"my","name":"$rule","localvar":"my"},{"kind":13,"line":1137,"containerName":"review_log","name":"@rules"},{"name":"$tracker","line":1138,"containerName":"review_log","kind":13},{"name":"$logger","line":1139,"containerName":"review_log","kind":13},{"containerName":"review_log","line":1139,"name":"debug","kind":12},{"kind":13,"containerName":"review_log","line":1142,"name":"$args","definition":"my","localvar":"my"},{"name":"$logger","containerName":"review_log","line":1146,"kind":13},{"line":1146,"containerName":"review_log","name":"debug","kind":12},{"kind":13,"name":"$tracker","containerName":"review_log","line":1147},{"kind":13,"line":1150,"containerName":"review_log","name":"$self"},{"containerName":"review_log","line":1150,"name":"iptablesqueue_enqueue","kind":12},{"kind":13,"name":"$args","containerName":"review_log","line":1150},{"line":1150,"containerName":"review_log","name":"$eject","kind":13},{"kind":13,"definition":"my","name":"$logmsg","line":1153,"containerName":"review_log","localvar":"my"},{"name":"$eject","containerName":"review_log","line":1154,"kind":13},{"kind":13,"name":"$logger","containerName":"review_log","line":1154},{"containerName":"review_log","line":1154,"name":"info","kind":12},{"kind":13,"name":"$logmsg","containerName":"review_log","line":1154},{"kind":13,"name":"$logobj","line":1156,"containerName":"review_log"},{"kind":13,"name":"$self","line":1160,"containerName":"review_log"},{"line":1160,"containerName":"review_log","name":"iptablesqueue_enqueue","kind":12},{"line":1162,"containerName":"review_log","definition":"my","name":"$timediff","localvar":"my","kind":13},{"name":"$start_loop_time","containerName":"review_log","line":1162,"kind":13},{"kind":13,"line":1163,"containerName":"review_log","name":"$timediff"},{"kind":13,"name":"$timediff","line":1163,"containerName":"review_log"},{"containerName":"review_log","line":1164,"name":"$logger","kind":13},{"kind":12,"name":"info","containerName":"review_log","line":1164},{"kind":13,"name":"$cycles","line":1166,"containerName":"review_log"},{"kind":13,"containerName":"review_log","line":1167,"name":"$logger"},{"name":"info","line":1167,"containerName":"review_log","kind":12},{"kind":13,"containerName":"review_log","line":1168,"name":"$microcyclesleep"}],"detail":"()"},{"kind":12,"name":"threads","line":1056},{"kind":12,"name":"configs","line":1061},{"line":1061,"name":"chainprefix","kind":12},{"line":1061,"name":"chain","kind":12},{"line":1063,"name":"Dumper","kind":12},{"kind":12,"line":1066,"name":"cycles"},{"line":1066,"name":"LONG_MAX","kind":12},{"name":"cyclesleep","line":1067,"kind":12},{"kind":12,"line":1079,"name":"configs"},{"name":"globalchain","line":1079,"kind":12},{"name":"options","line":1081,"kind":12},{"kind":12,"line":1081,"name":"rule"},{"kind":12,"line":1087,"name":"protocols"},{"name":"protocols","line":1087,"kind":12},{"kind":12,"line":1088,"name":"ports"},{"line":1094,"name":"ips_to_block","kind":12},{"name":"logcontents","line":1094,"kind":12},{"line":1098,"name":"Dumper","kind":12},{"name":"ips_to_block","line":1098,"kind":12},{"kind":12,"name":"ips_to_block","line":1102},{"kind":12,"line":1117,"name":"ports"},{"kind":12,"name":"Dumper","line":1134},{"kind":12,"name":"iptables_rules","line":1138},{"line":1143,"name":"options","kind":12},{"kind":12,"name":"rule","line":1144},{"line":1147,"name":"iptables_rules","kind":12},{"name":"ips_to_block","line":1156,"kind":12},{"kind":12,"name":"check_pending","line":1160},{"name":"usleep","line":1168,"kind":12},{"kind":13,"name":"$runtime","definition":"my","containerName":null,"line":1171,"localvar":"my"},{"line":1171,"containerName":null,"name":"$start_time","kind":13},{"line":1172,"containerName":null,"name":"$runtime","kind":13},{"kind":13,"name":"$runtime","containerName":null,"line":1172},{"kind":13,"localvar":"my","line":1173,"containerName":null,"definition":"my","name":"$cycles_completed"},{"containerName":null,"line":1173,"name":"%logobj","kind":13},{"line":1173,"name":"cycles","kind":12},{"kind":13,"containerName":null,"line":1173,"name":"$cycles"},{"localvar":"my","definition":"my","name":"$logmsg","line":1174,"containerName":null,"kind":13},{"line":1175,"containerName":null,"name":"$logmsg","kind":13},{"containerName":null,"line":1176,"name":"$logger","kind":13},{"containerName":"Net::IPBlocker","line":1176,"name":"info","kind":12},{"kind":13,"name":"$logmsg","containerName":null,"line":1176},{"kind":12,"line":1181,"range":{"end":{"line":1205,"character":9999},"start":{"character":0,"line":1181}},"containerName":"Net::IPBlocker","definition":"sub","name":"load_configs","children":[{"definition":"my","name":"$self","containerName":"load_configs","line":1182,"localvar":"my","kind":13},{"localvar":"my","name":"$configsfile","definition":"my","containerName":"load_configs","line":1183,"kind":13},{"containerName":"load_configs","line":1183,"name":"$self","kind":13},{"localvar":"my","line":1184,"containerName":"load_configs","definition":"my","name":"$clargs","kind":13},{"containerName":"load_configs","line":1184,"name":"$self","kind":13},{"name":"$configsfile","containerName":"load_configs","line":1186,"kind":13},{"kind":13,"name":"$self","line":1189,"containerName":"load_configs"},{"kind":13,"name":"$self","line":1189,"containerName":"load_configs"},{"kind":13,"name":"$self","containerName":"load_configs","line":1190},{"name":"$self","containerName":"load_configs","line":1190,"kind":13},{"kind":13,"containerName":"load_configs","line":1191,"name":"$self"},{"line":1196,"containerName":"load_configs","name":"$msg","definition":"my","localvar":"my","kind":13},{"line":1197,"containerName":"load_configs","name":"$msg","kind":13},{"kind":13,"name":"$msg","containerName":"load_configs","line":1198},{"name":"$clargs","containerName":"load_configs","line":1198,"kind":13},{"line":1199,"containerName":"load_configs","name":"$msg","kind":13},{"containerName":"load_configs","line":1199,"name":"$DEFAULTS","kind":13},{"kind":13,"name":"$msg","line":1200,"containerName":"load_configs"},{"kind":13,"containerName":"load_configs","line":1201,"name":"$msg"},{"name":"$msg","containerName":"load_configs","line":1202,"kind":13},{"localvar":"my","line":1205,"containerName":"load_configs","name":"$config","definition":"my","kind":13},{"name":"$DEFAULTS","line":1205,"containerName":"load_configs","kind":13}]},{"kind":12,"name":"configsfile","line":1183},{"kind":12,"line":1184,"name":"clargs"},{"name":"configs","line":1189,"kind":12},{"kind":12,"name":"Config","line":1189,"containerName":"File::read_config_file"},{"line":1189,"name":"configsfile","kind":12},{"line":1190,"name":"configs","kind":12},{"line":1190,"name":"globalchain","kind":12},{"line":1190,"name":"configs","kind":12},{"kind":12,"line":1190,"name":"globalchain"},{"kind":12,"line":1191,"name":"configs"},{"kind":12,"name":"globalchain","line":1191},{"line":1198,"name":"Dumper","kind":12},{"kind":12,"line":1199,"name":"Dumper"},{"line":1201,"name":"carp","kind":12},{"containerName":null,"line":1209,"name":"%self","kind":13},{"name":"configs","line":1209,"kind":12},{"name":"$config","containerName":null,"line":1209,"kind":13},{"name":"%clargs","line":1210,"containerName":null,"kind":13},{"kind":13,"containerName":null,"line":1210,"name":"$config"},{"kind":13,"name":"%clargs","line":1211,"containerName":null},{"kind":13,"containerName":null,"line":1211,"name":"$config"},{"line":1212,"containerName":null,"name":"%self","kind":13},{"kind":12,"name":"configs","line":1212},{"name":"$config","line":1212,"containerName":null,"kind":13},{"kind":13,"line":1212,"containerName":null,"name":"%DEFAULTS"},{"name":"$config","line":1212,"containerName":null,"kind":13},{"kind":13,"name":"%self","line":1215,"containerName":null},{"kind":12,"line":1215,"name":"configs"},{"detail":"()","children":[{"kind":13,"localvar":"my","definition":"my","name":"$self","line":1220,"containerName":"reverseMapHash"},{"kind":13,"localvar":"my","containerName":"reverseMapHash","line":1221,"name":"$hash","definition":"my"},{"kind":13,"name":"$new_hash","definition":"my","line":1225,"containerName":"reverseMapHash","localvar":"my"},{"containerName":"reverseMapHash","line":1226,"definition":"my","name":"$key","localvar":"my","kind":13},{"name":"$hash","line":1226,"containerName":"reverseMapHash","kind":13}],"definition":"sub","name":"reverseMapHash","range":{"end":{"character":9999,"line":1226},"start":{"character":0,"line":1219}},"line":1219,"containerName":"Net::IPBlocker","signature":{"label":"reverseMapHash()","parameters":[],"documentation":" Special helper function for clean_ips_to_block()"},"kind":12},{"kind":13,"containerName":null,"line":1227,"name":"%new_hash"},{"containerName":null,"line":1227,"name":"%hash","kind":13},{"line":1227,"containerName":null,"name":"$key","kind":13},{"kind":13,"containerName":null,"line":1231,"name":"$new_hash"},{"detail":"()","children":[{"kind":13,"localvar":"my","containerName":"clean_ips_to_block_combined","line":1237,"definition":"my","name":"$self"},{"localvar":"my","definition":"my","name":"$logobj","containerName":"clean_ips_to_block_combined","line":1238,"kind":13},{"line":1239,"containerName":"clean_ips_to_block_combined","definition":"my","name":"$TID","localvar":"my","kind":13},{"containerName":"clean_ips_to_block_combined","line":1239,"name":"tid","kind":12},{"containerName":"clean_ips_to_block_combined","line":1240,"name":"$TID","kind":13},{"name":"$TID","containerName":"clean_ips_to_block_combined","line":1240,"kind":13},{"name":"$Data","line":1242,"containerName":"clean_ips_to_block_combined","kind":13},{"containerName":"clean_ips_to_block_combined","line":1243,"name":"$Data","kind":13}],"name":"clean_ips_to_block_combined","definition":"sub","line":1236,"range":{"start":{"line":1236,"character":0},"end":{"line":1245,"character":9999}},"containerName":"Net::IPBlocker","signature":{"documentation":" Description: Combines the IPs from regex from the log to be blocked and the IPs from the allow/deny lists into\n               one hash","label":"clean_ips_to_block_combined()","parameters":[]},"kind":12},{"kind":12,"name":"threads","line":1239},{"name":"Dumper","line":1242,"containerName":"Terse","kind":12},{"containerName":"Indent","line":1243,"name":"Dumper","kind":12},{"children":[{"kind":13,"localvar":"my","definition":"my","name":"$self","containerName":"clean_ips_to_block_allowdeny","line":1251},{"definition":"my","name":"$logobj","containerName":"clean_ips_to_block_allowdeny","line":1252,"localvar":"my","kind":13},{"localvar":"my","name":"$TID","definition":"my","line":1253,"containerName":"clean_ips_to_block_allowdeny","kind":13},{"kind":12,"line":1253,"containerName":"clean_ips_to_block_allowdeny","name":"tid"},{"name":"$TID","containerName":"clean_ips_to_block_allowdeny","line":1254,"kind":13},{"kind":13,"name":"$TID","containerName":"clean_ips_to_block_allowdeny","line":1254},{"kind":13,"name":"$Data","line":1256,"containerName":"clean_ips_to_block_allowdeny"},{"name":"$Data","line":1257,"containerName":"clean_ips_to_block_allowdeny","kind":13},{"kind":13,"containerName":"clean_ips_to_block_allowdeny","line":1261,"name":"$allowdeny","definition":"my","localvar":"my"},{"kind":13,"containerName":"clean_ips_to_block_allowdeny","line":1261,"name":"$logobj"},{"kind":13,"name":"$self","containerName":"clean_ips_to_block_allowdeny","line":1261},{"localvar":"my","definition":"my","name":"$logobj_allowlist","containerName":"clean_ips_to_block_allowdeny","line":1262,"kind":13},{"line":1262,"containerName":"clean_ips_to_block_allowdeny","name":"$logobj","kind":13},{"kind":13,"containerName":"clean_ips_to_block_allowdeny","line":1262,"name":"$self"},{"localvar":"my","name":"$logobj_denylist","definition":"my","line":1263,"containerName":"clean_ips_to_block_allowdeny","kind":13},{"line":1263,"containerName":"clean_ips_to_block_allowdeny","name":"$logobj","kind":13},{"name":"$self","containerName":"clean_ips_to_block_allowdeny","line":1263,"kind":13},{"definition":"my","name":"$global_denylist","line":1264,"containerName":"clean_ips_to_block_allowdeny","localvar":"my","kind":13},{"kind":13,"line":1264,"containerName":"clean_ips_to_block_allowdeny","name":"$self"},{"kind":13,"localvar":"my","containerName":"clean_ips_to_block_allowdeny","line":1265,"name":"$global_allowlist","definition":"my"},{"name":"$self","line":1265,"containerName":"clean_ips_to_block_allowdeny","kind":13},{"kind":13,"containerName":"clean_ips_to_block_allowdeny","line":1267,"definition":"my","name":"$ips_to_block","localvar":"my"},{"kind":13,"name":"$logobj","line":1267,"containerName":"clean_ips_to_block_allowdeny"},{"name":"$logobj_allowlist","line":1270,"containerName":"clean_ips_to_block_allowdeny","kind":13},{"kind":13,"name":"$self","containerName":"clean_ips_to_block_allowdeny","line":1270},{"kind":12,"line":1270,"containerName":"clean_ips_to_block_allowdeny","name":"reverseMapHash"},{"name":"$logobj_allowlist","line":1270,"containerName":"clean_ips_to_block_allowdeny","kind":13},{"name":"$logobj_denylist","containerName":"clean_ips_to_block_allowdeny","line":1271,"kind":13},{"kind":13,"name":"$self","containerName":"clean_ips_to_block_allowdeny","line":1271},{"kind":12,"name":"reverseMapHash","line":1271,"containerName":"clean_ips_to_block_allowdeny"},{"kind":13,"containerName":"clean_ips_to_block_allowdeny","line":1271,"name":"$logobj_denylist"},{"name":"$global_allowlist","line":1272,"containerName":"clean_ips_to_block_allowdeny","kind":13},{"name":"$self","containerName":"clean_ips_to_block_allowdeny","line":1272,"kind":13},{"line":1272,"containerName":"clean_ips_to_block_allowdeny","name":"reverseMapHash","kind":12},{"name":"$global_allowlist","line":1272,"containerName":"clean_ips_to_block_allowdeny","kind":13},{"containerName":"clean_ips_to_block_allowdeny","line":1273,"name":"$global_denylist","kind":13},{"line":1273,"containerName":"clean_ips_to_block_allowdeny","name":"$self","kind":13},{"kind":12,"name":"reverseMapHash","containerName":"clean_ips_to_block_allowdeny","line":1273},{"kind":13,"name":"$global_denylist","line":1273,"containerName":"clean_ips_to_block_allowdeny"},{"name":"$logger","containerName":"clean_ips_to_block_allowdeny","line":1276,"kind":13},{"name":"info","containerName":"clean_ips_to_block_allowdeny","line":1276,"kind":12},{"kind":13,"name":"$logger","line":1277,"containerName":"clean_ips_to_block_allowdeny"},{"name":"debug","containerName":"clean_ips_to_block_allowdeny","line":1277,"kind":12},{"kind":13,"line":1277,"containerName":"clean_ips_to_block_allowdeny","name":"$logobj_allowlist"},{"kind":13,"name":"$logger","line":1277,"containerName":"clean_ips_to_block_allowdeny"},{"kind":12,"containerName":"clean_ips_to_block_allowdeny","line":1277,"name":"is_debug"},{"kind":13,"line":1278,"containerName":"clean_ips_to_block_allowdeny","name":"$logger"},{"line":1278,"containerName":"clean_ips_to_block_allowdeny","name":"debug","kind":12},{"kind":13,"name":"$logobj_denylist","containerName":"clean_ips_to_block_allowdeny","line":1278},{"kind":13,"line":1278,"containerName":"clean_ips_to_block_allowdeny","name":"$logger"},{"name":"is_debug","line":1278,"containerName":"clean_ips_to_block_allowdeny","kind":12},{"name":"$logger","line":1279,"containerName":"clean_ips_to_block_allowdeny","kind":13},{"kind":12,"containerName":"clean_ips_to_block_allowdeny","line":1279,"name":"debug"},{"name":"$ips_to_block","containerName":"clean_ips_to_block_allowdeny","line":1279,"kind":13},{"name":"$logger","containerName":"clean_ips_to_block_allowdeny","line":1279,"kind":13},{"name":"is_debug","containerName":"clean_ips_to_block_allowdeny","line":1279,"kind":12},{"line":1280,"containerName":"clean_ips_to_block_allowdeny","name":"$logger","kind":13},{"kind":12,"name":"debug","containerName":"clean_ips_to_block_allowdeny","line":1280},{"containerName":"clean_ips_to_block_allowdeny","line":1280,"name":"$global_allowlist","kind":13},{"kind":13,"name":"$logger","containerName":"clean_ips_to_block_allowdeny","line":1280},{"line":1280,"containerName":"clean_ips_to_block_allowdeny","name":"is_debug","kind":12},{"line":1281,"containerName":"clean_ips_to_block_allowdeny","name":"$logger","kind":13},{"line":1281,"containerName":"clean_ips_to_block_allowdeny","name":"debug","kind":12},{"name":"$global_denylist","containerName":"clean_ips_to_block_allowdeny","line":1281,"kind":13},{"kind":13,"name":"$logger","containerName":"clean_ips_to_block_allowdeny","line":1281},{"kind":12,"name":"is_debug","line":1281,"containerName":"clean_ips_to_block_allowdeny"},{"kind":13,"localvar":"my","definition":"my","name":"$allowlist","line":1284,"containerName":"clean_ips_to_block_allowdeny"},{"name":"$global_allowlist","containerName":"clean_ips_to_block_allowdeny","line":1284,"kind":13},{"kind":13,"line":1284,"containerName":"clean_ips_to_block_allowdeny","name":"$logobj_allowlist"}],"detail":"()","containerName":"Net::IPBlocker","range":{"start":{"line":1250,"character":0},"end":{"line":1284,"character":9999}},"line":1250,"definition":"sub","name":"clean_ips_to_block_allowdeny","signature":{"label":"clean_ips_to_block_allowdeny()","parameters":[],"documentation":" Description: Returns the logobj with ips_to_block set with the IPs to block from the allow/deny lists\n   There is a lot of logging available in this sub.\n   This sub is called from review_log()"},"kind":12},{"name":"threads","line":1253,"kind":12},{"kind":12,"name":"Dumper","containerName":"Terse","line":1256},{"kind":12,"name":"Dumper","line":1257,"containerName":"Indent"},{"name":"allowdeny","line":1261,"kind":12},{"kind":12,"line":1261,"name":"configs"},{"kind":12,"name":"allowdeny","line":1261},{"line":1262,"name":"allowlist","kind":12},{"kind":12,"line":1262,"name":"configs"},{"kind":12,"name":"allowlist","line":1262},{"line":1263,"name":"denylist","kind":12},{"line":1263,"name":"configs","kind":12},{"name":"denylist","line":1263,"kind":12},{"kind":12,"name":"configs","line":1264},{"kind":12,"line":1264,"name":"denylist"},{"name":"configs","line":1265,"kind":12},{"kind":12,"line":1265,"name":"allowlist"},{"kind":12,"line":1267,"name":"ips_to_block"},{"kind":12,"line":1277,"name":"Dumper"},{"kind":12,"line":1278,"name":"Dumper"},{"kind":12,"name":"Dumper","line":1279},{"kind":12,"name":"Dumper","line":1280},{"line":1281,"name":"Dumper","kind":12},{"localvar":"my","definition":"my","name":"%denylist","line":1285,"containerName":null,"kind":13},{"name":"$global_denylist","line":1285,"containerName":null,"kind":13},{"kind":13,"containerName":null,"line":1285,"name":"$logobj_denylist"},{"name":"$logger","line":1288,"containerName":null,"kind":13},{"containerName":"Net::IPBlocker","line":1288,"name":"debug","kind":12},{"kind":12,"line":1288,"name":"Dumper"},{"name":"$allowlist","containerName":null,"line":1288,"kind":13},{"name":"$logger","containerName":null,"line":1288,"kind":13},{"kind":12,"name":"is_debug","containerName":"Net::IPBlocker","line":1288},{"kind":13,"containerName":null,"line":1289,"name":"$logger"},{"kind":12,"line":1289,"containerName":"Net::IPBlocker","name":"debug"},{"name":"Dumper","line":1289,"kind":12},{"name":"$denylist","line":1289,"containerName":null,"kind":13},{"line":1289,"containerName":null,"name":"$logger","kind":13},{"line":1289,"containerName":"Net::IPBlocker","name":"is_debug","kind":12},{"kind":13,"line":1292,"containerName":null,"name":"%denylist"},{"name":"$denylist","line":1292,"containerName":null,"kind":13},{"containerName":null,"line":1292,"name":"$ips_to_block","kind":13},{"line":1295,"containerName":null,"name":"$logger","kind":13},{"kind":12,"line":1295,"containerName":"Net::IPBlocker","name":"debug"},{"line":1295,"name":"Dumper","kind":12},{"containerName":null,"line":1295,"name":"$denylist","kind":13},{"kind":13,"name":"$logger","containerName":null,"line":1295},{"name":"is_debug","line":1295,"containerName":"Net::IPBlocker","kind":12},{"kind":13,"containerName":null,"line":1299,"name":"%allowdeny"},{"kind":13,"name":"%logobj","line":1300,"containerName":null},{"kind":12,"line":1300,"name":"ips_to_block"},{"kind":13,"containerName":null,"line":1300,"name":"$denylist"},{"name":"$logger","line":1301,"containerName":null,"kind":13},{"containerName":"Net::IPBlocker","line":1301,"name":"debug","kind":12},{"kind":12,"name":"Dumper","line":1301},{"kind":13,"line":1301,"containerName":null,"name":"%logobj"},{"kind":12,"name":"ips_to_block","line":1301},{"kind":13,"line":1302,"containerName":null,"name":"$logger"},{"kind":12,"name":"is_debug","line":1302,"containerName":"Net::IPBlocker"},{"name":"%logobj","line":1303,"containerName":null,"kind":13},{"line":1308,"containerName":null,"name":"%denylist","kind":13},{"containerName":null,"line":1308,"name":"$allowlist","kind":13},{"name":"%logobj","line":1309,"containerName":null,"kind":13},{"kind":12,"name":"ips_to_block","line":1309},{"containerName":null,"line":1309,"name":"$denylist","kind":13},{"containerName":null,"line":1310,"name":"$logger","kind":13},{"containerName":"Net::IPBlocker","line":1310,"name":"debug","kind":12},{"kind":12,"line":1310,"name":"Dumper"},{"containerName":null,"line":1310,"name":"%logobj","kind":13},{"kind":12,"line":1310,"name":"ips_to_block"},{"line":1311,"containerName":null,"name":"$logger","kind":13},{"kind":12,"line":1311,"containerName":"Net::IPBlocker","name":"is_debug"},{"name":"$logobj","containerName":null,"line":1312,"kind":13},{"signature":{"label":"run_iptables()","parameters":[],"documentation":" Runs whatever parameters are passed to it against iptables\n  This is intended to be a one stop shop for running iptables out from a queue.\n  However, there are a few instances where it is called directly... especially when creating chains\n   This hopefully prevents excessive wait/locking on iptables\n   and helps to keep commands running in the order they are received.\n Arguments must be passed as a hash reference with (so far) the following keys:\n   rule:  The rule to run\n   options:  Any options to pass to iptables\n  Where it is ran like this:\n   iptables $options $rule 2>&1\n Future enhancement:\n   1. delete existing rule if it exists\n Take note this sub is intended (but not required) to be called from sub iptables_thread()\n  An error will happen if not called from sub iptables_thread(), but it will not stop the program\n  This is to encourage using the iptablesqueue_enqueue() sub instead of run_iptables() directly\n  So, to say this more clearly, if you want to run iptables commands, then call iptablesqueue_enqueue()"},"kind":12,"containerName":"Net::IPBlocker","range":{"start":{"line":1331,"character":0},"end":{"character":9999,"line":1430}},"line":1331,"definition":"sub","name":"run_iptables","children":[{"name":"$self","definition":"my","line":1332,"containerName":"run_iptables","localvar":"my","kind":13},{"containerName":"run_iptables","line":1332,"name":"$args","kind":13},{"kind":13,"line":1333,"containerName":"run_iptables","definition":"my","name":"@caller_lst","localvar":"my"},{"line":1334,"containerName":"run_iptables","name":"$caller_lst","kind":13},{"line":1334,"containerName":"run_iptables","name":"$IPTABLESRUNLINE","kind":13},{"kind":13,"name":"$IPTABLESRUNLINE","line":1334,"containerName":"run_iptables"},{"localvar":"my","name":"$logmsg","definition":"my","containerName":"run_iptables","line":1335,"kind":13},{"containerName":"run_iptables","line":1338,"name":"@caller_lst","kind":13},{"kind":13,"name":"$logger","line":1343,"containerName":"run_iptables"},{"kind":12,"containerName":"run_iptables","line":1343,"name":"error"},{"kind":13,"containerName":"run_iptables","line":1343,"name":"$logmsg"},{"kind":13,"name":"$TID","definition":"my","containerName":"run_iptables","line":1345,"localvar":"my"},{"kind":12,"containerName":"run_iptables","line":1345,"name":"tid"},{"name":"$TID","line":1346,"containerName":"run_iptables","kind":13},{"kind":13,"name":"$TID","containerName":"run_iptables","line":1346},{"containerName":"run_iptables","line":1349,"name":"$args","kind":13},{"name":"$logger","containerName":"run_iptables","line":1349,"kind":13},{"containerName":"run_iptables","line":1349,"name":"error","kind":12},{"kind":13,"containerName":"run_iptables","line":1350,"name":"$self"},{"kind":13,"name":"$logger","line":1350,"containerName":"run_iptables"},{"line":1350,"containerName":"run_iptables","name":"error","kind":12},{"kind":13,"line":1352,"containerName":"run_iptables","definition":"my","name":"$iptables","localvar":"my"},{"kind":13,"containerName":"run_iptables","line":1352,"name":"$self"},{"localvar":"my","line":1353,"containerName":"run_iptables","definition":"my","name":"$rule","kind":13},{"containerName":"run_iptables","line":1353,"name":"$args","kind":13},{"name":"$options","definition":"my","line":1354,"containerName":"run_iptables","localvar":"my","kind":13},{"kind":13,"line":1354,"containerName":"run_iptables","name":"$args"},{"name":"$logger","line":1356,"containerName":"run_iptables","kind":13},{"name":"is_debug","containerName":"run_iptables","line":1356,"kind":12},{"kind":13,"containerName":"run_iptables","line":1357,"name":"$logger"},{"kind":12,"name":"debug","containerName":"run_iptables","line":1357},{"kind":13,"name":"$args","containerName":"run_iptables","line":1358},{"name":"$args","containerName":"run_iptables","line":1366,"kind":13},{"kind":13,"localvar":"my","containerName":"run_iptables","line":1367,"name":"$allowdupes","definition":"my"},{"line":1367,"containerName":"run_iptables","name":"$args","kind":13},{"containerName":"run_iptables","line":1369,"name":"$allowdupes","kind":13},{"kind":13,"name":"$logger","containerName":"run_iptables","line":1370},{"kind":12,"containerName":"run_iptables","line":1370,"name":"debug"},{"containerName":"run_iptables","line":1371,"definition":"my","name":"$retval","localvar":"my","kind":13},{"name":"$self","containerName":"run_iptables","line":1371,"kind":13},{"line":1371,"containerName":"run_iptables","name":"check_if_rule_exists","kind":12},{"kind":13,"name":"$args","line":1371,"containerName":"run_iptables"},{"line":1372,"containerName":"run_iptables","name":"$retval","kind":13},{"localvar":"my","containerName":"run_iptables","line":1373,"definition":"my","name":"$logmsg","kind":13},{"kind":13,"line":1374,"containerName":"run_iptables","name":"$logmsg"},{"containerName":"run_iptables","line":1375,"name":"$logger","kind":13},{"kind":12,"name":"debug","line":1375,"containerName":"run_iptables"},{"kind":13,"containerName":"run_iptables","line":1375,"name":"$logmsg"},{"kind":13,"name":"$retval","containerName":"run_iptables","line":1378},{"kind":13,"name":"$logger","line":1382,"containerName":"run_iptables"},{"name":"debug","line":1382,"containerName":"run_iptables","kind":12},{"containerName":"run_iptables","line":1383,"name":"$tracker","kind":13},{"line":1383,"containerName":"run_iptables","name":"$rule","kind":13},{"kind":13,"name":"$retval","containerName":"run_iptables","line":1386},{"kind":13,"name":"$logger","line":1387,"containerName":"run_iptables"},{"containerName":"run_iptables","line":1387,"name":"debug","kind":12},{"kind":13,"name":"$retval","line":1389,"containerName":"run_iptables"},{"kind":13,"name":"$options","line":1390,"containerName":"run_iptables"},{"name":"$logger","line":1393,"containerName":"run_iptables","kind":13},{"kind":12,"name":"debug","containerName":"run_iptables","line":1393},{"containerName":"run_iptables","line":1396,"name":"$tracker","kind":13},{"kind":13,"line":1396,"containerName":"run_iptables","name":"$rule"},{"line":1398,"containerName":"run_iptables","name":"$retval","kind":13},{"kind":13,"containerName":"run_iptables","line":1399,"name":"$logger"},{"kind":12,"containerName":"run_iptables","line":1399,"name":"error"},{"line":1402,"containerName":"run_iptables","name":"$retval","kind":13},{"kind":13,"definition":"my","name":"$logmsg","containerName":"run_iptables","line":1403,"localvar":"my"},{"kind":13,"line":1404,"containerName":"run_iptables","name":"$logmsg"},{"kind":13,"line":1405,"containerName":"run_iptables","name":"$logger"},{"kind":12,"name":"error","line":1405,"containerName":"run_iptables"},{"containerName":"run_iptables","line":1405,"name":"$logmsg","kind":13},{"line":1409,"containerName":"run_iptables","name":"$logger","kind":13},{"line":1409,"containerName":"run_iptables","name":"error","kind":12},{"kind":13,"containerName":"run_iptables","line":1409,"name":"$retval"},{"name":"$command","definition":"my","containerName":"run_iptables","line":1414,"localvar":"my","kind":13},{"kind":13,"name":"$tracker","containerName":"run_iptables","line":1415},{"kind":13,"line":1415,"containerName":"run_iptables","name":"$rule"},{"name":"$self","containerName":"run_iptables","line":1416,"kind":13},{"kind":13,"name":"$logger","line":1417,"containerName":"run_iptables"},{"name":"debug","line":1417,"containerName":"run_iptables","kind":12},{"line":1418,"containerName":"run_iptables","name":"$output","definition":"my","localvar":"my","kind":13},{"line":1419,"containerName":"run_iptables","name":"$logger","kind":13},{"name":"debug","line":1419,"containerName":"run_iptables","kind":12},{"kind":13,"name":"$logger","line":1423,"containerName":"run_iptables"},{"kind":12,"name":"info","line":1423,"containerName":"run_iptables"},{"kind":13,"line":1428,"containerName":"run_iptables","name":"$logger"},{"kind":12,"name":"error","containerName":"run_iptables","line":1428}],"detail":"()"},{"line":1338,"name":"Dumper","kind":12},{"name":"threads","line":1345,"kind":12},{"name":"rule","line":1349,"kind":12},{"line":1350,"name":"configs","kind":12},{"kind":12,"line":1350,"name":"iptables"},{"kind":12,"line":1352,"name":"configs"},{"kind":12,"line":1352,"name":"iptables"},{"name":"rule","line":1353,"kind":12},{"name":"options","line":1354,"kind":12},{"name":"Dumper","line":1358,"kind":12},{"kind":12,"name":"allowdupes","line":1366},{"kind":12,"line":1367,"name":"allowdupes"},{"kind":12,"line":1383,"name":"iptables_rules"},{"name":"chains_created","line":1396,"kind":12},{"line":1415,"name":"iptables_rules","kind":12},{"name":"configs","line":1416,"kind":12},{"kind":12,"name":"PRODMODE","line":1416},{"range":{"start":{"character":0,"line":1432},"end":{"character":9999,"line":1440}},"containerName":"Net::IPBlocker","line":1432,"definition":"sub","name":"set_iptables_command","kind":12,"signature":{"documentation":"","label":"set_iptables_command()","parameters":[]},"children":[{"kind":13,"name":"$self","definition":"my","containerName":"set_iptables_command","line":1433,"localvar":"my"},{"kind":13,"name":"$self","line":1436,"containerName":"set_iptables_command"},{"name":"$self","line":1437,"containerName":"set_iptables_command","kind":13},{"kind":13,"name":"$logger","containerName":"set_iptables_command","line":1438},{"kind":12,"name":"info","containerName":"set_iptables_command","line":1438}],"detail":"()"},{"kind":12,"name":"configs","line":1436},{"kind":12,"line":1436,"name":"iptables"},{"name":"configs","line":1437,"kind":12},{"kind":12,"name":"iptables","line":1437},{"range":{"end":{"line":1499,"character":9999},"start":{"character":0,"line":1444}},"line":1444,"containerName":"Net::IPBlocker","definition":"sub","name":"check_if_rule_exists","kind":12,"signature":{"documentation":"# Returns 0 if there is an unknown return value from running iptables\n#          Otherwise returns a string","parameters":[{"label":"$self"},{"label":"$args"}],"label":"check_if_rule_exists($self,$args)"},"children":[{"kind":13,"localvar":"my","line":1445,"containerName":"check_if_rule_exists","definition":"my","name":"$self"},{"line":1445,"containerName":"check_if_rule_exists","name":"$args","kind":13},{"kind":13,"definition":"my","name":"$TID","line":1446,"containerName":"check_if_rule_exists","localvar":"my"},{"kind":12,"name":"tid","line":1446,"containerName":"check_if_rule_exists"},{"kind":13,"line":1447,"containerName":"check_if_rule_exists","name":"$TID"},{"kind":13,"line":1447,"containerName":"check_if_rule_exists","name":"$TID"},{"containerName":"check_if_rule_exists","line":1450,"name":"$args","kind":13},{"name":"$self","line":1450,"containerName":"check_if_rule_exists","kind":13},{"line":1450,"containerName":"check_if_rule_exists","name":"log_and_return","kind":12},{"kind":13,"containerName":"check_if_rule_exists","line":1451,"name":"$self"},{"name":"$logger","line":1451,"containerName":"check_if_rule_exists","kind":13},{"kind":12,"name":"error","line":1451,"containerName":"check_if_rule_exists"},{"line":1453,"containerName":"check_if_rule_exists","name":"$iptables","definition":"my","localvar":"my","kind":13},{"kind":13,"name":"$self","line":1453,"containerName":"check_if_rule_exists"},{"definition":"my","name":"$rule","line":1454,"containerName":"check_if_rule_exists","localvar":"my","kind":13},{"kind":13,"containerName":"check_if_rule_exists","line":1454,"name":"$args"},{"localvar":"my","name":"$options","definition":"my","line":1455,"containerName":"check_if_rule_exists","kind":13},{"kind":13,"containerName":"check_if_rule_exists","line":1455,"name":"$args"},{"kind":13,"line":1457,"containerName":"check_if_rule_exists","name":"$tracker"},{"name":"$rule","line":1457,"containerName":"check_if_rule_exists","kind":13},{"name":"$logger","line":1458,"containerName":"check_if_rule_exists","kind":13},{"line":1458,"containerName":"check_if_rule_exists","name":"debug","kind":12},{"kind":13,"name":"$tracker","line":1462,"containerName":"check_if_rule_exists"},{"kind":13,"containerName":"check_if_rule_exists","line":1462,"name":"$rule"},{"kind":13,"name":"$logger","line":1463,"containerName":"check_if_rule_exists"},{"kind":12,"line":1463,"containerName":"check_if_rule_exists","name":"debug"},{"kind":13,"name":"$options","line":1467,"containerName":"check_if_rule_exists"},{"containerName":"check_if_rule_exists","line":1468,"definition":"my","name":"$logmsg","localvar":"my","kind":13},{"line":1469,"containerName":"check_if_rule_exists","name":"$logmsg","kind":13},{"containerName":"check_if_rule_exists","line":1470,"name":"$logger","kind":13},{"name":"debug","containerName":"check_if_rule_exists","line":1470,"kind":12},{"kind":13,"containerName":"check_if_rule_exists","line":1470,"name":"$logmsg"},{"kind":13,"containerName":"check_if_rule_exists","line":1474,"definition":"my","name":"$checkrule_result","localvar":"my"},{"kind":13,"name":"$logger","line":1476,"containerName":"check_if_rule_exists"},{"name":"debug","line":1476,"containerName":"check_if_rule_exists","kind":12},{"kind":13,"containerName":"check_if_rule_exists","line":1480,"name":"$checkrule_result"},{"line":1481,"containerName":"check_if_rule_exists","name":"$logger","kind":13},{"kind":12,"containerName":"check_if_rule_exists","line":1481,"name":"debug"},{"kind":13,"name":"$logger","containerName":"check_if_rule_exists","line":1482},{"kind":12,"containerName":"check_if_rule_exists","line":1482,"name":"debug"},{"kind":13,"name":"$checkrule_result","line":1486,"containerName":"check_if_rule_exists"},{"name":"$logger","line":1487,"containerName":"check_if_rule_exists","kind":13},{"kind":12,"line":1487,"containerName":"check_if_rule_exists","name":"debug"},{"kind":13,"name":"$logger","containerName":"check_if_rule_exists","line":1488},{"kind":12,"name":"debug","line":1488,"containerName":"check_if_rule_exists"},{"kind":13,"name":"$checkrule_result","line":1492,"containerName":"check_if_rule_exists"},{"containerName":"check_if_rule_exists","line":1493,"name":"$logger","kind":13},{"kind":12,"containerName":"check_if_rule_exists","line":1493,"name":"debug"},{"kind":13,"name":"$logger","containerName":"check_if_rule_exists","line":1494},{"kind":12,"name":"debug","containerName":"check_if_rule_exists","line":1494},{"containerName":"check_if_rule_exists","line":1498,"name":"$self","kind":13},{"line":1498,"containerName":"check_if_rule_exists","name":"log_and_return","kind":12}],"detail":"($self,$args)"},{"kind":12,"line":1446,"name":"threads"},{"kind":12,"name":"rule","line":1450},{"name":"configs","line":1451,"kind":12},{"kind":12,"line":1451,"name":"iptables"},{"line":1453,"name":"configs","kind":12},{"kind":12,"name":"iptables","line":1453},{"line":1454,"name":"rule","kind":12},{"line":1455,"name":"options","kind":12},{"kind":12,"name":"chains_created","line":1457},{"name":"iptables_rules","line":1462,"kind":12},{"detail":"($self,$error_message)","children":[{"name":"$self","definition":"my","line":1502,"containerName":"log_and_return","localvar":"my","kind":13},{"kind":13,"line":1502,"containerName":"log_and_return","name":"$error_message"},{"kind":13,"localvar":"my","line":1503,"containerName":"log_and_return","name":"$TID","definition":"my"},{"containerName":"log_and_return","line":1503,"name":"tid","kind":12},{"name":"$TID","containerName":"log_and_return","line":1504,"kind":13},{"containerName":"log_and_return","line":1504,"name":"$TID","kind":13},{"kind":13,"line":1505,"containerName":"log_and_return","name":"$logger"},{"kind":12,"line":1505,"containerName":"log_and_return","name":"error"},{"containerName":"log_and_return","line":1505,"name":"$error_message","kind":13}],"kind":12,"signature":{"parameters":[{"label":"$self"},{"label":"$error_message"}],"label":"log_and_return($self,$error_message)","documentation":""},"name":"log_and_return","definition":"sub","containerName":"Net::IPBlocker","range":{"start":{"line":1501,"character":0},"end":{"character":9999,"line":1507}},"line":1501},{"line":1503,"name":"threads","kind":12},{"containerName":"Net::IPBlocker","range":{"end":{"line":1543,"character":9999},"start":{"line":1515,"character":0}},"line":1515,"definition":"sub","name":"add_global_chain","kind":12,"signature":{"parameters":[],"label":"add_global_chain()","documentation":" Description: Creates the global chain and then adds a jump rule to the global chains.\n           With default values this means creating the global chain \"IPBLOCKER_glopbal\" and then\n           adding a jump rule to the INPUT, OUTPUT, and FORWARD tables to go to IPBLOCKER_global\n Dies if no chain prefix is set or if no global chains are set\n    Bassically, this dies if it is not called as class or correct configs are not set\n Returns 1 always"},"children":[{"containerName":"add_global_chain","line":1516,"name":"$self","definition":"my","localvar":"my","kind":13},{"kind":13,"localvar":"my","definition":"my","name":"$TID","containerName":"add_global_chain","line":1517},{"name":"tid","line":1517,"containerName":"add_global_chain","kind":12},{"kind":13,"containerName":"add_global_chain","line":1518,"name":"$TID"},{"kind":13,"name":"$TID","containerName":"add_global_chain","line":1518},{"name":"$chain","definition":"my","containerName":"add_global_chain","line":1520,"localvar":"my","kind":13},{"containerName":"add_global_chain","line":1520,"name":"$self","kind":13},{"kind":13,"line":1520,"containerName":"add_global_chain","name":"$logger"},{"line":1520,"containerName":"add_global_chain","name":"logdie","kind":12},{"containerName":"add_global_chain","line":1521,"name":"$chain","kind":13},{"kind":13,"containerName":"add_global_chain","line":1521,"name":"$chain"},{"localvar":"my","name":"$globalchains_str","definition":"my","line":1523,"containerName":"add_global_chain","kind":13},{"kind":13,"name":"$self","line":1523,"containerName":"add_global_chain"},{"name":"$logger","containerName":"add_global_chain","line":1523,"kind":13},{"containerName":"add_global_chain","line":1523,"name":"logdie","kind":12},{"kind":13,"name":"@globalchains","definition":"my","containerName":"add_global_chain","line":1524,"localvar":"my"},{"containerName":"add_global_chain","line":1524,"name":"$globalchains_str","kind":13},{"kind":13,"line":1526,"containerName":"add_global_chain","name":"$logger"},{"line":1526,"containerName":"add_global_chain","name":"info","kind":12},{"kind":13,"name":"$args","definition":"my","line":1527,"containerName":"add_global_chain","localvar":"my"},{"kind":13,"name":"$self","containerName":"add_global_chain","line":1531},{"name":"iptablesqueue_enqueue","line":1531,"containerName":"add_global_chain","kind":12},{"containerName":"add_global_chain","line":1531,"name":"$args","kind":13},{"kind":13,"name":"$logger","line":1533,"containerName":"add_global_chain"},{"kind":12,"name":"info","line":1533,"containerName":"add_global_chain"},{"localvar":"my","definition":"my","name":"$table","containerName":"add_global_chain","line":1534,"kind":13},{"kind":13,"line":1534,"containerName":"add_global_chain","name":"@globalchains"},{"localvar":"my","line":1535,"containerName":"add_global_chain","definition":"my","name":"$args","kind":13},{"kind":13,"name":"$self","line":1539,"containerName":"add_global_chain"},{"kind":12,"name":"iptablesqueue_enqueue","containerName":"add_global_chain","line":1539},{"containerName":"add_global_chain","line":1539,"name":"$args","kind":13}],"detail":"()"},{"name":"threads","line":1517,"kind":12},{"line":1520,"name":"configs","kind":12},{"name":"chainprefix","line":1520,"kind":12},{"line":1523,"name":"configs","kind":12},{"line":1523,"name":"globalchains","kind":12},{"name":"options","line":1528,"kind":12},{"line":1529,"name":"rule","kind":12},{"kind":12,"name":"options","line":1536},{"kind":12,"line":1537,"name":"rule"},{"signature":{"documentation":" Description: Queues items onto the iptables queue\n Returns 1 if queue is allowing enqueuing\n Returns 0 if queue is not allowing enqueuing","label":"iptablesqueue_enqueue()","parameters":[]},"kind":12,"containerName":"Net::IPBlocker","range":{"start":{"line":1548,"character":0},"end":{"line":1564,"character":9999}},"line":1548,"definition":"sub","name":"iptablesqueue_enqueue","children":[{"definition":"my","name":"$self","containerName":"iptablesqueue_enqueue","line":1549,"localvar":"my","kind":13},{"kind":13,"name":"$args","containerName":"iptablesqueue_enqueue","line":1549},{"line":1550,"containerName":"iptablesqueue_enqueue","definition":"my","name":"$TID","localvar":"my","kind":13},{"line":1550,"containerName":"iptablesqueue_enqueue","name":"tid","kind":12},{"kind":13,"name":"$TID","line":1551,"containerName":"iptablesqueue_enqueue"},{"name":"$TID","containerName":"iptablesqueue_enqueue","line":1551,"kind":13},{"name":"$iptablesQueue_pending","definition":"my","line":1553,"containerName":"iptablesqueue_enqueue","localvar":"my","kind":13},{"kind":13,"name":"$IptablesQueue","containerName":"iptablesqueue_enqueue","line":1553},{"kind":12,"containerName":"iptablesqueue_enqueue","line":1553,"name":"pending"},{"name":"$iptablesQueue_pending","containerName":"iptablesqueue_enqueue","line":1554,"kind":13},{"kind":13,"name":"$logmsg","definition":"my","line":1555,"containerName":"iptablesqueue_enqueue","localvar":"my"},{"kind":13,"line":1556,"containerName":"iptablesqueue_enqueue","name":"$logmsg"},{"name":"$logger","containerName":"iptablesqueue_enqueue","line":1557,"kind":13},{"name":"info","line":1557,"containerName":"iptablesqueue_enqueue","kind":12},{"name":"$logmsg","line":1557,"containerName":"iptablesqueue_enqueue","kind":13},{"name":"$args","containerName":"iptablesqueue_enqueue","line":1560,"kind":13},{"containerName":"iptablesqueue_enqueue","line":1561,"name":"$logger","kind":13},{"line":1561,"containerName":"iptablesqueue_enqueue","name":"debug","kind":12},{"name":"$args","line":1561,"containerName":"iptablesqueue_enqueue","kind":13},{"kind":13,"name":"$logger","line":1561,"containerName":"iptablesqueue_enqueue"},{"kind":12,"line":1561,"containerName":"iptablesqueue_enqueue","name":"is_debug"},{"kind":13,"name":"$IptablesQueue","containerName":"iptablesqueue_enqueue","line":1562},{"kind":12,"containerName":"iptablesqueue_enqueue","line":1562,"name":"enqueue"},{"kind":13,"name":"$args","line":1562,"containerName":"iptablesqueue_enqueue"}],"detail":"()"},{"kind":12,"name":"threads","line":1550},{"name":"check_pending","line":1560,"kind":12},{"line":1561,"name":"Dumper","kind":12},{"detail":"($self,$logobj)","children":[{"kind":13,"name":"$self","definition":"my","line":1572,"containerName":"readlogfile","localvar":"my"},{"line":1572,"containerName":"readlogfile","name":"$logobj","kind":13},{"kind":13,"localvar":"my","containerName":"readlogfile","line":1573,"definition":"my","name":"$TID"},{"kind":12,"line":1573,"containerName":"readlogfile","name":"tid"},{"kind":13,"containerName":"readlogfile","line":1574,"name":"$TID"},{"containerName":"readlogfile","line":1574,"name":"$TID","kind":13},{"kind":13,"localvar":"my","line":1577,"containerName":"readlogfile","definition":"my","name":"$file"},{"kind":13,"line":1577,"containerName":"readlogfile","name":"$logobj"},{"containerName":"readlogfile","line":1578,"name":"$file","kind":13},{"kind":13,"name":"$logger","containerName":"readlogfile","line":1578},{"kind":12,"containerName":"readlogfile","line":1578,"name":"error"},{"containerName":"readlogfile","line":1578,"name":"$logobj","kind":13},{"line":1581,"containerName":"readlogfile","name":"$logobj","kind":13},{"containerName":"readlogfile","line":1582,"name":"$logobj","kind":13},{"containerName":"readlogfile","line":1582,"name":"$file","kind":13},{"line":1582,"containerName":"readlogfile","name":"$logobj","kind":13},{"containerName":"readlogfile","line":1583,"name":"$logobj","kind":13},{"containerName":"readlogfile","line":1583,"name":"$self","kind":13},{"name":"$logobj","line":1584,"containerName":"readlogfile","kind":13},{"kind":13,"containerName":"readlogfile","line":1584,"name":"$logobj"},{"name":"$logger","containerName":"readlogfile","line":1586,"kind":13},{"line":1586,"containerName":"readlogfile","name":"debug","kind":12},{"kind":13,"localvar":"my","containerName":"readlogfile","line":1592,"name":"$fh","definition":"my"},{"kind":13,"containerName":"readlogfile","line":1592,"name":"$file"},{"kind":13,"name":"$logger","line":1593,"containerName":"readlogfile"},{"kind":12,"line":1593,"containerName":"readlogfile","name":"error"},{"containerName":"readlogfile","line":1594,"name":"$logobj","kind":13},{"kind":13,"line":1596,"containerName":"readlogfile","name":"$fh"},{"line":1596,"containerName":"readlogfile","name":"$logobj","kind":13},{"localvar":"my","containerName":"readlogfile","line":1597,"definition":"my","name":"@logcontents","kind":13},{"kind":13,"name":"$fh","containerName":"readlogfile","line":1597},{"containerName":"readlogfile","line":1598,"name":"$logobj","kind":13},{"kind":13,"line":1598,"containerName":"readlogfile","name":"$fh"},{"kind":13,"containerName":"readlogfile","line":1599,"name":"$fh"},{"kind":13,"name":"@logcontents","line":1601,"containerName":"readlogfile"},{"line":1602,"containerName":"readlogfile","name":"$logger","kind":13},{"kind":12,"name":"debug","line":1602,"containerName":"readlogfile"},{"containerName":"readlogfile","line":1602,"name":"@logcontents","kind":13},{"name":"$logger","containerName":"readlogfile","line":1605,"kind":13},{"kind":12,"line":1605,"containerName":"readlogfile","name":"info"},{"kind":13,"containerName":"readlogfile","line":1606,"name":"$logobj"},{"name":"@logcontents","line":1609,"containerName":"readlogfile","kind":13},{"name":"$logobj","line":1610,"containerName":"readlogfile","kind":13},{"kind":13,"name":"@logcontents","line":1610,"containerName":"readlogfile"},{"name":"$logger","containerName":"readlogfile","line":1612,"kind":13},{"name":"debug","containerName":"readlogfile","line":1612,"kind":12},{"kind":13,"name":"@logcontents","line":1612,"containerName":"readlogfile"},{"line":1613,"containerName":"readlogfile","name":"$logger","kind":13},{"containerName":"readlogfile","line":1613,"name":"trace","kind":12},{"kind":13,"containerName":"readlogfile","line":1613,"name":"$logobj"},{"kind":13,"containerName":"readlogfile","line":1613,"name":"$logger"},{"name":"is_trace","line":1613,"containerName":"readlogfile","kind":12},{"kind":13,"line":1615,"containerName":"readlogfile","name":"$logobj"}],"signature":{"label":"readlogfile($self,$logobj)","parameters":[{"label":"$self"},{"label":"$logobj"}],"documentation":" This function reads the log file into memory from the seek position (if it exists)\n The reading of a log file based on the seek position creates a big issue if the log file is rotated AND is larger than\n   the seek position\n   This is a tradeoff of reading the entire log file into memory and then grepping for the regexps\n Returns: $logobj"},"kind":12,"definition":"sub","name":"readlogfile","range":{"end":{"line":1616,"character":9999},"start":{"line":1571,"character":0}},"containerName":"Net::IPBlocker","line":1571},{"line":1573,"name":"threads","kind":12},{"line":1577,"name":"file","kind":12},{"kind":12,"name":"seek","line":1581},{"name":"seek","line":1582,"kind":12},{"name":"seek","line":1582,"kind":12},{"line":1583,"name":"readentirefile","kind":12},{"kind":12,"name":"configs","line":1583},{"line":1583,"name":"readentirefile","kind":12},{"name":"seek","line":1584,"kind":12},{"name":"readentirefile","line":1584,"kind":12},{"line":1596,"name":"seek","kind":12},{"name":"seek","line":1598,"kind":12},{"kind":12,"name":"logcontents","line":1606},{"kind":12,"line":1610,"name":"logcontents"},{"line":1613,"name":"Dumper","kind":12},{"name":"logcontents","line":1613,"kind":12},{"detail":"($self,$log)","children":[{"name":"$self","definition":"my","containerName":"_grep_regexps","line":1622,"localvar":"my","kind":13},{"name":"$log","containerName":"_grep_regexps","line":1622,"kind":13},{"kind":13,"containerName":"_grep_regexps","line":1623,"definition":"my","name":"$TID","localvar":"my"},{"kind":12,"name":"tid","containerName":"_grep_regexps","line":1623},{"line":1625,"containerName":"_grep_regexps","definition":"my","name":"$matches","localvar":"my","kind":13},{"localvar":"my","name":"@log_contents","definition":"my","containerName":"_grep_regexps","line":1626,"kind":13},{"kind":13,"line":1626,"containerName":"_grep_regexps","name":"$log"}],"name":"_grep_regexps","definition":"sub","line":1621,"range":{"end":{"line":1626,"character":9999},"start":{"character":0,"line":1621}},"containerName":"Net::IPBlocker","signature":{"label":"_grep_regexps($self,$log)","parameters":[{"label":"$self"},{"label":"$log"}],"documentation":" Description:  Using the logobj, this greps against the log contents for matching lines and then gets the\n               IP address on each line.\n Returns:  Hash reference of IP addresses with count of how many times the IP address was found"},"kind":12},{"kind":12,"name":"threads","line":1623},{"kind":12,"line":1626,"name":"logcontents"},{"kind":13,"name":"@log_contents","containerName":null,"line":1628},{"kind":13,"localvar":"my","containerName":null,"line":1631,"definition":"my","name":"$regex"},{"line":1631,"containerName":null,"name":"%log","kind":13},{"kind":12,"name":"regexpdeny","line":1631},{"kind":13,"name":"$pattern","definition":"my","line":1632,"containerName":null,"localvar":"my"},{"kind":13,"name":"%log","containerName":null,"line":1632},{"kind":12,"line":1632,"name":"regexpdeny"},{"containerName":null,"line":1632,"name":"$regex","kind":13},{"kind":13,"name":"$logger","containerName":null,"line":1633},{"kind":12,"line":1633,"containerName":"Net::IPBlocker","name":"debug"},{"kind":13,"localvar":"my","definition":"my","name":"@current_matches","containerName":null,"line":1635},{"kind":13,"line":1635,"containerName":null,"name":"@log_contents"},{"line":1636,"containerName":null,"name":"$logger","kind":13},{"kind":12,"line":1636,"containerName":"Net::IPBlocker","name":"debug"},{"kind":12,"line":1636,"name":"Dumper"},{"line":1636,"containerName":null,"name":"@current_matches","kind":13},{"name":"$logger","line":1636,"containerName":null,"kind":13},{"kind":12,"line":1636,"containerName":"Net::IPBlocker","name":"is_debug"},{"kind":13,"name":"$line","definition":"my","line":1638,"containerName":null,"localvar":"my"},{"kind":13,"name":"@current_matches","containerName":null,"line":1638},{"line":1639,"containerName":null,"name":"$line","kind":13},{"kind":13,"name":"$logger","line":1640,"containerName":null},{"name":"debug","line":1640,"containerName":"Net::IPBlocker","kind":12},{"kind":13,"localvar":"my","name":"$ip_address","definition":"my","containerName":null,"line":1642},{"line":1642,"containerName":null,"name":"$line","kind":13},{"name":"%line","line":1642,"containerName":null,"kind":13},{"containerName":null,"line":1643,"name":"%matches","kind":13},{"name":"$ip_address","containerName":null,"line":1643,"kind":13},{"kind":13,"name":"$logger","containerName":null,"line":1644},{"containerName":"Net::IPBlocker","line":1644,"name":"debug","kind":12},{"name":"$logger","line":1649,"containerName":null,"kind":13},{"name":"debug","line":1649,"containerName":"Net::IPBlocker","kind":12},{"name":"Dumper","line":1649,"kind":12},{"name":"$matches","line":1649,"containerName":null,"kind":13},{"line":1649,"containerName":null,"name":"$logger","kind":13},{"kind":12,"containerName":"Net::IPBlocker","line":1649,"name":"is_debug"},{"localvar":"my","containerName":null,"line":1651,"definition":"my","name":"$log_msg","kind":13},{"kind":13,"line":1652,"containerName":null,"name":"$log_msg"},{"kind":13,"line":1652,"containerName":null,"name":"$matches"},{"name":"$logger","containerName":null,"line":1653,"kind":13},{"name":"info","line":1653,"containerName":"Net::IPBlocker","kind":12},{"kind":13,"name":"$log_msg","line":1653,"containerName":null},{"kind":13,"containerName":null,"line":1655,"name":"$matches"},{"children":[{"name":"$self","definition":"my","line":1660,"containerName":"add_chain","localvar":"my","kind":13},{"name":"$chain","line":1660,"containerName":"add_chain","kind":13},{"containerName":"add_chain","line":1661,"name":"$TID","definition":"my","localvar":"my","kind":13},{"line":1661,"containerName":"add_chain","name":"tid","kind":12},{"kind":13,"name":"$logger","containerName":"add_chain","line":1663},{"name":"info","line":1663,"containerName":"add_chain","kind":12},{"kind":13,"localvar":"my","containerName":"add_chain","line":1664,"definition":"my","name":"$rule"},{"kind":13,"line":1665,"containerName":"add_chain","name":"$options","definition":"my","localvar":"my"},{"kind":13,"definition":"my","name":"$args","line":1666,"containerName":"add_chain","localvar":"my"},{"line":1666,"containerName":"add_chain","name":"$rule","kind":13},{"containerName":"add_chain","line":1666,"name":"$options","kind":13},{"containerName":"add_chain","line":1667,"name":"$self","kind":13},{"name":"iptablesqueue_enqueue","containerName":"add_chain","line":1667,"kind":12},{"kind":13,"line":1667,"containerName":"add_chain","name":"$args"},{"containerName":"add_chain","line":1668,"name":"$self","kind":13},{"kind":13,"name":"$chain","line":1668,"containerName":"add_chain"}],"detail":"()","kind":12,"signature":{"documentation":" Description:  Adds the chain to iptables","label":"add_chain()","parameters":[]},"range":{"start":{"character":0,"line":1659},"end":{"character":9999,"line":1670}},"line":1659,"containerName":"Net::IPBlocker","definition":"sub","name":"add_chain"},{"kind":12,"line":1661,"name":"threads"},{"kind":12,"line":1666,"name":"rule"},{"kind":12,"name":"options","line":1666},{"kind":12,"line":1668,"name":"chains_created"},{"detail":"()","children":[{"kind":13,"line":1680,"containerName":"add_allowdeny_ips","definition":"my","name":"$self","localvar":"my"},{"name":"$args","containerName":"add_allowdeny_ips","line":1680,"kind":13},{"kind":13,"line":1681,"containerName":"add_allowdeny_ips","name":"$TID","definition":"my","localvar":"my"},{"kind":12,"name":"tid","containerName":"add_allowdeny_ips","line":1681},{"kind":13,"name":"$args","line":1683,"containerName":"add_allowdeny_ips"},{"line":1684,"containerName":"add_allowdeny_ips","name":"$logger","kind":13},{"name":"error","line":1684,"containerName":"add_allowdeny_ips","kind":12},{"containerName":"add_allowdeny_ips","line":1687,"definition":"my","name":"$chain","localvar":"my","kind":13},{"name":"$args","line":1687,"containerName":"add_allowdeny_ips","kind":13},{"localvar":"my","containerName":"add_allowdeny_ips","line":1689,"definition":"my","name":"%ip_rules","kind":13},{"name":"$args","containerName":"add_allowdeny_ips","line":1690,"kind":13},{"kind":13,"name":"$args","line":1691,"containerName":"add_allowdeny_ips"},{"kind":13,"containerName":"add_allowdeny_ips","line":1694,"name":"@allowdenyorder","definition":"my","localvar":"my"},{"line":1695,"containerName":"add_allowdeny_ips","name":"$args","kind":13},{"kind":13,"name":"@allowdenyorder","containerName":"add_allowdeny_ips","line":1696},{"containerName":"add_allowdeny_ips","line":1699,"name":"$logger","kind":13},{"line":1699,"containerName":"add_allowdeny_ips","name":"debug","kind":12},{"name":"%ip_rules","line":1699,"containerName":"add_allowdeny_ips","kind":13},{"kind":13,"containerName":"add_allowdeny_ips","line":1699,"name":"$logger"},{"kind":12,"containerName":"add_allowdeny_ips","line":1699,"name":"is_debug"},{"definition":"my","name":"$action","line":1702,"containerName":"add_allowdeny_ips","localvar":"my","kind":13},{"name":"@allowdenyorder","line":1702,"containerName":"add_allowdeny_ips","kind":13},{"line":1703,"containerName":"add_allowdeny_ips","name":"$logger","kind":13},{"name":"debug","containerName":"add_allowdeny_ips","line":1703,"kind":12},{"kind":13,"localvar":"my","line":1706,"containerName":"add_allowdeny_ips","definition":"my","name":"$chain"},{"name":"$args","line":1706,"containerName":"add_allowdeny_ips","kind":13},{"kind":13,"line":1707,"containerName":"add_allowdeny_ips","name":"$rule_action","definition":"my","localvar":"my"},{"kind":13,"containerName":"add_allowdeny_ips","line":1707,"name":"$action"},{"localvar":"my","containerName":"add_allowdeny_ips","line":1708,"name":"$ip","definition":"my","kind":13},{"kind":13,"name":"$ip_rules","line":1708,"containerName":"add_allowdeny_ips"},{"containerName":"add_allowdeny_ips","line":1708,"name":"$action","kind":13},{"line":1709,"containerName":"add_allowdeny_ips","name":"$logger","kind":13},{"kind":12,"name":"debug","containerName":"add_allowdeny_ips","line":1709},{"name":"$direction","definition":"my","containerName":"add_allowdeny_ips","line":1710,"localvar":"my","kind":13},{"kind":13,"localvar":"my","name":"$rule","definition":"my","line":1711,"containerName":"add_allowdeny_ips"},{"kind":13,"containerName":"add_allowdeny_ips","line":1712,"definition":"my","name":"$args","localvar":"my"},{"line":1712,"containerName":"add_allowdeny_ips","name":"$rule","kind":13},{"kind":13,"name":"$logger","containerName":"add_allowdeny_ips","line":1713},{"kind":12,"line":1713,"containerName":"add_allowdeny_ips","name":"debug"},{"kind":13,"name":"$self","containerName":"add_allowdeny_ips","line":1714},{"kind":12,"containerName":"add_allowdeny_ips","line":1714,"name":"iptablesqueue_enqueue"},{"name":"$args","containerName":"add_allowdeny_ips","line":1714,"kind":13}],"kind":12,"signature":{"documentation":" Description:  Adds the IPs to DROP or ACCEPT to the chain provided\n Returns:  1\n Requires: $args to be a hash reference with the following optional keys:\n  chain:  The chain to add the rules to.  If no chain provided then the default is ipblocker_global\n  allowlist:  An array of IPs to allow\n  denylist:  An array of IPs to deny\n  allowdenyorder:  The order to add the allow and deny rules","label":"add_allowdeny_ips()","parameters":[]},"name":"add_allowdeny_ips","definition":"sub","range":{"start":{"line":1679,"character":0},"end":{"character":9999,"line":1717}},"containerName":"Net::IPBlocker","line":1679},{"kind":12,"name":"threads","line":1681},{"name":"chain","line":1687,"kind":12},{"kind":12,"name":"allow","line":1690},{"line":1690,"name":"allowlist","kind":12},{"kind":12,"name":"deny","line":1691},{"name":"denylist","line":1691,"kind":12},{"kind":12,"name":"allowdeny","line":1695},{"kind":12,"line":1699,"name":"Dumper"},{"kind":12,"line":1706,"name":"chain"},{"line":1712,"name":"rule","kind":12},{"kind":12,"line":1712,"name":"options"},{"line":1724,"range":{"end":{"line":1730,"character":9999},"start":{"character":0,"line":1724}},"containerName":"Net::IPBlocker","definition":"sub","name":"add_global_allow_deny_ips","signature":{"documentation":" Description:  Adds the IPs to block or accept from the configs global allowlist and global denylist to the global chain\n Returns:  1","label":"add_global_allow_deny_ips()","parameters":[]},"kind":12,"children":[{"kind":13,"name":"$self","definition":"my","line":1725,"containerName":"add_global_allow_deny_ips","localvar":"my"},{"kind":13,"localvar":"my","definition":"my","name":"$TID","containerName":"add_global_allow_deny_ips","line":1726},{"line":1726,"containerName":"add_global_allow_deny_ips","name":"tid","kind":12},{"kind":13,"name":"$logger","containerName":"add_global_allow_deny_ips","line":1728},{"kind":12,"name":"debug","containerName":"add_global_allow_deny_ips","line":1728},{"containerName":"add_global_allow_deny_ips","line":1729,"name":"$chain","definition":"my","localvar":"my","kind":13},{"kind":13,"containerName":"add_global_allow_deny_ips","line":1729,"name":"$self"},{"localvar":"my","line":1730,"containerName":"add_global_allow_deny_ips","definition":"my","name":"@allowlist","kind":13},{"kind":13,"name":"$self","line":1730,"containerName":"add_global_allow_deny_ips"},{"name":"$self","containerName":"add_global_allow_deny_ips","line":1730,"kind":13}],"detail":"()"},{"kind":12,"line":1726,"name":"threads"},{"line":1729,"name":"configs","kind":12},{"kind":12,"name":"chainprefix","line":1729},{"kind":12,"name":"configs","line":1730},{"line":1730,"name":"allowlist","kind":12},{"kind":12,"name":"configs","line":1730},{"kind":12,"name":"allowlist","line":1730},{"name":"@denylist","definition":"my","containerName":null,"line":1731,"localvar":"my","kind":13},{"kind":13,"name":"%self","containerName":null,"line":1731},{"kind":12,"name":"configs","line":1731},{"line":1731,"name":"denylist","kind":12},{"name":"%self","containerName":null,"line":1731,"kind":13},{"kind":12,"name":"configs","line":1731},{"kind":12,"line":1731,"name":"denylist"},{"kind":13,"definition":"my","name":"$allowdeny","line":1732,"containerName":null,"localvar":"my"},{"containerName":null,"line":1732,"name":"%self","kind":13},{"line":1732,"name":"configs","kind":12},{"line":1732,"name":"allowdeny","kind":12},{"name":"%args","definition":"my","containerName":null,"line":1734,"localvar":"my","kind":13},{"line":1735,"name":"chain","kind":12},{"kind":13,"name":"$chain","line":1735,"containerName":null},{"line":1736,"name":"allowlist","kind":12},{"line":1736,"containerName":null,"name":"@allowlist","kind":13},{"line":1737,"name":"denylist","kind":12},{"name":"@denylist","line":1737,"containerName":null,"kind":13},{"kind":12,"line":1738,"name":"allowdeny"},{"kind":13,"name":"$allowdeny","line":1739,"containerName":null},{"name":"$logger","line":1741,"containerName":null,"kind":13},{"kind":12,"containerName":"Net::IPBlocker","line":1741,"name":"debug"},{"name":"Dumper","line":1741,"kind":12},{"kind":13,"line":1741,"containerName":null,"name":"$args"},{"kind":13,"name":"$logger","containerName":null,"line":1741},{"name":"is_debug","line":1741,"containerName":"Net::IPBlocker","kind":12},{"kind":13,"name":"$self","containerName":null,"line":1743},{"line":1743,"containerName":"Net::IPBlocker","name":"add_allowdeny_ips","kind":12},{"kind":13,"containerName":null,"line":1743,"name":"$args"},{"detail":"()","children":[{"kind":13,"localvar":"my","name":"$self","definition":"my","line":1747,"containerName":"add_logger_allow_deny_ips"},{"name":"$logobj","containerName":"add_logger_allow_deny_ips","line":1747,"kind":13},{"kind":13,"localvar":"my","line":1748,"containerName":"add_logger_allow_deny_ips","definition":"my","name":"$TID"},{"name":"tid","line":1748,"containerName":"add_logger_allow_deny_ips","kind":12},{"name":"$logger","containerName":"add_logger_allow_deny_ips","line":1750,"kind":13},{"name":"debug","containerName":"add_logger_allow_deny_ips","line":1750,"kind":12},{"kind":13,"localvar":"my","line":1751,"containerName":"add_logger_allow_deny_ips","name":"$chain","definition":"my"},{"name":"$self","line":1751,"containerName":"add_logger_allow_deny_ips","kind":13},{"kind":13,"name":"$logobj","line":1751,"containerName":"add_logger_allow_deny_ips"},{"kind":13,"name":"@allowlist","definition":"my","containerName":"add_logger_allow_deny_ips","line":1752,"localvar":"my"},{"name":"$logobj","containerName":"add_logger_allow_deny_ips","line":1752,"kind":13},{"kind":13,"name":"$logobj","line":1752,"containerName":"add_logger_allow_deny_ips"}],"signature":{"label":"add_logger_allow_deny_ips()","parameters":[],"documentation":""},"kind":12,"name":"add_logger_allow_deny_ips","definition":"sub","containerName":"Net::IPBlocker","range":{"start":{"line":1746,"character":0},"end":{"character":9999,"line":1752}},"line":1746},{"kind":12,"name":"threads","line":1748},{"kind":12,"name":"configs","line":1751},{"line":1751,"name":"chainprefix","kind":12},{"kind":12,"name":"chain","line":1751},{"name":"allowlist","line":1752,"kind":12},{"name":"allowlist","line":1752,"kind":12},{"kind":13,"localvar":"my","name":"@denylist","definition":"my","line":1753,"containerName":null},{"name":"%logobj","containerName":null,"line":1753,"kind":13},{"line":1753,"name":"denylist","kind":12},{"kind":13,"containerName":null,"line":1753,"name":"%logobj"},{"kind":12,"line":1753,"name":"denylist"},{"kind":13,"definition":"my","name":"$allowdeny","line":1754,"containerName":null,"localvar":"my"},{"containerName":null,"line":1754,"name":"%logobj","kind":13},{"kind":12,"name":"allowdeny","line":1754},{"containerName":null,"line":1756,"name":"%args","definition":"my","localvar":"my","kind":13},{"kind":12,"name":"chain","line":1757},{"kind":13,"line":1757,"containerName":null,"name":"$chain"},{"line":1758,"name":"allowlist","kind":12},{"name":"@allowlist","line":1758,"containerName":null,"kind":13},{"line":1759,"name":"denylist","kind":12},{"kind":13,"name":"@denylist","line":1759,"containerName":null},{"name":"allowdeny","line":1760,"kind":12},{"kind":13,"containerName":null,"line":1761,"name":"$allowdeny"},{"kind":13,"name":"$logger","containerName":null,"line":1763},{"kind":12,"line":1763,"containerName":"Net::IPBlocker","name":"debug"},{"kind":12,"name":"Dumper","line":1763},{"kind":13,"name":"$args","line":1763,"containerName":null},{"kind":13,"name":"$logger","containerName":null,"line":1763},{"name":"is_debug","containerName":"Net::IPBlocker","line":1763,"kind":12},{"name":"$self","containerName":null,"line":1765,"kind":13},{"kind":12,"containerName":"Net::IPBlocker","line":1765,"name":"add_allowdeny_ips"},{"name":"$args","containerName":null,"line":1765,"kind":13},{"children":[{"localvar":"my","line":1804,"containerName":"stop","definition":"my","name":"$self","kind":13},{"kind":13,"line":1804,"containerName":"stop","name":"$args"},{"localvar":"my","containerName":"stop","line":1805,"name":"$TID","definition":"my","kind":13},{"name":"tid","line":1805,"containerName":"stop","kind":12},{"line":1806,"containerName":"stop","name":"$TID","kind":13},{"containerName":"stop","line":1806,"name":"$TID","kind":13},{"kind":13,"name":"$logger","containerName":"stop","line":1807},{"kind":12,"containerName":"stop","line":1807,"name":"info"},{"definition":"my","name":"$chains_created","line":1809,"containerName":"stop","localvar":"my","kind":13},{"name":"$args","containerName":"stop","line":1809,"kind":13},{"kind":13,"containerName":"stop","line":1810,"name":"$logger"},{"kind":12,"containerName":"stop","line":1810,"name":"debug"},{"kind":13,"containerName":"stop","line":1810,"name":"$tracker"},{"name":"$logger","containerName":"stop","line":1810,"kind":13},{"containerName":"stop","line":1810,"name":"is_debug","kind":12},{"kind":13,"containerName":"stop","line":1813,"name":"$self"},{"name":"$chains_created","line":1813,"containerName":"stop","kind":13},{"name":"$logger","line":1814,"containerName":"stop","kind":13},{"kind":12,"name":"info","containerName":"stop","line":1814},{"localvar":"my","name":"$chain","definition":"my","containerName":"stop","line":1815,"kind":13},{"kind":13,"name":"$self","line":1815,"containerName":"stop"},{"containerName":"stop","line":1816,"name":"$logger","kind":13},{"line":1816,"containerName":"stop","name":"info","kind":12},{"kind":13,"name":"$IptablesQueue","containerName":"stop","line":1817},{"kind":12,"name":"enqueue","line":1817,"containerName":"stop"}],"detail":"()","kind":12,"signature":{"documentation":" sub add_global_allow_deny_ips {\n     my ($self) = @_;\n     my $TID = \"TID: \" . threads->tid;\n     $logger->debug(\"$TID|Adding global allow/deny IPs to global chains\");\n     my %ip_rules = (\n         allow => $self->{configs}->{allowlist} || {},\n         deny  => $self->{configs}->{denylist}  || {}\n     );\n     $logger->debug(\"$TID|IP rules: \" . Dumper(\\%ip_rules)) if $logger->is_debug();\n     foreach my $action (keys %ip_rules) {\n         my $chain = \"ipblocker_global\" . $action;\n         my $rule_action = $action eq 'allow' ? 'ACCEPT' : 'DROP';\n         foreach my $ruleorder (sort keys %{$ip_rules{$action}}) {\n             my $ip = $ip_rules{$action}{$ruleorder};\n             foreach my $direction ('-s', '-d') {\n                 # my $chain = $chain_prefix . ($direction eq '-s' ? '' : 'regex') . $action;\n                 my $rule = \"$chain $direction $ip -j $rule_action\";\n                 my $args = { rule => $rule, options => \"-w -A\" };\n                 $logger->debug(\"$TID|Adding >>-w -A $rule<< to iptables queue\");\n                 $self->iptablesqueue_enqueue($args);\n             }\n         }\n     }\n     return 1;\n }\n Stops the module\n  Future enhancements:\n   Clear the thread queues","parameters":[],"label":"stop()"},"range":{"start":{"character":0,"line":1803},"end":{"character":9999,"line":1824}},"containerName":"Net::IPBlocker","line":1803,"definition":"sub","name":"stop"},{"kind":12,"name":"threads","line":1805},{"kind":12,"name":"chains_created","line":1809},{"line":1810,"name":"Dumper","kind":12},{"kind":12,"line":1813,"name":"chains_created"},{"kind":12,"name":"chains_created","line":1815},{"kind":12,"line":1819,"name":"options"},{"kind":12,"line":1820,"name":"rule"},{"name":"$logger","line":1826,"containerName":null,"kind":13},{"name":"info","line":1826,"containerName":"Net::IPBlocker","kind":12},{"kind":13,"name":"$logger","containerName":null,"line":1829},{"kind":12,"name":"info","line":1829,"containerName":"Net::IPBlocker"},{"name":"clear_queues","line":1830,"kind":12},{"name":"$logger","containerName":null,"line":1830,"kind":13},{"kind":12,"name":"error","line":1830,"containerName":"Net::IPBlocker"},{"kind":13,"line":1831,"containerName":null,"name":"$logger"},{"line":1831,"containerName":"Net::IPBlocker","name":"info","kind":12},{"kind":12,"name":"join_threads","line":1832},{"line":1832,"containerName":null,"name":"$logger","kind":13},{"containerName":"Net::IPBlocker","line":1832,"name":"error","kind":12},{"kind":13,"containerName":null,"line":1834,"name":"$logger"},{"kind":12,"name":"info","line":1834,"containerName":"Net::IPBlocker"},{"name":"$lock_obj","containerName":null,"line":1835,"kind":13},{"containerName":"Net::IPBlocker","line":1835,"name":"release","kind":12},{"kind":13,"containerName":null,"line":1836,"name":"$logger"},{"line":1836,"containerName":"Net::IPBlocker","name":"info","kind":12},{"signature":{"label":"join_threads()","parameters":[],"documentation":" Joins all threads\n   Simple sub but really needs some rework\n   If a thread is taking a while to join then it will block the other threads from joining\n   Some of the threads could be reading a log file and if the log file is large then it could take a while or\n   if the log file is causing soem kind of blocking for reading then it could take a while.\n   This may be an issue, if an example, if trying to read a file across NFS or SSHFS and there is a network issue."},"kind":12,"definition":"sub","name":"join_threads","range":{"end":{"character":9999,"line":1851},"start":{"line":1845,"character":0}},"line":1845,"containerName":"Net::IPBlocker","detail":"()","children":[{"kind":13,"localvar":"my","name":"$TID","definition":"my","containerName":"join_threads","line":1846},{"name":"tid","containerName":"join_threads","line":1846,"kind":12},{"name":"$TID","line":1847,"containerName":"join_threads","kind":13},{"kind":13,"name":"$TID","containerName":"join_threads","line":1847},{"kind":13,"containerName":"join_threads","line":1848,"name":"$logger"},{"containerName":"join_threads","line":1848,"name":"debug","kind":12},{"name":"join","containerName":"join_threads","line":1849,"kind":12},{"kind":12,"containerName":"join_threads","line":1849,"name":"list"}]},{"kind":12,"name":"threads","line":1846},{"name":"threads","line":1849,"kind":12},{"detail":"()","children":[{"localvar":"my","line":1855,"containerName":"clear_queues","name":"$TID","definition":"my","kind":13},{"name":"tid","line":1855,"containerName":"clear_queues","kind":12},{"line":1856,"containerName":"clear_queues","name":"$TID","kind":13},{"kind":13,"line":1856,"containerName":"clear_queues","name":"$TID"},{"line":1857,"containerName":"clear_queues","name":"$logger","kind":13},{"kind":12,"name":"debug","line":1857,"containerName":"clear_queues"},{"name":"$DataQueue","containerName":"clear_queues","line":1858,"kind":13},{"line":1858,"containerName":"clear_queues","name":"end","kind":12},{"line":1859,"containerName":"clear_queues","name":"$IptablesQueue","kind":13},{"kind":12,"containerName":"clear_queues","line":1859,"name":"end"},{"kind":13,"line":1860,"containerName":"clear_queues","name":"$DataQueue"},{"name":"pending","line":1860,"containerName":"clear_queues","kind":12},{"containerName":"clear_queues","line":1860,"name":"$IptablesQueue","kind":13},{"containerName":"clear_queues","line":1860,"name":"pending","kind":12},{"containerName":"clear_queues","line":1861,"name":"$DataQueue","kind":13},{"kind":12,"name":"pending","line":1861,"containerName":"clear_queues"},{"containerName":"clear_queues","line":1861,"name":"$logger","kind":13},{"kind":12,"name":"debug","line":1861,"containerName":"clear_queues"},{"containerName":"clear_queues","line":1862,"name":"$IptablesQueue","kind":13},{"name":"pending","containerName":"clear_queues","line":1862,"kind":12},{"kind":13,"line":1862,"containerName":"clear_queues","name":"$logger"},{"containerName":"clear_queues","line":1862,"name":"debug","kind":12},{"kind":13,"name":"$DataQueue","containerName":"clear_queues","line":1866},{"name":"pending","containerName":"clear_queues","line":1866,"kind":12},{"kind":13,"name":"$IptablesQueue","line":1866,"containerName":"clear_queues"},{"kind":12,"line":1866,"containerName":"clear_queues","name":"pending"},{"kind":13,"containerName":"clear_queues","line":1867,"name":"$logger"},{"name":"error","line":1867,"containerName":"clear_queues","kind":12},{"name":"$logger","line":1871,"containerName":"clear_queues","kind":13},{"kind":12,"name":"debug","containerName":"clear_queues","line":1871}],"signature":{"documentation":" Clears the queues","parameters":[],"label":"clear_queues()"},"kind":12,"definition":"sub","name":"clear_queues","containerName":"Net::IPBlocker","range":{"start":{"character":0,"line":1854},"end":{"character":9999,"line":1874}},"line":1854},{"kind":12,"name":"threads","line":1855},{"range":{"start":{"line":1876,"character":0},"end":{"line":1903,"character":9999}},"containerName":"Net::IPBlocker","line":1876,"name":"reload","definition":"sub","kind":12,"signature":{"label":"reload()","parameters":[],"documentation":""},"children":[{"kind":13,"line":1877,"containerName":"reload","name":"$TID","definition":"my","localvar":"my"},{"kind":12,"line":1877,"containerName":"reload","name":"tid"},{"kind":13,"line":1878,"containerName":"reload","name":"$TID"},{"kind":13,"name":"$TID","containerName":"reload","line":1878},{"kind":13,"name":"$logger","line":1879,"containerName":"reload"},{"kind":12,"name":"info","containerName":"reload","line":1879}],"detail":"()"},{"line":1877,"name":"threads","kind":12},{"children":[{"kind":13,"name":"$logger","containerName":"SIG_INT","line":1908},{"kind":12,"containerName":"SIG_INT","line":1908,"name":"info"}],"definition":"sub","name":"SIG_INT","range":{"start":{"line":1907,"character":0},"end":{"character":9999,"line":1911}},"line":1907,"containerName":"Net::IPBlocker","kind":12},{"range":{"start":{"character":0,"line":1915},"end":{"character":9999,"line":1918}},"line":1915,"containerName":"Net::IPBlocker","name":"SIG_HUP","definition":"sub","kind":12,"children":[{"containerName":"SIG_HUP","line":1916,"name":"$logger","kind":13},{"kind":12,"name":"info","line":1916,"containerName":"SIG_HUP"}]},{"containerName":"Net::IPBlocker","range":{"end":{"character":9999,"line":1925},"start":{"line":1922,"character":0}},"line":1922,"name":"SIG_TERM","definition":"sub","kind":12,"children":[{"kind":13,"name":"$logger","line":1923,"containerName":"SIG_TERM"},{"kind":12,"containerName":"SIG_TERM","line":1923,"name":"info"}]},{"children":[{"localvar":"my","line":1930,"containerName":"SIG_QUIT","definition":"my","name":"$self","kind":13}],"kind":12,"containerName":"Net::IPBlocker","range":{"start":{"character":0,"line":1929},"end":{"character":9999,"line":1932}},"line":1929,"name":"SIG_QUIT","definition":"sub"},{"children":[{"kind":13,"name":"$logger","line":1935,"containerName":"set_signal_handler"},{"line":1935,"containerName":"set_signal_handler","name":"info","kind":12},{"containerName":"set_signal_handler","line":1937,"name":"$SIG","kind":13},{"kind":13,"name":"$SIG","line":1938,"containerName":"set_signal_handler"},{"containerName":"set_signal_handler","line":1939,"name":"$SIG","kind":13},{"kind":13,"name":"$SIG","containerName":"set_signal_handler","line":1940}],"detail":"()","signature":{"parameters":[],"label":"set_signal_handler()","documentation":""},"kind":12,"line":1934,"range":{"end":{"line":1941,"character":9999},"start":{"character":0,"line":1934}},"containerName":"Net::IPBlocker","definition":"sub","name":"set_signal_handler"},{"line":1937,"name":"INT","kind":12},{"name":"TERM","line":1938,"kind":12},{"line":1939,"name":"HUP","kind":12},{"kind":12,"line":1940,"name":"QUIT"}]}