{"version":5,"vars":[{"kind":2,"name":"Net::IPBlocker","definition":1,"line":0},{"name":"strict","containerName":"","line":3,"kind":2},{"kind":2,"containerName":"","line":4,"name":"warnings"},{"kind":2,"containerName":"","line":5,"name":"POSIX"},{"kind":2,"line":6,"containerName":"","name":"DateTime"},{"line":7,"containerName":"File","name":"Basename","kind":2},{"kind":2,"line":8,"containerName":"List","name":"Util"},{"kind":2,"containerName":"Time","line":12,"name":"HiRes"},{"line":18,"containerName":"Config","name":"File","kind":2},{"name":"Carp","containerName":"","line":19,"kind":2},{"name":"Log4perl","line":20,"containerName":"Log","kind":2},{"line":21,"containerName":"Log","name":"Any","kind":2},{"kind":2,"containerName":"Data","line":22,"name":"Dumper"},{"name":"IPv6","line":23,"containerName":"Regexp","kind":2},{"kind":2,"containerName":"LockFile","line":24,"name":"Simple"},{"name":"Path","line":25,"containerName":"File","kind":2},{"line":26,"containerName":"Net::Ifconfig","name":"Wrapper","kind":2},{"name":"threads","line":29,"containerName":"","kind":2},{"name":"Queue","containerName":"Thread","line":31,"kind":2},{"kind":13,"containerName":null,"line":32,"definition":"my","name":"$DataQueue","localvar":"my"},{"kind":12,"containerName":"Queue","line":32,"name":"Thread"},{"name":"new","line":32,"containerName":"Net::IPBlocker","kind":12},{"kind":13,"definition":"my","name":"$LoggerTIDS","line":33,"containerName":null,"localvar":"my"},{"line":36,"containerName":null,"definition":"my","name":"$IptablesQueue","localvar":"my","kind":13},{"kind":12,"name":"Thread","line":36,"containerName":"Queue"},{"line":36,"containerName":"Net::IPBlocker","name":"new","kind":12},{"kind":13,"localvar":"my","definition":"my","name":"$IptablesTIDS","line":37,"containerName":null},{"kind":13,"name":"$Data","line":40,"containerName":null},{"line":40,"containerName":"Sortkeys","name":"Dumper","kind":12},{"kind":13,"line":41,"containerName":null,"name":"$Data"},{"containerName":"Indent","line":41,"name":"Dumper","kind":12},{"localvar":"my","containerName":null,"line":48,"definition":"my","name":"$logger","kind":13},{"localvar":"my","containerName":null,"line":51,"definition":"my","name":"$lock_obj","kind":13},{"localvar":"my","containerName":null,"line":56,"definition":"my","name":"$REGEX_IPV4","kind":13},{"localvar":"my","line":57,"containerName":null,"name":"$REGEX_IPV6","definition":"my","kind":13},{"kind":13,"containerName":null,"line":58,"definition":"my","name":"$IPTABLESRUNLINE","localvar":"my"},{"kind":13,"name":"%tracker","definition":"our","containerName":"Net::IPBlocker","line":62},{"containerName":null,"line":63,"name":"%DEFAULTS","definition":"my","localvar":"my","kind":13},{"kind":12,"name":"allowdeny","line":64},{"name":"allowlist","line":65,"kind":12},{"kind":12,"line":66,"name":"configsfile"},{"name":"cycles","line":67,"kind":12},{"kind":12,"line":67,"name":"LONG_MAX"},{"name":"cyclesleep","line":68,"kind":12},{"kind":12,"name":"dumpconfigsandexit","line":69},{"kind":12,"name":"denylist","line":70},{"kind":12,"name":"forceremovelockfile","line":71},{"name":"globalallowlist","line":72,"kind":12},{"kind":12,"line":73,"name":"chainprefix"},{"line":74,"name":"globalchains","kind":12},{"line":75,"name":"globaldenylist","kind":12},{"name":"globalregexallowlist","line":76,"kind":12},{"name":"globalregexdenylist","line":77,"kind":12},{"name":"ignoreinterfaceips","line":78,"kind":12},{"name":"iptables","line":79,"kind":12},{"kind":12,"line":80,"name":"lockfile"},{"kind":12,"name":"log4perlconf","line":81},{"kind":12,"line":82,"name":"loglevel"},{"kind":12,"line":86,"name":"logcontents"},{"line":87,"name":"logs_to_review","kind":12},{"kind":12,"name":"logwatch_interval","line":88},{"kind":12,"name":"prodmode","line":89},{"kind":12,"line":90,"name":"queuechecktime"},{"kind":12,"name":"queuecycles","line":91},{"kind":12,"line":91,"name":"LONG_MAX"},{"name":"readentirefile","line":92,"kind":12},{"kind":13,"containerName":"Net::IPBlocker","line":105,"name":"$VERSION","definition":"our"},{"children":[{"localvar":"my","definition":"my","name":"$class","line":342,"containerName":"new","kind":13},{"name":"$args","definition":"my","line":343,"containerName":"new","localvar":"my","kind":13},{"kind":13,"name":"$args","line":345,"containerName":"new"},{"name":"$args","containerName":"new","line":347,"kind":13},{"name":"$args","containerName":"new","line":349,"kind":13},{"kind":13,"localvar":"my","containerName":"new","line":354,"definition":"my","name":"$configsfile"},{"name":"$args","line":354,"containerName":"new","kind":13},{"name":"$DEFAULTS","line":354,"containerName":"new","kind":13},{"name":"$self","definition":"my","line":356,"containerName":"new","localvar":"my","kind":13},{"name":"$configsfile","line":357,"containerName":"new","kind":13},{"kind":13,"name":"$args","line":358,"containerName":"new"},{"kind":13,"name":"$self","containerName":"new","line":362},{"kind":13,"name":"$class","containerName":"new","line":362},{"line":366,"containerName":"new","name":"$self","kind":13},{"containerName":"new","line":366,"name":"load_configs","kind":12},{"kind":13,"line":368,"containerName":"new","name":"$self"},{"name":"$self","containerName":"new","line":370,"kind":13},{"kind":13,"line":371,"containerName":"new","name":"$self"},{"containerName":"new","line":372,"name":"$self","kind":13},{"name":"$self","containerName":"new","line":374,"kind":13},{"name":"$logger","line":379,"containerName":"new","kind":13},{"kind":13,"containerName":"new","line":379,"name":"$self"},{"name":"setup_Logger","line":379,"containerName":"new","kind":12},{"name":"$logger","line":380,"containerName":"new","kind":13},{"kind":12,"line":380,"containerName":"new","name":"info"},{"kind":13,"containerName":"new","line":381,"name":"$logger"},{"kind":12,"name":"debug","line":381,"containerName":"new"},{"kind":13,"containerName":"new","line":381,"name":"$self"},{"line":381,"containerName":"new","name":"$logger","kind":13},{"kind":12,"containerName":"new","line":381,"name":"is_debug"},{"containerName":"new","line":383,"name":"$self","kind":13}],"detail":"()","range":{"start":{"line":341,"character":0},"end":{"character":9999,"line":384}},"containerName":"Net::IPBlocker","line":341,"definition":"sub","name":"new","kind":12,"signature":{"label":"new()","parameters":[],"documentation":"1; # End of Net::IPBlocker\npackage Net::IPBlocker;\n\nuse 5.006;\nuse strict;\nuse warnings;\nuse POSIX qw(LONG_MAX);\nuse DateTime;\nuse File::Basename;\nuse List::Util qw(any);\n\n# use Getopt::Long;\n# use File::Lockfile;\nuse Time::HiRes qw(usleep gettimeofday time);\n\n# use Regexp::Common qw/ net number /;\n# use NetAddr::IP::Util qw(inet_ntoa);\n# use Net::DNS::Dig;\n# use Term::ANSIColor;\nuse Config::File;\nuse Carp;\nuse Log::Log4perl qw(get_logger :nowarn :levels);\nuse Log::Any qw($log);\nuse Data::Dumper;\nuse Regexp::IPv6     qw($IPv6_re);\nuse LockFile::Simple qw(lock trylock unlock);\nuse File::Path       qw(make_path);\nuse Net::Ifconfig::Wrapper;\n\n# Thread setup\nuse threads;\n# use threads::shared;\nuse Thread::Queue;\nmy $DataQueue  = Thread::Queue->new();\nmy $LoggerTIDS = ();                     # Thread IDs for tracking or whatever\n\n# Another queue for iptables commands\nmy $IptablesQueue = Thread::Queue->new();\nmy $IptablesTIDS  = ();                     # Thread IDs for tracking or whatever\n\n# Data Dumper setup\n$Data::Dumper::Sortkeys = 1;\n$Data::Dumper::Indent   = 1;\n\n### Global Variables  (clearly the threading stuff is global, duh)\n## I hate global variables!\n# logger --- I really debated whether to make this global or not.  I decided to make it global because it is used\n#   in the signal interupts and those use prototyped subs.  I don't know how (if possible) to pass $self to the\n#   signal interupt subs with so much threaded.\nmy $logger;      # This gets set after log4Perl is loaded in new()\n                 # Some might say to use 'our' instead of 'my' but does it matter when it is global to lexical scope of\n                 #   the package?\nmy $lock_obj;    # This is the lock object and is set in set_lockFile()\n                 # Needs to be global because it is used in the signal interupts and those use prototyped subs.\n## Regex for IPv4 and IPv6 capturing.\n#   This is critical and needs be consistent across the entire module\n# my $REGEX_IPV4 = q/.*\\b((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\\b.*/;\nmy $REGEX_IPV4 = q/\\b((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\\b/;\nmy $REGEX_IPV6      = q/\\b($IPv6_re)\\b/;\nmy $IPTABLESRUNLINE = 0;    #This is just an odd one.  It is used to track the line number of the sub iptables_thread()\n                            #  where run_iptables() is called.  This is used in the signal interupts to print out the\n                            #  line number of where the iptables command was run.  This is used for debugging.\n                            #  This is set in the iptables_thread() sub.\nour $tracker = {};          # Mostly chains added and rules added are stuffed in here for tracking purposes\nmy $DEFAULTS = {\n    allowdeny            => 'Allow,Deny',\n    allowlist            => {},\n    configsfile          => '/etc/ipblocker/ipblocker.conf',\n    cycles               => LONG_MAX,\n    cyclesleep           => 0.5,\n    dumpconfigsandexit   => 0,\n    denylist             => {},\n    forceremovelockfile  => 0,\n    globalallowlist      => {},\n    chainprefix          => \"IPBLOCKER_\",\n    globalchains         => [qw / INPUT OUTPUT FORWARD /],\n    globaldenylist       => {},\n    globalregexallowlist => {},\n    globalregexdenylist  => {},\n    ignoreinterfaceips   => 1,                                   #This adds the IPs from the interfaces to the allowlist\n    iptables             => '/sbin/iptables',\n    lockfile             => '/var/run/ipblocker.run.default',\n    log4perlconf         => '/etc/ipblocker/log4perl.conf',\n    loglevel             => 'Will use value from log4perl.conf', # Can be set from calling script.\n                                                                 #   If no value sent from calling script, then\n        #   use value from configs file.  If no value in configs file then I think the\n        #   Easy Init log4perl is used which defaults to DEBUG, i think.\n    logcontents       => {},\n    logs_to_review    => {},\n    logwatch_interval => 3,\n    prodmode          => 0,\n    queuechecktime    => 1,\n    queuecycles       => LONG_MAX,\n    readentirefile    => 0,\n};\n\n=head1 NAME\n\nNet::IPBlocker - Blocks IPs based on regex from specified log files\n\n=head1 VERSION\n\nVersion 0.01\n\n\nour $VERSION = '0.01';\n\n\n=head1 SYNOPSIS\n\nBlocks IPs based on Regular Expressions in specified log files.\n\n use Net::IPBlocker;\n my $foo = Net::IPBlocker->new();\n $foo->go(); \n\nYou can send all configs into the constructor as a hash, I really advise using a config file.  \nThe default config file is F</etc/ipblocker/ipblocker.conf> but you can set it to another file.\nIf a config file is not found, it will use default values for everything and that will probably not work very well.\n\n my $foo = Net::IPBlocker->new( { configsfile => '/etc/ipblocker/ipblocker.conf' } );\n $foo->go();\n\n=head2 Future Enhancements\n\n=over 4\n\n* * Add jail time for IPs\n\nThis involves adding a database to store the IPs and the time they were blocked.\nThis also means adding a mechanism to unblock IPs after a certain amount of time.\nLuckily, I have threaded this so adding that is just a matter of adding another thread.\nI am open to ideas of what database to use.  I am thinking SQLite.\nOr, possibly just a file with the IPs (the rule) and the time they are to be unblocked (deleted \nfrom iptables).\n\n* * Add synchronized appender logging:\n      \nhttps://metacpan.org/dist/Log-Log4perl/view/lib/Log/Log4perl/Appender/Synchronized.pm\n\n* * Fix the ability for Log4perl to re-read the \"log4perl.conf\" which seems to not work right now\n\n* * my $interfaces = Net::Ifconfig::Wrapper::Ifconfig('list', '', '', '');\n\nThis is a list of interfaces.  Need to figure out how to use this to get the IP address of the\ninterfaces.  Need to add those IPs to the global allow list.\n\n* * Fix sub add_ifconfig_ips_to_allowlist() to handle IPv4 and IPv6 addresses\n\n* * Change from using log4perl to Log::Any\n\n\n=head2 DESCRIPTION\n\nThis has been a very long running project of mine.  I have been using this script for years to block IPs and then \nrealized Fail2Ban exists.  I have tried to use Fail2Ban multiple times but it never seems to work right for me.\nIt seems to lock-up. \nThis module tries to incorporate the ideas of my past experience with the general idea of Fail2Ban.\n\nI highly encourage you to use a config file.  The default config file is in the same location as this module but you \ncan set it to another file.\n\nWhen installing this, you should also receive a script called \"ipBlocker.pl\".  This is a sample script that uses \nthis module.\n\nFinally, for now, this module use log4perl.  I didn't realize there was a heated debate about log4perl vs Log::Any vs \nwhatever else.  I am open to changing this to Log::Any but I need to figure out how to do that.\n\n=head1 SUBROUTINES/METHODS\n\n=head2 new\n\nReads configs, logging configs, sets up logging, sets up a class and returns a blessed object\nThe sub go() is where the action starts\n\nExample:\n\n  use IPblocker;\n\n  my $args = {\n    configsfile         => '/etc/ipblocker/ipblocker.conf',\n    dumpconfigsandexit  => '0', # True false value\n    forceremovelockfile => '0', # True false value\n    iptables            => 'sudo /sbin/iptables',\n    lockfile            => '/var/run/ipblocker.run',\n    log4perlconf        => '/etc/ipblocker/log4perl.conf',  #Can also be 0 to use default log4perl\n    loglevel            => 'DEBUG', # Can be TRACE DEBUG INFO WARN ERROR FATAL\n    prodmode            => '0', # True false value --- Determins if the iptables commands are actually run\n    queuechecktime      => '3', # How long to wait when the queue is empty before checking again. Any float value.\n    readentirefile      => '0', # True false value --- Determines if the entire log file is read or\n                                # new entries since last run are read.\n    cycles              => 'LONG_MAX', # How many times to run the main loop.  LONG_MAX is the default.\n  };\n\n  my $ipb    = IPblocker->new($args);\n  my $logger = $ipb->{logger};\n\n=head3 All arguments to new() and their defaults\n\n=head4 allowdeny\n\nallowdeny            => 'Allow,Deny',\n\nSet to 'Allow,Deny' or 'Deny,Allow' to determine the order of the allow and deny lists.\nSeteting to 'Allow,Deny' means the allow list is processed first and then the deny list is processed.\nMeaning, as an example, if 1.1.1.1 is on the allow list and allowdeny is set to Allow,Deny, then\nthe IP of 1.1.1.1 will never be blocked.  If allowdeny is set to Deny,Allow, then it is possible \nfor 1.1.1.1 to be blocked.\n\n=head4 allowlist\n\nallowlist            => {},\n\nA list of IPs to allow.  This is a hash reference.  The key is the order to allow the IP.  The value is the IP.\nExample:\n allowlist => (\n  '01' => '1.1.1.1',\n  '4' => '1.1.1.4',\n  '10' => '1.1.1.2',\n  '100' => '1.1.1.3',\n  \n )\n\nThe allow list is sorted in standard Perl sort order.  So, be sure to pad 0's or whatever to the front of the key.\n\n=head4 configsfile\n\nconfigsfile          => '/etc/ipblocker/ipblocker.conf',\n\nUse a config file!  This is the default config file location.  You can set it to another file.\n\n=head4 cycles\n\ncycles               => LONG_MAX,\n\nHow many times to run the main loop.  LONG_MAX is the default.  Why not infinity?  Because I don't want to.\n\n=head4 cyclesleep\n\ncyclesleep           => 0.5,\n\nHow long to sleep between cycles.  This is in seconds.  Default is 0.5 seconds.  You can use a float value.\n\n=head4 dumpconfigsandexit\n\ndumpconfigsandexit   => 0,\n\nIf set to 1 (true), then the configs are dumped to stdout and the script exits.  This is useful for creating a \nconfig file.\n\n=head4 denylist\n\ndenylist             => {},\n\nSimilar to allow list but for IPs to deny.  This is a hash reference.  The key is the order to deny the IP.\n\n=head4 forceremovelockfile\n\nforceremovelockfile  => 0,\n\nThis will force removal of lock file (if possible) before starting.  Seriously, you better know what you are doing.\n\n=head4 chainprefix\n\nchainprefix          => \"IPBLOCKER_\",\n\nThis is the prefix for the chains created in iptables.  This is the prefix you will see in iptables for \nall the chains created by this module.\n\n=head4 globalchains\n\nglobalchains         => [qw / INPUT OUTPUT FORWARD /],\n\nThis is a list of the global chains to add the global chain to.\nThe global chain is where all the subordinate file logger chains are added.\n\nI see some value in adding the global chain to some other chain but by default we add it to INPUT, OUTPUT, and FORWARD.\nOr, possibly, you don't want to add to the FORWARD chain.\nMaybe you onkly care about INPUT table.  I don't know.  Whatever works best for you.\n\n=head4 iptables\n\niptables             => '/sbin/iptables',\n\nThis is the iptables command to use.  You can use sudo or whatever you want.\nI really encourage using sudo but by default it is not used.  \nUsing sudo and non-root user is a bit more work.  You need to setup sudoers to allow the user to run iptables.\nHowever, I think it is worth it for an added measure of security.\nIf you change this to use sudo, then you may also need to change the lockfile location to a location that the user \ncan write to.\n\n=head4 lockfile\n\nlockfile             => '/var/run/ipblocker.run.default',\n\nThis is the lock file location to use to try to prevent multiple instances from running.\n\n=head4 log4perlconf\n\nlog4perlconf         => '/etc/ipblocker/log4perl.conf',\n\nThis is the log4perl configuration file to use.  You can also set this to 0 to use the default log4perl configuration.\n\n=head4 loglevel\n\nloglevel             => 'INFO'\n\nTHis can be TRACE DEBUG INFO WARN ERROR FATAL.\n\n=head4 prodmode\n\nprodmode          => 0,\n\nThis is a true/false value.  If set to 1 (true), then the iptables commands are actually run.  If set to 0 (false), \nthen the iptables commands are not run.  This is useful for testing.\n\nBy default, this is set to 0 (false).\n\n=head4 queuechecktime\n\nqueuechecktime    => 1,\n\nWhen the queue is empty, how long to wait before checking again.  When the queue is not empty, this value is ignored\n\n=head4 queuecycles\n\nqueuecycles       => LONG_MAX,\n\nHow many times to check the queue.  LONG_MAX is the default.  Why not infinity?  Because I don't want to.\n\n=head4 readentirefile\n\nreadentirefile    => 0,\n\nThis is a true/false value.  If set to 1 (true), then the entire log file is read.  If set to 0 (false), then only\nnew entries since the last run are read.\nThis can aslo be set per log file in the configs file."}},{"line":346,"name":"carp","kind":12},{"line":350,"name":"croak","kind":12},{"kind":12,"line":354,"name":"configsfile"},{"kind":12,"line":354,"name":"configsfile"},{"kind":12,"name":"configsfile","line":357},{"kind":12,"name":"clargs","line":358},{"line":368,"name":"configs","kind":12},{"kind":12,"line":368,"name":"dumpconfigsandexit"},{"kind":12,"line":370,"name":"configs"},{"name":"configsfile","line":370,"kind":12},{"kind":12,"line":371,"name":"configs"},{"line":371,"name":"globalchain","kind":12},{"name":"configs","line":372,"kind":12},{"name":"dumpconfigsandexit","line":372,"kind":12},{"name":"recursiveHashPrint","line":374,"kind":12},{"line":374,"name":"configs","kind":12},{"line":381,"name":"Dumper","kind":12},{"detail":"($ref,$prefix)","children":[{"kind":13,"localvar":"my","definition":"my","name":"$ref","containerName":"recursiveHashPrint","line":387},{"kind":13,"name":"$prefix","containerName":"recursiveHashPrint","line":387},{"name":"$prefix","containerName":"recursiveHashPrint","line":388,"kind":13},{"containerName":"recursiveHashPrint","line":388,"name":"$prefix","kind":13},{"name":"$ref","containerName":"recursiveHashPrint","line":390,"kind":13},{"localvar":"my","line":391,"containerName":"recursiveHashPrint","name":"$key","definition":"my","kind":13},{"kind":13,"name":"$ref","line":391,"containerName":"recursiveHashPrint"},{"localvar":"my","line":394,"containerName":"recursiveHashPrint","definition":"my","name":"$new_prefix","kind":13},{"name":"$prefix","containerName":"recursiveHashPrint","line":394,"kind":13},{"containerName":"recursiveHashPrint","line":395,"name":"$ref","kind":13},{"kind":13,"name":"$key","containerName":"recursiveHashPrint","line":395},{"containerName":"recursiveHashPrint","line":395,"name":"$new_prefix","kind":13}],"definition":"sub","name":"recursiveHashPrint","containerName":"Net::IPBlocker","range":{"end":{"character":9999,"line":397},"start":{"line":386,"character":0}},"line":386,"signature":{"documentation":"","parameters":[{"label":"$ref"},{"label":"$prefix"}],"label":"recursiveHashPrint($ref,$prefix)"},"kind":12},{"kind":13,"containerName":null,"line":398,"name":"%ref"},{"line":401,"containerName":null,"definition":"my","name":"$line","localvar":"my","kind":13},{"kind":13,"containerName":null,"line":401,"name":"$ref"},{"kind":13,"name":"$line","line":402,"containerName":null},{"kind":13,"name":"$line","line":403,"containerName":null},{"kind":13,"name":"%line","line":404,"containerName":null},{"kind":13,"localvar":"my","name":"$line","definition":"my","containerName":null,"line":408},{"name":"$line","line":409,"containerName":null,"kind":13},{"kind":13,"containerName":null,"line":410,"name":"$line"},{"containerName":null,"line":411,"name":"$line","kind":13},{"kind":12,"signature":{"documentation":"1; # End of Net::IPBlocker\npackage Net::IPBlocker;\n\nuse 5.006;\nuse strict;\nuse warnings;\nuse POSIX qw(LONG_MAX);\nuse DateTime;\nuse File::Basename;\nuse List::Util qw(any);\n\n# use Getopt::Long;\n# use File::Lockfile;\nuse Time::HiRes qw(usleep gettimeofday time);\n\n# use Regexp::Common qw/ net number /;\n# use NetAddr::IP::Util qw(inet_ntoa);\n# use Net::DNS::Dig;\n# use Term::ANSIColor;\nuse Config::File;\nuse Carp;\nuse Log::Log4perl qw(get_logger :nowarn :levels);\nuse Log::Any qw($log);\nuse Data::Dumper;\nuse Regexp::IPv6     qw($IPv6_re);\nuse LockFile::Simple qw(lock trylock unlock);\nuse File::Path       qw(make_path);\nuse Net::Ifconfig::Wrapper;\n\n# Thread setup\nuse threads;\n# use threads::shared;\nuse Thread::Queue;\nmy $DataQueue  = Thread::Queue->new();\nmy $LoggerTIDS = ();                     # Thread IDs for tracking or whatever\n\n# Another queue for iptables commands\nmy $IptablesQueue = Thread::Queue->new();\nmy $IptablesTIDS  = ();                     # Thread IDs for tracking or whatever\n\n# Data Dumper setup\n$Data::Dumper::Sortkeys = 1;\n$Data::Dumper::Indent   = 1;\n\n### Global Variables  (clearly the threading stuff is global, duh)\n## I hate global variables!\n# logger --- I really debated whether to make this global or not.  I decided to make it global because it is used\n#   in the signal interupts and those use prototyped subs.  I don't know how (if possible) to pass $self to the\n#   signal interupt subs with so much threaded.\nmy $logger;      # This gets set after log4Perl is loaded in new()\n                 # Some might say to use 'our' instead of 'my' but does it matter when it is global to lexical scope of\n                 #   the package?\nmy $lock_obj;    # This is the lock object and is set in set_lockFile()\n                 # Needs to be global because it is used in the signal interupts and those use prototyped subs.\n## Regex for IPv4 and IPv6 capturing.\n#   This is critical and needs be consistent across the entire module\n# my $REGEX_IPV4 = q/.*\\b((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\\b.*/;\nmy $REGEX_IPV4 = q/\\b((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\\b/;\nmy $REGEX_IPV6      = q/\\b($IPv6_re)\\b/;\nmy $IPTABLESRUNLINE = 0;    #This is just an odd one.  It is used to track the line number of the sub iptables_thread()\n                            #  where run_iptables() is called.  This is used in the signal interupts to print out the\n                            #  line number of where the iptables command was run.  This is used for debugging.\n                            #  This is set in the iptables_thread() sub.\nour $tracker = {};          # Mostly chains added and rules added are stuffed in here for tracking purposes\nmy $DEFAULTS = {\n    allowdeny            => 'Allow,Deny',\n    allowlist            => {},\n    configsfile          => '/etc/ipblocker/ipblocker.conf',\n    cycles               => LONG_MAX,\n    cyclesleep           => 0.5,\n    dumpconfigsandexit   => 0,\n    denylist             => {},\n    forceremovelockfile  => 0,\n    globalallowlist      => {},\n    chainprefix          => \"IPBLOCKER_\",\n    globalchains         => [qw / INPUT OUTPUT FORWARD /],\n    globaldenylist       => {},\n    globalregexallowlist => {},\n    globalregexdenylist  => {},\n    ignoreinterfaceips   => 1,                                   #This adds the IPs from the interfaces to the allowlist\n    iptables             => '/sbin/iptables',\n    lockfile             => '/var/run/ipblocker.run.default',\n    log4perlconf         => '/etc/ipblocker/log4perl.conf',\n    loglevel             => 'Will use value from log4perl.conf', # Can be set from calling script.\n                                                                 #   If no value sent from calling script, then\n        #   use value from configs file.  If no value in configs file then I think the\n        #   Easy Init log4perl is used which defaults to DEBUG, i think.\n    logcontents       => {},\n    logs_to_review    => {},\n    logwatch_interval => 3,\n    prodmode          => 0,\n    queuechecktime    => 1,\n    queuecycles       => LONG_MAX,\n    readentirefile    => 0,\n};\n\n=head1 NAME\n\nNet::IPBlocker - Blocks IPs based on regex from specified log files\n\n=head1 VERSION\n\nVersion 0.01\n\n\nour $VERSION = '0.01';\n\n\n=head1 SYNOPSIS\n\nBlocks IPs based on Regular Expressions in specified log files.\n\n use Net::IPBlocker;\n my $foo = Net::IPBlocker->new();\n $foo->go(); \n\nYou can send all configs into the constructor as a hash, I really advise using a config file.  \nThe default config file is F</etc/ipblocker/ipblocker.conf> but you can set it to another file.\nIf a config file is not found, it will use default values for everything and that will probably not work very well.\n\n my $foo = Net::IPBlocker->new( { configsfile => '/etc/ipblocker/ipblocker.conf' } );\n $foo->go();\n\n=head2 Future Enhancements\n\n=over 4\n\n* * Add jail time for IPs\n\nThis involves adding a database to store the IPs and the time they were blocked.\nThis also means adding a mechanism to unblock IPs after a certain amount of time.\nLuckily, I have threaded this so adding that is just a matter of adding another thread.\nI am open to ideas of what database to use.  I am thinking SQLite.\nOr, possibly just a file with the IPs (the rule) and the time they are to be unblocked (deleted \nfrom iptables).\n\n* * Add synchronized appender logging:\n      \nhttps://metacpan.org/dist/Log-Log4perl/view/lib/Log/Log4perl/Appender/Synchronized.pm\n\n* * Fix the ability for Log4perl to re-read the \"log4perl.conf\" which seems to not work right now\n\n* * my $interfaces = Net::Ifconfig::Wrapper::Ifconfig('list', '', '', '');\n\nThis is a list of interfaces.  Need to figure out how to use this to get the IP address of the\ninterfaces.  Need to add those IPs to the global allow list.\n\n* * Fix sub add_ifconfig_ips_to_allowlist() to handle IPv4 and IPv6 addresses\n\n* * Change from using log4perl to Log::Any\n\n\n=head2 DESCRIPTION\n\nThis has been a very long running project of mine.  I have been using this script for years to block IPs and then \nrealized Fail2Ban exists.  I have tried to use Fail2Ban multiple times but it never seems to work right for me.\nIt seems to lock-up. \nThis module tries to incorporate the ideas of my past experience with the general idea of Fail2Ban.\n\nI highly encourage you to use a config file.  The default config file is in the same location as this module but you \ncan set it to another file.\n\nWhen installing this, you should also receive a script called \"ipBlocker.pl\".  This is a sample script that uses \nthis module.\n\nFinally, for now, this module use log4perl.  I didn't realize there was a heated debate about log4perl vs Log::Any vs \nwhatever else.  I am open to changing this to Log::Any but I need to figure out how to do that.\n\n=head1 SUBROUTINES/METHODS\n\n=head2 new\n\nReads configs, logging configs, sets up logging, sets up a class and returns a blessed object\nThe sub go() is where the action starts\n\nExample:\n\n  use IPblocker;\n\n  my $args = {\n    configsfile         => '/etc/ipblocker/ipblocker.conf',\n    dumpconfigsandexit  => '0', # True false value\n    forceremovelockfile => '0', # True false value\n    iptables            => 'sudo /sbin/iptables',\n    lockfile            => '/var/run/ipblocker.run',\n    log4perlconf        => '/etc/ipblocker/log4perl.conf',  #Can also be 0 to use default log4perl\n    loglevel            => 'DEBUG', # Can be TRACE DEBUG INFO WARN ERROR FATAL\n    prodmode            => '0', # True false value --- Determins if the iptables commands are actually run\n    queuechecktime      => '3', # How long to wait when the queue is empty before checking again. Any float value.\n    readentirefile      => '0', # True false value --- Determines if the entire log file is read or\n                                # new entries since last run are read.\n    cycles              => 'LONG_MAX', # How many times to run the main loop.  LONG_MAX is the default.\n  };\n\n  my $ipb    = IPblocker->new($args);\n  my $logger = $ipb->{logger};\n\n=head3 All arguments to new() and their defaults\n\n=head4 allowdeny\n\nallowdeny            => 'Allow,Deny',\n\nSet to 'Allow,Deny' or 'Deny,Allow' to determine the order of the allow and deny lists.\nSeteting to 'Allow,Deny' means the allow list is processed first and then the deny list is processed.\nMeaning, as an example, if 1.1.1.1 is on the allow list and allowdeny is set to Allow,Deny, then\nthe IP of 1.1.1.1 will never be blocked.  If allowdeny is set to Deny,Allow, then it is possible \nfor 1.1.1.1 to be blocked.\n\n=head4 allowlist\n\nallowlist            => {},\n\nA list of IPs to allow.  This is a hash reference.  The key is the order to allow the IP.  The value is the IP.\nExample:\n allowlist => (\n  '01' => '1.1.1.1',\n  '4' => '1.1.1.4',\n  '10' => '1.1.1.2',\n  '100' => '1.1.1.3',\n  \n )\n\nThe allow list is sorted in standard Perl sort order.  So, be sure to pad 0's or whatever to the front of the key.\n\n=head4 configsfile\n\nconfigsfile          => '/etc/ipblocker/ipblocker.conf',\n\nUse a config file!  This is the default config file location.  You can set it to another file.\n\n=head4 cycles\n\ncycles               => LONG_MAX,\n\nHow many times to run the main loop.  LONG_MAX is the default.  Why not infinity?  Because I don't want to.\n\n=head4 cyclesleep\n\ncyclesleep           => 0.5,\n\nHow long to sleep between cycles.  This is in seconds.  Default is 0.5 seconds.  You can use a float value.\n\n=head4 dumpconfigsandexit\n\ndumpconfigsandexit   => 0,\n\nIf set to 1 (true), then the configs are dumped to stdout and the script exits.  This is useful for creating a \nconfig file.\n\n=head4 denylist\n\ndenylist             => {},\n\nSimilar to allow list but for IPs to deny.  This is a hash reference.  The key is the order to deny the IP.\n\n=head4 forceremovelockfile\n\nforceremovelockfile  => 0,\n\nThis will force removal of lock file (if possible) before starting.  Seriously, you better know what you are doing.\n\n=head4 chainprefix\n\nchainprefix          => \"IPBLOCKER_\",\n\nThis is the prefix for the chains created in iptables.  This is the prefix you will see in iptables for \nall the chains created by this module.\n\n=head4 globalchains\n\nglobalchains         => [qw / INPUT OUTPUT FORWARD /],\n\nThis is a list of the global chains to add the global chain to.\nThe global chain is where all the subordinate file logger chains are added.\n\nI see some value in adding the global chain to some other chain but by default we add it to INPUT, OUTPUT, and FORWARD.\nOr, possibly, you don't want to add to the FORWARD chain.\nMaybe you onkly care about INPUT table.  I don't know.  Whatever works best for you.\n\n=head4 iptables\n\niptables             => '/sbin/iptables',\n\nThis is the iptables command to use.  You can use sudo or whatever you want.\nI really encourage using sudo but by default it is not used.  \nUsing sudo and non-root user is a bit more work.  You need to setup sudoers to allow the user to run iptables.\nHowever, I think it is worth it for an added measure of security.\nIf you change this to use sudo, then you may also need to change the lockfile location to a location that the user \ncan write to.\n\n=head4 lockfile\n\nlockfile             => '/var/run/ipblocker.run.default',\n\nThis is the lock file location to use to try to prevent multiple instances from running.\n\n=head4 log4perlconf\n\nlog4perlconf         => '/etc/ipblocker/log4perl.conf',\n\nThis is the log4perl configuration file to use.  You can also set this to 0 to use the default log4perl configuration.\n\n=head4 loglevel\n\nloglevel             => 'INFO'\n\nTHis can be TRACE DEBUG INFO WARN ERROR FATAL.\n\n=head4 prodmode\n\nprodmode          => 0,\n\nThis is a true/false value.  If set to 1 (true), then the iptables commands are actually run.  If set to 0 (false), \nthen the iptables commands are not run.  This is useful for testing.\n\nBy default, this is set to 0 (false).\n\n=head4 queuechecktime\n\nqueuechecktime    => 1,\n\nWhen the queue is empty, how long to wait before checking again.  When the queue is not empty, this value is ignored\n\n=head4 queuecycles\n\nqueuecycles       => LONG_MAX,\n\nHow many times to check the queue.  LONG_MAX is the default.  Why not infinity?  Because I don't want to.\n\n=head4 readentirefile\n\nreadentirefile    => 0,\n\nThis is a true/false value.  If set to 1 (true), then the entire log file is read.  If set to 0 (false), then only\nnew entries since the last run are read.\nThis can aslo be set per log file in the configs file.\n\n\nsub new() {\n    my $class = shift;\n    my $args  = shift;\n\n    if ( !$args ) {\n        carp(\"No arguments passed to new().  This may not be an issue.\");\n        $args = {};\n    }\n    elsif ( ref($args) ne 'HASH' ) {\n        croak(\"Arguments passed to new() are not a hash reference\");\n    }\n\n    # Allow command line to override default configs file location\n    my $configsfile = $args->{configsfile} || $DEFAULTS->{configsfile};\n\n    my $self = {\n        configsfile => $configsfile,\n        clargs      => $args,\n    };\n\n    # Create the $self object\n    bless $self, $class;\n\n    # Load all the configs into the $self object under the configs key\n    # The sub load_configs() expects $self to be an object and have configsfile setup\n    $self->load_configs();\n\n    if ( $self->{configs}->{dumpconfigsandexit} ) {\n        ## Rip out some stuff that is used internally and not needed for the configs file\n        delete $self->{configs}->{configsfile};\n        delete $self->{configs}->{globalchain};\n        delete $self->{configs}->{dumpconfigsandexit};\n        print \"This can basically be copy/pasted into a config file:\\n\";\n        recursiveHashPrint( $self->{configs} );\n        exit;\n    } ## end if ( $self->{configs}->...)\n\n    # Setup logging.\n    $logger = $self->setup_Logger();\n    $logger->info(\"Logging initialized and ready to go\");\n    $logger->debug( \"Dumping self: \" . Dumper($self) ) if ( $logger->is_debug() );\n\n    return $self;\n} ## end sub new\n\nsub recursiveHashPrint {\n    my ( $ref, $prefix ) = @_;\n    $prefix = '' unless defined $prefix;    # Initialize prefix if not provided\n\n    if ( ref($ref) eq 'HASH' ) {\n        foreach my $key ( sort keys %{$ref} ) {\n\n            # Concatenate the current key to the prefix for the next level\n            my $new_prefix = $prefix ? \"$prefix][$key\" : \"[$key\";\n            recursiveHashPrint( $ref->{$key}, $new_prefix );\n        } ## end foreach my $key ( sort keys...)\n    } ## end if ( ref($ref) eq 'HASH')\n    elsif ( ref($ref) eq 'ARRAY' ) {\n\n        # If the reference is an array, join and print the elements\n        my $line = \"$prefix] = \" . join( ', ', @{$ref} ) . \"\\n\";\n        $line =~ s/\\[//;\n        $line =~ s/\\]//;\n        print $line;\n    } ## end elsif ( ref($ref) eq 'ARRAY')\n    else {\n        # Print the scalar value\n        my $line = \"$prefix]=$ref\\n\";\n        $line =~ s/\\[//;\n        $line =~ s/\\]//;\n        print $line;\n    } ## end else [ if ( ref($ref) eq 'HASH')]\n} ## end sub recursiveHashPrint\n\n=head2 go\n\nThis is where the action starts.  This is called from the script that uses this module after\nnew() is instantiated.\n\nThis creates a thread for each log watcher and a thread for the iptables queue watcher.\nIf you have 5 files to watch, then there will be 5 threads watching those files + 1 thread to add commands to \niptables.","label":"go()","parameters":[]},"definition":"sub","name":"go","range":{"start":{"character":0,"line":426},"end":{"line":482,"character":9999}},"line":426,"containerName":"Net::IPBlocker","detail":"()","children":[{"kind":13,"localvar":"my","line":427,"containerName":"go","definition":"my","name":"$self"},{"definition":"my","name":"$start_time","line":428,"containerName":"go","localvar":"my","kind":13},{"kind":13,"containerName":"go","line":431,"name":"$self"},{"name":"$logger","line":432,"containerName":"go","kind":13},{"line":432,"containerName":"go","name":"error","kind":12},{"kind":13,"name":"$self","line":437,"containerName":"go"},{"kind":12,"line":437,"containerName":"go","name":"set_iptables_command"},{"kind":13,"containerName":"go","line":437,"name":"$logger"},{"kind":12,"name":"error","line":437,"containerName":"go"},{"containerName":"go","line":438,"name":"$self","kind":13},{"kind":12,"name":"set_signal_handler","line":438,"containerName":"go"},{"kind":13,"containerName":"go","line":439,"name":"$self"},{"line":439,"containerName":"go","name":"$self","kind":13},{"containerName":"go","line":440,"name":"$self","kind":13},{"containerName":"go","line":440,"name":"set_lockFile","kind":12},{"name":"$logger","line":440,"containerName":"go","kind":13},{"kind":12,"containerName":"go","line":440,"name":"logdie"},{"localvar":"my","line":445,"containerName":"go","definition":"my","name":"$iptables_thr","kind":13},{"kind":12,"name":"create","containerName":"go","line":445},{"kind":13,"containerName":"go","line":445,"name":"$self"},{"kind":13,"name":"$self","line":448,"containerName":"go"},{"name":"add_global_chain","containerName":"go","line":448,"kind":12},{"kind":13,"name":"$self","containerName":"go","line":451},{"kind":12,"name":"add_global_allow_deny_ips","containerName":"go","line":451},{"kind":13,"name":"$logger","line":455,"containerName":"go"},{"line":455,"containerName":"go","name":"logdie","kind":12},{"containerName":"go","line":455,"name":"$self","kind":13},{"kind":12,"line":455,"containerName":"go","name":"logger_thread"},{"kind":13,"localvar":"my","definition":"my","name":"$cycles","containerName":"go","line":465},{"name":"$self","line":465,"containerName":"go","kind":13},{"kind":13,"containerName":"go","line":466,"name":"$cyclesleep","definition":"my","localvar":"my"},{"containerName":"go","line":466,"name":"$self","kind":13},{"kind":13,"name":"$cycles","line":467,"containerName":"go"},{"line":468,"containerName":"go","name":"$cycles","kind":13},{"name":"$cyclesleep","containerName":"go","line":469,"kind":13},{"kind":13,"localvar":"my","name":"$logmsg","definition":"my","containerName":"go","line":470},{"name":"$logmsg","line":471,"containerName":"go","kind":13},{"kind":13,"containerName":"go","line":471,"name":"$cycles"},{"name":"$logmsg","containerName":"go","line":472,"kind":13},{"line":473,"containerName":"go","name":"$logmsg","kind":13},{"kind":13,"containerName":"go","line":473,"name":"$cyclesleep"},{"name":"$logmsg","containerName":"go","line":474,"kind":13},{"kind":13,"containerName":"go","line":475,"name":"$logger"},{"kind":12,"containerName":"go","line":475,"name":"trace"},{"kind":13,"line":475,"containerName":"go","name":"$logmsg"},{"kind":13,"line":475,"containerName":"go","name":"$logger"},{"name":"is_debug","line":475,"containerName":"go","kind":12},{"localvar":"my","line":478,"containerName":"go","definition":"my","name":"$runtime","kind":13},{"line":478,"containerName":"go","name":"$start_time","kind":13},{"kind":13,"name":"$runtime","containerName":"go","line":479},{"name":"$runtime","line":479,"containerName":"go","kind":13},{"name":"$logger","containerName":"go","line":480,"kind":13},{"kind":12,"containerName":"go","line":480,"name":"info"},{"name":"$self","containerName":"go","line":481,"kind":13},{"kind":12,"containerName":"go","line":481,"name":"stop"}]},{"kind":12,"name":"configs","line":431},{"name":"logs_to_review","line":431,"kind":12},{"kind":12,"name":"configs","line":439},{"name":"globalchain","line":439,"kind":12},{"name":"configs","line":439,"kind":12},{"kind":12,"line":439,"name":"chainprefix"},{"kind":12,"name":"threads","line":445},{"kind":12,"line":445,"name":"iptables_thread"},{"kind":12,"name":"configs","line":465},{"line":465,"name":"cycles","kind":12},{"kind":12,"line":466,"name":"configs"},{"name":"cyclesleep","line":466,"kind":12},{"line":469,"name":"usleep","kind":12},{"children":[{"kind":13,"containerName":"iptables_thread","line":485,"definition":"my","name":"$self","localvar":"my"},{"localvar":"my","containerName":"iptables_thread","line":486,"name":"$TID","definition":"my","kind":13},{"name":"tid","containerName":"iptables_thread","line":486,"kind":12},{"name":"$TID","containerName":"iptables_thread","line":487,"kind":13},{"kind":13,"line":487,"containerName":"iptables_thread","name":"$TID"},{"kind":13,"localvar":"my","line":489,"containerName":"iptables_thread","name":"$cyclesleep","definition":"my"},{"name":"$self","containerName":"iptables_thread","line":489,"kind":13},{"name":"$cycles","definition":"my","containerName":"iptables_thread","line":490,"localvar":"my","kind":13},{"kind":13,"name":"$self","containerName":"iptables_thread","line":490},{"localvar":"my","name":"$logmsg","definition":"my","line":491,"containerName":"iptables_thread","kind":13},{"kind":13,"line":492,"containerName":"iptables_thread","name":"$logmsg"},{"kind":13,"name":"$logger","line":493,"containerName":"iptables_thread"},{"line":493,"containerName":"iptables_thread","name":"info","kind":12},{"kind":13,"name":"$logmsg","line":493,"containerName":"iptables_thread"},{"localvar":"my","name":"$iptablesQueue_pending","definition":"my","line":496,"containerName":"iptables_thread","kind":13},{"name":"$IptablesQueue","containerName":"iptables_thread","line":496,"kind":13},{"line":496,"containerName":"iptables_thread","name":"pending","kind":12},{"containerName":"iptables_thread","line":497,"name":"$iptablesQueue_pending","kind":13},{"line":498,"containerName":"iptables_thread","definition":"my","name":"$logmsg","localvar":"my","kind":13},{"kind":13,"name":"$logmsg","line":499,"containerName":"iptables_thread"},{"name":"$logger","line":500,"containerName":"iptables_thread","kind":13},{"kind":12,"name":"info","containerName":"iptables_thread","line":500},{"kind":13,"containerName":"iptables_thread","line":500,"name":"$logmsg"},{"kind":13,"line":504,"containerName":"iptables_thread","name":"$iptablesQueue_pending"},{"kind":13,"line":505,"containerName":"iptables_thread","name":"$logger"},{"name":"info","line":505,"containerName":"iptables_thread","kind":12},{"kind":13,"localvar":"my","containerName":"iptables_thread","line":506,"name":"$data","definition":"my"},{"name":"$IptablesQueue","containerName":"iptables_thread","line":506,"kind":13},{"kind":12,"line":506,"containerName":"iptables_thread","name":"dequeue"},{"containerName":"iptables_thread","line":507,"name":"$logger","kind":13},{"kind":12,"name":"debug","line":507,"containerName":"iptables_thread"},{"kind":13,"name":"$data","containerName":"iptables_thread","line":507},{"name":"$logger","line":507,"containerName":"iptables_thread","kind":13},{"kind":12,"name":"is_debug","line":507,"containerName":"iptables_thread"},{"kind":13,"containerName":"iptables_thread","line":508,"name":"$self"},{"name":"run_iptables","containerName":"iptables_thread","line":508,"kind":12},{"name":"$data","line":508,"containerName":"iptables_thread","kind":13},{"name":"$logger","containerName":"iptables_thread","line":508,"kind":13},{"kind":12,"name":"error","containerName":"iptables_thread","line":508},{"kind":13,"name":"$data","containerName":"iptables_thread","line":508},{"name":"$IPTABLESRUNLINE","line":509,"containerName":"iptables_thread","kind":13},{"kind":13,"name":"$IPTABLESRUNLINE","containerName":"iptables_thread","line":510},{"line":510,"containerName":"iptables_thread","name":"$IPTABLESRUNLINE","kind":13},{"kind":13,"containerName":"iptables_thread","line":512,"name":"$iptablesQueue_pending"},{"line":515,"containerName":"iptables_thread","name":"$logmsg","definition":"my","localvar":"my","kind":13},{"kind":13,"name":"$logmsg","line":516,"containerName":"iptables_thread"},{"kind":13,"line":516,"containerName":"iptables_thread","name":"$cyclesleep"},{"kind":13,"name":"$logmsg","containerName":"iptables_thread","line":517},{"line":518,"containerName":"iptables_thread","name":"$logger","kind":13},{"kind":12,"name":"info","line":518,"containerName":"iptables_thread"},{"name":"$logmsg","line":518,"containerName":"iptables_thread","kind":13},{"containerName":"iptables_thread","line":519,"name":"$cyclesleep","kind":13},{"containerName":"iptables_thread","line":522,"name":"$logger","kind":13},{"name":"error","containerName":"iptables_thread","line":522,"kind":12}],"detail":"()","signature":{"label":"iptables_thread()","parameters":[],"documentation":""},"kind":12,"range":{"end":{"character":9999,"line":526},"start":{"line":484,"character":0}},"containerName":"Net::IPBlocker","line":484,"name":"iptables_thread","definition":"sub"},{"name":"threads","line":486,"kind":12},{"kind":12,"name":"configs","line":489},{"kind":12,"line":489,"name":"queuechecktime"},{"kind":12,"line":490,"name":"configs"},{"line":490,"name":"queuecycles","kind":12},{"name":"Dumper","line":507,"kind":12},{"name":"Dumper","line":508,"kind":12},{"line":519,"name":"usleep","kind":12},{"signature":{"label":"add_ifconfig_ips_to_allowlist()","parameters":[],"documentation":" Description:  Adds IPs on the local interfaces to the global allowlist\n  This does not work becasue it only handles IPv4 addresses and other issues"},"kind":12,"range":{"start":{"character":0,"line":530},"end":{"character":9999,"line":558}},"line":530,"containerName":"Net::IPBlocker","name":"add_ifconfig_ips_to_allowlist","definition":"sub","children":[{"kind":13,"localvar":"my","definition":"my","name":"$self","line":531,"containerName":"add_ifconfig_ips_to_allowlist"}],"detail":"()"},{"range":{"start":{"line":608,"character":0},"end":{"character":9999,"line":633}},"line":608,"containerName":"Net::IPBlocker","definition":"sub","name":"setup_Logger","kind":12,"signature":{"documentation":" Unnecesary sub.  I am leaving it here for now in case I need it later.\n sub dataQueue_runner() {\n     my ($self) = @_;\n     my $TID = threads->tid;\n     $TID = \"TID: \" . $TID;\n     local $Data::Dumper::Terse  = 1;    # Disable use of $VARn\n     local $Data::Dumper::Indent = 0;    # Disable indentation\n     $logger->info(\"$TID|DataQueue runner\");\n     my $queuechecktime = $self->{configs}->{queuechecktime};\n     my $queuecycles    = $self->{configs}->{queuecycles};\n     while (1) {\n         my $dataqueue_pending = eval { $DataQueue->pending() };\n         unless ( defined $dataqueue_pending ) {\n             $logger->info(\"$TID|DataQueue is in an undefined state. This is probably intentional. Exiting the loop.\");\n             last;\n         }\n         if ( $dataqueue_pending > 0 ) {\n             $logger->info(\"$TID|Queue length of DataQueue is $dataqueue_pending\");\n             my $data = $DataQueue->dequeue();\n             ##### Need to add an 'if ( $data eq \"stop\" )' here to call sub stop() and gracefully exit\n             $logger->debug( \"$TID|Dequeued from DataQueue: \" . Dumper($data) ) if $logger->is_debug();\n         } ## end if ( $dataqueue_pending...)\n         elsif ( $dataqueue_pending == 0 ) {\n             my $logmsg = \"$TID|DataQueue depth: $dataqueue_pending.  Sleeping: $queuechecktime second(s).  \";\n             $logmsg .= \"Queue cycles remaining: $queuecycles\";\n             $logger->info($logmsg);\n             $queuecycles--;\n             last if ( $queuecycles <= 0 );\n             sleep $queuechecktime;\n         } ## end elsif ( $dataqueue_pending...)\n         else {\n             $logger->error(\"$TID|DataQueue is in an unknown state. Leaving queue watch due to an unknown issue.\");\n             last;\n         }\n     } ## end while (1)\n     $logger->info(\"$TID|DataQueue runner exiting\");\n } ## end sub dataQueue_runner\n Assumptions:\n   $self->{configs}->{log4perlconf} is set\n   $self->{configs}->{logwatch_interval} is set\n These assumptions *should* be true because this is called from new()","label":"setup_Logger()","parameters":[]},"children":[{"kind":13,"definition":"my","name":"$self","line":609,"containerName":"setup_Logger","localvar":"my"},{"kind":13,"localvar":"my","containerName":"setup_Logger","line":612,"name":"$log4perlconf","definition":"my"},{"kind":13,"name":"$self","line":612,"containerName":"setup_Logger"},{"kind":13,"localvar":"my","containerName":"setup_Logger","line":613,"name":"$logwatch_interval","definition":"my"},{"kind":13,"line":613,"containerName":"setup_Logger","name":"$self"},{"kind":12,"name":"init_and_watch","line":614,"containerName":"setup_Logger"},{"kind":13,"name":"$log4perlconf","containerName":"setup_Logger","line":614},{"kind":13,"containerName":"setup_Logger","line":614,"name":"$logwatch_interval"},{"kind":12,"containerName":"setup_Logger","line":618,"name":"easy_init"},{"containerName":"setup_Logger","line":618,"name":"$Log","kind":13},{"kind":13,"name":"$logger","containerName":"setup_Logger","line":620},{"line":621,"containerName":"setup_Logger","name":"$self","kind":13},{"name":"$logger","line":622,"containerName":"setup_Logger","kind":13},{"kind":12,"name":"level","containerName":"setup_Logger","line":622},{"kind":13,"name":"$self","line":622,"containerName":"setup_Logger"},{"kind":13,"name":"$logger","containerName":"setup_Logger","line":623},{"kind":12,"line":623,"containerName":"setup_Logger","name":"info"},{"line":623,"containerName":"setup_Logger","name":"$logger","kind":13},{"kind":12,"name":"level","line":623,"containerName":"setup_Logger"},{"name":"$logger","containerName":"setup_Logger","line":630,"kind":13},{"kind":12,"line":630,"containerName":"setup_Logger","name":"info"},{"line":632,"containerName":"setup_Logger","name":"$logger","kind":13}],"detail":"()"},{"kind":12,"name":"configs","line":612},{"name":"log4perlconf","line":612,"kind":12},{"name":"configs","line":613,"kind":12},{"name":"logwatch_interval","line":613,"kind":12},{"name":"Log","containerName":"Log4perl","line":614,"kind":12},{"line":616,"name":"carp","kind":12},{"kind":12,"name":"carp","line":617},{"name":"Log","containerName":"Log4perl","line":618,"kind":12},{"kind":12,"containerName":"DEBUG","line":618,"name":"Log4perl"},{"kind":12,"name":"get_logger","line":620},{"kind":12,"name":"croak","line":620},{"line":621,"name":"configs","kind":12},{"kind":12,"line":621,"name":"loglevel"},{"kind":12,"line":622,"name":"configs"},{"kind":12,"name":"loglevel","line":622},{"signature":{"label":"set_lockFile()","parameters":[],"documentation":" Set lock file\n   Returns 1 if lock file is set, otherwise returns 0\n   This is very important to get right.  If the lock file is not set, then multiple instances of this script can\n   cause problems.\n   Some of this is on the user but I'll try my best to make it so duplicate instances of this script can't run."},"kind":12,"definition":"sub","name":"set_lockFile","line":640,"range":{"end":{"character":9999,"line":682},"start":{"character":0,"line":640}},"containerName":"Net::IPBlocker","detail":"()","children":[{"localvar":"my","definition":"my","name":"$self","line":641,"containerName":"set_lockFile","kind":13},{"name":"$self","containerName":"set_lockFile","line":643,"kind":13},{"kind":13,"name":"$logger","containerName":"set_lockFile","line":644},{"name":"logdie","containerName":"set_lockFile","line":644,"kind":12},{"kind":13,"name":"$lockfile","definition":"my","containerName":"set_lockFile","line":647,"localvar":"my"},{"containerName":"set_lockFile","line":647,"name":"$self","kind":13},{"kind":13,"containerName":"set_lockFile","line":650,"definition":"my","name":"$lf","localvar":"my"},{"kind":13,"name":"$self","containerName":"set_lockFile","line":650},{"containerName":"set_lockFile","line":651,"name":"$logger","kind":13},{"name":"debug","containerName":"set_lockFile","line":651,"kind":12},{"kind":13,"containerName":"set_lockFile","line":653,"name":"$lf"},{"name":"$self","line":654,"containerName":"set_lockFile","kind":13},{"kind":13,"name":"$logger","containerName":"set_lockFile","line":655},{"kind":12,"name":"info","containerName":"set_lockFile","line":655},{"kind":13,"name":"$lf","line":656,"containerName":"set_lockFile"},{"kind":13,"line":656,"containerName":"set_lockFile","name":"$logger"},{"line":656,"containerName":"set_lockFile","name":"logdie","kind":12},{"kind":13,"containerName":"set_lockFile","line":659,"definition":"my","name":"$fh","localvar":"my"},{"name":"$lf","line":659,"containerName":"set_lockFile","kind":13},{"kind":13,"line":659,"containerName":"set_lockFile","name":"$logger"},{"name":"logdie","line":659,"containerName":"set_lockFile","kind":12},{"localvar":"my","containerName":"set_lockFile","line":660,"definition":"my","name":"@contents","kind":13},{"name":"$fh","line":660,"containerName":"set_lockFile","kind":13},{"kind":13,"name":"$fh","line":661,"containerName":"set_lockFile"},{"line":662,"containerName":"set_lockFile","name":"@contents","kind":13},{"localvar":"my","name":"$printable_contents","definition":"my","line":663,"containerName":"set_lockFile","kind":13},{"kind":13,"containerName":"set_lockFile","line":663,"name":"@contents"},{"kind":13,"definition":"my","name":"$logmsg","line":664,"containerName":"set_lockFile","localvar":"my"},{"kind":13,"line":665,"containerName":"set_lockFile","name":"$logger"},{"containerName":"set_lockFile","line":665,"name":"info","kind":12},{"kind":13,"containerName":"set_lockFile","line":665,"name":"$logmsg"},{"kind":13,"name":"$lf","line":669,"containerName":"set_lockFile"},{"kind":13,"name":"$logger","line":669,"containerName":"set_lockFile"},{"kind":12,"name":"logdie","containerName":"set_lockFile","line":669},{"kind":13,"name":"$self","containerName":"set_lockFile","line":672},{"kind":12,"name":"make","line":672,"containerName":"set_lockFile"},{"kind":13,"name":"$logger","line":675,"containerName":"set_lockFile"},{"kind":12,"line":675,"containerName":"set_lockFile","name":"debug"},{"kind":13,"name":"$self","line":675,"containerName":"set_lockFile"},{"name":"$logger","line":675,"containerName":"set_lockFile","kind":13},{"kind":12,"line":675,"containerName":"set_lockFile","name":"is_debug"},{"kind":13,"name":"$self","line":676,"containerName":"set_lockFile"},{"name":"$self","containerName":"set_lockFile","line":676,"kind":13},{"name":"lock","line":676,"containerName":"set_lockFile","kind":12},{"kind":13,"containerName":"set_lockFile","line":676,"name":"$lf"},{"kind":13,"containerName":"set_lockFile","line":677,"name":"$logger"},{"kind":12,"name":"logdie","containerName":"set_lockFile","line":677},{"kind":13,"containerName":"set_lockFile","line":678,"name":"$lock_obj"},{"kind":13,"name":"$self","containerName":"set_lockFile","line":678},{"kind":13,"name":"$logger","containerName":"set_lockFile","line":680},{"line":680,"containerName":"set_lockFile","name":"info","kind":12}]},{"name":"configs","line":643,"kind":12},{"kind":12,"name":"lockfile","line":643},{"line":647,"name":"configs","kind":12},{"kind":12,"name":"lockfile","line":647},{"name":"configs","line":650,"kind":12},{"kind":12,"name":"lockfile","line":650},{"line":654,"name":"configs","kind":12},{"kind":12,"line":654,"name":"forceremovelockfile"},{"line":672,"name":"lockmgr","kind":12},{"name":"LockFile","containerName":"Simple","line":672,"kind":12},{"kind":12,"line":675,"name":"Dumper"},{"kind":12,"name":"lockmgr","line":675},{"line":676,"name":"lock","kind":12},{"line":676,"name":"lockmgr","kind":12},{"kind":12,"name":"lock","line":678},{"kind":12,"signature":{"parameters":[],"label":"logger_thread()","documentation":"# Description: Creates a thread for each log file to review\n# Returns 1 or dies if thread can not be created"},"definition":"sub","name":"logger_thread","range":{"start":{"line":686,"character":0},"end":{"character":9999,"line":693}},"line":686,"containerName":"Net::IPBlocker","detail":"()","children":[{"localvar":"my","line":687,"containerName":"logger_thread","definition":"my","name":"$self","kind":13},{"kind":13,"line":689,"containerName":"logger_thread","definition":"my","name":"$logstoreview","localvar":"my"},{"name":"$self","containerName":"logger_thread","line":689,"kind":13},{"kind":13,"name":"$logstoreview","containerName":"logger_thread","line":690},{"kind":13,"line":693,"containerName":"logger_thread","definition":"my","name":"$logtoreview","localvar":"my"},{"kind":13,"name":"$logstoreview","containerName":"logger_thread","line":693}]},{"line":689,"name":"configs","kind":12},{"line":689,"name":"logs_to_review","kind":12},{"kind":13,"name":"$logger","containerName":null,"line":694},{"name":"info","containerName":"Net::IPBlocker","line":694,"kind":12},{"kind":13,"localvar":"my","definition":"my","name":"$logobj","line":695,"containerName":null},{"kind":13,"line":695,"containerName":null,"name":"%logstoreview"},{"name":"$logtoreview","line":695,"containerName":null,"kind":13},{"kind":13,"name":"%logobj","containerName":null,"line":696},{"line":696,"name":"chain","kind":12},{"kind":13,"line":696,"containerName":null,"name":"$logtoreview"},{"localvar":"my","line":698,"containerName":null,"name":"$thr","definition":"my","kind":13},{"line":698,"name":"threads","kind":12},{"kind":12,"name":"create","line":698,"containerName":"Net::IPBlocker"},{"kind":12,"name":"review_log","line":698},{"line":698,"containerName":null,"name":"$self","kind":13},{"kind":13,"name":"$logobj","containerName":null,"line":698},{"line":698,"containerName":null,"name":"$logger","kind":13},{"line":698,"containerName":"Net::IPBlocker","name":"logdie","kind":12},{"kind":13,"containerName":null,"line":699,"name":"$LoggerTIDS"},{"line":699,"containerName":null,"name":"$thr","kind":13},{"kind":12,"name":"tid","line":699,"containerName":"Net::IPBlocker"},{"name":"$logger","line":700,"containerName":null,"kind":13},{"containerName":"Net::IPBlocker","line":700,"name":"debug","kind":12},{"containerName":null,"line":700,"name":"$thr","kind":13},{"kind":12,"name":"tid","line":700,"containerName":"Net::IPBlocker"},{"kind":13,"containerName":null,"line":700,"name":"$logger"},{"kind":12,"line":700,"containerName":"Net::IPBlocker","name":"is_debug"},{"kind":13,"name":"$logger","line":701,"containerName":null},{"kind":12,"line":701,"containerName":"Net::IPBlocker","name":"debug"},{"containerName":null,"line":701,"name":"$thr","kind":13},{"containerName":"Net::IPBlocker","line":701,"name":"tid","kind":12},{"name":"$thr","containerName":null,"line":701,"kind":13},{"kind":12,"name":"is_running","containerName":"Net::IPBlocker","line":701},{"kind":13,"name":"$logger","containerName":null,"line":701},{"kind":12,"containerName":"Net::IPBlocker","line":701,"name":"is_debug"},{"detail":"()","children":[{"kind":13,"localvar":"my","definition":"my","name":"$self","line":710,"containerName":"prepare_directions"},{"kind":13,"name":"$logobj","containerName":"prepare_directions","line":710},{"localvar":"my","containerName":"prepare_directions","line":711,"definition":"my","name":"$TID","kind":13},{"name":"tid","line":711,"containerName":"prepare_directions","kind":12},{"line":712,"containerName":"prepare_directions","name":"$TID","kind":13},{"kind":13,"line":712,"containerName":"prepare_directions","name":"$TID"},{"name":"@directions","definition":"my","containerName":"prepare_directions","line":714,"localvar":"my","kind":13},{"kind":13,"name":"$logobj","line":714,"containerName":"prepare_directions"},{"line":714,"containerName":"prepare_directions","name":"$logobj","kind":13},{"kind":13,"name":"@directions","line":715,"containerName":"prepare_directions"},{"kind":13,"containerName":"prepare_directions","line":715,"name":"@directions"},{"kind":13,"containerName":"prepare_directions","line":716,"name":"@directions"},{"containerName":"prepare_directions","line":716,"name":"@directions","kind":13},{"kind":13,"name":"@directions","line":717,"containerName":"prepare_directions"},{"kind":13,"name":"@directions","line":717,"containerName":"prepare_directions"},{"name":"@directions","containerName":"prepare_directions","line":718,"kind":13},{"kind":13,"name":"@directions","containerName":"prepare_directions","line":718},{"name":"@directions","containerName":"prepare_directions","line":719,"kind":13}],"name":"prepare_directions","definition":"sub","range":{"start":{"character":0,"line":709},"end":{"character":9999,"line":720}},"containerName":"Net::IPBlocker","line":709,"kind":12,"signature":{"label":"prepare_directions()","parameters":[],"documentation":""}},{"line":711,"name":"threads","kind":12},{"line":714,"name":"directions","kind":12},{"kind":12,"name":"directions","line":714},{"kind":12,"line":717,"name":"any"},{"definition":"sub","name":"review_log","line":728,"range":{"start":{"character":0,"line":728},"end":{"character":9999,"line":843}},"containerName":"Net::IPBlocker","signature":{"documentation":" This is called as a thread and runs a loop to check the log file for new entries\n   Prior to checking the log file, it creates a chain for the log file and adds it to the global chain\n This entire sub needs to be refactored.\n It's easy to folllw but it is:\n  a) just too many lines for one sub\n  b) the for loops nesting is just too much","parameters":[],"label":"review_log()"},"kind":12,"detail":"()","children":[{"kind":13,"definition":"my","name":"$self","line":729,"containerName":"review_log","localvar":"my"},{"line":729,"containerName":"review_log","name":"$logobj","kind":13},{"localvar":"my","line":730,"containerName":"review_log","name":"$TID","definition":"my","kind":13},{"kind":12,"line":730,"containerName":"review_log","name":"tid"},{"kind":13,"name":"$TID","containerName":"review_log","line":731},{"kind":13,"name":"$TID","containerName":"review_log","line":731},{"localvar":"my","name":"$start_time","definition":"my","containerName":"review_log","line":732,"kind":13},{"kind":13,"line":734,"containerName":"review_log","name":"$logobj"},{"kind":13,"name":"$chain","definition":"my","containerName":"review_log","line":735,"localvar":"my"},{"name":"$self","line":735,"containerName":"review_log","kind":13},{"name":"$logobj","containerName":"review_log","line":735,"kind":13},{"kind":13,"name":"$logger","containerName":"review_log","line":736},{"kind":12,"line":736,"containerName":"review_log","name":"info"},{"kind":13,"name":"$logger","line":737,"containerName":"review_log"},{"kind":12,"line":737,"containerName":"review_log","name":"debug"},{"name":"$logobj","line":737,"containerName":"review_log","kind":13},{"kind":13,"name":"$logger","containerName":"review_log","line":737},{"line":737,"containerName":"review_log","name":"is_debug","kind":12},{"line":740,"containerName":"review_log","definition":"my","name":"$cycles","localvar":"my","kind":13},{"containerName":"review_log","line":740,"name":"$logobj","kind":13},{"kind":13,"line":741,"containerName":"review_log","name":"$cyclesleep","definition":"my","localvar":"my"},{"kind":13,"name":"$logobj","line":741,"containerName":"review_log"},{"line":742,"containerName":"review_log","name":"$microcyclesleep","definition":"my","localvar":"my","kind":13},{"kind":13,"containerName":"review_log","line":742,"name":"$cyclesleep"},{"name":"$logger","line":744,"containerName":"review_log","kind":13},{"kind":12,"name":"info","containerName":"review_log","line":744},{"kind":13,"name":"$logger","line":749,"containerName":"review_log"},{"kind":12,"line":749,"containerName":"review_log","name":"info"},{"kind":13,"name":"$self","line":750,"containerName":"review_log"},{"kind":12,"line":750,"containerName":"review_log","name":"add_chain"},{"kind":13,"containerName":"review_log","line":750,"name":"$chain"},{"kind":13,"name":"$globalchain","definition":"my","line":753,"containerName":"review_log","localvar":"my"},{"kind":13,"name":"$self","line":753,"containerName":"review_log"},{"line":754,"containerName":"review_log","name":"$logger","kind":13},{"name":"debug","line":754,"containerName":"review_log","kind":12},{"kind":13,"name":"$self","line":755,"containerName":"review_log"},{"kind":12,"name":"iptablesqueue_enqueue","containerName":"review_log","line":755},{"line":757,"containerName":"review_log","name":"$self","kind":13},{"kind":12,"name":"add_logger_allow_deny_ips","line":757,"containerName":"review_log"},{"name":"$logobj","line":757,"containerName":"review_log","kind":13},{"kind":13,"definition":"my","name":"@directions","line":760,"containerName":"review_log","localvar":"my"},{"kind":13,"line":760,"containerName":"review_log","name":"$self"},{"kind":12,"name":"prepare_directions","containerName":"review_log","line":760},{"name":"$logobj","line":760,"containerName":"review_log","kind":13},{"localvar":"my","definition":"my","name":"@protocols","line":761,"containerName":"review_log","kind":13},{"kind":13,"line":761,"containerName":"review_log","name":"$logobj"},{"kind":13,"line":761,"containerName":"review_log","name":"$logobj"},{"kind":13,"localvar":"my","name":"$ports","definition":"my","line":762,"containerName":"review_log"},{"kind":13,"containerName":"review_log","line":762,"name":"$logobj"},{"kind":13,"name":"$cycles","line":764,"containerName":"review_log"},{"kind":13,"localvar":"my","containerName":"review_log","line":765,"name":"$start_loop_time","definition":"my"},{"kind":13,"containerName":"review_log","line":766,"name":"$logger"},{"name":"info","line":766,"containerName":"review_log","kind":12},{"containerName":"review_log","line":767,"name":"$logobj","kind":13},{"kind":13,"name":"$self","line":767,"containerName":"review_log"},{"line":767,"containerName":"review_log","name":"readlogfile","kind":12},{"name":"$logobj","line":767,"containerName":"review_log","kind":13},{"kind":13,"line":768,"containerName":"review_log","name":"$logobj"},{"kind":13,"name":"$self","line":768,"containerName":"review_log"},{"containerName":"review_log","line":768,"name":"_grep_regexps","kind":12},{"kind":13,"name":"$logobj","containerName":"review_log","line":768},{"line":768,"containerName":"review_log","name":"$logobj","kind":13},{"kind":13,"name":"$logger","line":772,"containerName":"review_log"},{"kind":12,"name":"debug","containerName":"review_log","line":772},{"name":"$logobj","containerName":"review_log","line":772,"kind":13},{"name":"$logger","containerName":"review_log","line":773,"kind":13},{"kind":12,"containerName":"review_log","line":773,"name":"is_debug"},{"kind":13,"localvar":"my","containerName":"review_log","line":775,"name":"@rules","definition":"my"},{"kind":13,"definition":"my","name":"$ip","line":776,"containerName":"review_log","localvar":"my"},{"name":"$logobj","line":776,"containerName":"review_log","kind":13},{"kind":13,"name":"$logger","containerName":"review_log","line":777},{"kind":12,"name":"debug","containerName":"review_log","line":777},{"kind":13,"localvar":"my","line":779,"containerName":"review_log","definition":"my","name":"$direction"},{"kind":13,"containerName":"review_log","line":779,"name":"@directions"},{"kind":13,"name":"$direction_switch","definition":"my","line":780,"containerName":"review_log","localvar":"my"},{"kind":13,"containerName":"review_log","line":780,"name":"$direction"},{"kind":13,"definition":"my","name":"$randval","line":781,"containerName":"review_log","localvar":"my"},{"kind":13,"line":782,"containerName":"review_log","name":"$direction_switch"},{"name":"$direction","line":782,"containerName":"review_log","kind":13},{"line":783,"containerName":"review_log","name":"$logger","kind":13},{"kind":12,"line":783,"containerName":"review_log","name":"info"},{"localvar":"my","name":"$base_rule","definition":"my","line":784,"containerName":"review_log","kind":13},{"kind":13,"name":"$logger","line":785,"containerName":"review_log"},{"line":785,"containerName":"review_log","name":"debug","kind":12},{"kind":13,"line":787,"containerName":"review_log","name":"@protocols"},{"containerName":"review_log","line":788,"definition":"my","name":"$protocol","localvar":"my","kind":13},{"kind":13,"containerName":"review_log","line":788,"name":"@protocols"},{"kind":13,"containerName":"review_log","line":789,"name":"$rule","definition":"my","localvar":"my"},{"kind":13,"name":"$base_rule","line":789,"containerName":"review_log"},{"name":"$logger","containerName":"review_log","line":790,"kind":13},{"line":790,"containerName":"review_log","name":"debug","kind":12},{"name":"$logobj","line":791,"containerName":"review_log","kind":13},{"line":795,"containerName":"review_log","name":"$rule","kind":13},{"name":"$logger","line":797,"containerName":"review_log","kind":13},{"name":"debug","containerName":"review_log","line":797,"kind":12},{"name":"@rules","containerName":"review_log","line":798,"kind":13},{"kind":13,"name":"$logger","line":802,"containerName":"review_log"},{"kind":12,"line":802,"containerName":"review_log","name":"debug"},{"containerName":"review_log","line":803,"name":"@rules","kind":13},{"kind":13,"line":808,"containerName":"review_log","name":"$logger"},{"kind":12,"line":808,"containerName":"review_log","name":"debug"},{"kind":13,"line":808,"containerName":"review_log","name":"@rules"},{"kind":13,"containerName":"review_log","line":809,"name":"$logger"},{"containerName":"review_log","line":809,"name":"is_debug","kind":12},{"kind":13,"localvar":"my","definition":"my","name":"$eject","containerName":"review_log","line":810},{"kind":13,"name":"$rule","definition":"my","line":811,"containerName":"review_log","localvar":"my"},{"name":"@rules","containerName":"review_log","line":811,"kind":13},{"name":"$tracker","containerName":"review_log","line":812,"kind":13},{"kind":13,"containerName":"review_log","line":813,"name":"$logger"},{"line":813,"containerName":"review_log","name":"debug","kind":12},{"localvar":"my","containerName":"review_log","line":816,"name":"$args","definition":"my","kind":13},{"name":"$logger","containerName":"review_log","line":820,"kind":13},{"name":"debug","containerName":"review_log","line":820,"kind":12},{"containerName":"review_log","line":821,"name":"$tracker","kind":13},{"kind":13,"line":824,"containerName":"review_log","name":"$self"},{"kind":12,"name":"iptablesqueue_enqueue","line":824,"containerName":"review_log"},{"kind":13,"line":824,"containerName":"review_log","name":"$args"},{"name":"$eject","line":824,"containerName":"review_log","kind":13},{"kind":13,"localvar":"my","line":827,"containerName":"review_log","name":"$logmsg","definition":"my"},{"kind":13,"name":"$eject","line":828,"containerName":"review_log"},{"name":"$logger","line":828,"containerName":"review_log","kind":13},{"name":"info","line":828,"containerName":"review_log","kind":12},{"name":"$logmsg","line":828,"containerName":"review_log","kind":13},{"line":830,"containerName":"review_log","name":"$logobj","kind":13},{"name":"$self","containerName":"review_log","line":834,"kind":13},{"name":"iptablesqueue_enqueue","containerName":"review_log","line":834,"kind":12},{"kind":13,"line":836,"containerName":"review_log","name":"$timediff","definition":"my","localvar":"my"},{"name":"$start_loop_time","line":836,"containerName":"review_log","kind":13},{"kind":13,"name":"$timediff","containerName":"review_log","line":837},{"containerName":"review_log","line":837,"name":"$timediff","kind":13},{"containerName":"review_log","line":838,"name":"$logger","kind":13},{"kind":12,"name":"info","containerName":"review_log","line":838},{"kind":13,"name":"$cycles","line":840,"containerName":"review_log"},{"name":"$logger","line":841,"containerName":"review_log","kind":13},{"kind":12,"containerName":"review_log","line":841,"name":"info"},{"name":"$microcyclesleep","line":842,"containerName":"review_log","kind":13}]},{"name":"threads","line":730,"kind":12},{"name":"configs","line":735,"kind":12},{"name":"chainprefix","line":735,"kind":12},{"name":"chain","line":735,"kind":12},{"kind":12,"line":737,"name":"Dumper"},{"name":"cycles","line":740,"kind":12},{"name":"LONG_MAX","line":740,"kind":12},{"kind":12,"line":741,"name":"cyclesleep"},{"kind":12,"line":753,"name":"configs"},{"kind":12,"name":"globalchain","line":753},{"kind":12,"name":"options","line":755},{"line":755,"name":"rule","kind":12},{"kind":12,"name":"protocols","line":761},{"kind":12,"line":761,"name":"protocols"},{"kind":12,"name":"ports","line":762},{"name":"ips_to_block","line":768,"kind":12},{"kind":12,"line":768,"name":"logcontents"},{"line":772,"name":"Dumper","kind":12},{"kind":12,"line":772,"name":"ips_to_block"},{"kind":12,"name":"ips_to_block","line":776},{"name":"ports","line":791,"kind":12},{"kind":12,"name":"Dumper","line":808},{"line":812,"name":"iptables_rules","kind":12},{"line":817,"name":"options","kind":12},{"line":818,"name":"rule","kind":12},{"line":821,"name":"iptables_rules","kind":12},{"line":830,"name":"ips_to_block","kind":12},{"name":"check_pending","line":834,"kind":12},{"kind":12,"line":842,"name":"usleep"},{"kind":13,"localvar":"my","line":845,"containerName":null,"name":"$runtime","definition":"my"},{"kind":13,"containerName":null,"line":845,"name":"$start_time"},{"kind":13,"name":"$runtime","line":846,"containerName":null},{"kind":13,"name":"$runtime","line":846,"containerName":null},{"kind":13,"localvar":"my","name":"$cycles_completed","definition":"my","line":847,"containerName":null},{"name":"%logobj","line":847,"containerName":null,"kind":13},{"line":847,"name":"cycles","kind":12},{"kind":13,"line":847,"containerName":null,"name":"$cycles"},{"kind":13,"containerName":null,"line":848,"definition":"my","name":"$logmsg","localvar":"my"},{"line":849,"containerName":null,"name":"$logmsg","kind":13},{"name":"$logger","containerName":null,"line":850,"kind":13},{"kind":12,"line":850,"containerName":"Net::IPBlocker","name":"info"},{"kind":13,"name":"$logmsg","line":850,"containerName":null},{"children":[{"kind":13,"localvar":"my","definition":"my","name":"$self","containerName":"load_configs","line":856},{"localvar":"my","containerName":"load_configs","line":857,"name":"$configsfile","definition":"my","kind":13},{"kind":13,"line":857,"containerName":"load_configs","name":"$self"},{"kind":13,"localvar":"my","name":"$clargs","definition":"my","line":858,"containerName":"load_configs"},{"name":"$self","line":858,"containerName":"load_configs","kind":13},{"line":860,"containerName":"load_configs","name":"$configsfile","kind":13},{"kind":13,"name":"$self","containerName":"load_configs","line":863},{"name":"$self","line":863,"containerName":"load_configs","kind":13},{"name":"$self","containerName":"load_configs","line":864,"kind":13},{"kind":13,"name":"$self","containerName":"load_configs","line":864},{"containerName":"load_configs","line":865,"name":"$self","kind":13},{"line":870,"containerName":"load_configs","name":"$msg","definition":"my","localvar":"my","kind":13},{"kind":13,"containerName":"load_configs","line":871,"name":"$msg"},{"kind":13,"containerName":"load_configs","line":872,"name":"$msg"},{"kind":13,"name":"$clargs","line":872,"containerName":"load_configs"},{"name":"$msg","line":873,"containerName":"load_configs","kind":13},{"containerName":"load_configs","line":873,"name":"$DEFAULTS","kind":13},{"kind":13,"containerName":"load_configs","line":874,"name":"$msg"},{"line":875,"containerName":"load_configs","name":"$msg","kind":13},{"name":"$msg","containerName":"load_configs","line":876,"kind":13},{"kind":13,"localvar":"my","name":"$config","definition":"my","line":879,"containerName":"load_configs"},{"kind":13,"line":879,"containerName":"load_configs","name":"$DEFAULTS"}],"kind":12,"definition":"sub","name":"load_configs","line":855,"range":{"start":{"character":0,"line":855},"end":{"character":9999,"line":879}},"containerName":"Net::IPBlocker"},{"kind":12,"line":857,"name":"configsfile"},{"name":"clargs","line":858,"kind":12},{"name":"configs","line":863,"kind":12},{"line":863,"containerName":"File::read_config_file","name":"Config","kind":12},{"kind":12,"line":863,"name":"configsfile"},{"kind":12,"name":"configs","line":864},{"kind":12,"line":864,"name":"globalchain"},{"kind":12,"line":864,"name":"configs"},{"kind":12,"line":864,"name":"globalchain"},{"kind":12,"name":"configs","line":865},{"kind":12,"line":865,"name":"globalchain"},{"line":872,"name":"Dumper","kind":12},{"line":873,"name":"Dumper","kind":12},{"kind":12,"line":875,"name":"carp"},{"line":883,"containerName":null,"name":"%self","kind":13},{"line":883,"name":"configs","kind":12},{"kind":13,"line":883,"containerName":null,"name":"$config"},{"kind":13,"name":"%clargs","line":884,"containerName":null},{"line":884,"containerName":null,"name":"$config","kind":13},{"kind":13,"name":"%clargs","line":885,"containerName":null},{"kind":13,"containerName":null,"line":885,"name":"$config"},{"kind":13,"containerName":null,"line":886,"name":"%self"},{"line":886,"name":"configs","kind":12},{"name":"$config","line":886,"containerName":null,"kind":13},{"kind":13,"containerName":null,"line":886,"name":"%DEFAULTS"},{"kind":13,"containerName":null,"line":886,"name":"$config"},{"name":"%self","containerName":null,"line":889,"kind":13},{"name":"configs","line":889,"kind":12},{"detail":"()","children":[{"kind":13,"localvar":"my","line":894,"containerName":"reverseMapHash","definition":"my","name":"$self"},{"localvar":"my","definition":"my","name":"$hash","line":895,"containerName":"reverseMapHash","kind":13},{"localvar":"my","containerName":"reverseMapHash","line":899,"definition":"my","name":"$new_hash","kind":13},{"localvar":"my","containerName":"reverseMapHash","line":900,"definition":"my","name":"$key","kind":13},{"kind":13,"name":"$hash","line":900,"containerName":"reverseMapHash"}],"name":"reverseMapHash","definition":"sub","line":893,"range":{"start":{"line":893,"character":0},"end":{"character":9999,"line":900}},"containerName":"Net::IPBlocker","kind":12,"signature":{"label":"reverseMapHash()","parameters":[],"documentation":" Special helper function for clean_ips_to_block()"}},{"kind":13,"name":"%new_hash","line":901,"containerName":null},{"name":"%hash","line":901,"containerName":null,"kind":13},{"kind":13,"name":"$key","line":901,"containerName":null},{"kind":13,"name":"$new_hash","line":905,"containerName":null},{"children":[{"kind":13,"localvar":"my","containerName":"clean_ips_to_block_combined","line":911,"definition":"my","name":"$self"},{"localvar":"my","name":"$logobj","definition":"my","line":912,"containerName":"clean_ips_to_block_combined","kind":13},{"definition":"my","name":"$TID","line":913,"containerName":"clean_ips_to_block_combined","localvar":"my","kind":13},{"name":"tid","line":913,"containerName":"clean_ips_to_block_combined","kind":12},{"name":"$TID","containerName":"clean_ips_to_block_combined","line":914,"kind":13},{"name":"$TID","line":914,"containerName":"clean_ips_to_block_combined","kind":13},{"containerName":"clean_ips_to_block_combined","line":916,"name":"$Data","kind":13},{"name":"$Data","containerName":"clean_ips_to_block_combined","line":917,"kind":13}],"detail":"()","kind":12,"signature":{"documentation":" Description: Combines the IPs from regex from the log to be blocked and the IPs from the allow/deny lists into\n               one hash","parameters":[],"label":"clean_ips_to_block_combined()"},"containerName":"Net::IPBlocker","range":{"end":{"character":9999,"line":919},"start":{"line":910,"character":0}},"line":910,"definition":"sub","name":"clean_ips_to_block_combined"},{"kind":12,"name":"threads","line":913},{"line":916,"containerName":"Terse","name":"Dumper","kind":12},{"name":"Dumper","line":917,"containerName":"Indent","kind":12},{"children":[{"definition":"my","name":"$self","line":925,"containerName":"clean_ips_to_block_allowdeny","localvar":"my","kind":13},{"name":"$logobj","definition":"my","line":926,"containerName":"clean_ips_to_block_allowdeny","localvar":"my","kind":13},{"containerName":"clean_ips_to_block_allowdeny","line":927,"name":"$TID","definition":"my","localvar":"my","kind":13},{"name":"tid","containerName":"clean_ips_to_block_allowdeny","line":927,"kind":12},{"line":928,"containerName":"clean_ips_to_block_allowdeny","name":"$TID","kind":13},{"kind":13,"line":928,"containerName":"clean_ips_to_block_allowdeny","name":"$TID"},{"line":930,"containerName":"clean_ips_to_block_allowdeny","name":"$Data","kind":13},{"line":931,"containerName":"clean_ips_to_block_allowdeny","name":"$Data","kind":13},{"name":"$allowdeny","definition":"my","line":935,"containerName":"clean_ips_to_block_allowdeny","localvar":"my","kind":13},{"kind":13,"name":"$logobj","containerName":"clean_ips_to_block_allowdeny","line":935},{"containerName":"clean_ips_to_block_allowdeny","line":935,"name":"$self","kind":13},{"containerName":"clean_ips_to_block_allowdeny","line":936,"name":"$logobj_allowlist","definition":"my","localvar":"my","kind":13},{"kind":13,"name":"$logobj","line":936,"containerName":"clean_ips_to_block_allowdeny"},{"kind":13,"containerName":"clean_ips_to_block_allowdeny","line":936,"name":"$self"},{"kind":13,"name":"$logobj_denylist","definition":"my","line":937,"containerName":"clean_ips_to_block_allowdeny","localvar":"my"},{"kind":13,"containerName":"clean_ips_to_block_allowdeny","line":937,"name":"$logobj"},{"kind":13,"line":937,"containerName":"clean_ips_to_block_allowdeny","name":"$self"},{"name":"$global_denylist","definition":"my","line":938,"containerName":"clean_ips_to_block_allowdeny","localvar":"my","kind":13},{"kind":13,"name":"$self","containerName":"clean_ips_to_block_allowdeny","line":938},{"kind":13,"localvar":"my","name":"$global_allowlist","definition":"my","containerName":"clean_ips_to_block_allowdeny","line":939},{"name":"$self","line":939,"containerName":"clean_ips_to_block_allowdeny","kind":13},{"kind":13,"name":"$ips_to_block","definition":"my","containerName":"clean_ips_to_block_allowdeny","line":941,"localvar":"my"},{"line":941,"containerName":"clean_ips_to_block_allowdeny","name":"$logobj","kind":13},{"kind":13,"name":"$logobj_allowlist","containerName":"clean_ips_to_block_allowdeny","line":944},{"containerName":"clean_ips_to_block_allowdeny","line":944,"name":"$self","kind":13},{"kind":12,"line":944,"containerName":"clean_ips_to_block_allowdeny","name":"reverseMapHash"},{"containerName":"clean_ips_to_block_allowdeny","line":944,"name":"$logobj_allowlist","kind":13},{"line":945,"containerName":"clean_ips_to_block_allowdeny","name":"$logobj_denylist","kind":13},{"kind":13,"name":"$self","containerName":"clean_ips_to_block_allowdeny","line":945},{"kind":12,"line":945,"containerName":"clean_ips_to_block_allowdeny","name":"reverseMapHash"},{"kind":13,"name":"$logobj_denylist","containerName":"clean_ips_to_block_allowdeny","line":945},{"kind":13,"name":"$global_allowlist","line":946,"containerName":"clean_ips_to_block_allowdeny"},{"kind":13,"line":946,"containerName":"clean_ips_to_block_allowdeny","name":"$self"},{"name":"reverseMapHash","containerName":"clean_ips_to_block_allowdeny","line":946,"kind":12},{"containerName":"clean_ips_to_block_allowdeny","line":946,"name":"$global_allowlist","kind":13},{"kind":13,"name":"$global_denylist","line":947,"containerName":"clean_ips_to_block_allowdeny"},{"kind":13,"name":"$self","line":947,"containerName":"clean_ips_to_block_allowdeny"},{"kind":12,"line":947,"containerName":"clean_ips_to_block_allowdeny","name":"reverseMapHash"},{"kind":13,"name":"$global_denylist","line":947,"containerName":"clean_ips_to_block_allowdeny"},{"name":"$logger","line":950,"containerName":"clean_ips_to_block_allowdeny","kind":13},{"line":950,"containerName":"clean_ips_to_block_allowdeny","name":"info","kind":12},{"kind":13,"containerName":"clean_ips_to_block_allowdeny","line":951,"name":"$logger"},{"kind":12,"containerName":"clean_ips_to_block_allowdeny","line":951,"name":"debug"},{"name":"$logobj_allowlist","containerName":"clean_ips_to_block_allowdeny","line":951,"kind":13},{"containerName":"clean_ips_to_block_allowdeny","line":951,"name":"$logger","kind":13},{"name":"is_debug","containerName":"clean_ips_to_block_allowdeny","line":951,"kind":12},{"kind":13,"line":952,"containerName":"clean_ips_to_block_allowdeny","name":"$logger"},{"kind":12,"containerName":"clean_ips_to_block_allowdeny","line":952,"name":"debug"},{"kind":13,"name":"$logobj_denylist","line":952,"containerName":"clean_ips_to_block_allowdeny"},{"kind":13,"name":"$logger","containerName":"clean_ips_to_block_allowdeny","line":952},{"kind":12,"name":"is_debug","containerName":"clean_ips_to_block_allowdeny","line":952},{"kind":13,"containerName":"clean_ips_to_block_allowdeny","line":953,"name":"$logger"},{"kind":12,"line":953,"containerName":"clean_ips_to_block_allowdeny","name":"debug"},{"kind":13,"name":"$ips_to_block","containerName":"clean_ips_to_block_allowdeny","line":953},{"kind":13,"line":953,"containerName":"clean_ips_to_block_allowdeny","name":"$logger"},{"line":953,"containerName":"clean_ips_to_block_allowdeny","name":"is_debug","kind":12},{"kind":13,"line":954,"containerName":"clean_ips_to_block_allowdeny","name":"$logger"},{"name":"debug","line":954,"containerName":"clean_ips_to_block_allowdeny","kind":12},{"name":"$global_allowlist","line":954,"containerName":"clean_ips_to_block_allowdeny","kind":13},{"kind":13,"name":"$logger","containerName":"clean_ips_to_block_allowdeny","line":954},{"name":"is_debug","line":954,"containerName":"clean_ips_to_block_allowdeny","kind":12},{"kind":13,"name":"$logger","line":955,"containerName":"clean_ips_to_block_allowdeny"},{"line":955,"containerName":"clean_ips_to_block_allowdeny","name":"debug","kind":12},{"line":955,"containerName":"clean_ips_to_block_allowdeny","name":"$global_denylist","kind":13},{"line":955,"containerName":"clean_ips_to_block_allowdeny","name":"$logger","kind":13},{"line":955,"containerName":"clean_ips_to_block_allowdeny","name":"is_debug","kind":12},{"kind":13,"localvar":"my","containerName":"clean_ips_to_block_allowdeny","line":958,"name":"$allowlist","definition":"my"},{"kind":13,"containerName":"clean_ips_to_block_allowdeny","line":958,"name":"$global_allowlist"},{"kind":13,"containerName":"clean_ips_to_block_allowdeny","line":958,"name":"$logobj_allowlist"}],"detail":"()","line":924,"range":{"end":{"character":9999,"line":958},"start":{"line":924,"character":0}},"containerName":"Net::IPBlocker","name":"clean_ips_to_block_allowdeny","definition":"sub","kind":12,"signature":{"label":"clean_ips_to_block_allowdeny()","parameters":[],"documentation":" Description: Returns the logobj with ips_to_block set with the IPs to block from the allow/deny lists\n   There is a lot of logging available in this sub.\n   This sub is called from review_log()"}},{"kind":12,"line":927,"name":"threads"},{"kind":12,"name":"Dumper","containerName":"Terse","line":930},{"name":"Dumper","line":931,"containerName":"Indent","kind":12},{"kind":12,"line":935,"name":"allowdeny"},{"kind":12,"name":"configs","line":935},{"name":"allowdeny","line":935,"kind":12},{"name":"allowlist","line":936,"kind":12},{"kind":12,"name":"configs","line":936},{"kind":12,"name":"allowlist","line":936},{"name":"denylist","line":937,"kind":12},{"name":"configs","line":937,"kind":12},{"kind":12,"line":937,"name":"denylist"},{"name":"configs","line":938,"kind":12},{"name":"denylist","line":938,"kind":12},{"name":"configs","line":939,"kind":12},{"kind":12,"name":"allowlist","line":939},{"name":"ips_to_block","line":941,"kind":12},{"name":"Dumper","line":951,"kind":12},{"kind":12,"name":"Dumper","line":952},{"name":"Dumper","line":953,"kind":12},{"kind":12,"line":954,"name":"Dumper"},{"line":955,"name":"Dumper","kind":12},{"line":959,"containerName":null,"name":"%denylist","definition":"my","localvar":"my","kind":13},{"name":"$global_denylist","containerName":null,"line":959,"kind":13},{"kind":13,"name":"$logobj_denylist","line":959,"containerName":null},{"kind":13,"containerName":null,"line":962,"name":"$logger"},{"name":"debug","containerName":"Net::IPBlocker","line":962,"kind":12},{"name":"Dumper","line":962,"kind":12},{"name":"$allowlist","line":962,"containerName":null,"kind":13},{"kind":13,"containerName":null,"line":962,"name":"$logger"},{"line":962,"containerName":"Net::IPBlocker","name":"is_debug","kind":12},{"kind":13,"line":963,"containerName":null,"name":"$logger"},{"containerName":"Net::IPBlocker","line":963,"name":"debug","kind":12},{"kind":12,"line":963,"name":"Dumper"},{"name":"$denylist","line":963,"containerName":null,"kind":13},{"containerName":null,"line":963,"name":"$logger","kind":13},{"name":"is_debug","containerName":"Net::IPBlocker","line":963,"kind":12},{"kind":13,"line":966,"containerName":null,"name":"%denylist"},{"kind":13,"containerName":null,"line":966,"name":"$denylist"},{"name":"$ips_to_block","containerName":null,"line":966,"kind":13},{"kind":13,"name":"$logger","line":969,"containerName":null},{"containerName":"Net::IPBlocker","line":969,"name":"debug","kind":12},{"line":969,"name":"Dumper","kind":12},{"kind":13,"name":"$denylist","line":969,"containerName":null},{"name":"$logger","containerName":null,"line":969,"kind":13},{"line":969,"containerName":"Net::IPBlocker","name":"is_debug","kind":12},{"kind":13,"containerName":null,"line":973,"name":"%allowdeny"},{"kind":13,"name":"%logobj","line":974,"containerName":null},{"kind":12,"line":974,"name":"ips_to_block"},{"kind":13,"line":974,"containerName":null,"name":"$denylist"},{"kind":13,"containerName":null,"line":975,"name":"$logger"},{"containerName":"Net::IPBlocker","line":975,"name":"debug","kind":12},{"kind":12,"name":"Dumper","line":975},{"name":"%logobj","line":975,"containerName":null,"kind":13},{"name":"ips_to_block","line":975,"kind":12},{"line":976,"containerName":null,"name":"$logger","kind":13},{"kind":12,"containerName":"Net::IPBlocker","line":976,"name":"is_debug"},{"line":977,"containerName":null,"name":"%logobj","kind":13},{"kind":13,"line":982,"containerName":null,"name":"%denylist"},{"kind":13,"name":"$allowlist","line":982,"containerName":null},{"kind":13,"name":"%logobj","containerName":null,"line":983},{"name":"ips_to_block","line":983,"kind":12},{"name":"$denylist","containerName":null,"line":983,"kind":13},{"kind":13,"name":"$logger","containerName":null,"line":984},{"name":"debug","containerName":"Net::IPBlocker","line":984,"kind":12},{"kind":12,"line":984,"name":"Dumper"},{"line":984,"containerName":null,"name":"%logobj","kind":13},{"kind":12,"name":"ips_to_block","line":984},{"kind":13,"line":985,"containerName":null,"name":"$logger"},{"containerName":"Net::IPBlocker","line":985,"name":"is_debug","kind":12},{"kind":13,"name":"$logobj","line":986,"containerName":null},{"name":"run_iptables","definition":"sub","range":{"start":{"line":1005,"character":0},"end":{"line":1104,"character":9999}},"line":1005,"containerName":"Net::IPBlocker","kind":12,"signature":{"label":"run_iptables()","parameters":[],"documentation":" Runs whatever parameters are passed to it against iptables\n  This is intended to be a one stop shop for running iptables out from a queue.\n  However, there are a few instances where it is called directly... especially when creating chains\n   This hopefully prevents excessive wait/locking on iptables\n   and helps to keep commands running in the order they are received.\n Arguments must be passed as a hash reference with (so far) the following keys:\n   rule:  The rule to run\n   options:  Any options to pass to iptables\n  Where it is ran like this:\n   iptables $options $rule 2>&1\n Future enhancement:\n   1. delete existing rule if it exists\n Take note this sub is intended (but not required) to be called from sub iptables_thread()\n  An error will happen if not called from sub iptables_thread(), but it will not stop the program\n  This is to encourage using the iptablesqueue_enqueue() sub instead of run_iptables() directly\n  So, to say this more clearly, if you want to run iptables commands, then call iptablesqueue_enqueue()"},"detail":"()","children":[{"localvar":"my","containerName":"run_iptables","line":1006,"definition":"my","name":"$self","kind":13},{"kind":13,"name":"$args","containerName":"run_iptables","line":1006},{"kind":13,"localvar":"my","name":"@caller_lst","definition":"my","containerName":"run_iptables","line":1007},{"name":"$caller_lst","containerName":"run_iptables","line":1008,"kind":13},{"kind":13,"line":1008,"containerName":"run_iptables","name":"$IPTABLESRUNLINE"},{"kind":13,"line":1008,"containerName":"run_iptables","name":"$IPTABLESRUNLINE"},{"localvar":"my","containerName":"run_iptables","line":1009,"name":"$logmsg","definition":"my","kind":13},{"name":"@caller_lst","containerName":"run_iptables","line":1012,"kind":13},{"kind":13,"name":"$logger","line":1017,"containerName":"run_iptables"},{"kind":12,"containerName":"run_iptables","line":1017,"name":"error"},{"kind":13,"containerName":"run_iptables","line":1017,"name":"$logmsg"},{"name":"$TID","definition":"my","containerName":"run_iptables","line":1019,"localvar":"my","kind":13},{"line":1019,"containerName":"run_iptables","name":"tid","kind":12},{"kind":13,"name":"$TID","containerName":"run_iptables","line":1020},{"name":"$TID","containerName":"run_iptables","line":1020,"kind":13},{"kind":13,"line":1023,"containerName":"run_iptables","name":"$args"},{"containerName":"run_iptables","line":1023,"name":"$logger","kind":13},{"kind":12,"name":"error","line":1023,"containerName":"run_iptables"},{"line":1024,"containerName":"run_iptables","name":"$self","kind":13},{"kind":13,"name":"$logger","containerName":"run_iptables","line":1024},{"line":1024,"containerName":"run_iptables","name":"error","kind":12},{"kind":13,"name":"$iptables","definition":"my","containerName":"run_iptables","line":1026,"localvar":"my"},{"containerName":"run_iptables","line":1026,"name":"$self","kind":13},{"localvar":"my","containerName":"run_iptables","line":1027,"definition":"my","name":"$rule","kind":13},{"kind":13,"containerName":"run_iptables","line":1027,"name":"$args"},{"kind":13,"line":1028,"containerName":"run_iptables","definition":"my","name":"$options","localvar":"my"},{"line":1028,"containerName":"run_iptables","name":"$args","kind":13},{"containerName":"run_iptables","line":1030,"name":"$logger","kind":13},{"containerName":"run_iptables","line":1030,"name":"is_debug","kind":12},{"kind":13,"name":"$logger","line":1031,"containerName":"run_iptables"},{"kind":12,"line":1031,"containerName":"run_iptables","name":"debug"},{"kind":13,"line":1032,"containerName":"run_iptables","name":"$args"},{"containerName":"run_iptables","line":1040,"name":"$args","kind":13},{"kind":13,"containerName":"run_iptables","line":1041,"name":"$allowdupes","definition":"my","localvar":"my"},{"kind":13,"name":"$args","line":1041,"containerName":"run_iptables"},{"kind":13,"name":"$allowdupes","containerName":"run_iptables","line":1043},{"kind":13,"name":"$logger","containerName":"run_iptables","line":1044},{"kind":12,"containerName":"run_iptables","line":1044,"name":"debug"},{"localvar":"my","line":1045,"containerName":"run_iptables","name":"$retval","definition":"my","kind":13},{"kind":13,"line":1045,"containerName":"run_iptables","name":"$self"},{"kind":12,"containerName":"run_iptables","line":1045,"name":"check_if_rule_exists"},{"kind":13,"name":"$args","line":1045,"containerName":"run_iptables"},{"kind":13,"name":"$retval","line":1046,"containerName":"run_iptables"},{"kind":13,"containerName":"run_iptables","line":1047,"definition":"my","name":"$logmsg","localvar":"my"},{"line":1048,"containerName":"run_iptables","name":"$logmsg","kind":13},{"name":"$logger","line":1049,"containerName":"run_iptables","kind":13},{"line":1049,"containerName":"run_iptables","name":"debug","kind":12},{"line":1049,"containerName":"run_iptables","name":"$logmsg","kind":13},{"kind":13,"name":"$retval","line":1052,"containerName":"run_iptables"},{"kind":13,"name":"$logger","line":1056,"containerName":"run_iptables"},{"containerName":"run_iptables","line":1056,"name":"debug","kind":12},{"name":"$tracker","line":1057,"containerName":"run_iptables","kind":13},{"kind":13,"containerName":"run_iptables","line":1057,"name":"$rule"},{"name":"$retval","line":1060,"containerName":"run_iptables","kind":13},{"kind":13,"name":"$logger","line":1061,"containerName":"run_iptables"},{"containerName":"run_iptables","line":1061,"name":"debug","kind":12},{"name":"$retval","line":1063,"containerName":"run_iptables","kind":13},{"name":"$options","containerName":"run_iptables","line":1064,"kind":13},{"containerName":"run_iptables","line":1067,"name":"$logger","kind":13},{"name":"debug","line":1067,"containerName":"run_iptables","kind":12},{"name":"$tracker","containerName":"run_iptables","line":1070,"kind":13},{"line":1070,"containerName":"run_iptables","name":"$rule","kind":13},{"containerName":"run_iptables","line":1072,"name":"$retval","kind":13},{"kind":13,"name":"$logger","containerName":"run_iptables","line":1073},{"name":"error","containerName":"run_iptables","line":1073,"kind":12},{"kind":13,"line":1076,"containerName":"run_iptables","name":"$retval"},{"kind":13,"name":"$logmsg","definition":"my","containerName":"run_iptables","line":1077,"localvar":"my"},{"name":"$logmsg","containerName":"run_iptables","line":1078,"kind":13},{"kind":13,"name":"$logger","line":1079,"containerName":"run_iptables"},{"line":1079,"containerName":"run_iptables","name":"error","kind":12},{"kind":13,"name":"$logmsg","containerName":"run_iptables","line":1079},{"name":"$logger","line":1083,"containerName":"run_iptables","kind":13},{"containerName":"run_iptables","line":1083,"name":"error","kind":12},{"line":1083,"containerName":"run_iptables","name":"$retval","kind":13},{"kind":13,"line":1088,"containerName":"run_iptables","name":"$command","definition":"my","localvar":"my"},{"kind":13,"line":1089,"containerName":"run_iptables","name":"$tracker"},{"name":"$rule","line":1089,"containerName":"run_iptables","kind":13},{"kind":13,"containerName":"run_iptables","line":1090,"name":"$self"},{"kind":13,"containerName":"run_iptables","line":1091,"name":"$logger"},{"kind":12,"containerName":"run_iptables","line":1091,"name":"debug"},{"line":1092,"containerName":"run_iptables","name":"$output","definition":"my","localvar":"my","kind":13},{"containerName":"run_iptables","line":1093,"name":"$logger","kind":13},{"kind":12,"line":1093,"containerName":"run_iptables","name":"debug"},{"kind":13,"name":"$logger","line":1097,"containerName":"run_iptables"},{"containerName":"run_iptables","line":1097,"name":"info","kind":12},{"line":1102,"containerName":"run_iptables","name":"$logger","kind":13},{"kind":12,"name":"error","line":1102,"containerName":"run_iptables"}]},{"name":"Dumper","line":1012,"kind":12},{"kind":12,"line":1019,"name":"threads"},{"kind":12,"name":"rule","line":1023},{"kind":12,"name":"configs","line":1024},{"name":"iptables","line":1024,"kind":12},{"line":1026,"name":"configs","kind":12},{"line":1026,"name":"iptables","kind":12},{"kind":12,"name":"rule","line":1027},{"line":1028,"name":"options","kind":12},{"line":1032,"name":"Dumper","kind":12},{"kind":12,"name":"allowdupes","line":1040},{"name":"allowdupes","line":1041,"kind":12},{"kind":12,"line":1057,"name":"iptables_rules"},{"name":"chains_created","line":1070,"kind":12},{"kind":12,"line":1089,"name":"iptables_rules"},{"kind":12,"name":"configs","line":1090},{"line":1090,"name":"PRODMODE","kind":12},{"children":[{"kind":13,"name":"$self","definition":"my","line":1107,"containerName":"set_iptables_command","localvar":"my"},{"name":"$self","containerName":"set_iptables_command","line":1110,"kind":13},{"containerName":"set_iptables_command","line":1111,"name":"$self","kind":13},{"name":"$logger","containerName":"set_iptables_command","line":1112,"kind":13},{"kind":12,"name":"info","containerName":"set_iptables_command","line":1112}],"detail":"()","range":{"start":{"character":0,"line":1106},"end":{"line":1114,"character":9999}},"line":1106,"containerName":"Net::IPBlocker","name":"set_iptables_command","definition":"sub","signature":{"label":"set_iptables_command()","parameters":[],"documentation":""},"kind":12},{"name":"configs","line":1110,"kind":12},{"kind":12,"name":"iptables","line":1110},{"name":"configs","line":1111,"kind":12},{"kind":12,"line":1111,"name":"iptables"},{"name":"check_if_rule_exists","definition":"sub","containerName":"Net::IPBlocker","range":{"start":{"character":0,"line":1118},"end":{"line":1173,"character":9999}},"line":1118,"signature":{"label":"check_if_rule_exists($self,$args)","parameters":[{"label":"$self"},{"label":"$args"}],"documentation":"# Returns 0 if there is an unknown return value from running iptables\n#          Otherwise returns a string"},"kind":12,"detail":"($self,$args)","children":[{"localvar":"my","definition":"my","name":"$self","containerName":"check_if_rule_exists","line":1119,"kind":13},{"kind":13,"line":1119,"containerName":"check_if_rule_exists","name":"$args"},{"localvar":"my","containerName":"check_if_rule_exists","line":1120,"name":"$TID","definition":"my","kind":13},{"kind":12,"containerName":"check_if_rule_exists","line":1120,"name":"tid"},{"name":"$TID","line":1121,"containerName":"check_if_rule_exists","kind":13},{"kind":13,"containerName":"check_if_rule_exists","line":1121,"name":"$TID"},{"kind":13,"name":"$args","containerName":"check_if_rule_exists","line":1124},{"line":1124,"containerName":"check_if_rule_exists","name":"$self","kind":13},{"name":"log_and_return","line":1124,"containerName":"check_if_rule_exists","kind":12},{"name":"$self","line":1125,"containerName":"check_if_rule_exists","kind":13},{"kind":13,"name":"$logger","line":1125,"containerName":"check_if_rule_exists"},{"containerName":"check_if_rule_exists","line":1125,"name":"error","kind":12},{"localvar":"my","line":1127,"containerName":"check_if_rule_exists","definition":"my","name":"$iptables","kind":13},{"name":"$self","containerName":"check_if_rule_exists","line":1127,"kind":13},{"kind":13,"localvar":"my","name":"$rule","definition":"my","line":1128,"containerName":"check_if_rule_exists"},{"kind":13,"name":"$args","line":1128,"containerName":"check_if_rule_exists"},{"localvar":"my","name":"$options","definition":"my","line":1129,"containerName":"check_if_rule_exists","kind":13},{"kind":13,"line":1129,"containerName":"check_if_rule_exists","name":"$args"},{"kind":13,"line":1131,"containerName":"check_if_rule_exists","name":"$tracker"},{"kind":13,"name":"$rule","line":1131,"containerName":"check_if_rule_exists"},{"name":"$logger","line":1132,"containerName":"check_if_rule_exists","kind":13},{"kind":12,"name":"debug","containerName":"check_if_rule_exists","line":1132},{"name":"$tracker","line":1136,"containerName":"check_if_rule_exists","kind":13},{"line":1136,"containerName":"check_if_rule_exists","name":"$rule","kind":13},{"name":"$logger","line":1137,"containerName":"check_if_rule_exists","kind":13},{"kind":12,"line":1137,"containerName":"check_if_rule_exists","name":"debug"},{"containerName":"check_if_rule_exists","line":1141,"name":"$options","kind":13},{"localvar":"my","definition":"my","name":"$logmsg","line":1142,"containerName":"check_if_rule_exists","kind":13},{"kind":13,"name":"$logmsg","line":1143,"containerName":"check_if_rule_exists"},{"line":1144,"containerName":"check_if_rule_exists","name":"$logger","kind":13},{"kind":12,"line":1144,"containerName":"check_if_rule_exists","name":"debug"},{"kind":13,"containerName":"check_if_rule_exists","line":1144,"name":"$logmsg"},{"kind":13,"localvar":"my","name":"$checkrule_result","definition":"my","line":1148,"containerName":"check_if_rule_exists"},{"containerName":"check_if_rule_exists","line":1150,"name":"$logger","kind":13},{"line":1150,"containerName":"check_if_rule_exists","name":"debug","kind":12},{"containerName":"check_if_rule_exists","line":1154,"name":"$checkrule_result","kind":13},{"line":1155,"containerName":"check_if_rule_exists","name":"$logger","kind":13},{"kind":12,"name":"debug","containerName":"check_if_rule_exists","line":1155},{"name":"$logger","line":1156,"containerName":"check_if_rule_exists","kind":13},{"containerName":"check_if_rule_exists","line":1156,"name":"debug","kind":12},{"line":1160,"containerName":"check_if_rule_exists","name":"$checkrule_result","kind":13},{"kind":13,"name":"$logger","containerName":"check_if_rule_exists","line":1161},{"kind":12,"containerName":"check_if_rule_exists","line":1161,"name":"debug"},{"kind":13,"containerName":"check_if_rule_exists","line":1162,"name":"$logger"},{"line":1162,"containerName":"check_if_rule_exists","name":"debug","kind":12},{"line":1166,"containerName":"check_if_rule_exists","name":"$checkrule_result","kind":13},{"name":"$logger","line":1167,"containerName":"check_if_rule_exists","kind":13},{"kind":12,"name":"debug","line":1167,"containerName":"check_if_rule_exists"},{"line":1168,"containerName":"check_if_rule_exists","name":"$logger","kind":13},{"kind":12,"line":1168,"containerName":"check_if_rule_exists","name":"debug"},{"name":"$self","containerName":"check_if_rule_exists","line":1172,"kind":13},{"kind":12,"name":"log_and_return","containerName":"check_if_rule_exists","line":1172}]},{"name":"threads","line":1120,"kind":12},{"kind":12,"line":1124,"name":"rule"},{"name":"configs","line":1125,"kind":12},{"kind":12,"line":1125,"name":"iptables"},{"kind":12,"name":"configs","line":1127},{"kind":12,"name":"iptables","line":1127},{"name":"rule","line":1128,"kind":12},{"name":"options","line":1129,"kind":12},{"name":"chains_created","line":1131,"kind":12},{"name":"iptables_rules","line":1136,"kind":12},{"children":[{"kind":13,"localvar":"my","line":1176,"containerName":"log_and_return","definition":"my","name":"$self"},{"kind":13,"name":"$error_message","containerName":"log_and_return","line":1176},{"localvar":"my","line":1177,"containerName":"log_and_return","name":"$TID","definition":"my","kind":13},{"name":"tid","line":1177,"containerName":"log_and_return","kind":12},{"kind":13,"containerName":"log_and_return","line":1178,"name":"$TID"},{"line":1178,"containerName":"log_and_return","name":"$TID","kind":13},{"kind":13,"name":"$logger","containerName":"log_and_return","line":1179},{"kind":12,"containerName":"log_and_return","line":1179,"name":"error"},{"kind":13,"name":"$error_message","line":1179,"containerName":"log_and_return"}],"detail":"($self,$error_message)","containerName":"Net::IPBlocker","range":{"start":{"line":1175,"character":0},"end":{"line":1181,"character":9999}},"line":1175,"name":"log_and_return","definition":"sub","kind":12,"signature":{"parameters":[{"label":"$self"},{"label":"$error_message"}],"label":"log_and_return($self,$error_message)","documentation":""}},{"line":1177,"name":"threads","kind":12},{"children":[{"localvar":"my","line":1190,"containerName":"add_global_chain","definition":"my","name":"$self","kind":13},{"kind":13,"containerName":"add_global_chain","line":1191,"name":"$TID","definition":"my","localvar":"my"},{"kind":12,"containerName":"add_global_chain","line":1191,"name":"tid"},{"kind":13,"line":1192,"containerName":"add_global_chain","name":"$TID"},{"name":"$TID","line":1192,"containerName":"add_global_chain","kind":13},{"localvar":"my","name":"$chain","definition":"my","line":1194,"containerName":"add_global_chain","kind":13},{"kind":13,"name":"$self","line":1194,"containerName":"add_global_chain"},{"kind":13,"name":"$logger","line":1194,"containerName":"add_global_chain"},{"containerName":"add_global_chain","line":1194,"name":"logdie","kind":12},{"line":1195,"containerName":"add_global_chain","name":"$chain","kind":13},{"name":"$chain","containerName":"add_global_chain","line":1195,"kind":13},{"kind":13,"localvar":"my","name":"$globalchains_str","definition":"my","line":1197,"containerName":"add_global_chain"},{"containerName":"add_global_chain","line":1197,"name":"$self","kind":13},{"kind":13,"name":"$logger","line":1197,"containerName":"add_global_chain"},{"kind":12,"containerName":"add_global_chain","line":1197,"name":"logdie"},{"line":1198,"containerName":"add_global_chain","definition":"my","name":"@globalchains","localvar":"my","kind":13},{"kind":13,"line":1198,"containerName":"add_global_chain","name":"$globalchains_str"},{"containerName":"add_global_chain","line":1200,"name":"$logger","kind":13},{"name":"info","containerName":"add_global_chain","line":1200,"kind":12},{"kind":13,"localvar":"my","name":"$args","definition":"my","containerName":"add_global_chain","line":1201},{"containerName":"add_global_chain","line":1205,"name":"$self","kind":13},{"name":"iptablesqueue_enqueue","containerName":"add_global_chain","line":1205,"kind":12},{"name":"$args","line":1205,"containerName":"add_global_chain","kind":13},{"line":1207,"containerName":"add_global_chain","name":"$logger","kind":13},{"kind":12,"name":"info","line":1207,"containerName":"add_global_chain"},{"localvar":"my","definition":"my","name":"$table","line":1208,"containerName":"add_global_chain","kind":13},{"kind":13,"name":"@globalchains","line":1208,"containerName":"add_global_chain"},{"kind":13,"localvar":"my","definition":"my","name":"$args","line":1209,"containerName":"add_global_chain"},{"containerName":"add_global_chain","line":1213,"name":"$self","kind":13},{"kind":12,"line":1213,"containerName":"add_global_chain","name":"iptablesqueue_enqueue"},{"kind":13,"containerName":"add_global_chain","line":1213,"name":"$args"}],"detail":"()","signature":{"label":"add_global_chain()","parameters":[],"documentation":" Description: Creates the global chain and then adds a jump rule to the global chains.\n           With default values this means creating the global chain \"IPBLOCKER_glopbal\" and then\n           adding a jump rule to the INPUT, OUTPUT, and FORWARD tables to go to IPBLOCKER_global\n Dies if no chain prefix is set or if no global chains are set\n    Bassically, this dies if it is not called as class or correct configs are not set\n Returns 1 always"},"kind":12,"containerName":"Net::IPBlocker","range":{"start":{"character":0,"line":1189},"end":{"character":9999,"line":1217}},"line":1189,"definition":"sub","name":"add_global_chain"},{"name":"threads","line":1191,"kind":12},{"kind":12,"line":1194,"name":"configs"},{"line":1194,"name":"chainprefix","kind":12},{"name":"configs","line":1197,"kind":12},{"kind":12,"name":"globalchains","line":1197},{"name":"options","line":1202,"kind":12},{"kind":12,"line":1203,"name":"rule"},{"kind":12,"line":1210,"name":"options"},{"name":"rule","line":1211,"kind":12},{"line":1222,"range":{"end":{"character":9999,"line":1238},"start":{"character":0,"line":1222}},"containerName":"Net::IPBlocker","definition":"sub","name":"iptablesqueue_enqueue","kind":12,"signature":{"documentation":" Description: Queues items onto the iptables queue\n Returns 1 if queue is allowing enqueuing\n Returns 0 if queue is not allowing enqueuing","label":"iptablesqueue_enqueue()","parameters":[]},"children":[{"kind":13,"localvar":"my","containerName":"iptablesqueue_enqueue","line":1223,"definition":"my","name":"$self"},{"kind":13,"name":"$args","containerName":"iptablesqueue_enqueue","line":1223},{"line":1224,"containerName":"iptablesqueue_enqueue","definition":"my","name":"$TID","localvar":"my","kind":13},{"line":1224,"containerName":"iptablesqueue_enqueue","name":"tid","kind":12},{"kind":13,"line":1225,"containerName":"iptablesqueue_enqueue","name":"$TID"},{"containerName":"iptablesqueue_enqueue","line":1225,"name":"$TID","kind":13},{"localvar":"my","containerName":"iptablesqueue_enqueue","line":1227,"name":"$iptablesQueue_pending","definition":"my","kind":13},{"kind":13,"name":"$IptablesQueue","line":1227,"containerName":"iptablesqueue_enqueue"},{"containerName":"iptablesqueue_enqueue","line":1227,"name":"pending","kind":12},{"line":1228,"containerName":"iptablesqueue_enqueue","name":"$iptablesQueue_pending","kind":13},{"localvar":"my","containerName":"iptablesqueue_enqueue","line":1229,"name":"$logmsg","definition":"my","kind":13},{"line":1230,"containerName":"iptablesqueue_enqueue","name":"$logmsg","kind":13},{"name":"$logger","line":1231,"containerName":"iptablesqueue_enqueue","kind":13},{"line":1231,"containerName":"iptablesqueue_enqueue","name":"info","kind":12},{"kind":13,"name":"$logmsg","containerName":"iptablesqueue_enqueue","line":1231},{"containerName":"iptablesqueue_enqueue","line":1234,"name":"$args","kind":13},{"kind":13,"containerName":"iptablesqueue_enqueue","line":1235,"name":"$logger"},{"containerName":"iptablesqueue_enqueue","line":1235,"name":"debug","kind":12},{"containerName":"iptablesqueue_enqueue","line":1235,"name":"$args","kind":13},{"containerName":"iptablesqueue_enqueue","line":1235,"name":"$logger","kind":13},{"name":"is_debug","containerName":"iptablesqueue_enqueue","line":1235,"kind":12},{"kind":13,"containerName":"iptablesqueue_enqueue","line":1236,"name":"$IptablesQueue"},{"name":"enqueue","line":1236,"containerName":"iptablesqueue_enqueue","kind":12},{"kind":13,"name":"$args","line":1236,"containerName":"iptablesqueue_enqueue"}],"detail":"()"},{"kind":12,"name":"threads","line":1224},{"line":1234,"name":"check_pending","kind":12},{"kind":12,"line":1235,"name":"Dumper"},{"signature":{"documentation":" This function reads the log file into memory from the seek position (if it exists)\n The reading of a log file based on the seek position creates a big issue if the log file is rotated AND is larger than\n   the seek position\n   This is a tradeoff of reading the entire log file into memory and then grepping for the regexps\n Returns: $logobj","label":"readlogfile($self,$logobj)","parameters":[{"label":"$self"},{"label":"$logobj"}]},"kind":12,"name":"readlogfile","definition":"sub","containerName":"Net::IPBlocker","range":{"start":{"line":1245,"character":0},"end":{"character":9999,"line":1290}},"line":1245,"detail":"($self,$logobj)","children":[{"kind":13,"localvar":"my","line":1246,"containerName":"readlogfile","definition":"my","name":"$self"},{"kind":13,"name":"$logobj","line":1246,"containerName":"readlogfile"},{"kind":13,"name":"$TID","definition":"my","line":1247,"containerName":"readlogfile","localvar":"my"},{"line":1247,"containerName":"readlogfile","name":"tid","kind":12},{"kind":13,"name":"$TID","containerName":"readlogfile","line":1248},{"kind":13,"name":"$TID","line":1248,"containerName":"readlogfile"},{"localvar":"my","line":1251,"containerName":"readlogfile","definition":"my","name":"$file","kind":13},{"kind":13,"name":"$logobj","containerName":"readlogfile","line":1251},{"name":"$file","containerName":"readlogfile","line":1252,"kind":13},{"line":1252,"containerName":"readlogfile","name":"$logger","kind":13},{"kind":12,"name":"error","containerName":"readlogfile","line":1252},{"kind":13,"containerName":"readlogfile","line":1252,"name":"$logobj"},{"line":1255,"containerName":"readlogfile","name":"$logobj","kind":13},{"kind":13,"line":1256,"containerName":"readlogfile","name":"$logobj"},{"line":1256,"containerName":"readlogfile","name":"$file","kind":13},{"line":1256,"containerName":"readlogfile","name":"$logobj","kind":13},{"kind":13,"line":1257,"containerName":"readlogfile","name":"$logobj"},{"kind":13,"name":"$self","line":1257,"containerName":"readlogfile"},{"kind":13,"containerName":"readlogfile","line":1258,"name":"$logobj"},{"line":1258,"containerName":"readlogfile","name":"$logobj","kind":13},{"kind":13,"name":"$logger","containerName":"readlogfile","line":1260},{"kind":12,"name":"debug","containerName":"readlogfile","line":1260},{"localvar":"my","name":"$fh","definition":"my","line":1266,"containerName":"readlogfile","kind":13},{"kind":13,"containerName":"readlogfile","line":1266,"name":"$file"},{"kind":13,"name":"$logger","line":1267,"containerName":"readlogfile"},{"name":"error","containerName":"readlogfile","line":1267,"kind":12},{"containerName":"readlogfile","line":1268,"name":"$logobj","kind":13},{"line":1270,"containerName":"readlogfile","name":"$fh","kind":13},{"kind":13,"name":"$logobj","line":1270,"containerName":"readlogfile"},{"kind":13,"localvar":"my","definition":"my","name":"@logcontents","containerName":"readlogfile","line":1271},{"name":"$fh","containerName":"readlogfile","line":1271,"kind":13},{"kind":13,"name":"$logobj","containerName":"readlogfile","line":1272},{"kind":13,"name":"$fh","containerName":"readlogfile","line":1272},{"kind":13,"name":"$fh","line":1273,"containerName":"readlogfile"},{"containerName":"readlogfile","line":1275,"name":"@logcontents","kind":13},{"kind":13,"name":"$logger","line":1276,"containerName":"readlogfile"},{"name":"debug","containerName":"readlogfile","line":1276,"kind":12},{"name":"@logcontents","line":1276,"containerName":"readlogfile","kind":13},{"kind":13,"line":1279,"containerName":"readlogfile","name":"$logger"},{"kind":12,"line":1279,"containerName":"readlogfile","name":"info"},{"line":1280,"containerName":"readlogfile","name":"$logobj","kind":13},{"kind":13,"name":"@logcontents","containerName":"readlogfile","line":1283},{"line":1284,"containerName":"readlogfile","name":"$logobj","kind":13},{"kind":13,"containerName":"readlogfile","line":1284,"name":"@logcontents"},{"name":"$logger","line":1286,"containerName":"readlogfile","kind":13},{"line":1286,"containerName":"readlogfile","name":"debug","kind":12},{"kind":13,"name":"@logcontents","containerName":"readlogfile","line":1286},{"containerName":"readlogfile","line":1287,"name":"$logger","kind":13},{"kind":12,"name":"trace","containerName":"readlogfile","line":1287},{"kind":13,"name":"$logobj","containerName":"readlogfile","line":1287},{"line":1287,"containerName":"readlogfile","name":"$logger","kind":13},{"name":"is_trace","line":1287,"containerName":"readlogfile","kind":12},{"name":"$logobj","line":1289,"containerName":"readlogfile","kind":13}]},{"name":"threads","line":1247,"kind":12},{"line":1251,"name":"file","kind":12},{"line":1255,"name":"seek","kind":12},{"line":1256,"name":"seek","kind":12},{"kind":12,"line":1256,"name":"seek"},{"kind":12,"name":"readentirefile","line":1257},{"kind":12,"line":1257,"name":"configs"},{"kind":12,"name":"readentirefile","line":1257},{"name":"seek","line":1258,"kind":12},{"line":1258,"name":"readentirefile","kind":12},{"line":1270,"name":"seek","kind":12},{"name":"seek","line":1272,"kind":12},{"line":1280,"name":"logcontents","kind":12},{"name":"logcontents","line":1284,"kind":12},{"name":"Dumper","line":1287,"kind":12},{"kind":12,"name":"logcontents","line":1287},{"children":[{"kind":13,"definition":"my","name":"$self","line":1296,"containerName":"_grep_regexps","localvar":"my"},{"kind":13,"containerName":"_grep_regexps","line":1296,"name":"$log"},{"definition":"my","name":"$TID","line":1297,"containerName":"_grep_regexps","localvar":"my","kind":13},{"kind":12,"name":"tid","line":1297,"containerName":"_grep_regexps"},{"name":"$matches","definition":"my","containerName":"_grep_regexps","line":1299,"localvar":"my","kind":13},{"kind":13,"localvar":"my","name":"@log_contents","definition":"my","line":1300,"containerName":"_grep_regexps"},{"name":"$log","containerName":"_grep_regexps","line":1300,"kind":13}],"detail":"($self,$log)","containerName":"Net::IPBlocker","range":{"start":{"character":0,"line":1295},"end":{"character":9999,"line":1300}},"line":1295,"name":"_grep_regexps","definition":"sub","kind":12,"signature":{"documentation":" Description:  Using the logobj, this greps against the log contents for matching lines and then gets the\n               IP address on each line.\n Returns:  Hash reference of IP addresses with count of how many times the IP address was found","parameters":[{"label":"$self"},{"label":"$log"}],"label":"_grep_regexps($self,$log)"}},{"kind":12,"name":"threads","line":1297},{"line":1300,"name":"logcontents","kind":12},{"containerName":null,"line":1302,"name":"@log_contents","kind":13},{"containerName":null,"line":1305,"definition":"my","name":"$regex","localvar":"my","kind":13},{"containerName":null,"line":1305,"name":"%log","kind":13},{"line":1305,"name":"regexpdeny","kind":12},{"kind":13,"containerName":null,"line":1306,"definition":"my","name":"$pattern","localvar":"my"},{"name":"%log","line":1306,"containerName":null,"kind":13},{"line":1306,"name":"regexpdeny","kind":12},{"kind":13,"name":"$regex","line":1306,"containerName":null},{"kind":13,"line":1307,"containerName":null,"name":"$logger"},{"containerName":"Net::IPBlocker","line":1307,"name":"debug","kind":12},{"kind":13,"name":"@current_matches","definition":"my","line":1309,"containerName":null,"localvar":"my"},{"kind":13,"name":"@log_contents","line":1309,"containerName":null},{"kind":13,"name":"$logger","line":1310,"containerName":null},{"line":1310,"containerName":"Net::IPBlocker","name":"debug","kind":12},{"name":"Dumper","line":1310,"kind":12},{"kind":13,"name":"@current_matches","containerName":null,"line":1310},{"name":"$logger","containerName":null,"line":1310,"kind":13},{"kind":12,"line":1310,"containerName":"Net::IPBlocker","name":"is_debug"},{"localvar":"my","containerName":null,"line":1312,"name":"$line","definition":"my","kind":13},{"kind":13,"name":"@current_matches","line":1312,"containerName":null},{"kind":13,"line":1313,"containerName":null,"name":"$line"},{"name":"$logger","line":1314,"containerName":null,"kind":13},{"kind":12,"name":"debug","line":1314,"containerName":"Net::IPBlocker"},{"containerName":null,"line":1316,"name":"$ip_address","definition":"my","localvar":"my","kind":13},{"kind":13,"containerName":null,"line":1316,"name":"$line"},{"containerName":null,"line":1316,"name":"%line","kind":13},{"kind":13,"containerName":null,"line":1317,"name":"%matches"},{"kind":13,"containerName":null,"line":1317,"name":"$ip_address"},{"kind":13,"name":"$logger","line":1318,"containerName":null},{"kind":12,"name":"debug","containerName":"Net::IPBlocker","line":1318},{"name":"$logger","line":1323,"containerName":null,"kind":13},{"name":"debug","line":1323,"containerName":"Net::IPBlocker","kind":12},{"kind":12,"name":"Dumper","line":1323},{"kind":13,"containerName":null,"line":1323,"name":"$matches"},{"kind":13,"containerName":null,"line":1323,"name":"$logger"},{"kind":12,"name":"is_debug","containerName":"Net::IPBlocker","line":1323},{"localvar":"my","containerName":null,"line":1325,"definition":"my","name":"$log_msg","kind":13},{"kind":13,"line":1326,"containerName":null,"name":"$log_msg"},{"kind":13,"containerName":null,"line":1326,"name":"$matches"},{"name":"$logger","containerName":null,"line":1327,"kind":13},{"line":1327,"containerName":"Net::IPBlocker","name":"info","kind":12},{"kind":13,"name":"$log_msg","containerName":null,"line":1327},{"name":"$matches","containerName":null,"line":1329,"kind":13},{"detail":"()","children":[{"containerName":"add_chain","line":1334,"definition":"my","name":"$self","localvar":"my","kind":13},{"kind":13,"name":"$chain","line":1334,"containerName":"add_chain"},{"localvar":"my","containerName":"add_chain","line":1335,"definition":"my","name":"$TID","kind":13},{"kind":12,"containerName":"add_chain","line":1335,"name":"tid"},{"kind":13,"containerName":"add_chain","line":1337,"name":"$logger"},{"kind":12,"line":1337,"containerName":"add_chain","name":"info"},{"kind":13,"line":1338,"containerName":"add_chain","name":"$rule","definition":"my","localvar":"my"},{"localvar":"my","line":1339,"containerName":"add_chain","name":"$options","definition":"my","kind":13},{"localvar":"my","name":"$args","definition":"my","containerName":"add_chain","line":1340,"kind":13},{"kind":13,"name":"$rule","containerName":"add_chain","line":1340},{"containerName":"add_chain","line":1340,"name":"$options","kind":13},{"kind":13,"line":1341,"containerName":"add_chain","name":"$self"},{"name":"iptablesqueue_enqueue","line":1341,"containerName":"add_chain","kind":12},{"name":"$args","line":1341,"containerName":"add_chain","kind":13},{"line":1342,"containerName":"add_chain","name":"$self","kind":13},{"name":"$chain","containerName":"add_chain","line":1342,"kind":13}],"definition":"sub","name":"add_chain","line":1333,"range":{"start":{"line":1333,"character":0},"end":{"character":9999,"line":1344}},"containerName":"Net::IPBlocker","signature":{"documentation":" Description:  Adds the chain to iptables","parameters":[],"label":"add_chain()"},"kind":12},{"kind":12,"name":"threads","line":1335},{"kind":12,"line":1340,"name":"rule"},{"kind":12,"name":"options","line":1340},{"name":"chains_created","line":1342,"kind":12},{"children":[{"line":1354,"containerName":"add_allowdeny_ips","definition":"my","name":"$self","localvar":"my","kind":13},{"name":"$args","containerName":"add_allowdeny_ips","line":1354,"kind":13},{"localvar":"my","definition":"my","name":"$TID","containerName":"add_allowdeny_ips","line":1355,"kind":13},{"name":"tid","containerName":"add_allowdeny_ips","line":1355,"kind":12},{"name":"$args","containerName":"add_allowdeny_ips","line":1357,"kind":13},{"kind":13,"name":"$logger","line":1358,"containerName":"add_allowdeny_ips"},{"name":"error","containerName":"add_allowdeny_ips","line":1358,"kind":12},{"localvar":"my","line":1361,"containerName":"add_allowdeny_ips","definition":"my","name":"$chain","kind":13},{"name":"$args","containerName":"add_allowdeny_ips","line":1361,"kind":13},{"localvar":"my","name":"%ip_rules","definition":"my","containerName":"add_allowdeny_ips","line":1363,"kind":13},{"kind":13,"name":"$args","containerName":"add_allowdeny_ips","line":1364},{"kind":13,"name":"$args","line":1365,"containerName":"add_allowdeny_ips"},{"line":1368,"containerName":"add_allowdeny_ips","name":"@allowdenyorder","definition":"my","localvar":"my","kind":13},{"kind":13,"name":"$args","line":1369,"containerName":"add_allowdeny_ips"},{"name":"@allowdenyorder","line":1370,"containerName":"add_allowdeny_ips","kind":13},{"kind":13,"containerName":"add_allowdeny_ips","line":1373,"name":"$logger"},{"kind":12,"containerName":"add_allowdeny_ips","line":1373,"name":"debug"},{"kind":13,"name":"%ip_rules","containerName":"add_allowdeny_ips","line":1373},{"kind":13,"line":1373,"containerName":"add_allowdeny_ips","name":"$logger"},{"containerName":"add_allowdeny_ips","line":1373,"name":"is_debug","kind":12},{"kind":13,"localvar":"my","definition":"my","name":"$action","line":1376,"containerName":"add_allowdeny_ips"},{"line":1376,"containerName":"add_allowdeny_ips","name":"@allowdenyorder","kind":13},{"name":"$logger","containerName":"add_allowdeny_ips","line":1377,"kind":13},{"kind":12,"name":"debug","line":1377,"containerName":"add_allowdeny_ips"},{"kind":13,"localvar":"my","name":"$chain","definition":"my","containerName":"add_allowdeny_ips","line":1380},{"kind":13,"name":"$args","line":1380,"containerName":"add_allowdeny_ips"},{"kind":13,"localvar":"my","line":1381,"containerName":"add_allowdeny_ips","definition":"my","name":"$rule_action"},{"name":"$action","containerName":"add_allowdeny_ips","line":1381,"kind":13},{"containerName":"add_allowdeny_ips","line":1382,"name":"$ip","definition":"my","localvar":"my","kind":13},{"line":1382,"containerName":"add_allowdeny_ips","name":"$ip_rules","kind":13},{"line":1382,"containerName":"add_allowdeny_ips","name":"$action","kind":13},{"line":1383,"containerName":"add_allowdeny_ips","name":"$logger","kind":13},{"containerName":"add_allowdeny_ips","line":1383,"name":"debug","kind":12},{"kind":13,"line":1384,"containerName":"add_allowdeny_ips","definition":"my","name":"$direction","localvar":"my"},{"kind":13,"definition":"my","name":"$rule","line":1385,"containerName":"add_allowdeny_ips","localvar":"my"},{"localvar":"my","containerName":"add_allowdeny_ips","line":1386,"name":"$args","definition":"my","kind":13},{"kind":13,"name":"$rule","containerName":"add_allowdeny_ips","line":1386},{"kind":13,"containerName":"add_allowdeny_ips","line":1387,"name":"$logger"},{"name":"debug","line":1387,"containerName":"add_allowdeny_ips","kind":12},{"kind":13,"containerName":"add_allowdeny_ips","line":1388,"name":"$self"},{"kind":12,"name":"iptablesqueue_enqueue","containerName":"add_allowdeny_ips","line":1388},{"kind":13,"containerName":"add_allowdeny_ips","line":1388,"name":"$args"}],"detail":"()","signature":{"label":"add_allowdeny_ips()","parameters":[],"documentation":" Description:  Adds the IPs to DROP or ACCEPT to the chain provided\n Returns:  1\n Requires: $args to be a hash reference with the following optional keys:\n  chain:  The chain to add the rules to.  If no chain provided then the default is ipblocker_global\n  allowlist:  An array of IPs to allow\n  denylist:  An array of IPs to deny\n  allowdenyorder:  The order to add the allow and deny rules"},"kind":12,"range":{"start":{"character":0,"line":1353},"end":{"character":9999,"line":1391}},"line":1353,"containerName":"Net::IPBlocker","definition":"sub","name":"add_allowdeny_ips"},{"kind":12,"name":"threads","line":1355},{"line":1361,"name":"chain","kind":12},{"name":"allow","line":1364,"kind":12},{"name":"allowlist","line":1364,"kind":12},{"kind":12,"name":"deny","line":1365},{"kind":12,"line":1365,"name":"denylist"},{"name":"allowdeny","line":1369,"kind":12},{"name":"Dumper","line":1373,"kind":12},{"kind":12,"name":"chain","line":1380},{"name":"rule","line":1386,"kind":12},{"kind":12,"line":1386,"name":"options"},{"detail":"()","children":[{"kind":13,"name":"$self","definition":"my","containerName":"add_global_allow_deny_ips","line":1399,"localvar":"my"},{"localvar":"my","name":"$TID","definition":"my","line":1400,"containerName":"add_global_allow_deny_ips","kind":13},{"kind":12,"name":"tid","line":1400,"containerName":"add_global_allow_deny_ips"},{"containerName":"add_global_allow_deny_ips","line":1402,"name":"$logger","kind":13},{"kind":12,"name":"debug","containerName":"add_global_allow_deny_ips","line":1402},{"kind":13,"name":"$chain","definition":"my","line":1403,"containerName":"add_global_allow_deny_ips","localvar":"my"},{"name":"$self","containerName":"add_global_allow_deny_ips","line":1403,"kind":13},{"kind":13,"localvar":"my","line":1404,"containerName":"add_global_allow_deny_ips","definition":"my","name":"@allowlist"},{"name":"$self","containerName":"add_global_allow_deny_ips","line":1404,"kind":13},{"kind":13,"line":1404,"containerName":"add_global_allow_deny_ips","name":"$self"}],"signature":{"documentation":" Description:  Adds the IPs to block or accept from the configs global allowlist and global denylist to the global chain\n Returns:  1","parameters":[],"label":"add_global_allow_deny_ips()"},"kind":12,"name":"add_global_allow_deny_ips","definition":"sub","range":{"start":{"character":0,"line":1398},"end":{"character":9999,"line":1404}},"line":1398,"containerName":"Net::IPBlocker"},{"line":1400,"name":"threads","kind":12},{"name":"configs","line":1403,"kind":12},{"name":"chainprefix","line":1403,"kind":12},{"kind":12,"line":1404,"name":"configs"},{"line":1404,"name":"allowlist","kind":12},{"name":"configs","line":1404,"kind":12},{"line":1404,"name":"allowlist","kind":12},{"kind":13,"line":1405,"containerName":null,"name":"@denylist","definition":"my","localvar":"my"},{"kind":13,"line":1405,"containerName":null,"name":"%self"},{"kind":12,"name":"configs","line":1405},{"kind":12,"line":1405,"name":"denylist"},{"line":1405,"containerName":null,"name":"%self","kind":13},{"name":"configs","line":1405,"kind":12},{"name":"denylist","line":1405,"kind":12},{"kind":13,"localvar":"my","name":"$allowdeny","definition":"my","containerName":null,"line":1406},{"kind":13,"name":"%self","containerName":null,"line":1406},{"line":1406,"name":"configs","kind":12},{"line":1406,"name":"allowdeny","kind":12},{"localvar":"my","definition":"my","name":"%args","containerName":null,"line":1408,"kind":13},{"name":"chain","line":1409,"kind":12},{"kind":13,"containerName":null,"line":1409,"name":"$chain"},{"kind":12,"line":1410,"name":"allowlist"},{"kind":13,"line":1410,"containerName":null,"name":"@allowlist"},{"name":"denylist","line":1411,"kind":12},{"name":"@denylist","line":1411,"containerName":null,"kind":13},{"kind":12,"name":"allowdeny","line":1412},{"kind":13,"containerName":null,"line":1413,"name":"$allowdeny"},{"kind":13,"name":"$logger","line":1415,"containerName":null},{"name":"debug","line":1415,"containerName":"Net::IPBlocker","kind":12},{"name":"Dumper","line":1415,"kind":12},{"name":"$args","containerName":null,"line":1415,"kind":13},{"kind":13,"name":"$logger","line":1415,"containerName":null},{"kind":12,"line":1415,"containerName":"Net::IPBlocker","name":"is_debug"},{"kind":13,"containerName":null,"line":1417,"name":"$self"},{"name":"add_allowdeny_ips","line":1417,"containerName":"Net::IPBlocker","kind":12},{"kind":13,"line":1417,"containerName":null,"name":"$args"},{"name":"add_logger_allow_deny_ips","definition":"sub","range":{"start":{"character":0,"line":1420},"end":{"line":1426,"character":9999}},"containerName":"Net::IPBlocker","line":1420,"kind":12,"signature":{"parameters":[],"label":"add_logger_allow_deny_ips()","documentation":""},"detail":"()","children":[{"kind":13,"line":1421,"containerName":"add_logger_allow_deny_ips","definition":"my","name":"$self","localvar":"my"},{"line":1421,"containerName":"add_logger_allow_deny_ips","name":"$logobj","kind":13},{"kind":13,"localvar":"my","line":1422,"containerName":"add_logger_allow_deny_ips","name":"$TID","definition":"my"},{"containerName":"add_logger_allow_deny_ips","line":1422,"name":"tid","kind":12},{"kind":13,"containerName":"add_logger_allow_deny_ips","line":1424,"name":"$logger"},{"name":"debug","line":1424,"containerName":"add_logger_allow_deny_ips","kind":12},{"containerName":"add_logger_allow_deny_ips","line":1425,"name":"$chain","definition":"my","localvar":"my","kind":13},{"kind":13,"containerName":"add_logger_allow_deny_ips","line":1425,"name":"$self"},{"kind":13,"name":"$logobj","containerName":"add_logger_allow_deny_ips","line":1425},{"kind":13,"localvar":"my","name":"@allowlist","definition":"my","line":1426,"containerName":"add_logger_allow_deny_ips"},{"containerName":"add_logger_allow_deny_ips","line":1426,"name":"$logobj","kind":13},{"name":"$logobj","containerName":"add_logger_allow_deny_ips","line":1426,"kind":13}]},{"kind":12,"name":"threads","line":1422},{"name":"configs","line":1425,"kind":12},{"line":1425,"name":"chainprefix","kind":12},{"kind":12,"line":1425,"name":"chain"},{"name":"allowlist","line":1426,"kind":12},{"kind":12,"name":"allowlist","line":1426},{"kind":13,"name":"@denylist","definition":"my","containerName":null,"line":1427,"localvar":"my"},{"name":"%logobj","line":1427,"containerName":null,"kind":13},{"kind":12,"line":1427,"name":"denylist"},{"kind":13,"name":"%logobj","containerName":null,"line":1427},{"kind":12,"name":"denylist","line":1427},{"name":"$allowdeny","definition":"my","line":1428,"containerName":null,"localvar":"my","kind":13},{"kind":13,"name":"%logobj","line":1428,"containerName":null},{"line":1428,"name":"allowdeny","kind":12},{"kind":13,"name":"%args","definition":"my","line":1430,"containerName":null,"localvar":"my"},{"name":"chain","line":1431,"kind":12},{"name":"$chain","line":1431,"containerName":null,"kind":13},{"name":"allowlist","line":1432,"kind":12},{"kind":13,"name":"@allowlist","line":1432,"containerName":null},{"kind":12,"line":1433,"name":"denylist"},{"name":"@denylist","containerName":null,"line":1433,"kind":13},{"kind":12,"name":"allowdeny","line":1434},{"containerName":null,"line":1435,"name":"$allowdeny","kind":13},{"name":"$logger","line":1437,"containerName":null,"kind":13},{"name":"debug","line":1437,"containerName":"Net::IPBlocker","kind":12},{"kind":12,"line":1437,"name":"Dumper"},{"name":"$args","containerName":null,"line":1437,"kind":13},{"kind":13,"name":"$logger","containerName":null,"line":1437},{"name":"is_debug","line":1437,"containerName":"Net::IPBlocker","kind":12},{"name":"$self","line":1439,"containerName":null,"kind":13},{"name":"add_allowdeny_ips","line":1439,"containerName":"Net::IPBlocker","kind":12},{"name":"$args","line":1439,"containerName":null,"kind":13},{"signature":{"documentation":" sub add_global_allow_deny_ips {\n     my ($self) = @_;\n     my $TID = \"TID: \" . threads->tid;\n     $logger->debug(\"$TID|Adding global allow/deny IPs to global chains\");\n     my %ip_rules = (\n         allow => $self->{configs}->{allowlist} || {},\n         deny  => $self->{configs}->{denylist}  || {}\n     );\n     $logger->debug(\"$TID|IP rules: \" . Dumper(\\%ip_rules)) if $logger->is_debug();\n     foreach my $action (keys %ip_rules) {\n         my $chain = \"ipblocker_global\" . $action;\n         my $rule_action = $action eq 'allow' ? 'ACCEPT' : 'DROP';\n         foreach my $ruleorder (sort keys %{$ip_rules{$action}}) {\n             my $ip = $ip_rules{$action}{$ruleorder};\n             foreach my $direction ('-s', '-d') {\n                 # my $chain = $chain_prefix . ($direction eq '-s' ? '' : 'regex') . $action;\n                 my $rule = \"$chain $direction $ip -j $rule_action\";\n                 my $args = { rule => $rule, options => \"-w -A\" };\n                 $logger->debug(\"$TID|Adding >>-w -A $rule<< to iptables queue\");\n                 $self->iptablesqueue_enqueue($args);\n             }\n         }\n     }\n     return 1;\n }\n Stops the module\n  Future enhancements:\n   Clear the thread queues","parameters":[],"label":"stop()"},"kind":12,"line":1477,"range":{"start":{"line":1477,"character":0},"end":{"character":9999,"line":1498}},"containerName":"Net::IPBlocker","name":"stop","definition":"sub","children":[{"kind":13,"definition":"my","name":"$self","line":1478,"containerName":"stop","localvar":"my"},{"kind":13,"line":1478,"containerName":"stop","name":"$args"},{"localvar":"my","name":"$TID","definition":"my","containerName":"stop","line":1479,"kind":13},{"kind":12,"containerName":"stop","line":1479,"name":"tid"},{"name":"$TID","containerName":"stop","line":1480,"kind":13},{"containerName":"stop","line":1480,"name":"$TID","kind":13},{"kind":13,"name":"$logger","containerName":"stop","line":1481},{"name":"info","containerName":"stop","line":1481,"kind":12},{"localvar":"my","definition":"my","name":"$chains_created","containerName":"stop","line":1483,"kind":13},{"kind":13,"line":1483,"containerName":"stop","name":"$args"},{"name":"$logger","line":1484,"containerName":"stop","kind":13},{"kind":12,"name":"debug","line":1484,"containerName":"stop"},{"kind":13,"containerName":"stop","line":1484,"name":"$tracker"},{"kind":13,"name":"$logger","line":1484,"containerName":"stop"},{"kind":12,"line":1484,"containerName":"stop","name":"is_debug"},{"kind":13,"name":"$self","containerName":"stop","line":1487},{"name":"$chains_created","containerName":"stop","line":1487,"kind":13},{"kind":13,"line":1488,"containerName":"stop","name":"$logger"},{"name":"info","line":1488,"containerName":"stop","kind":12},{"kind":13,"line":1489,"containerName":"stop","definition":"my","name":"$chain","localvar":"my"},{"name":"$self","containerName":"stop","line":1489,"kind":13},{"kind":13,"containerName":"stop","line":1490,"name":"$logger"},{"name":"info","line":1490,"containerName":"stop","kind":12},{"kind":13,"name":"$IptablesQueue","line":1491,"containerName":"stop"},{"kind":12,"line":1491,"containerName":"stop","name":"enqueue"}],"detail":"()"},{"name":"threads","line":1479,"kind":12},{"kind":12,"name":"chains_created","line":1483},{"kind":12,"name":"Dumper","line":1484},{"line":1487,"name":"chains_created","kind":12},{"name":"chains_created","line":1489,"kind":12},{"kind":12,"name":"options","line":1493},{"kind":12,"name":"rule","line":1494},{"line":1500,"containerName":null,"name":"$logger","kind":13},{"kind":12,"containerName":"Net::IPBlocker","line":1500,"name":"info"},{"kind":13,"containerName":null,"line":1503,"name":"$logger"},{"kind":12,"line":1503,"containerName":"Net::IPBlocker","name":"info"},{"name":"clear_queues","line":1504,"kind":12},{"containerName":null,"line":1504,"name":"$logger","kind":13},{"kind":12,"line":1504,"containerName":"Net::IPBlocker","name":"error"},{"kind":13,"line":1505,"containerName":null,"name":"$logger"},{"containerName":"Net::IPBlocker","line":1505,"name":"info","kind":12},{"kind":12,"name":"join_threads","line":1506},{"kind":13,"name":"$logger","line":1506,"containerName":null},{"name":"error","line":1506,"containerName":"Net::IPBlocker","kind":12},{"name":"$logger","containerName":null,"line":1508,"kind":13},{"kind":12,"name":"info","containerName":"Net::IPBlocker","line":1508},{"kind":13,"line":1509,"containerName":null,"name":"$lock_obj"},{"kind":12,"name":"release","line":1509,"containerName":"Net::IPBlocker"},{"kind":13,"containerName":null,"line":1510,"name":"$logger"},{"kind":12,"name":"info","line":1510,"containerName":"Net::IPBlocker"},{"detail":"()","children":[{"name":"$TID","definition":"my","containerName":"join_threads","line":1520,"localvar":"my","kind":13},{"name":"tid","containerName":"join_threads","line":1520,"kind":12},{"kind":13,"line":1521,"containerName":"join_threads","name":"$TID"},{"line":1521,"containerName":"join_threads","name":"$TID","kind":13},{"name":"$logger","line":1522,"containerName":"join_threads","kind":13},{"name":"debug","line":1522,"containerName":"join_threads","kind":12},{"kind":12,"name":"join","containerName":"join_threads","line":1523},{"name":"list","containerName":"join_threads","line":1523,"kind":12}],"kind":12,"signature":{"label":"join_threads()","parameters":[],"documentation":" Joins all threads\n   Simple sub but really needs some rework\n   If a thread is taking a while to join then it will block the other threads from joining\n   Some of the threads could be reading a log file and if the log file is large then it could take a while or\n   if the log file is causing soem kind of blocking for reading then it could take a while.\n   This may be an issue, if an example, if trying to read a file across NFS or SSHFS and there is a network issue."},"name":"join_threads","definition":"sub","range":{"end":{"character":9999,"line":1525},"start":{"character":0,"line":1519}},"line":1519,"containerName":"Net::IPBlocker"},{"name":"threads","line":1520,"kind":12},{"kind":12,"line":1523,"name":"threads"},{"children":[{"kind":13,"definition":"my","name":"$TID","line":1529,"containerName":"clear_queues","localvar":"my"},{"containerName":"clear_queues","line":1529,"name":"tid","kind":12},{"kind":13,"name":"$TID","containerName":"clear_queues","line":1530},{"kind":13,"name":"$TID","line":1530,"containerName":"clear_queues"},{"kind":13,"line":1531,"containerName":"clear_queues","name":"$logger"},{"line":1531,"containerName":"clear_queues","name":"debug","kind":12},{"name":"$DataQueue","containerName":"clear_queues","line":1532,"kind":13},{"kind":12,"name":"end","containerName":"clear_queues","line":1532},{"kind":13,"line":1533,"containerName":"clear_queues","name":"$IptablesQueue"},{"containerName":"clear_queues","line":1533,"name":"end","kind":12},{"kind":13,"name":"$DataQueue","line":1534,"containerName":"clear_queues"},{"kind":12,"containerName":"clear_queues","line":1534,"name":"pending"},{"name":"$IptablesQueue","line":1534,"containerName":"clear_queues","kind":13},{"kind":12,"line":1534,"containerName":"clear_queues","name":"pending"},{"containerName":"clear_queues","line":1535,"name":"$DataQueue","kind":13},{"name":"pending","containerName":"clear_queues","line":1535,"kind":12},{"kind":13,"line":1535,"containerName":"clear_queues","name":"$logger"},{"kind":12,"line":1535,"containerName":"clear_queues","name":"debug"},{"containerName":"clear_queues","line":1536,"name":"$IptablesQueue","kind":13},{"kind":12,"name":"pending","containerName":"clear_queues","line":1536},{"kind":13,"line":1536,"containerName":"clear_queues","name":"$logger"},{"kind":12,"containerName":"clear_queues","line":1536,"name":"debug"},{"kind":13,"line":1540,"containerName":"clear_queues","name":"$DataQueue"},{"kind":12,"line":1540,"containerName":"clear_queues","name":"pending"},{"kind":13,"name":"$IptablesQueue","line":1540,"containerName":"clear_queues"},{"kind":12,"containerName":"clear_queues","line":1540,"name":"pending"},{"kind":13,"name":"$logger","containerName":"clear_queues","line":1541},{"line":1541,"containerName":"clear_queues","name":"error","kind":12},{"kind":13,"name":"$logger","line":1545,"containerName":"clear_queues"},{"kind":12,"line":1545,"containerName":"clear_queues","name":"debug"}],"detail":"()","signature":{"documentation":" Clears the queues","label":"clear_queues()","parameters":[]},"kind":12,"range":{"start":{"character":0,"line":1528},"end":{"line":1548,"character":9999}},"containerName":"Net::IPBlocker","line":1528,"name":"clear_queues","definition":"sub"},{"line":1529,"name":"threads","kind":12},{"detail":"()","children":[{"kind":13,"definition":"my","name":"$TID","line":1551,"containerName":"reload","localvar":"my"},{"name":"tid","containerName":"reload","line":1551,"kind":12},{"containerName":"reload","line":1552,"name":"$TID","kind":13},{"kind":13,"line":1552,"containerName":"reload","name":"$TID"},{"line":1553,"containerName":"reload","name":"$logger","kind":13},{"kind":12,"line":1553,"containerName":"reload","name":"info"}],"kind":12,"signature":{"documentation":"","label":"reload()","parameters":[]},"definition":"sub","name":"reload","line":1550,"range":{"start":{"line":1550,"character":0},"end":{"line":1577,"character":9999}},"containerName":"Net::IPBlocker"},{"kind":12,"name":"threads","line":1551},{"children":[{"name":"$logger","line":1582,"containerName":"SIG_INT","kind":13},{"name":"info","line":1582,"containerName":"SIG_INT","kind":12}],"name":"SIG_INT","definition":"sub","range":{"end":{"line":1585,"character":9999},"start":{"character":0,"line":1581}},"containerName":"Net::IPBlocker","line":1581,"kind":12},{"children":[{"name":"$logger","line":1590,"containerName":"SIG_HUP","kind":13},{"containerName":"SIG_HUP","line":1590,"name":"info","kind":12}],"name":"SIG_HUP","definition":"sub","range":{"start":{"character":0,"line":1589},"end":{"character":9999,"line":1592}},"line":1589,"containerName":"Net::IPBlocker","kind":12},{"children":[{"name":"$logger","line":1597,"containerName":"SIG_TERM","kind":13},{"line":1597,"containerName":"SIG_TERM","name":"info","kind":12}],"kind":12,"name":"SIG_TERM","definition":"sub","containerName":"Net::IPBlocker","range":{"end":{"line":1599,"character":9999},"start":{"character":0,"line":1596}},"line":1596},{"definition":"sub","name":"SIG_QUIT","line":1603,"range":{"end":{"character":9999,"line":1606},"start":{"character":0,"line":1603}},"containerName":"Net::IPBlocker","kind":12,"children":[{"localvar":"my","definition":"my","name":"$self","containerName":"SIG_QUIT","line":1604,"kind":13}]},{"children":[{"kind":13,"containerName":"set_signal_handler","line":1609,"name":"$logger"},{"kind":12,"name":"info","line":1609,"containerName":"set_signal_handler"},{"kind":13,"containerName":"set_signal_handler","line":1611,"name":"$SIG"},{"name":"$SIG","line":1612,"containerName":"set_signal_handler","kind":13},{"containerName":"set_signal_handler","line":1613,"name":"$SIG","kind":13},{"line":1614,"containerName":"set_signal_handler","name":"$SIG","kind":13}],"detail":"()","kind":12,"signature":{"documentation":"","parameters":[],"label":"set_signal_handler()"},"line":1608,"range":{"end":{"character":9999,"line":1615},"start":{"line":1608,"character":0}},"containerName":"Net::IPBlocker","definition":"sub","name":"set_signal_handler"},{"name":"INT","line":1611,"kind":12},{"name":"TERM","line":1612,"kind":12},{"kind":12,"name":"HUP","line":1613},{"kind":12,"name":"QUIT","line":1614}]}